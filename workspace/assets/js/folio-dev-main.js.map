{
  "version": 3,
  "sources": [
    "../../node_modules/browser-pack/_prelude.js",
    "../../node_modules/underscore.string/capitalize.js",
    "../../node_modules/underscore.string/dasherize.js",
    "../../node_modules/underscore.string/helper/defaultToWhiteSpace.js",
    "../../node_modules/underscore.string/helper/escapeRegExp.js",
    "../../node_modules/underscore.string/helper/makeString.js",
    "../../node_modules/underscore.string/helper/strRepeat.js",
    "../../node_modules/underscore.string/lpad.js",
    "../../node_modules/underscore.string/pad.js",
    "../../node_modules/underscore.string/rpad.js",
    "../../node_modules/underscore.string/trim.js",
    "app/App.js",
    "app/control/Controller.js",
    "app/control/Globals.js",
    "app/debug/DebugToolbar.js",
    "app/debug/template/DebugToolbar.SVGGrid.hbs",
    "app/debug/template/DebugToolbar.hbs",
    "app/model/AppState.js",
    "app/model/BaseItem.js",
    "app/model/BaseModel.js",
    "app/model/SelectableCollection.js",
    "app/model/collection/ArticleCollection.js",
    "app/model/collection/BundleCollection.js",
    "app/model/collection/KeywordCollection.js",
    "app/model/collection/TypeCollection.js",
    "app/model/helper/bootstrap.js",
    "app/model/item/ArticleItem.js",
    "app/model/item/BundleItem.js",
    "app/model/item/KeywordItem.js",
    "app/model/item/MediaItem.js",
    "app/model/item/SourceItem.js",
    "app/model/item/TypeItem.js",
    "app/view/AppView.js",
    "app/view/ContentView.js",
    "app/view/NavigationView.js",
    "app/view/base/CallbackQueue.js",
    "app/view/base/CanvasView.js",
    "app/view/base/Interpolator.js",
    "app/view/base/PrefixedEvents.js",
    "app/view/base/TouchManager.js",
    "app/view/base/View.js",
    "app/view/base/ViewError.js",
    "app/view/component/ArticleButton.hbs",
    "app/view/component/ArticleButton.js",
    "app/view/component/ArticleView.js",
    "app/view/component/CanvasProgressMeter.js",
    "app/view/component/Carousel.js",
    "app/view/component/CollectionStack.hbs",
    "app/view/component/CollectionStack.js",
    "app/view/component/FilterableListView.js",
    "app/view/component/GraphView.js",
    "app/view/component/GroupingListView.js",
    "app/view/component/PlayToggleSymbol.js",
    "app/view/component/SelectableListView.js",
    "app/view/helper/createColorStyleSheet.js",
    "app/view/promise/_loadImageAsObjectURL.js",
    "app/view/promise/_whenImageLoads.js",
    "app/view/promise/whenDefaultImageLoads.js",
    "app/view/promise/whenScrollingEnds.js",
    "app/view/promise/whenSelectionDistanceIs.js",
    "app/view/promise/whenSelectionIsContiguous.js",
    "app/view/promise/whenViewIsAttached.js",
    "app/view/promise/whenViewIsRendered.js",
    "app/view/render/CarouselRenderer.js",
    "app/view/render/ClickableRenderer.js",
    "app/view/render/DefaultSelectableRenderer.hbs",
    "app/view/render/DefaultSelectableRenderer.js",
    "app/view/render/DotNavigationRenderer.hbs",
    "app/view/render/DotNavigationRenderer.js",
    "app/view/render/ImageRenderer.hbs",
    "app/view/render/ImageRenderer.js",
    "app/view/render/LabelRenderer.js",
    "app/view/render/MediaRenderer.js",
    "app/view/render/PlayableRenderer.js",
    "app/view/render/SequenceRenderer.hbs",
    "app/view/render/SequenceRenderer.js",
    "app/view/render/VideoRenderer.hbs",
    "app/view/render/VideoRenderer.js",
    "app/view/template/Carousel.EmptyRenderer.Bundle.hbs",
    "app/view/template/CollectionStack.Media.hbs",
    "app/view/template/ErrorBlock.hbs",
    "app/view/template/_helpers.js",
    "app/view/template/svg/CogSymbol.hbs",
    "app/view/template/svg/FullscreenSymbol.hbs",
    "utils/Timer.js",
    "utils/TransformHelper.js",
    "utils/TransformItem.js",
    "utils/array/difference.js",
    "utils/canvas/CanvasHelper.js",
    "utils/canvas/bitmap/BlurStack.js",
    "utils/canvas/bitmap/desaturate.js",
    "utils/canvas/bitmap/getAverageRGB.js",
    "utils/canvas/bitmap/mul_table.js",
    "utils/canvas/bitmap/multiply.js",
    "utils/canvas/bitmap/shg_table.js",
    "utils/canvas/bitmap/stackBlurRGB.js",
    "utils/canvas/calcArcHConnector.js",
    "utils/css/getBoxEdgeStyles.js",
    "utils/ease/fn/easeInQuad.js",
    "utils/ease/fn/easeOutQuad.js",
    "utils/ease/fn/linear.js",
    "utils/event/mediaEventsEnum.js",
    "utils/geom/inflateRect.js",
    "utils/prefixedEvent.js",
    "utils/prefixedProperty.js",
    "utils/prefixedStyleName.js",
    "utils/prefixes.js",
    "utils/promise/rejectAll.js",
    "utils/promise/resolveAll.js",
    "utils/strings/camelToDashed.js",
    "utils/strings/stripTags.js",
    "utils/touch/SmoothPanRecognizer.js",
    "../sass/variables.json"
  ],
  "names": [],
  "mappings": "AAAA;ACAA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;ACRA;AACA;AACA;AACA;AACA;AACA;;ACLA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;ACVA;AACA;AACA;AACA;AACA;AACA;;ACLA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;ACPA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;ACTA;AACA;AACA;AACA;AACA;AACA;;ACLA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;AC1BA;AACA;AACA;AACA;AACA;AACA;;ACLA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;;ACVA;;;AAGA;;AAEA,OAAO,CAAC,IAAR,qCAA0C,OAA1C,G,CAEA;AACA;AACA;AACA;AACA;;AAEA,IAAI,KAAJ,EAAW;AACV,EAAA,OAAO,CAAC,WAAD,CAAP;AACA;;AACD,OAAO,CAAC,cAAD,CAAP;;AACA,OAAO,CAAC,kBAAD,CAAP;;AACA,OAAO,CAAC,oBAAD,CAAP;;AACA,OAAO,CAAC,cAAD,CAAP;;AACA,OAAO,CAAC,kBAAD,CAAP;;AACA,OAAO,CAAC,qBAAD,CAAP;;AACA,OAAO,CAAC,oBAAD,CAAP,C,CACA;;;AACA,OAAO,CAAC,mBAAD,CAAP;;AAEA,OAAO,CAAC,UAAD,CAAP,CAAoB,CAApB,GAAwB,OAAO,CAAC,iBAAD,CAA/B;;AACA,OAAO,CAAC,qBAAD,CAAP;;AACA,OAAO,CAAC,mBAAD,CAAP;;AACA,OAAO,CAAC,UAAD,CAAP,C,CAEA;AACA;AACA;;;AAEA,MAAM,CAAC,gBAAP,CAAwB,MAAxB,EAAgC,UAAS,EAAT,EAAa;AAC5C,EAAA,OAAO,CAAC,GAAR,CAAY,eAAZ,EAA6B,EAAE,CAAC,MAAhC,EAAwC,EAAE,CAAC,IAA3C,EAD4C,CAG5C;;AACA,MAAI;AACH,IAAA,OAAO,CAAC,4BAAD,CAAP,CAAsC,MAAM,CAAC,SAA7C;AACA,GAFD,CAEE,OAAO,GAAP,EAAY;AACb,QAAI,EAAE,GAAG,QAAQ,CAAC,aAAT,CAAuB,MAAvB,CAAT;AACA,IAAA,EAAE,CAAC,SAAH,CAAa,MAAb,CAAoB,aAApB;AACA,IAAA,EAAE,CAAC,SAAH,CAAa,GAAb,CAAiB,WAAjB;AACA,UAAM,IAAI,KAAJ,CAAU,2BAA2B,GAAG,CAAC,OAA/B,GAAyC,GAAnD,EAAwD,GAAG,CAAC,QAA5D,EAAsE,GAAG,CAAC,UAA1E,CAAN;AACA,GAPD,SAOU;AAAE;AACX,WAAO,MAAM,CAAC,SAAd;AACA;;AAED,EAAA,OAAO,CAAC,4BAAD,CAAP;AAEA;;;AACA,EAAA,OAAO,CAAC,uCAAD,CAAP,CAAiD,IAAjD;AAAyD;;;AACzD,MAAI,OAAO,GAAG,OAAO,CAAC,kBAAD,CAArB,CAnB4C,CAoB5C;;AAEA;;;AACA,MAAI,OAAO,GAAG,OAAO,CAAC,eAAD,CAArB;;AACA,MAAI,QAAQ,GAAG;AACd,IAAA,KAAK,EAAE,KADO;AAEd,IAAA,SAAS,EAAE,EAFG;AAGd,IAAA,OAAO,EAAE,KAHK;AAId,IAAA,OAAO,EAAE,mBAAW;AACnB,MAAA,OAAO,CAAC,GAAR,CAAY,oBAAZ,EAAkC,KAAK,SAAvC;AACA,KANa;AAOd,IAAA,MAAM,EAAE,kBAAW;AAClB,MAAA,OAAO,CAAC,IAAR,CAAa,mBAAb,EAAkC,KAAK,SAAvC;AACA,KATa;AAUd,IAAA,QAAQ,EAAE,oBAAW;AACpB,MAAA,OAAO,CAAC,IAAR,CAAa,qBAAb,EAAoC,KAAK,SAAzC;AACA,KAZa;AAad,IAAA,UAAU,EAAE,oBAAS,UAAT,EAAqB,UAArB,EAAiC;AAC5C,MAAA,OAAO,CAAC,IAAR,CAAa,iCAAb,EAAgD,KAAK,SAArD,EAAgE,UAAhE,EAA4E,UAA5E;AACA,KAfa;AAgBd,IAAA,YAAY,EAAE,sBAAS,UAAT,EAAqB,UAArB,EAAiC;AAC9C,MAAA,OAAO,CAAC,IAAR,CAAa,mCAAb,EAAkD,KAAK,SAAvD,EAAkE,UAAlE,EAA8E,UAA9E;AACA,KAlBa,CAmBd;AACA;AACA;;AArBc,GAAf;AAwBA,EAAA,OAAO,CAAC,IAAR,CAAa,CAAC,CAAC,QAAF,CAAW;AACvB,IAAA,KAAK,EAAE,KADgB;AAEvB,IAAA,SAAS,EAAE,UAFY;AAGvB,IAAA,MAAM,EAAE;AACP,MAAA,QAAQ,EAAE,CACT,wBADS,EAET;AACA,uBAHS,CADH;AAMP,MAAA,WAAW,EAAE;AACZ,wBAAgB;AADJ;AANN,KAHe;AAavB,IAAA,MAAM,EAAE;AAAA,aAAM,OAAO,CAAC,WAAR,EAAN;AAAA,KAbe;AAcvB,IAAA,QAAQ,EAAE;AAAA,aAAM,OAAO,CAAC,WAAR,EAAN;AAAA;AAda,GAAX,EAeV,QAfU,CAAb;AAiBA,EAAA,OAAO,CAAC,IAAR,CAAa,CAAC,CAAC,QAAF,CAAW,EAAX,EAAe,QAAf,CAAb,EAjE4C,CAmE5C;AACA;AACA;AACA,CAtED;;AAyEA,IAAI,KAAJ,EAAW,CACV;AACA;AAEA;AACA;;AACA;;;;;;;;;;;;;;;;AAeA;;;;;;;;;;;;;AAcA;;AACA;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;AA8BA;;;;;;AC9KD;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;;;;ACpQA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;;;;AC/NA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;;;ACjNA;AACA;AACA;AACA;AACA;AACA;;ACLA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;AC7CA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;;AC3JA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;;;;AC/FA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;;;;AC/EA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;;;AC9IA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;ACtBA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;ACtCA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;ACvBA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;;ACvBA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;;;AC9DA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;;ACzBA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;;;AC/GA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;;ACvCA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;;;;AC/IA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;;;AC9FA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;;AC1BA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;;;;ACrqBA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;;;;AC9jBA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;;;ACjgCA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;;AC3MA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;;;;AChWA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;;;;AChRA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;;;;ACrCA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;;;;AC1OA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;;;AC12BA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;ACVA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;ACbA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;AC3CA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;;AC1DA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;;;;ACldA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;;;ACthCA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;ACPA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;;ACnGA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;;;;AC3lBA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;;;;AC93BA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;;;;AC5MA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;;;AC3WA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;;ACtKA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;;;ACnOA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;ACzEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;;AC1CA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;;;AC1DA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;AChFA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;AC9CA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;ACVA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;ACXA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;;ACXA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;;;AChHA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;ACpDA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;ACXA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;ACtCA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;ACXA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;AC3DA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;ACXA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;ACjGA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;;AC5CA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;;;;AC5XA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;;;AC3sBA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;;ACXA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;;;AC3yBA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;;ACbA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;;;AChjCA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;ACXA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;ACbA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;ACrBA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;AC/FA;AACA;AACA;AACA;AACA;AACA;;ACLA;AACA;AACA;AACA;AACA;AACA;;;;;ACLA;AACA,IAAM,MAAM,GAAG,OAAO,CAAC,UAAD,CAAP,CAAoB,MAAnC,C,CAGA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;;AACA,IAAI,MAAM,GAAG,CAAb;;AAEA,IAAI,KAAK,GAAG,SAAR,KAAQ,CAAS,OAAT,EAAkB;AAC7B;AACA;AACA;AACA,OAAK,GAAL,GAAW,MAAM,EAAjB,CAJ6B,CAK7B;;AACA,OAAK,SAAL,GAAiB,CAAjB;AACA,OAAK,OAAL,GAAe,aAAf;AACA,OAAK,MAAL,GAAc,CAAd,CAR6B,CAS7B;AAEA;AACA;AACA;AACA;AACA,CAfD;;AAiBA,CAAC,CAAC,MAAF,CAAS,KAAK,CAAC,SAAf,EAA0B,MAA1B,EAAkC;AAEjC,EAAA,KAAK,EAAE,eAAS,QAAT,EAAmB;AACzB,QAAI,CAAC,CAAC,CAAC,QAAF,CAAW,QAAX,CAAD,IAAyB,CAAC,KAAK,SAAnC,EAA8C;AAC7C,aAAO,IAAP;AACA,KAHwB,CAIzB;;;AACA,QAAI,KAAK,QAAL,IAAiB,KAAK,OAAL,KAAiB,SAAtC,EAAiD;AAChD,aAAO,IAAP;AACA;;AACD,QAAI,MAAM,GAAI,KAAK,OAAL,KAAiB,SAAlB,GAA+B,OAA/B,GAAyC,QAAtD;AACA,SAAK,SAAL,GAAiB,QAAQ,IAAI,KAAK,SAAlC;AACA,SAAK,QAAL,GAAgB,MAAM,CAAC,UAAP,CAAkB,GAAG,CAAC,IAAJ,CAAS,IAAT,CAAlB,EAAkC,KAAK,SAAvC,CAAhB,CAVyB,CAWzB;AACA;AACA;AACA;AACA;;AACA,SAAK,MAAL,GAAc,IAAI,EAAlB;AACA,SAAK,OAAL,GAAe,SAAf;AACA,SAAK,OAAL,CAAa,MAAb,EAAqB,KAAK,WAAL,EAArB;AACA,WAAO,IAAP;AACA,GAtBgC;AAwBjC,EAAA,KAAK,EAAE,iBAAW;AACjB,QAAI,KAAK,OAAL,KAAiB,SAArB,EAAgC;AAC/B,aAAO,IAAP;AACA;;AACD,SAAK,SAAL,IAAmB,IAAI,KAAK,KAAK,MAAjC;AACA,IAAA,KAAK,CAAC,IAAN,CAAW,IAAX,EAAiB,KAAjB;AACA,SAAK,OAAL,GAAe,QAAf;AACA,SAAK,OAAL,CAAa,OAAb,EAAsB,KAAK,WAAL,EAAtB;AACA,WAAO,IAAP;AACA,GAjCgC;AAmCjC,EAAA,IAAI,EAAE,gBAAW;AAChB,QAAI,CAAC,iBAAiB,IAAjB,CAAsB,KAAK,OAA3B,CAAL,EAA0C;AACzC,aAAO,IAAP;AACA;;AACD,IAAA,KAAK,CAAC,IAAN,CAAW,IAAX,EAAiB,IAAjB;AACA,SAAK,OAAL,GAAe,SAAf;AACA,SAAK,OAAL,CAAa,MAAb;AACA,WAAO,IAAP;AACA,GA3CgC;AA6CjC,EAAA,WAAW,EAAE,uBAAW;AACvB,QAAI,KAAK,OAAL,KAAiB,SAArB,EAAgC;AAC/B,aAAO,KAAK,SAAL,IAAkB,IAAI,KAAK,KAAK,MAAhC,CAAP;AACA;;AACD,QAAI,KAAK,OAAL,KAAiB,QAArB,EAA+B;AAC9B,aAAO,KAAK,SAAZ;AACA;;AACD,WAAO,CAAP;AACA,GArDgC;AAuDjC,EAAA,SAAS,EAAE,qBAAW;AACrB,WAAO,KAAK,OAAZ;AACA;AAzDgC,CAAlC;;AA4DA,IAAI,IAAI,GAAG,MAAM,CAAC,WAAP,GACV,MAAM,CAAC,WAAP,CAAmB,GAAnB,CAAuB,IAAvB,CAA4B,MAAM,CAAC,WAAnC,CADU,GAEV,IAAI,CAAC,GAAL,CAAS,IAAT,CAAc,IAAd,CAFD;;AAIA,SAAS,GAAT,GAAe;AACd,EAAA,KAAK,CAAC,IAAN,CAAW,IAAX;AACA,OAAK,OAAL,GAAe,SAAf;AACA,OAAK,OAAL,CAAa,KAAb;AACA;;AAED,SAAS,KAAT,CAAe,aAAf,EAA8B;AAC7B,EAAA,MAAM,CAAC,YAAP,CAAoB,KAAK,QAAzB,EAD6B,CAE7B;;AACA,MAAI,aAAa,KAAK,IAAtB,EAA4B;AAC3B,SAAK,SAAL,GAAiB,CAAjB;AACA;AACD;;AAED,MAAM,CAAC,gBAAP,CAAwB,KAAK,CAAC,SAA9B,EAAyC;AACxC,EAAA,QAAQ,EAAE;AACT,IAAA,UAAU,EAAE,IADH;AAET,IAAA,GAAG,EAAE,eAAW;AACf,aAAO,KAAK,WAAL,EAAP;AACA;AAJQ,GAD8B;AAOxC,EAAA,MAAM,EAAE;AACP,IAAA,UAAU,EAAE,IADL;AAEP,IAAA,GAAG,EAAE,eAAW;AACf,aAAO,KAAK,SAAL,EAAP;AACA;AAJM;AAPgC,CAAzC;AAeA,MAAM,CAAC,gBAAP,CAAwB,KAAxB,EAA+B;AAC9B,EAAA,OAAO,EAAE;AACR,IAAA,UAAU,EAAE,IADJ;AAER,IAAA,KAAK,EAAE;AAFC,GADqB;AAK9B,EAAA,OAAO,EAAE;AACR,IAAA,UAAU,EAAE,IADJ;AAER,IAAA,KAAK,EAAE;AAFC,GALqB;AAS9B,EAAA,MAAM,EAAE;AACP,IAAA,UAAU,EAAE,IADL;AAEP,IAAA,KAAK,EAAE;AAFA;AATsB,CAA/B;AAeA,MAAM,CAAC,OAAP,GAAiB,KAAjB;;;;;;;AC3IA;;;;AAGA;AACA,IAAM,aAAa,GAAG,OAAO,CAAC,iBAAD,CAA7B;;AAEA,IAAI,MAAM,GAAG,CAAb;AACA,IAAI,OAAO,GAAG,GAAd;AACA,IAAI,KAAK,GAAG,KAAK,CAAC,SAAN,CAAgB,KAA5B;AAEA;;;;;AAIA,SAAS,eAAT,GAA2B;AAC1B,OAAK,EAAL,GAAU,MAAM,EAAhB;AACA,OAAK,MAAL,GAAc,EAAd;AACA,OAAK,UAAL,GAAkB,EAAlB;AACA;;AAED,eAAe,CAAC,SAAhB,GAA4B,MAAM,CAAC,MAAP,CAAc;AAEzC;;;AAIA,EAAA,IAAI,EAAE,cAAS,EAAT,EAAa;AAClB,QAAI,KAAK,GAAL,CAAS,EAAT,CAAJ,EAAkB;AACjB,aAAO,KAAK,UAAL,CAAgB,EAAE,CAAC,GAAnB,CAAP;AACA,KAFD,MAEO;AACN,aAAO,KAAK,IAAL,CAAU,EAAV,CAAP;AACA;AACD,GAZwC;AAczC,EAAA,IAAI,EAAE,cAAS,EAAT,EAAa;AAClB,QAAI,IAAJ,EAAU,EAAV,CADkB,CAElB;AACA;AACA;AACA;AACA;AACA;AACA;;AACA,IAAA,EAAE,GAAG,EAAE,CAAC,GAAH,IAAU,EAAE,CAAC,GAAb,IAAqB,QAAQ,OAAO,EAAzC;AACA,IAAA,IAAI,GAAG,IAAI,aAAJ,CAAkB,EAAlB,EAAsB,EAAtB,CAAP;AACA,SAAK,UAAL,CAAgB,EAAhB,IAAsB,IAAtB;;AACA,SAAK,MAAL,CAAY,IAAZ,CAAiB,IAAjB;;AACA,WAAO,IAAP;AACA,GA5BwC;AA8BzC,EAAA,OAAO,EAAE,iBAAS,EAAT,EAAa;AACrB,QAAI,KAAK,GAAL,CAAS,EAAT,CAAJ,EAAkB;AACjB,UAAI,CAAC,GAAG,KAAK,UAAL,CAAgB,EAAE,CAAC,GAAnB,CAAR;;AACA,WAAK,MAAL,CAAY,MAAZ,CAAmB,KAAK,MAAL,CAAY,OAAZ,CAAoB,CAApB,CAAnB,EAA2C,CAA3C;;AACA,MAAA,CAAC,CAAC,OAAF;AACA,aAAO,KAAK,UAAL,CAAgB,EAAE,CAAC,GAAnB,CAAP;AACA;AACD,GArCwC;AAuCzC,EAAA,OAAO,EAAE,iBAAS,QAAT,EAAmB,IAAnB,EAAyB,UAAzB,EAAqC;AAC7C,QAAI,CAAJ,EAAO,EAAP,EAAW,CAAX,EAAc,EAAd,EAAkB,EAAlB,EAAsB,CAAtB,EAAyB,EAAzB;AACA,QAAI,QAAQ,GAAG,IAAf;;AACA,QAAI,UAAU,KAAK,KAAK,CAAxB,EAA2B;AAC1B,MAAA,QAAQ,GAAG,KAAK,CAAC,IAAN,CAAW,IAAX,EAAiB,CAAjB,EAAoB,UAApB,CAAX;AACA,KAFD,MAEO;AACN,MAAA,UAAU,GAAG,CAAb;AACA;;AACD,SAAK,CAAC,GAAG,UAAJ,EAAgB,EAAE,GAAG,IAAI,CAAC,MAA1B,EAAkC,EAAE,GAAG,EAA5C,EAAgD,CAAC,GAAG,EAApD,EAAwD,EAAE,CAA1D,EAA6D;AAC5D,MAAA,EAAE,GAAG,IAAI,CAAC,CAAD,CAAT,CAD4D,CAE5D;;AACA,UAAI,EAAE,CAAC,MAAP,EAAe;AACd,aAAK,CAAC,GAAG,CAAJ,EAAO,EAAE,GAAG,EAAE,CAAC,MAApB,EAA4B,CAAC,GAAG,EAAhC,EAAoC,EAAE,CAAtC,EAAyC;AACxC,UAAA,CAAC,GAAG,KAAK,IAAL,CAAU,EAAE,CAAC,CAAD,CAAZ,CAAJ;AACA,UAAA,EAAE,CAAC,IAAH,CAAQ,CAAC,CAAC,QAAD,CAAD,CAAY,KAAZ,CAAkB,CAAlB,EAAqB,QAArB,CAAR;AACA;AACD,OALD,MAKO;AACN,QAAA,CAAC,GAAG,KAAK,IAAL,CAAU,EAAV,CAAJ;AACA,QAAA,EAAE,CAAC,IAAH,CAAQ,CAAC,CAAC,QAAD,CAAD,CAAY,KAAZ,CAAkB,CAAlB,EAAqB,QAArB,CAAR;AACA;AACD;;AACD,WAAO,EAAP;AACA,GA7DwC;;AA+DzC;;;AAIA,EAAA,GAAG,EAAE,aAAS,EAAT,EAAa;AACjB,WAAO,EAAE,CAAC,GAAH,IAAU,KAAK,UAAL,CAAgB,EAAE,CAAC,GAAnB,MAA4B,KAAK,CAAlD;AACA,GArEwC;AAuEzC,EAAA,QAAQ,EAAE,oBAAW;AACpB,QAAI,CAAJ;AAAA,QAAO,CAAP;AAAA,QAAU,EAAV;AAAA,QAAc,GAAG,GAAG,EAApB;;AACA,SAAK,CAAC,GAAG,CAAT,EAAY,CAAC,GAAG,SAAS,CAAC,MAA1B,EAAkC,EAAE,CAApC,EAAuC;AACtC,MAAA,EAAE,GAAG,SAAS,CAAC,CAAD,CAAd;;AACA,UAAI,EAAE,CAAC,MAAP,EAAe;AACd,aAAK,CAAC,GAAG,CAAT,EAAY,CAAC,GAAG,EAAE,CAAC,MAAnB,EAA2B,EAAE,CAA7B,EAAgC;AAC/B,UAAA,GAAG,CAAC,IAAJ,CAAS,KAAK,IAAL,CAAU,EAAE,CAAC,CAAD,CAAZ,CAAT;AACA;AACD,OAJD,MAIO;AACN,QAAA,GAAG,CAAC,IAAJ,CAAS,KAAK,IAAL,CAAU,EAAV,CAAT;AACA;AACD;;AACD,WAAO,GAAP;AACA,GApFwC;AAsFzC,EAAA,GAAG,EAAE,aAAS,EAAT,EAAa;AACjB,WAAO,KAAK,IAAL,CAAU,EAAV,CAAP;AACA,GAxFwC;AA0FzC,EAAA,GAAG,EAAE,eAAW;AACf,QAAI,CAAJ,EAAO,CAAP,EAAU,EAAV;;AACA,SAAK,CAAC,GAAG,CAAT,EAAY,CAAC,GAAG,SAAS,CAAC,MAA1B,EAAkC,EAAE,CAApC,EAAuC;AACtC,MAAA,EAAE,GAAG,SAAS,CAAC,CAAD,CAAd;;AACA,UAAI,EAAE,CAAC,MAAP,EAAe;AACd,aAAK,CAAC,GAAG,CAAT,EAAY,CAAC,GAAG,EAAE,CAAC,MAAnB,EAA2B,EAAE,CAA7B,EAAgC;AAC/B,eAAK,IAAL,CAAU,EAAE,CAAC,CAAD,CAAZ;AACA;AACD,OAJD,MAIO;AACN,aAAK,IAAL,CAAU,EAAV;AACA;AACD;AACD,GAtGwC;AAwGzC,EAAA,MAAM,EAAE,kBAAW;AAClB,QAAI,CAAJ,EAAO,CAAP,EAAU,EAAV;;AACA,SAAK,CAAC,GAAG,CAAT,EAAY,CAAC,GAAG,SAAS,CAAC,MAA1B,EAAkC,EAAE,CAApC,EAAuC;AACtC,MAAA,EAAE,GAAG,SAAS,CAAC,CAAD,CAAd;;AACA,UAAI,EAAE,CAAC,MAAP,EAAe;AACd,aAAK,CAAC,GAAG,CAAT,EAAY,CAAC,GAAG,EAAE,CAAC,MAAnB,EAA2B,EAAE,CAA7B,EAAgC;AAC/B,eAAK,OAAL,CAAa,EAAE,CAAC,CAAD,CAAf;AACA;AACD,OAJD,MAIO;AACN,aAAK,OAAL,CAAa,EAAb;AACA;AACD;AACD,GApHwC;;AAsHzC;;;;AAIA;;AAGA,EAAA,SAAS,EAAE,mBAAS,EAAT,EAAa;AACvB,WAAO,KAAK,GAAL,CAAS,EAAT,IAAe,KAAK,UAAL,CAAgB,EAAE,CAAC,GAAnB,EAAwB,SAAvC,GAAoD,KAAK,CAAhE;AACA,GA/HwC;;AAiIzC;;AAGA,EAAA,OAAO,EAAE,mBAAW;AACnB,SAAK,OAAL,CAAa,SAAb,EAAwB,SAAxB;AACA,GAtIwC;AAuIzC,EAAA,UAAU,EAAE,sBAAW;AACtB,SAAK,IAAI,CAAC,GAAG,CAAR,EAAW,EAAE,GAAG,KAAK,MAAL,CAAY,MAAjC,EAAyC,CAAC,GAAG,EAA7C,EAAiD,CAAC,EAAlD,EAAsD;AACrD,WAAK,MAAL,CAAY,CAAZ,EAAe,OAAf;AACA;AACD,GA3IwC;AA6IzC,EAAA,YAAY,EAAE,wBAAW;AACxB,SAAK,OAAL,CAAa,cAAb,EAA6B,SAA7B;AACA,GA/IwC;AAgJzC,EAAA,gBAAgB,EAAE,4BAAW;AAC5B,SAAK,IAAI,CAAC,GAAG,CAAR,EAAW,EAAE,GAAG,KAAK,MAAL,CAAY,MAAjC,EAAyC,CAAC,GAAG,EAA7C,EAAiD,CAAC,EAAlD,EAAsD;AACrD,WAAK,MAAL,CAAY,CAAZ,EAAe,YAAf;AACA;AACD,GApJwC;;AAsJzC;;AAEA,EAAA,MAAM,EAAE,gBAAS,CAAT,EAAY,CAAZ,EAAe;AACtB,SAAK,OAAL,CAAa,QAAb,EAAuB,SAAvB,EAAkC,CAAlC;AACA,GA1JwC;AA2JzC,EAAA,SAAS,EAAE,mBAAS,CAAT,EAAY,CAAZ,EAAe;AACzB,SAAK,IAAI,CAAC,GAAG,CAAR,EAAW,EAAE,GAAG,KAAK,MAAL,CAAY,MAAjC,EAAyC,CAAC,GAAG,EAA7C,EAAiD,CAAC,EAAlD,EAAsD;AACrD,WAAK,MAAL,CAAY,CAAZ,EAAe,MAAf,CAAsB,CAAtB,EAAyB,CAAzB;AACA;AACD,GA/JwC;AAiKzC,EAAA,WAAW,EAAE,uBAAW;AACvB,SAAK,OAAL,CAAa,aAAb,EAA4B,SAA5B;AACA,GAnKwC;AAoKzC,EAAA,eAAe,EAAE,2BAAW;AAC3B,SAAK,IAAI,CAAC,GAAG,CAAR,EAAW,EAAE,GAAG,KAAK,MAAL,CAAY,MAAjC,EAAyC,CAAC,GAAG,EAA7C,EAAiD,CAAC,EAAlD,EAAsD;AACrD,WAAK,MAAL,CAAY,CAAZ,EAAe,WAAf;AACA;AACD,GAxKwC;;AA0KzC;;AAGA,EAAA,aAAa,EAAE,uBAAS,UAAT,EAAqB;AACnC,SAAK,OAAL,CAAa,eAAb,EAA8B,SAA9B,EAAyC,CAAzC;AACA,GA/KwC;AAgLzC,EAAA,iBAAiB,EAAE,2BAAS,UAAT,EAAqB;AACvC,SAAK,IAAI,CAAC,GAAG,CAAR,EAAW,EAAE,GAAG,KAAK,MAAL,CAAY,MAAjC,EAAyC,CAAC,GAAG,EAA7C,EAAiD,CAAC,EAAlD,EAAsD;AACrD,WAAK,MAAL,CAAY,CAAZ,EAAe,aAAf,CAA6B,UAA7B;AACA;AACD,GApLwC;AAsLzC,EAAA,eAAe,EAAE,2BAAW;AAC3B,SAAK,OAAL,CAAa,iBAAb,EAAgC,SAAhC;AACA,GAxLwC;AAyLzC,EAAA,mBAAmB,EAAE,+BAAW;AAC/B,SAAK,IAAI,CAAC,GAAG,CAAR,EAAW,EAAE,GAAG,KAAK,MAAL,CAAY,MAAjC,EAAyC,CAAC,GAAG,EAA7C,EAAiD,CAAC,EAAlD,EAAsD;AACrD,WAAK,MAAL,CAAY,CAAZ,EAAe,eAAf;AACA;AACD,GA7LwC;AA+LzC,EAAA,cAAc,EAAE,0BAAW;AAC1B,SAAK,OAAL,CAAa,gBAAb,EAA+B,SAA/B;AACA,GAjMwC;AAkMzC,EAAA,kBAAkB,EAAE,8BAAW;AAC9B,SAAK,IAAI,CAAC,GAAG,CAAR,EAAW,EAAE,GAAG,KAAK,MAAL,CAAY,MAAjC,EAAyC,CAAC,GAAG,EAA7C,EAAiD,CAAC,EAAlD,EAAsD;AACrD,WAAK,MAAL,CAAY,CAAZ,EAAe,cAAf;AACA;AACD,GAtMwC;AAwMzC,EAAA,kBAAkB,EAAE,8BAAW;AAC9B,QAAI,GAAG,GAAG,KAAK,OAAL,CAAa,oBAAb,EAAmC,SAAnC,CAAV;;AACA,WAAO,GAAG,CAAC,MAAJ,IAAc,CAAd,GACN,OAAO,CAAC,GAAR,CAAY,GAAZ,CADM,GAEN,OAAO,CAAC,OAAR,CAAgB,IAAhB,CAFD;AAGA,GA7MwC;AA8MzC,EAAA,qBAAqB,EAAE,iCAAW;AACjC,WAAQ,KAAK,MAAL,CAAY,MAAZ,IAAsB,CAAvB,GAA4B,OAAO,CAAC,GAAR,CAAY,KAAK,MAAL,CAAY,GAAZ,CAAgB,UAAS,CAAT,EAAY;AAC1E,aAAO,CAAC,CAAC,kBAAF,EAAP;AACA,KAF8C,CAAZ,CAA5B,GAED,OAAO,CAAC,OAAR,CAAgB,IAAhB,CAFN;AAGA,GAlNwC;AAoNzC,EAAA,OAAO,EAAE,mBAAW;AACnB,WAAO,SAAS,CAAC,MAAV,IAAoB,CAApB,GACN,KAAK,qBAAL,EADM,GAEN,KAAK,kBAAL,CAAwB,IAAxB,CAA6B,IAA7B,EAAmC,SAAnC,CAFD;AAGA,GAxNwC;;AA0NzC;;;AAIA,EAAA,QAAQ,EAAE,oBAAW;AACpB,SAAK,IAAI,CAAC,GAAG,CAAR,EAAW,EAAE,GAAG,KAAK,MAAL,CAAY,MAAjC,EAAyC,CAAC,GAAG,EAA7C,EAAiD,CAAC,EAAlD,EAAsD;AACrD,WAAK,MAAL,CAAY,CAAZ,EAAe,QAAf;AACA;AACD;AAlOwC,CAAd,EAmOzB;AACF,EAAA,KAAK,EAAE;AACN,IAAA,GAAG,EAAE,eAAW;AACf,aAAO,KAAK,MAAZ;AACA;AAHK;AADL,CAnOyB,CAA5B;AA2OA,MAAM,CAAC,OAAP,GAAiB,eAAjB;;;;;;AC/PA;;;;AAGA;AACA,IAAM,gBAAgB,GAAG,OAAO,CAAC,wBAAD,CAAhC;AACA;;;AACA,IAAM,iBAAiB,GAAG,OAAO,CAAC,yBAAD,CAAjC;AACA;;;AACA,IAAM,aAAa,GAAG,OAAO,CAAC,qBAAD,CAA7B;AACA;;;AACA,IAAI,aAAa,GAAG,aAAa,CAAC,eAAD,CAAjC,C,CACA;AACA;AACA;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;AACA;;AAEA;;;;AAIA,IAAI,mBAAmB,GAAG,uBAA1B,C,CACA;;AAEA,IAAI,gBAAgB,GAAG;AACtB,EAAA,IAAI,EAAE,OADgB;AAEtB,EAAA,SAAS,EAAE,UAFW;AAGtB,EAAA,QAAQ,EAAE,MAHY;AAItB,EAAA,MAAM,EAAE,MAJc;AAKtB,EAAA,KAAK,EAAE,CALe;AAMtB,EAAA,QAAQ,EAAE,CANY;AAOtB,EAAA,OAAO,EAAE;AAPa,CAAvB,C,CAUA;AACA;AACA;;AAEA,IAAI,iBAAiB,GAAI,UAAS,EAAT,EAAa;AACrC,SAAO,UAAS,CAAT,EAAY;AAClB,WAAO,EAAE,CAAC,CAAC,CAAC,UAAH,EAAe,CAAC,CAAC,UAAjB,CAAT;AACA,GAFD;AAGA,CAJwB,CAIvB,OAAO,CAAC,qBAAD,CAAP,CAA+B,kBAJR,CAAzB;;AAMA,IAAI,kBAAkB,GAAG,SAArB,kBAAqB,CAAS,CAAT,EAAY;AACpC,SAAO,CAAC,CAAC,QAAF,GAAa,GAAb,GACN,CAAC,CAAC,QAAF,GAAa,IADP,GACc,IADd,GAEN,CAAC,CAAC,MAFI,GAEK,GAFL,GAGN,CAAC,CAAC,KAAF,GAAU,IAHJ,GAGW,GAHlB;AAIA,CALD;;AAOA,IAAI,YAAY,GAAG;AAClB,aAAW,GADO;AAElB,gBAAc,SAFI;AAGlB,eAAa,0BAHK;AAIlB,oBAAkB,EAJA;AAKlB,gBAAc,EALI,CAMlB;AACA;AACA;AACA;AACA;;AAVkB,CAAnB;AAYA,IAAI,QAAQ,GAAG,MAAM,CAAC,IAAP,CAAY,YAAZ,CAAf;AACA,IAAI,SAAS,GAAG,QAAQ,CAAC,MAAT,CAAgB,UAAS,GAAT,EAAc,QAAd,EAAwB;AACvD,EAAA,GAAG,CAAC,QAAD,CAAH,GAAgB,gBAAgB,CAAC,QAAD,CAAhC;AACA,SAAO,GAAP;AACA,CAHe,EAGb,EAHa,CAAhB;;AAKA,IAAI,UAAU,GAAI,UAAS,aAAT,EAAwB;AACzC,SAAO,QAAQ,CACb,GADK,CACD,aADC,EAEL,MAFK,CAEE,UAAS,GAAT,EAAc,QAAd,EAAwB;AAC/B,IAAA,GAAG,CAAC,QAAD,CAAH,GAAgB,iBAAiB,CAAC,QAAD,CAAjC;AACA,WAAO,GAAP;AACA,GALK,EAKH,EALG,CAAP;AAMA,CAPgB,CAOd,OAAO,CAAC,6BAAD,CAPO,CAAjB;;AASA,IAAI,UAAU,GAAG,SAAb,UAAa,CAAS,EAAT,EAAa,MAAb,EAAqB;AACrC,MAAI,EAAE,CAAC,MAAH,IAAa,CAAjB,EAAoB;AACnB,IAAA,EAAE,CAAC,OAAH,CAAW,UAAS,CAAT,EAAY,CAAZ,EAAe,CAAf,EAAkB;AAC5B,MAAA,CAAC,CAAC,OAAF,CAAU,MAAV;AACA,MAAA,CAAC,CAAC,CAAD,CAAD,GAAO,IAAP;AACA,KAHD;AAIA,IAAA,EAAE,CAAC,MAAH,GAAY,CAAZ;AACA;;AACD,SAAO,EAAP;AACA,CATD;;AAWA,IAAI,SAAS,GAAG,SAAZ,SAAY,CAAS,EAAT,EAAa,MAAb,EAAqB;AACpC,MAAI,EAAE,CAAC,MAAH,IAAa,CAAjB,EAAoB;AACnB,IAAA,EAAE,CAAC,OAAH,CAAW,UAAS,CAAT,EAAY,CAAZ,EAAe,CAAf,EAAkB;AAC5B,MAAA,CAAC,CAAC,MAAF,CAAS,MAAT,EAD4B,CACX;;AACjB,MAAA,CAAC,CAAC,CAAD,CAAD,GAAO,IAAP;AACA,KAHD;AAIA,IAAA,EAAE,CAAC,MAAH,GAAY,CAAZ,CALmB,CAKL;AACd;;AACD,SAAO,EAAP;AACA,CATD;AAWA;;;;AAIA;;;;;AAGA,IAAI,aAAa,GAAG,SAAhB,aAAgB,CAAS,EAAT,EAAa,EAAb,EAAiB;AACpC,OAAK,EAAL,GAAU,EAAV;AACA,OAAK,EAAL,GAAU,EAAV;AACA,OAAK,EAAL,CAAQ,GAAR,GAAc,EAAd;AAEA,OAAK,gBAAL,GAAwB,KAAK,gBAAL,CAAsB,IAAtB,CAA2B,IAA3B,CAAxB;AACA,OAAK,EAAL,CAAQ,gBAAR,CAAyB,aAAzB,EAAwC,KAAK,gBAA7C,EAA+D,KAA/D;AAEA,OAAK,eAAL,GAAuB,KAAvB;AACA,OAAK,gBAAL,GAAwB,KAAxB;AACA,OAAK,UAAL,GAAkB,IAAlB;AACA,OAAK,UAAL,GAAkB,IAAlB;AACA,OAAK,YAAL,GAAoB,EAApB;AACA,OAAK,YAAL,GAAoB,EAApB;AAEA,OAAK,UAAL,GAAkB,KAAlB;AACA,OAAK,cAAL,GAAsB,KAAtB;AACA,OAAK,QAAL,GAAgB,IAAhB;AACA,OAAK,QAAL,GAAgB,IAAhB;AAEA,OAAK,UAAL,GAAkB,IAAlB;AACA,OAAK,UAAL,GAAkB,IAAlB;AAEA,OAAK,cAAL,GAAsB,KAAtB;AACA,OAAK,kBAAL,GAA0B,KAA1B;AACA,OAAK,kBAAL,GAA0B,KAA1B;AACA,OAAK,WAAL,GAAmB,CAAC,CAAC,MAAF,CAAS,EAAT,EAAa,gBAAb,CAAnB,CA1BoC,CA0Be;;AAEnD,OAAK,SAAL,GAAiB,EAAjB;AACA,OAAK,gBAAL,GAAwB,EAAxB;AACA,CA9BD;;AAgCA,aAAa,CAAC,SAAd,GAA0B,MAAM,CAAC,MAAP,CAAc;AAEvC;;;;AAIA;;AAEA,EAAA,OAAO,EAAE,mBAAW;AACnB;AACA;AACA,SAAK,EAAL,CAAQ,mBAAR,CAA4B,aAA5B,EAA2C,KAAK,gBAAhD,EAAkE,KAAlE;AACA,IAAA,UAAU,CAAC,KAAK,gBAAN,EAAwB,IAAxB,CAAV;AACA,IAAA,UAAU,CAAC,KAAK,SAAN,EAAiB,IAAjB,CAAV,CALmB,CAMnB;AACA,GAfsC;;AAiBvC;;AAEA,EAAA,OAAO,EAAE,iBAAS,KAAT,EAAgB;AACxB;AACA,QAAI,KAAJ,EAAW;AACV,WAAK,YAAL;AACA;;AACD,SAAK,gBAAL;;AACA,WAAO,IAAP;AACA,GA1BsC;AA4BvC,EAAA,YAAY,EAAE,wBAAW;AACxB;AACA;AACA,SAAK,eAAL,GAAuB,IAAvB;AACA,WAAO,IAAP;AACA,GAjCsC;;AAmCvC;;AAEA,EAAA,MAAM,EAAE,gBAAS,CAAT,EAAY,CAAZ,EAAe;AACtB;AACA,SAAK,UAAL,GAAkB,IAAlB;AACA,SAAK,cAAL,GAAsB,IAAtB;AACA,SAAK,QAAL,GAAgB,CAAC,IAAI,CAArB;AACA,SAAK,QAAL,GAAgB,CAAC,IAAI,CAArB,CALsB,CAMtB;;AACA,WAAO,IAAP;AACA,GA7CsC;AA+CvC,EAAA,WAAW,EAAE,uBAAW;AACvB,QAAI,KAAK,UAAT,EAAqB;AACpB;AACA,WAAK,UAAL,GAAkB,KAAlB;AACA,WAAK,cAAL,GAAsB,IAAtB;AACA,WAAK,QAAL,GAAgB,IAAhB;AACA,WAAK,QAAL,GAAgB,IAAhB,CALoB,CAMpB;AACA,KARsB,CASvB;AACA;AACA;;;AACA,WAAO,IAAP;AACA,GA5DsC;;AA8DvC;;AAEA,EAAA,aAAa,EAAE,uBAAS,UAAT,EAAqB;AACnC,QAAI,CAAC,UAAL,EAAiB;AAAE;AAClB,aAAO,KAAK,eAAL,EAAP;AACA;;AACD,QAAI,SAAS,GAAG,KAAK,gBAArB;AACA,QAAI,QAAQ,GAAG,KAAK,WAAL,CAAiB,IAAhC;AACA,SAAK,WAAL,CAAiB,QAAjB,GAA4B,UAAU,CAAC,WAAD,CAAtC;AACA,SAAK,WAAL,GAAmB,CAAC,CAAC,MAAF,CAAS,KAAK,WAAd,EAA2B,UAA3B,CAAnB;AACA,SAAK,gBAAL,GAAwB,kBAAkB,CAAC,KAAK,WAAN,CAA1C;;AAEA,QAAI,KAAK,kBAAT,EAA6B;AAC5B,MAAA,OAAO,CAAC,IAAR,CAAa,qDAAb,EAAoE,KAAK,EAAzE,EACC,QADD,EACW,SADX,EACsB,KAAK,WAAL,CAAiB,IADvC,EAC6C,KAAK,gBADlD;AAEA;;AAED,SAAK,cAAL,GAAsB,IAAtB;AACA,SAAK,kBAAL,GAA0B,IAA1B,CAhBmC,CAiBnC;;AACA,WAAO,IAAP;AACA,GAnFsC;AAqFvC,EAAA,eAAe,EAAE,2BAAW;AAC3B,SAAK,WAAL,GAAmB,CAAC,CAAC,MAAF,CAAS,KAAK,WAAd,EAA2B,gBAA3B,CAAnB;AACA,SAAK,gBAAL,GAAwB,mBAAxB;AAEA,SAAK,cAAL,GAAsB,KAAtB;AACA,SAAK,kBAAL,GAA0B,IAA1B,CAL2B,CAM3B;;AACA,WAAO,IAAP;AACA,GA7FsC;AA+FvC,EAAA,cAAc,EAAE,0BAAW;AAC1B;AACA;AACA,SAAK,WAAL,GAAmB,CAAC,CAAC,MAAF,CAAS,KAAK,WAAd,EAA2B,gBAA3B,CAAnB;AACA,SAAK,gBAAL,GAAwB,mBAAxB;AAEA,SAAK,cAAL,GAAsB,KAAtB;AACA,SAAK,kBAAL,GAA0B,IAA1B,CAP0B,CAQ1B;;AACA,WAAO,IAAP;AACA,GAzGsC;AA2GvC,EAAA,kBAAkB,EAAE,8BAAW;AAC9B,QAAI,CAAJ,EAAO,CAAP,EAAU,EAAV;;AACA,QAAI,KAAK,kBAAL,IAA2B,KAAK,kBAApC,EAAwD;AACvD,MAAA,CAAC,GAAG,EAAJ;AACA,MAAA,CAAC,GAAG,IAAI,OAAJ,CAAY,UAAS,OAAT,EAAkB,MAAlB,EAA0B;AACzC,QAAA,CAAC,CAAC,OAAF,GAAY,OAAZ;AACA,QAAA,CAAC,CAAC,MAAF,GAAW,MAAX;AACA,OAHG,CAAJ;AAIA,MAAA,EAAE,GAAG,KAAK,kBAAL,GAA0B,KAAK,gBAA/B,GAAkD,KAAK,SAA5D;AACA,MAAA,EAAE,CAAC,IAAH,CAAQ,CAAR;AACA,KARD,MAQO;AACN,MAAA,CAAC,GAAG,OAAO,CAAC,OAAR,CAAgB,IAAhB,CAAJ;AACA;;AACD,WAAO,CAAP;AACA,GAzHsC;;AA2HvC;;AAEA,EAAA,QAAQ,EAAE,oBAAW;AACpB;AACA,SAAK,YAAL,GAAoB,IAApB;;AAEA,QAAI,KAAK,eAAT,EAA0B;AACzB,UAAI,KAAK,GAAI,KAAK,UAAL,KAAoB,IAApB,GAA2B,KAAK,UAAhC,GAA6C,KAAK,UAA/D;AAAA,UACC,KAAK,GAAI,KAAK,UAAL,KAAoB,IAApB,GAA2B,KAAK,UAAhC,GAA6C,KAAK,UAD5D,CADyB,CAIzB;;AACA,WAAK,gBAAL;;AACA,WAAK,eAAL;;AAEA,UAAI,KAAK,GAAI,KAAK,UAAL,KAAoB,IAApB,GAA2B,KAAK,UAAhC,GAA6C,KAAK,UAA/D;AAAA,UACC,KAAK,GAAI,KAAK,UAAL,KAAoB,IAApB,GAA2B,KAAK,UAAhC,GAA6C,KAAK,UAD5D;;AAGA,UAAI,KAAK,KAAK,KAAV,IAAmB,KAAK,KAAK,KAAjC,EAAwC;AACvC,aAAK,cAAL,IAAuB,OAAO,CAAC,IAAR,CAAa,uDAAb,EAAsE,KAAK,EAAL,CAAQ,EAAR,IAAc,KAAK,EAAzF,EAA6F,KAA7F,EAAoG,KAApG,EAA2G,KAA3G,EAAkH,KAAlH,CAAvB,CADuC,CAEvC;;AACA,aAAK,eAAL,GAHuC,CAIvC;AACA;;AACD,WAAK,mBAAL;AACA,KAlBD,MAkBO;AACN;AACA,WAAK,mBAAL;;AACA,WAAK,eAAL;AACA,KA1BmB,CA4BpB;;;AACA,SAAK,YAAL,GAAoB,KAApB,CA7BoB,CA+BpB;AACA;AACA;;AACA,SAAK,gBAAL,GAAwB,KAAxB;AACA,WAAO,IAAP;AACA,GAjKsC;;AAmKvC;;;AAIA,EAAA,gBAAgB,EAAE,4BAAW;AAC5B,QAAI,CAAC,KAAK,eAAV,EAA2B;AAC1B;AACA,KAH2B,CAI5B;;;AACA,QAAI,cAAc,GAAG,IAArB;;AAEA,QAAI,KAAK,UAAL,IAAmB,CAAC,KAAK,cAA7B,EAA6C;AAC5C;AACA,MAAA,cAAc,GAAG,KAAK,WAAL,CAAiB,WAAjB,CAAjB;;AACA,UAAI,cAAc,KAAK,EAAvB,EAA2B;AAC1B,QAAA,OAAO,CAAC,KAAR,CAAc,+DAAd,EAA+E,KAAK,EAApF,EAAwF,KAAK,QAA7F,EAAuG,KAAK,QAA5G;AACA;;AACD,WAAK,cAAL,CAAoB,WAApB;AACA,KAd2B,CAgB5B;;;AACA,SAAK,YAAL,GAAoB,KAAK,YAAzB;AACA,SAAK,YAAL,GAAoB,KAAK,oBAAL,EAApB;;AAEA,QAAI,KAAK,YAAL,CAAkB,SAAlB,KAAgC,KAAK,YAAL,CAAkB,SAAtD,EAAiE;AAChE,UAAI,CAAJ,EAAO,EAAP,CADgE,CACrD;;AACX,MAAA,EAAE,GAAG,KAAK,YAAL,CAAkB,SAAlB,CAA4B,KAA5B,CAAkC,+BAAlC,CAAL;;AACA,UAAI,EAAJ,EAAQ;AACP,QAAA,CAAC,GAAG,EAAE,CAAC,CAAD,CAAF,CAAM,KAAN,CAAY,GAAZ,CAAJ;;AACA,YAAI,EAAE,CAAC,CAAD,CAAF,KAAU,QAAd,EAAwB;AACvB,eAAK,UAAL,GAAkB,UAAU,CAAC,CAAC,CAAC,CAAD,CAAF,CAA5B;AACA,eAAK,UAAL,GAAkB,UAAU,CAAC,CAAC,CAAC,CAAD,CAAF,CAA5B;AACA,SAHD,MAGO;AACN,eAAK,UAAL,GAAkB,UAAU,CAAC,CAAC,CAAC,EAAD,CAAF,CAA5B;AACA,eAAK,UAAL,GAAkB,UAAU,CAAC,CAAC,CAAC,EAAD,CAAF,CAA5B;AACA;AACD,OATD,MASO;AACN,aAAK,UAAL,GAAkB,CAAlB;AACA,aAAK,UAAL,GAAkB,CAAlB;AACA;;AACD,WAAK,gBAAL,GAAwB,IAAxB;AACA;;AACD,QAAI,cAAc,KAAK,IAAvB,EAA6B;AAC5B,MAAA,OAAO,CAAC,GAAR,CAAY,kCAAZ,EAAgD,KAAK,EAArD,EAAyD,cAAzD;;AACA,WAAK,WAAL,CAAiB,WAAjB,EAA8B,cAA9B;AACA;;AACD,SAAK,eAAL,GAAuB,KAAvB;AACA,GAlNsC;AAoNvC,EAAA,eAAe,EAAE,2BAAW;AAC3B,QAAI,KAAK,cAAT,EAAyB;AACxB;AACA,WAAK,cAAL,GAAsB,KAAtB;;AACA,UAAI,KAAK,UAAT,EAAqB;AACpB,YAAI,EAAE,GAAG,KAAK,QAAL,GAAgB,KAAK,UAA9B;AACA,YAAI,EAAE,GAAG,KAAK,QAAL,GAAgB,KAAK,UAA9B;;AACA,YAAI,EAAE,KAAK,KAAK,UAAZ,IAA0B,EAAE,KAAK,KAAK,UAA1C,EAAsD;AACrD,eAAK,UAAL,GAAkB,EAAlB;AACA,eAAK,UAAL,GAAkB,EAAlB;;AACA,eAAK,WAAL,CAAiB,WAAjB,EAA8B,iBAAiB,CAAC,IAAD,CAA/C;AACA;AACD,OARD,MAQO;AACN,aAAK,UAAL,GAAkB,IAAlB;AACA,aAAK,UAAL,GAAkB,IAAlB;;AACA,aAAK,cAAL,CAAoB,WAApB;AACA;AACD;AACD,GAtOsC;AAwOvC,EAAA,mBAAmB,EAAE,+BAAW;AAC/B,QAAI,KAAK,kBAAT,EAA6B;AAC5B;AACA,WAAK,kBAAL,GAA0B,KAA1B,CAF4B,CAI5B;;AACA,UAAI,EAAE,GAAG,KAAK,SAAd,CAL4B,CAM5B;;AACA,WAAK,SAAL,GAAiB,KAAK,gBAAtB,CAP4B,CAQ5B;;AACA,WAAK,gBAAL,GAAwB,UAAU,CAAC,EAAD,EAAK,IAAL,CAAlC,CAT4B,CAW5B;;AACA,WAAK,kBAAL,GAA0B,KAAK,cAA/B,CAZ4B,CAa5B;;AACA,WAAK,WAAL,CAAiB,YAAjB,EAA+B,KAAK,gBAApC;;AACA,UAAI,KAAJ,EAAW;AACV,YAAI,KAAK,cAAT,EAAyB;AACxB,eAAK,EAAL,CAAQ,YAAR,CAAqB,SAArB,EAAgC,KAAK,WAAL,CAAiB,IAAjD;AACA;AACD;;AAED,UAAI,CAAC,KAAK,cAAV,EAA0B;AACzB;AACA,QAAA,UAAU,CAAC,KAAK,SAAN,EAAiB,IAAjB,CAAV;AACA;AACD;AACD,GAnQsC;AAqQvC,EAAA,gBAAgB,EAAE,0BAAS,EAAT,EAAa;AAC9B,QAAI,KAAK,YAAT,EAAuB;AACtB;AACA;;AACD,QAAI,KAAK,kBAAL,IAA4B,KAAK,EAAL,KAAY,EAAE,CAAC,MAA3C,IACF,KAAK,WAAL,CAAiB,QAAjB,IAA6B,EAAE,CAAC,YADlC,EACiD;AAChD,WAAK,cAAL,GAAsB,KAAtB;AACA,WAAK,kBAAL,GAA0B,KAA1B;;AACA,WAAK,cAAL,CAAoB,YAApB;;AACA,MAAA,UAAU,CAAC,KAAK,SAAN,EAAiB,IAAjB,CAAV;;AAEA,UAAI,KAAJ,EAAW;AACV,YAAI,KAAK,EAAL,CAAQ,YAAR,CAAqB,SAArB,CAAJ,EAAqC;AACpC;AACA,eAAK,EAAL,CAAQ,eAAR,CAAwB,SAAxB;AACA;AACD;AACD;AACD,GAvRsC;;AAyRvC;;;AAIA,EAAA,WAAW,EAAE,qBAAS,IAAT,EAAe;AAC3B,WAAO,KAAK,EAAL,CAAQ,KAAR,CAAc,SAAS,CAAC,IAAD,CAAvB,CAAP,CAD2B,CAE3B;AACA;AACA,GAjSsC;AAmSvC,EAAA,WAAW,EAAE,qBAAS,IAAT,EAAe,KAAf,EAAsB;AAClC,QAAI,IAAI,KAAK,YAAT,IAAyB,KAAK,IAAI,mBAAtC,EAA2D;AAC1D,MAAA,KAAK,GAAG,EAAR;AACA;;AACD,QAAI,KAAK,KAAK,IAAV,IAAkB,KAAK,KAAK,KAAK,CAAjC,IAAsC,KAAK,KAAK,EAApD,EAAwD;AACvD,WAAK,cAAL,CAAoB,IAApB;AACA,KAFD,MAEO;AACN,WAAK,EAAL,CAAQ,KAAR,CAAc,SAAS,CAAC,IAAD,CAAvB,IAAiC,KAAjC,CADM,CAEN;AACA;AACD,GA7SsC;AA+SvC,EAAA,cAAc,EAAE,wBAAS,IAAT,EAAe;AAC9B,SAAK,EAAL,CAAQ,KAAR,CAAc,SAAS,CAAC,IAAD,CAAvB,IAAiC,EAAjC,CAD8B,CAE9B;AACA,GAlTsC;AAoTvC,EAAA,oBAAoB,EAAE,gCAAW;AAChC,QAAI,MAAM,GAAG,EAAb;AACA,QAAI,QAAQ,GAAG,MAAM,CAAC,gBAAP,CAAwB,KAAK,EAA7B,CAAf;;AACA,SAAK,IAAI,CAAT,IAAc,SAAd,EAAyB;AACxB,MAAA,MAAM,CAAC,CAAD,CAAN,GAAY,QAAQ,CAAC,SAAS,CAAC,CAAD,CAAV,CAApB;AACA;;AACD,WAAO,MAAP;AACA;AA3TsC,CAAd,EA4TvB;AACF,EAAA,UAAU,EAAE;AACX,IAAA,GAAG,EAAE,eAAW;AACf,aAAO,KAAK,WAAZ;AACA;AAHU,GADV;AAMF,EAAA,aAAa,EAAE;AACd,IAAA,GAAG,EAAE,eAAW;AACf,aAAO,KAAK,cAAZ;AACA;AAHa,GANb;AAWF,EAAA,eAAe,EAAE;AAChB,IAAA,GAAG,EAAE,eAAW;AACf,aAAO,KAAK,gBAAZ;AACA;AAHe,GAXf;AAgBF,EAAA,SAAS,EAAE;AACV,IAAA,GAAG,EAAE,eAAW;AACf,aAAO,KAAK,UAAZ;AACA;AAHS,GAhBT;AAqBF,EAAA,SAAS,EAAE;AACV,IAAA,GAAG,EAAE,eAAW;AACf,aAAO,KAAK,UAAZ;AACA;AAHS,GArBT;AA2BF,EAAA,SAAS,EAAE;AACV,IAAA,GAAG,EAAE,eAAW;AACf,aAAO,KAAK,UAAZ;AACA;AAHS,GA3BT;AAgCF,EAAA,OAAO,EAAE;AACR,IAAA,GAAG,EAAE,eAAW;AACf,aAAO,KAAK,QAAZ;AACA;AAHO,GAhCP;AAqCF,EAAA,OAAO,EAAE;AACR,IAAA,GAAG,EAAE,eAAW;AACf,aAAO,KAAK,QAAZ;AACA;AAHO;AArCP,CA5TuB,CAA1B;AAwWA,MAAM,CAAC,OAAP,GAAiB,aAAjB;;;;;AC3iBA;AACA;AACA;AACA;AACA;AACA;AACA;;ACNA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;ACvLA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;AChDA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;AC3EA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;AChBA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;AC1DA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;ACTA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;AC1DA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;ACpPA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;;AC/IA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;;;ACrEA;AACA;AACA;AACA;AACA;;ACJA;AACA;AACA;AACA;AACA;;ACJA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;ACZA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;ACjCA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;;;AC/BA;AACA,IAAI,UAAU,GAAG,CAAC,EAAD,EAAK,MAAL,CAAY,OAAO,CAAC,YAAD,CAAnB,CAAjB;AAEA;;AACA,IAAI,UAAU,GAAG,UAAU,CAAC,GAAX,CAAe,UAAS,CAAT,EAAY;AAC3C,SAAQ,CAAC,KAAK,EAAP,GAAa,CAAb,GAAiB,CAAC,CAAC,MAAF,CAAS,CAAT,EAAY,WAAZ,KAA4B,CAAC,CAAC,MAAF,CAAS,CAAT,CAApD;AACA,CAFgB,CAAjB;AAIA;;AACA,IAAI,QAAQ,GAAG,EAAf;AAEA;;AACA,IAAI,MAAM,GAAG,EAAb;AAEA;;;;;;;AAMA,IAAI,cAAc,GAAG,SAAjB,cAAiB,CAAS,IAAT,EAAe,GAAf,EAAoB,QAApB,EAA8B;AAClD,MAAI,QAAQ,GAAG,SAAS,IAAT,CAAc,IAAd,IAAsB,UAAtB,GAAmC,UAAlD;AACA,EAAA,GAAG,KAAK,GAAG,GAAG,QAAX,CAAH;;AACA,OAAK,IAAI,CAAC,GAAG,CAAb,EAAgB,CAAC,GAAG,QAAQ,CAAC,MAA7B,EAAqC,CAAC,EAAtC,EAA0C;AACzC,QAAI,QAAJ,EAAc;AACb,UAAK,QAAQ,CAAC,CAAD,CAAR,GAAc,QAAf,IAA4B,GAAhC,EAAqC;AACpC,eAAO,QAAQ,CAAC,CAAD,CAAR,GAAc,IAArB;AACA;AACD;;AACD,QAAK,OAAO,QAAQ,CAAC,CAAD,CAAf,GAAqB,IAAtB,IAA+B,GAAnC,EAAwC;AACvC,aAAO,QAAQ,CAAC,CAAD,CAAR,GAAc,IAArB;AACA;AACD;;AACD,SAAO,IAAP;AACA,CAdD,C,CAgBA;;;AACA,QAAQ,CAAC,eAAD,CAAR,GAA4B,YAAW;AACtC,MAAI,IAAJ;AAAA,MAAU,KAAK,GAAG,QAAQ,CAAC,IAAT,CAAc,KAAhC;AAAA,MACC,GAAG,GAAG;AACL,kBAAc,eADT;AAEL,wBAAoB,qBAFf;AAGL,qBAAiB,eAHZ;AAIL;AACA,mBAAe;AALV,GADP;;AAQA,OAAK,IAAL,IAAa,GAAb,EAAkB;AACjB,QAAI,IAAI,IAAI,KAAZ,EAAmB;AAClB,aAAO,GAAG,CAAC,IAAD,CAAV;AACA;AACD;;AACD,SAAO,IAAP;AACA,CAfD;AAiBA;;;;;;;;AAMA,MAAM,CAAC,OAAP,GAAiB,UAAS,MAAT,EAAiB;AACjC,MAAI,CAAC,MAAM,CAAC,cAAP,CAAsB,MAAtB,CAAL,EAAoC;AACnC,IAAA,MAAM,CAAC,MAAD,CAAN,GAAiB,QAAQ,CAAC,cAAT,CAAwB,MAAxB,IAAkC,QAAQ,CAAC,MAAD,CAAR,EAAlC,GAAuD,cAAc,CAAC,KAAf,CAAqB,IAArB,EAA2B,SAA3B,CAAxE;;AACA,QAAI,MAAM,CAAC,MAAD,CAAN,KAAmB,IAAvB,EAA6B;AAC5B,MAAA,OAAO,CAAC,IAAR,CAAa,sBAAb,EAAqC,MAArC;AACA,KAFD,MAEO;AACN,MAAA,OAAO,CAAC,GAAR,CAAY,0BAAZ,EAAwC,MAAxC,EAAgD,MAAM,CAAC,MAAD,CAAtD;AACA;AACD;;AACD,SAAO,MAAM,CAAC,MAAD,CAAb,CATiC,CAUjC;AACA,CAXD;AAaA;;;;;;;;;;;;;;;;;;;;;;;;;;;ACzEA;;;;AAIA;AACA,IAAM,QAAQ,GAAG,OAAO,CAAC,YAAD,CAAxB;AACA;;;AACA,IAAI,UAAU,GAAG,QAAQ,CAAC,MAA1B;AACA;;AACA,IAAI,MAAM,GAAG,EAAb;;AAEA,IAAI,iBAAiB,GAAG,SAApB,iBAAoB,CAAS,IAAT,EAAe,GAAf,EAAoB;AAC3C,MAAI,YAAJ,EAAkB,SAAlB;;AAEA,MAAI,IAAI,IAAI,GAAZ,EAAiB;AAChB,IAAA,OAAO,CAAC,GAAR,CAAY,gCAAZ,EAA8C,IAA9C;AACA,WAAO,IAAP;AACA;;AACD,EAAA,SAAS,GAAG,IAAI,CAAC,CAAD,CAAJ,CAAQ,WAAR,KAAwB,IAAI,CAAC,KAAL,CAAW,CAAX,CAApC;;AACA,OAAK,IAAI,CAAC,GAAG,CAAb,EAAgB,CAAC,GAAG,UAApB,EAAgC,CAAC,EAAjC,EAAqC;AACpC,IAAA,YAAY,GAAG,QAAQ,CAAC,CAAD,CAAR,GAAc,SAA7B;;AACA,QAAI,YAAY,IAAI,GAApB,EAAyB;AACxB,MAAA,OAAO,CAAC,GAAR,CAAY,6BAAZ,EAA2C,IAA3C,EAAiD,YAAjD;AACA,aAAO,YAAP;AACA;AACD;;AACD,EAAA,OAAO,CAAC,KAAR,CAAc,yBAAd,EAAyC,IAAzC;AACA,SAAO,IAAP;AACA,CAjBD;AAmBA;;;;;;;;AAMA,MAAM,CAAC,OAAP,GAAiB,UAAS,IAAT,EAAe,GAAf,EAAoB;AACpC,SAAO,MAAM,CAAC,IAAD,CAAN,KAAiB,MAAM,CAAC,IAAD,CAAN,GAAe,iBAAiB,CAAC,IAAD,EAAO,GAAG,IAAI,QAAQ,CAAC,IAAT,CAAc,KAA5B,CAAjD,CAAP;AACA,CAFD;;;;;ACpCA;;;;AAIA;AACA,IAAM,QAAQ,GAAG,OAAO,CAAC,YAAD,CAAxB,C,CAAwC;;AACxC;;;AACA,IAAI,UAAU,GAAG,QAAQ,CAAC,MAA1B;AACA;;AACA,IAAI,MAAM,GAAG,EAAb;;AAEA,IAAI,kBAAkB,GAAG,SAArB,kBAAqB,CAAS,KAAT,EAAgB,QAAhB,EAA0B;AAClD,MAAI,aAAJ;;AAEA,MAAI,KAAK,IAAI,QAAb,EAAuB;AACtB,IAAA,OAAO,CAAC,GAAR,CAAY,iCAAZ,EAA+C,KAA/C;AACA,WAAO,KAAP;AACA;;AACD,OAAK,IAAI,CAAC,GAAG,CAAb,EAAgB,CAAC,GAAG,UAApB,EAAgC,CAAC,EAAjC,EAAqC;AACpC,IAAA,aAAa,GAAG,MAAM,QAAQ,CAAC,CAAD,CAAd,GAAoB,GAApB,GAA0B,KAA1C,CADoC,CAEpC;;AACA,QAAI,aAAa,IAAI,QAArB,EAA+B;AAC9B,MAAA,OAAO,CAAC,GAAR,CAAY,8BAAZ,EAA4C,KAA5C,EAAmD,aAAnD;AACA,aAAO,aAAP;AACA;AACD;;AACD,EAAA,OAAO,CAAC,IAAR,CAAa,0BAAb,EAAyC,KAAzC;AACA,SAAO,IAAP;AACA,CAjBD;AAmBA;;;;;;;;AAMA,MAAM,CAAC,OAAP,GAAiB,UAAS,KAAT,EAAgB,QAAhB,EAA0B;AAC1C;AACA,SAAO,MAAM,CAAC,KAAD,CAAN,KAAkB,MAAM,CAAC,KAAD,CAAN,GAAgB,kBAAkB,CAAC,KAAD,EAAQ,QAAQ,IAAI,QAAQ,CAAC,IAAT,CAAc,KAAlC,CAApD,CAAP;AACA,CAHD,C,CAKA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;;;;ACrDA,MAAM,CAAC,OAAP,GAAiB,CAAC,QAAD,EAAW,KAAX,EAAkB,IAAlB,EAAwB,GAAxB,CAAjB;;;ACAA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;ACVA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;ACVA;AACA;AACA;AACA;AACA;AACA;;ACLA;AACA;AACA;AACA;;ACHA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;ACnKA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA",
  "file": "generated.js",
  "sourceRoot": "./src/js/",
  "sourcesContent": [
    "(function(){function r(e,n,t){function o(i,f){if(!n[i]){if(!e[i]){var c=\"function\"==typeof require&&require;if(!f&&c)return c(i,!0);if(u)return u(i,!0);var a=new Error(\"Cannot find module '\"+i+\"'\");throw a.code=\"MODULE_NOT_FOUND\",a}var p=n[i]={exports:{}};e[i][0].call(p.exports,function(r){var n=e[i][1][r];return o(n||r)},p,p.exports,r,e,n,t)}return n[i].exports}for(var u=\"function\"==typeof require&&require,i=0;i<t.length;i++)o(t[i]);return o}return r})()",
    "var makeString = require('./helper/makeString');\n\nmodule.exports = function capitalize(str, lowercaseRest) {\n  str = makeString(str);\n  var remainingChars = !lowercaseRest ? str.slice(1) : str.slice(1).toLowerCase();\n\n  return str.charAt(0).toUpperCase() + remainingChars;\n};\n",
    "var trim = require('./trim');\n\nmodule.exports = function dasherize(str) {\n  return trim(str).replace(/([A-Z])/g, '-$1').replace(/[-_\\s]+/g, '-').toLowerCase();\n};\n",
    "var escapeRegExp = require('./escapeRegExp');\n\nmodule.exports = function defaultToWhiteSpace(characters) {\n  if (characters == null)\n    return '\\\\s';\n  else if (characters.source)\n    return characters.source;\n  else\n    return '[' + escapeRegExp(characters) + ']';\n};\n",
    "var makeString = require('./makeString');\n\nmodule.exports = function escapeRegExp(str) {\n  return makeString(str).replace(/([.*+?^=!:${}()|[\\]\\/\\\\])/g, '\\\\$1');\n};\n",
    "/**\n * Ensure some object is a coerced to a string\n **/\nmodule.exports = function makeString(object) {\n  if (object == null) return '';\n  return '' + object;\n};\n",
    "module.exports = function strRepeat(str, qty){\n  if (qty < 1) return '';\n  var result = '';\n  while (qty > 0) {\n    if (qty & 1) result += str;\n    qty >>= 1, str += str;\n  }\n  return result;\n};\n",
    "var pad = require('./pad');\n\nmodule.exports = function lpad(str, length, padStr) {\n  return pad(str, length, padStr);\n};\n",
    "var makeString = require('./helper/makeString');\nvar strRepeat = require('./helper/strRepeat');\n\nmodule.exports = function pad(str, length, padStr, type) {\n  str = makeString(str);\n  length = ~~length;\n\n  var padlen = 0;\n\n  if (!padStr)\n    padStr = ' ';\n  else if (padStr.length > 1)\n    padStr = padStr.charAt(0);\n\n  switch (type) {\n  case 'right':\n    padlen = length - str.length;\n    return str + strRepeat(padStr, padlen);\n  case 'both':\n    padlen = length - str.length;\n    return strRepeat(padStr, Math.ceil(padlen / 2)) + str + strRepeat(padStr, Math.floor(padlen / 2));\n  default: // 'left'\n    padlen = length - str.length;\n    return strRepeat(padStr, padlen) + str;\n  }\n};\n",
    "var pad = require('./pad');\n\nmodule.exports = function rpad(str, length, padStr) {\n  return pad(str, length, padStr, 'right');\n};\n",
    "var makeString = require('./helper/makeString');\nvar defaultToWhiteSpace = require('./helper/defaultToWhiteSpace');\nvar nativeTrim = String.prototype.trim;\n\nmodule.exports = function trim(str, characters) {\n  str = makeString(str);\n  if (!characters && nativeTrim) return nativeTrim.call(str);\n  characters = defaultToWhiteSpace(characters);\n  return str.replace(new RegExp('^' + characters + '+|' + characters + '+$', 'g'), '');\n};\n",
    "/**\n * @module app/App\n */\n\"use strict\";\n\nconsole.info(`Portfolio App started GIT:${GIT_REV}`);\n\n// if (!DEBUG) {\n// \twindow.addEventListener(\"error\", function(ev) {\n// \t\tconsole.error(\"Uncaught Error\", ev);\n// \t});\n// }\n\nif (DEBUG) {\n\trequire(\"Modernizr\");\n}\nrequire(\"setimmediate\");\nrequire(\"es6-promise/auto\");\nrequire(\"classlist-polyfill\");\nrequire(\"raf-polyfill\");\nrequire(\"matches-polyfill\");\nrequire(\"fullscreen-polyfill\");\nrequire(\"math-sign-polyfill\");\n// require(\"path2d-polyfill\");\nrequire(\"mutation-observer\");\n\nrequire(\"backbone\").$ = require(\"backbone.native\");\nrequire(\"backbone.babysitter\");\nrequire(\"Backbone.Mutators\");\nrequire(\"hammerjs\");\n\n// document.addEventListener('DOMContentLoaded', function(ev) {\n// \tconsole.log(\"%s:[event %s]\", ev.target, ev.type);\n// });\n\nwindow.addEventListener(\"load\", function(ev) {\n\tconsole.log(\"%s:[event %s]\", ev.target, ev.type);\n\n\t// process bootstrap data, let errors go up the stack\n\ttry {\n\t\trequire(\"app/model/helper/bootstrap\")(window.bootstrap);\n\t} catch (err) {\n\t\tvar el = document.querySelector(\".app\");\n\t\tel.classList.remove(\"app-initial\");\n\t\tel.classList.add(\"app-error\");\n\t\tthrow new Error(\"bootstrap data error (\" + err.message + \")\", err.fileName, err.lineNumber);\n\t} finally { // detele global var\n\t\tdelete window.bootstrap;\n\t}\n\n\trequire(\"app/view/template/_helpers\");\n\n\t/** @type {module:app/view/helper/createColorStyleSheet} */\n\trequire(\"app/view/helper/createColorStyleSheet\").call(); /** @type {module:app/view/AppView} */\n\tvar AppView = require(\"app/view/AppView\");\n\t// var startApp = AppView.getInstance.bind(AppView);\n\n\t/** @type {module:webfontloader} */\n\tvar WebFont = require(\"webfontloader\");\n\tvar loadOpts = {\n\t\tasync: false,\n\t\tgroupName: \"\",\n\t\tclasses: false,\n\t\tloading: function() {\n\t\t\tconsole.log(\"WebFont:%s:loading\", this.groupName);\n\t\t},\n\t\tactive: function() {\n\t\t\tconsole.info(\"WebFont:%s:active\", this.groupName);\n\t\t},\n\t\tinactive: function() {\n\t\t\tconsole.warn(\"WebFont:%s:inactive\", this.groupName);\n\t\t},\n\t\tfontactive: function(familyName, variantFvd) {\n\t\t\tconsole.info(\"WebFont:%s:fontactive '%s' (%s)\", this.groupName, familyName, variantFvd);\n\t\t},\n\t\tfontinactive: function(familyName, variantFvd) {\n\t\t\tconsole.warn(\"WebFont:%s:fontinactive '%s' (%s)\", this.groupName, familyName, variantFvd);\n\t\t},\n\t\t// fontloading: function(familyName, variantDesc) {\n\t\t// \tconsole.log(\"WebFont::fontloading\", familyName, JSON.stringify(variantDesc, null, \" \"));\n\t\t// },\n\t};\n\n\tWebFont.load(_.defaults({\n\t\tasync: false,\n\t\tgroupName: \"required\",\n\t\tcustom: {\n\t\t\tfamilies: [\n\t\t\t\t\"FranklinGothicFS:n4,n6\",\n\t\t\t\t// \"FranklinGothicFS:i4,i6\"\n\t\t\t\t\"FolioFigures:n4\",\n\t\t\t],\n\t\t\ttestStrings: {\n\t\t\t\t\"FolioFigures\": \"hms\"\n\t\t\t},\n\t\t},\n\t\tactive: () => AppView.getInstance(),\n\t\tinactive: () => AppView.getInstance(),\n\t}, loadOpts));\n\n\tWebFont.load(_.defaults({}, loadOpts));\n\n\t// requestAnimationFrame(function(tstamp) {\n\t// \tAppView.getInstance();\n\t// });\n});\n\n\nif (DEBUG) {\n\t// /** @type {module:underscore} */\n\t// var _ = require(\"underscore\");\n\n\t// var isFF = /Firefox/.test(window.navigator.userAgent);\n\t// var isIOS = /iPad|iPhone/.test(window.navigator.userAgent);\n\t/*\n\tif (/Firefox/.test(window.navigator.userAgent)) {\n\t\tconsole.prefix = \"# \";\n\t\tvar shift = [].shift;\n\t\tvar logWrapFn = function() {\n\t\t\tif (typeof arguments[1] == \"string\") arguments[1] = console.prefix + arguments[1];\n\t\t\treturn shift.apply(arguments).apply(console, arguments);\n\t\t};\n\t\tconsole.group = _.wrap(console.group, logWrapFn);\n\t\tconsole.log = _.wrap(console.log, logWrapFn);\n\t\tconsole.info = _.wrap(console.info, logWrapFn);\n\t\tconsole.warn = _.wrap(console.warn, logWrapFn);\n\t\tconsole.error = _.wrap(console.error, logWrapFn);\n\t}\n\t*/\n\t/*\n\tvar saveLogs = function() {\n\t\tvar logWrapFn = function(name, fn, msg) {\n\t\t\tdocument.documentElement.appendChild(\n\t\t\t\tdocument.createComment(\"[\" + name + \"] \" + msg));\n\t\t};\n\t\tconsole.group = _.wrap(console.group, _.partial(logWrapFn, \"group\"));\n\t\tconsole.log = _.wrap(console.log, _.partial(logWrapFn, \"log\"));\n\t\tconsole.info = _.wrap(console.info, _.partial(logWrapFn, \"info\"));\n\t\tconsole.warn = _.wrap(console.warn, _.partial(logWrapFn, \"warn\"));\n\t\tconsole.error = _.wrap(console.error, _.partial(logWrapFn, \"error\"));\n\t};\n\t*/\n\n\t// handle error events on some platforms and production\n\t/*\n\tif (isIOS) {\n\t\t// saveLogs();\n\t\twindow.addEventListener(\"error\", function() {\n\t\t\tvar args = Array.prototype.slice.apply(arguments),\n\t\t\t\tel = document.createElement(\"div\"),\n\t\t\t\thtml = \"\";\n\t\t\t_.extend(el.style, {\n\t\t\t\tfontfamily: \"monospace\",\n\t\t\t\tdisplay: \"block\",\n\t\t\t\tposition: \"absolute\",\n\t\t\t\tzIndex: \"999\",\n\t\t\t\tbackgroundColor: \"white\",\n\t\t\t\tcolor: \"black\",\n\t\t\t\twidth: \"calc(100% - 3em)\",\n\t\t\t\tbottom: \"0\",\n\t\t\t\tmargin: \"1em 1.5em\",\n\t\t\t\tpadding: \"1em 1.5em\",\n\t\t\t\toutline: \"0.5em solid red\",\n\t\t\t\toutlineOffset: \"0.5em\",\n\t\t\t\tboxSizing: \"border-box\",\n\t\t\t\toverflow: \"hidden\",\n\t\t\t});\n\t\t\thtml += \"<pre><b>location:<b> \" + window.location + \"</pre>\";\n\t\t\thtml += \"<pre><b>event:<b> \" + JSON.stringify(args.shift(), null, \" \") + \"</pre>\";\n\t\t\tif (args.length) html += \"<pre><b>rest:<b> \" + JSON.stringify(args, null, \" \") + \"</pre>\";\n\t\t\tel.innerHTML = html;\n\t\t\tdocument.body.appendChild(el);\n\t\t});\n\t}*/\n}\n",
    "/**\n * @module app/control/Controller\n */\n\n/** @type {module:backbone} */\nconst Backbone = require(\"backbone\");\n\n// /** @type {module:app/model/collection/TypeCollection} */\n// var types = require(\"app/model/collection/TypeCollection\");\n// /** @type {module:app/model/collection/KeywordCollection} */\n// var keywords = require(\"app/model/collection/KeywordCollection\");\n/** @type {module:app/model/collection/ArticleCollection} */\nconst articles = require(\"app/model/collection/ArticleCollection\");\n/** @type {module:app/model/collection/BundleCollection} */\nconst bundles = require(\"app/model/collection/BundleCollection\");\n\n/* --------------------------- *\n/* Static private\n/* --------------------------- */\n\n/**\n/* @constructor\n/* @type {module:app/control/Controller}\n/*/\nvar Controller = Backbone.Router.extend({\n\n\t// /** @override */\n\t// routes: {},\n\n\t/** @override */\n\tinitialize: function(options) {\n\t\tif (DEBUG) {\n\t\t\tthis._routeNames = [];\n\t\t\tthis.route = function(route, name, callback) {\n\t\t\t\tthis._routeNames.push(_.isString(name) ? name : '');\n\t\t\t\treturn Backbone.Router.prototype.route.apply(this, arguments);\n\t\t\t};\n\t\t\tthis.on(\"route\", function(routeName, args) {\n\t\t\t\tconsole.log(\"controller:[route] %s [%s]\", routeName, args.join());\n\t\t\t});\n\t\t}\n\n\t\t/*\n\t\t * Prefixed article regexp: /^article(?:\\/([^\\/]+))\\/?$/\n\t\t * Single bundle regexp: /^bundles(?:\\/([^\\/]+)(?:\\/(\\d+))?)?\\/?$/\n\t\t */\n\t\tthis.route(/(.*)/,\n\t\t\t\"notfound\", this.toNotFound);\n\t\tthis.route(/^([a-z][a-z0-9\\-]*)\\/?$/,\n\t\t\t\"article-item\", this.toArticleItem);\n\t\tthis.route(/^(?:bundles)?\\/?$/,\n\t\t\t\"root\", this.toRoot);\n\t\t// this.route(/^bundles\\/?$/,\n\t\t// \t\"bundle-list\", this.toBundleList);\n\n\t\t// this.route(/^bundles\\/([^\\/]+)\\/?$/,\n\t\t// \t\"bundle-item\", this.toBundleItem);\n\t\t// this.route(/^bundles\\/([^\\/]+)\\/(\\d+)\\/?$/,\n\t\t// \t\"media-item\", this.toMediaItem);\n\n\t\t// this.route(/^bundles(?:\\/([^\\/]+)(?:\\/(\\d+))?)?\\/?$/,\n\t\t// \t\"media-item\", this.toMediaItem);\n\n\t\tthis.route(/^bundles\\/([^\\/]+)(?:\\/(\\d+)?)?\\/?$/,\n\t\t\t\"media-item\", this.toMediaItem);\n\n\t\tif (DEBUG) {\n\t\t\tconsole.log(\"%s::initialize routes: %o\", \"controller\", this._routeNames);\n\t\t}\n\t},\n\n\n\n\t/* ---------------------------\n\t/* JS to URL: public command methods\n\t/* --------------------------- */\n\n\tselectMedia: function(media) {\n\t\tthis._goToLocation(media.get(\"bundle\"), media);\n\t},\n\n\tselectBundle: function(bundle) {\n\t\tif (bundle.attr(\"@no-desc\")) {\n\t\t\tthis._goToLocation(bundle,\n\t\t\t\tbundle.get(\"media\").at(0), {\n\t\t\t\t\treplace: true,\n\t\t\t\t\ttrigger: true\n\t\t\t\t}\n\t\t\t);\n\t\t} else {\n\t\t\tthis._goToLocation(bundle);\n\t\t}\n\t},\n\n\tdeselectMedia: function() {\n\t\tthis._goToLocation(bundles.selected);\n\t},\n\n\tdeselectBundle: function() {\n\t\tthis._goToLocation();\n\t},\n\n\tselectArticle: function(article) {\n\t\tthis.navigate(article.get(\"handle\"), { trigger: true });\n\t},\n\n\tdeselectArticle: function() {\n\t\tthis.navigate(\"\", { trigger: true });\n\t},\n\n\t/* ---------------------------\n\t/* JS to URL: private helpers\n\t/* --------------------------- */\n\n\t/** Update location when navigation happens internally */\n\t/*_updateLocation: function() {\n\t\tvar bundle, media;\n\t\tbundle = bundles.selected;\n\t\tif (bundle) {\n\t\t\tmedia = bundle.get(\"media\").selected;\n\t\t}\n\t\tthis.navigate(this._getLocation(bundle, media), {\n\t\t\ttrigger: false\n\t\t});\n\t},*/\n\n\t_getLocation: function(bundle, media) {\n\t\tvar mediaIndex, location = [];\n\t\tif (bundle) {\n\t\t\tlocation.push(\"bundles\");\n\t\t\tlocation.push(bundle.get(\"handle\"));\n\t\t\tif (media) {\n\t\t\t\tmediaIndex = bundle.get(\"media\").indexOf(media);\n\t\t\t\tif (mediaIndex >= 0) {\n\t\t\t\t\tlocation.push(mediaIndex);\n\t\t\t\t}\n\t\t\t}\n\t\t}\n\t\t// location.push(\"\");\n\t\treturn location.join(\"/\");\n\t},\n\n\t_goToLocation: function(bundle, media, opts) {\n\t\tthis.navigate(\n\t\t\tthis._getLocation(bundle, media),\n\t\t\t_.defaults(opts || {}, {\n\t\t\t\ttrigger: true\n\t\t\t})\n\t\t);\n\t},\n\n\t/* --------------------------- *\n\t * URL to JS: router handlers\n\t * --------------------------- */\n\n\ttoRoot: function() {\n\t\tthis.trigger(\"change:before\");\n\t\tif (bundles.selected) {\n\t\t\t// bundles.selected.get(\"media\").deselect();\n\t\t\tbundles.deselect();\n\t\t}\n\t\t// keywords.deselect();\n\t\tarticles.deselect();\n\t\tthis.trigger(\"change:after\");\n\t},\n\n\ttoNotFound: function(slug) {\n\t\tconsole.info(\"route:[*:%s]\", slug);\n\t},\n\n\t// toBundleList: function() {\n\t// \tthis.navigate(\"\", {\n\t// \t\ttrigger: true,\n\t// \t\treplace: true\n\t// \t});\n\t// },\n\n\ttoBundleItem: function(bundleHandle) {\n\t\tlet bundle = bundles.findWhere({ handle: bundleHandle });\n\t\tif (!bundle) {\n\t\t\tthrow new Error(`No bundle found with handle '${bundleHandle}'`);\n\t\t\t// } else if (bundle.attr(\"@no-desc\")) {\n\t\t\t// this._changeSelection(bundle, bundle.get(\"media\").at(0));\n\t\t\t// this.navigate(this._getLocation(bundle, bundle.get(\"media\").at(0)), { trigger: true, replace: false });\n\t\t}\n\t\tthis._changeSelection(bundle);\n\t},\n\n\ttoMediaItem: function(bundleHandle, mediaIndex) {\n\t\tlet bundle = bundles.findWhere({ handle: bundleHandle });\n\t\tif (!bundle) {\n\t\t\tthrow new Error(`No bundle found with handle '${bundleHandle}'`);\n\t\t}\n\t\tlet media = bundle.get(\"media\").at(mediaIndex ? mediaIndex : 0);\n\t\tif (!media) {\n\t\t\tthrow new Error(`No media found at index ${mediaIndex} in bundle '${bundleHandle}'`);\n\t\t}\n\t\tthis._changeSelection(bundle, media);\n\t},\n\n\ttoArticleItem: function(articleHandle) {\n\t\tlet article = articles.findWhere({ handle: articleHandle });\n\t\tif (!article) {\n\t\t\tthrow new Error(`No article found with handle '${articleHandle}'`);\n\t\t}\n\t\tthis.trigger(\"change:before\", article);\n\t\tbundles.deselect();\n\t\tarticles.select(article);\n\t\tthis.trigger(\"change:after\", article);\n\t},\n\n\t/* -------------------------------\n\t/* URL to JS: private helpers\n\t/* ------------------------------- */\n\n\t/*\n\t/* NOTE: Selection order\n\t/* - Apply media selection to *incoming bundle*, as not to trigger\n\t/*\tunneccesary events on an outgoing bundle. Outgoing bundle media selection\n\t/*\tremains untouched.\n\t/* - Apply media selection *before* selecting the incoming bundle. Views\n\t/*\tnormally listen to the selected bundle only, so if the bundle is changing,\n\t/*\tthey will not be listening to media selection changes yet.\n\t/*/\n\t_changeSelection: function(bundle, media) {\n\t\tvar lastBundle, lastMedia;\n\t\tif (bundle === void 0) bundle = null;\n\t\tif (media === void 0) media = null;\n\n\t\t// if (bundle !== null && media === null && bundle.attr(\"@no-desc\")) {\n\t\t// \tmedia = bundle.get(\"media\").at(0);\n\t\t// \tthis._goToLocation(bundle, media);\n\t\t// \treturn;\n\t\t// }\n\n\t\tlastBundle = bundles.selected;\n\t\tlastMedia = lastBundle ? lastBundle.get(\"media\").selected : null;\n\t\tconsole.log(\"controller::_changeSelection bundle:[%s -> %s] media:[%s -> %s]\",\n\t\t\t(lastBundle ? lastBundle.cid : lastBundle),\n\t\t\t(bundle ? bundle.cid : bundle),\n\t\t\t(lastMedia ? lastMedia.cid : lastMedia),\n\t\t\t(media ? media.cid : media)\n\t\t);\n\n\t\tif (!articles.selected\n\t\t\t&& (lastBundle === bundle)\n\t\t\t&& (lastMedia === media)) {\n\t\t\treturn;\n\t\t}\n\n\t\tthis.trigger(\"change:before\", bundle, media);\n\t\tbundle && bundle.get(\"media\").select(media);\n\t\tbundles.select(bundle);\n\t\tarticles.deselect();\n\t\tthis.trigger(\"change:after\", bundle, media);\n\t},\n});\n\n\nmodule.exports = new Controller();\n",
    "/**\n * @module app/control/Globals\n */\n\nmodule.exports = (function() {\n\t// reusable vars\n\tvar o, s, so;\n\t// global hash\n\tvar g = {};\n\t// SASS <--> JS shared hash\n\tvar sass = require(\"../../../sass/variables.json\");\n\n\t// JUNK FIRST: Some app-wide defaults\n\t// - - - - - - - - - - - - - - - - -\n\tg.VPAN_DRAG = 0.95; // as factor of pointer delta\n\tg.HPAN_OUT_DRAG = 0.4; // factor\n\tg.VPAN_OUT_DRAG = 0.1; // factor\n\tg.PAN_THRESHOLD = 15; // px\n\tg.COLLAPSE_THRESHOLD = 75; // px\n\tg.COLLAPSE_OFFSET = parseInt(sass.temp[\"collapse_offset\"]);\n\t// g.CLICK_EVENT = \"click\"; //window.hasOwnProperty(\"onpointerup\") ? \"pointerup\" : \"mouseup\";\n\tg.VIDEO_CROP_PX = parseInt(sass[\"video_crop_px\"]);\n\n\t// breakpoints\n\t// - - - - - - - - - - - - - - - - -\n\tg.BREAKPOINTS = {};\n\tfor (s in sass.breakpoints) {\n\t\to = sass.breakpoints[s];\n\t\t/*if (Array.isArray(o)) {\n\t\t\tg.BREAKPOINTS[s] = Object.defineProperties({}, {\n\t\t\t\t\"matches\": {\n\t\t\t\t\tget: _.partial(_.some, o.map(window.matchMedia), _.property(\"matches\"))\n\t\t\t\t},\n\t\t\t\t\"media\": {\n\t\t\t\t\tvalue: o.join(\", \")\n\t\t\t\t},\n\t\t\t\t\"queries\": {\n\t\t\t\t\tvalue: o.map(window.matchMedia)\n\t\t\t\t},\n\t\t\t});\n\t\t} else {\n\t\t\tg.BREAKPOINTS[s] = window.matchMedia(o);\n\t\t}*/\n\t\to = Array.isArray(o) ? o.join(\", \") : o;\n\t\to = o.replace(/[\\'\\\"]/g, \"\");\n\t\to = window.matchMedia(o);\n\t\to.className = s;\n\t\tg.BREAKPOINTS[s] = o;\n\t}\n\tif (DEBUG) {\n\t\tconsole.groupCollapsed(\"Breakpoints\");\n\t\tfor (s in g.BREAKPOINTS) {\n\t\t\tconsole.log(\"%s: %o\", s, g.BREAKPOINTS[s].media);\n\t\t}\n\t\tconsole.groupEnd();\n\t}\n\n\t// base colors, dimensions\n\t// - - - - - - - - - - - - - - - - -\n\tg.DEFAULT_COLORS = _.clone(sass.default_colors);\n\t// g.HORIZONTAL_STEP = parseFloat(sass.units[\"hu_px\"]);\n\t// g.VERTICAL_STEP = parseFloat(sass.units[\"vu_px\"]);\n\n\n\t// paths, networking\n\t// - - - - - - - - - - - - - - - - -\n\t// var toAbsoluteURL = (function() {\n\t// \tvar a = null;\n\t// \treturn function(url) {\n\t// \t\ta = a || document.createElement('a');\n\t// \t\ta.href = url;\n\t// \t\treturn a.href;\n\t// \t};\n\t// })();\n\t// g.APP_ROOT = toAbsoluteURL(window.approot);\n\t// g.MEDIA_DIR = toAbsoluteURL(window.mediadir);\n\n\tg.APP_ROOT = window.approot;\n\tg.MEDIA_DIR = window.mediadir;\n\n\tdelete window.approot;\n\tdelete window.mediadir;\n\n\t// hardcoded font data\n\t// - - - - - - - - - - - - - - - - -\n\tg.FONT_METRICS = {\n\t\t\"FranklinGothicFS\": {\n\t\t\t\"unitsPerEm\": 1000,\n\t\t\t\"ascent\": 827,\n\t\t\t\"descent\": -173\n\t\t},\n\t\t\"ITCFranklinGothicStd\": {\n\t\t\t\"unitsPerEm\": 1000,\n\t\t\t\"ascent\": 686,\n\t\t\t\"descent\": -314\n\t\t},\n\t\t\"FolioFigures\": {\n\t\t\t\"unitsPerEm\": 1024,\n\t\t\t\"ascent\": 939,\n\t\t\t\"descent\": -256\n\t\t},\n\t};\n\n\tg.PAUSE_CHAR = String.fromCharCode(0x23F8);\n\tg.PLAY_CHAR = String.fromCharCode(0x23F5);\n\tg.STOP_CHAR = String.fromCharCode(0x23F9);\n\n\t// translate common template\n\tif (sass.transform_type == \"3d\") {\n\t\tg.TRANSLATE_TEMPLATE = function(x, y) {\n\t\t\treturn \"translate3d(\" + x + \"px, \" + y + \"px, 0px)\";\n\t\t};\n\t} else {\n\t\tg.TRANSLATE_TEMPLATE = function(x, y) {\n\t\t\treturn \"translate(\" + x + \"px, \" + y + \"px)\";\n\t\t};\n\t}\n\n\tg.TRANSLATE_TEMPLATE = function(x, y) {\n\t\treturn \"translate(\" + x + \"px, \" + y + \"px)\";\n\t\t// return \"translate3d(\" + x + \"px, \" + y + \"px ,0px)\";\n\t};\n\t// timing, easing\n\t// - - - - - - - - - - - - - - - - -\n\tvar ease = g.TRANSITION_EASE = sass.transitions[\"ease\"];\n\tvar duration = g.TRANSITION_DURATION = parseFloat(sass.transitions[\"duration_ms\"]);\n\tvar delayInterval = g.TRANSITION_DELAY_INTERVAL = parseFloat(sass.transitions[\"delay_interval_ms\"]);\n\tvar minDelay = g.TRANSITION_MIN_DELAY = parseFloat(sass.transitions[\"min_delay_ms\"]);\n\tvar delay = g.TRANSITION_DELAY = g.TRANSITION_DURATION + g.TRANSITION_DELAY_INTERVAL;\n\n\t// css transitions\n\t// - - - - - - - - - - - - - - - - -\n\to = {};\n\n\t// match tx() in _transitions.scss\n\t// - - - - - - - - - - - - - - - - -\n\to.tx = function tx(durationCount, delayCount, easeVal) {\n\t\t_.isNumber(durationCount) || (durationCount = 1);\n\t\t_.isNumber(delayCount) || (delayCount = -1);\n\t\t_.isString(easeVal) || (easeVal = ease);\n\n\t\tvar o = {};\n\t\tif (delayCount < 0) {\n\t\t\to.duration = (duration * durationCount) +\n\t\t\t\t(delayInterval * (durationCount - 1));\n\t\t\to.delay = 0;\n\t\t} else {\n\t\t\to.duration = (duration * durationCount) +\n\t\t\t\t(delayInterval * (durationCount - 1)) - minDelay;\n\t\t\to.delay = (delay * delayCount) - minDelay;\n\t\t}\n\t\to.easeing = easeVal;\n\t\treturn 0;\n\t}\n\n\t// transition presets\n\t// TODO: get rid of this\n\t// - - - - - - - - - - - - - - - - -\n\n\to.NONE = {\n\t\tdelay: 0,\n\t\tduration: 0,\n\t\teasing: \"step-start\"\n\t};\n\to.NOW = {\n\t\tdelay: 0,\n\t\tduration: duration,\n\t\teasing: ease\n\t};\n\to.UNSET = _.defaults({\n\t\tcssText: \"\"\n\t}, o.NONE);\n\n\tvar txAligned = _.defaults({\n\t\tduration: duration - minDelay\n\t}, o.NOW);\n\to.FIRST = _.defaults({\n\t\tdelay: delay * 0.0 + minDelay\n\t}, txAligned);\n\to.BETWEEN = _.defaults({\n\t\tdelay: delay * 1.0 + minDelay\n\t}, txAligned);\n\to.LAST = _.defaults({\n\t\tdelay: delay * 2.0 + minDelay\n\t}, txAligned);\n\to.AFTER = _.defaults({\n\t\tdelay: delay * 2.0 + minDelay\n\t}, txAligned);\n\n\to.BETWEEN_EARLY = _.defaults({\n\t\tdelay: delay * 1.0 + minDelay - 60\n\t}, txAligned);\n\to.BETWEEN_LATE = _.defaults({\n\t\tdelay: delay * 1.0 + minDelay + 60\n\t}, txAligned);\n\n\to.FIRST_LATE = _.defaults({\n\t\tdelay: delay * 0.5 + minDelay\n\t}, txAligned);\n\to.LAST_EARLY = _.defaults({\n\t\tdelay: delay * 1.5 + minDelay\n\t}, txAligned);\n\t// o.FIRST_LATE = \t\t_.defaults({delay: txDelay*0.0 + txMinDelay*2}, txAligned);\n\t// o.LAST_EARLY = \t\t_.defaults({delay: txDelay*2.0 + txMinDelay*0}, txAligned);\n\t// o.AFTER = \t\t\t_.defaults({delay: txDelay*2.0 + txMinDelay}, txAligned);\n\n\tconsole.groupCollapsed(\"Transitions\");\n\tfor (s in o) {\n\t\tif (!_.isFunction(o[s])) {\n\t\t\tso = o[s];\n\t\t\tso.name = s;\n\t\t\tso.className = \"tx-\" + s.replace(\"_\", \"-\").toLowerCase();\n\t\t\tif (!so.hasOwnProperty(\"cssText\")) {\n\t\t\t\tso.cssText = so.duration / 1000 + \"s \" + so.easing + \" \" + so.delay / 1000 + \"s\";\n\t\t\t}\n\t\t\tconsole.log(\"%s: %s\", so.name, so.cssText);\n\t\t}\n\t}\n\tconsole.groupEnd();\n\tg.transitions = o;\n\n\treturn g;\n}());\n",
    "/**\n * @module app/view/DebugToolbar\n */\n\n/** @type {module:cookies-js} */\nconst Cookies = require(\"cookies-js\");\n\n/** @type {module:modernizr} */\nconst Modernizr = require(\"Modernizr\");\n\n/** @type {module:app/control/Globals} */\nconst Globals = require(\"app/control/Globals\");\n// /** @type {module:app/control/Controller} */\n// var controller = require(\"app/control/Controller\");\n\n/** @type {module:app/view/base/View} */\nconst View = require(\"app/view/base/View\");\n\n/** @type {Function} */\nconst viewTemplate = require(\"./template/DebugToolbar.hbs\");\n\n/** @type {Function} */\nconst gridTemplate = require(\"./template/DebugToolbar.SVGGrid.hbs\");\n\n/** @type {Function} */\nconst sizeTemplate = _.template(\"<%= w %> \\u00D7 <%= h %>\");\n\n// var appStateSymbols = { withBundle: \"b\", withMedia: \"m\", collapsed: \"c\"};\n// var appStateKeys = Object.keys(appStateSymbols);\n\nmodule.exports = View.extend({\n\n\t/** @override */\n\tcidPrefix: \"debugToolbar\",\n\t/** @override */\n\ttagName: \"div\",\n\t/** @override */\n\tclassName: \"toolbar\",\n\t/** @override */\n\ttemplate: viewTemplate,\n\n\t/** @override */\n\tproperties: {\n\t\tgrid: {\n\t\t\tget: function() {\n\t\t\t\treturn this._grid || (this._grid = this.createGridElement());\n\t\t\t}\n\t\t}\n\t},\n\n\tinitialize: function(options) {\n\t\tCookies.defaults = {\n\t\t\texpires: new Date(0x7fffffff * 1e3),\n\t\t\tdomain: String(window.location)\n\t\t\t\t.match(/^https?\\:\\/\\/([^\\/:?#]+)(?:[\\/:?#]|$)/i)[1]\n\t\t};\n\n\t\tthis.el.innerHTML = this.template({\n\t\t\ttests: Modernizr,\n\t\t\tnavigator: window.navigator\n\t\t});\n\n\t\t/* toggle's target: container\n\t\t/* - - - - - - - - - - - - - - - - */\n\t\tvar container = document.getElementById(\"container\"); //.querySelector(\"#container\");\n\n\t\t/* create/attach svg grid element\n\t\t/* - - - - - - - - - - - - - - - - */\n\t\tcontainer.insertBefore(this.createGridElement(), container.firstElementChild);\n\n\t\t/* info elements\n\t\t/* - - - - - - - - - - - - - - - - */\n\t\tthis.backendEl = this.el.querySelector(\"#edit-backend a\");\n\t\tthis.mediaInfoEl = this.el.querySelector(\"#media-info span\");\n\t\tthis.appStateEl = this.el.querySelector(\"#app-state\");\n\n\t\t/* toggle visibility\n\t\t/* - - - - - - - - - - - - - - - - */\n\t\tthis.initializeClassToggle(\"show-links\", this.el.querySelector(\"#links-toggle\"), this.el,\n\t\t\tfunction(key, value) {\n\t\t\t\tthis.el.classList.toggle(\"not-\" + key, !value);\n\t\t\t}\n\t\t);\n\t\tthis.initializeClassToggle(\"show-tests\", this.el.querySelector(\"#toggle-tests a\"), this.el);\n\t\tthis.initializeClassToggle(\"hide-passed\", this.el.querySelector(\"#toggle-passed\"), this.el);\n\n\t\t/* toggle container classes\n\t\t/* - - - - - - - - - - - - - - - - */\n\t\tthis.initializeClassToggle(\"debug-state\",\n\t\t\tthis.el.querySelector(\"#toggle-state a\"), container);\n\t\tthis.initializeClassToggle(\"debug-blocks-nav\",\n\t\t\tthis.el.querySelector(\"#toggle-blocks-nav a\"), container);\n\t\tthis.initializeClassToggle(\"debug-blocks-content\",\n\t\t\tthis.el.querySelector(\"#toggle-blocks-content a\"), container);\n\t\tthis.initializeClassToggle(\"debug-mdown\",\n\t\t\tthis.el.querySelector(\"#toggle-mdown a\"), container);\n\t\tthis.initializeClassToggle(\"debug-tx\",\n\t\t\tthis.el.querySelector(\"#toggle-tx a\"), container,\n\t\t\tfunction(key, value) {\n\t\t\t\tthis.el.classList.toggle(\"show-tx\", value);\n\t\t\t\tthis.el.classList.toggle(\"not-show-tx\", !value);\n\t\t\t}\n\t\t);\n\t\tthis.initializeClassToggle(\"debug-graph\",\n\t\t\tthis.el.querySelector(\"#toggle-graph a\"), container);\n\t\tthis.initializeClassToggle(\"debug-logs\",\n\t\t\tthis.el.querySelector(\"#toggle-logs a\"), container);\n\t\tthis.initializeClassToggle(\"debug-grid-bg\",\n\t\t\tthis.el.querySelector(\"#toggle-grid-bg a\"), document.body);\n\n\t\tthis.initializeViewportInfo();\n\n\t\t// this.initializeLayoutSelect();\n\n\t\tthis.listenTo(this.model, \"change\", this._onModelChange);\n\t\tthis._onModelChange();\n\t},\n\n\tinitializeViewportInfo: function() {\n\t\tvar viewportInfoEl = this.el.querySelector(\"#viewport-info span\");\n\t\tvar callback = function() {\n\t\t\tviewportInfoEl.textContent = sizeTemplate({ w: window.innerWidth, h: window.innerHeight });\n\t\t};\n\t\tcallback.call();\n\t\twindow.addEventListener(\"resize\", _.debounce(callback, 100, false, false));\n\t},\n\n\tinitializeToggle: function(key, toggleEl, callback) {\n\t\tif (!toggleEl) return;\n\n\t\tvar ctx = this;\n\t\tvar toggleValue = Cookies.get(key) === \"true\";\n\t\tcallback.call(ctx, key, toggleValue);\n\n\t\ttoggleEl.addEventListener(\"click\", function(ev) {\n\t\t\tif (ev.defaultPrevented) return;\n\t\t\telse ev.preventDefault();\n\t\t\ttoggleValue = !toggleValue;\n\t\t\tCookies.set(key, toggleValue ? \"true\" : \"\");\n\t\t\tcallback.call(ctx, key, toggleValue);\n\t\t}, false);\n\t},\n\n\tinitializeClassToggle: function(key, toggleEl, targetEl, callback) {\n\t\tvar hasCallback = _.isFunction(callback);\n\n\t\tthis.initializeToggle(key, toggleEl, function(key, toggleValue) {\n\t\t\ttargetEl.classList.toggle(key, toggleValue);\n\t\t\ttoggleEl.classList.toggle(\"toggle-enabled\", toggleValue);\n\t\t\ttoggleEl.classList.toggle(\"color-reverse\", toggleValue);\n\t\t\thasCallback && callback.apply(this, arguments);\n\t\t});\n\t},\n\n\t_onModelChange: function() {\n\t\t// console.log(\"%s::_onModelChange changedAttributes: %o\", this.cid, this.model.changedAttributes());\n\t\tvar i, ii, prop, el, els = this.appStateEl.children;\n\t\tfor (i = 0, ii = els.length; i < ii; i++) {\n\t\t\tel = els[i];\n\t\t\tprop = el.getAttribute(\"data-prop\");\n\t\t\tel.classList.toggle(\"has-value\", this.model.get(prop));\n\t\t\tel.classList.toggle(\"has-changed\", this.model.hasChanged(prop));\n\t\t\tel.classList.toggle(\"color-reverse\", this.model.hasChanged(prop));\n\t\t}\n\n\t\t// NOTE: Always but rewrite CMS href.\n\t\t// Only collapsed may have changed, but not worth all the logic\n\t\tvar attrVal = Globals.APP_ROOT + \"symphony/\";\n\t\tswitch (this.model.get(\"routeName\")) {\n\t\t\tcase \"article-item\":\n\t\t\t\tattrVal += \"publish/articles/edit/\" + this.model.get(\"article\").id;\n\t\t\t\tbreak;\n\t\t\tcase \"bundle-item\":\n\t\t\t\tattrVal += \"publish/bundles/edit/\" + this.model.get(\"bundle\").id;\n\t\t\t\tbreak;\n\t\t\tcase \"media-item\":\n\t\t\t\tattrVal += \"publish/media/edit/\" + this.model.get(\"media\").id;\n\t\t\t\tbreak;\n\t\t\tcase \"root\":\n\t\t\t\tattrVal += \"publish/bundles\";\n\t\t\t\tbreak;\n\t\t}\n\t\tthis.backendEl.setAttribute(\"href\", attrVal);\n\n\t\tif (this.model.hasChanged(\"routeName\")) {\n\t\t\tdocument.body.setAttribute(\"last-route\", this.model.previous(\"routeName\"));\n\t\t\tdocument.body.setAttribute(\"current-route\", this.model.get(\"routeName\"));\n\t\t}\n\n\t\tif (this.model.hasChanged(\"media\")) {\n\t\t\tif (this.model.has(\"media\")) {\n\t\t\t\tthis.mediaInfoEl.textContent = sizeTemplate(this.model.get(\"media\").get(\"source\").toJSON());\n\t\t\t\tthis.mediaInfoEl.style.display = \"\";\n\t\t\t} else {\n\t\t\t\tthis.mediaInfoEl.textContent = \"\";\n\t\t\t\tthis.mediaInfoEl.style.display = \"none\";\n\t\t\t}\n\t\t}\n\t},\n\n\tcreateGridElement: function() {\n\t\tvar el = document.createElement(\"div\");\n\t\tel.id = \"grid-wrapper\";\n\t\tel.innerHTML = gridTemplate();\n\t\treturn el;\n\t},\n});\n\nmodule.exports.prototype._logFlags = \"\";\n",
    "// hbsfy compiled Handlebars template\nvar HandlebarsCompiler = require('hbsfy/runtime');\nmodule.exports = HandlebarsCompiler.template({\"compiler\":[7,\">= 4.0.0\"],\"main\":function(container,depth0,helpers,partials,data) {\n    return \"<svg id=\\\"debug-grid\\\" version=\\\"1.1\\\" xmlns=\\\"http://www.w3.org/2000/svg\\\" xmlns:xlink=\\\"http://www.w3.org/1999/xlink\\\" preserveAspectRatio=\\\"xMaxYMid slice\\\" viewport-fill=\\\"hsl(0,0%,100%)\\\" viewport-fill-opacity=\\\"1\\\" style=\\\"fill:none;stroke:none;stroke-width:1px;fill:none;fill-rule:evenodd;\\\">\\n<defs>\\n\t<pattern id=\\\"pat-baseline-12px\\\" class=\\\"baseline base12\\\" x=\\\"0\\\" y=\\\"0\\\" width=\\\"20\\\" height=\\\"12\\\" patternUnits=\\\"userSpaceOnUse\\\">\\n\t\t<line x1=\\\"0\\\" x2=\\\"100%\\\" y1=\\\"0\\\" y2=\\\"0\\\" stroke-opacity=\\\"1.0\\\"/>\\n\t\t<line x1=\\\"0\\\" x2=\\\"100%\\\" y1=\\\"3\\\" y2=\\\"3\\\" stroke-opacity=\\\"0.125\\\"/>\\n\t\t<line x1=\\\"0\\\" x2=\\\"100%\\\" y1=\\\"6\\\" y2=\\\"6\\\" stroke-opacity=\\\"0.375\\\"/>\\n\t\t<line x1=\\\"0\\\" x2=\\\"100%\\\" y1=\\\"9\\\" y2=\\\"9\\\" stroke-opacity=\\\"0.125\\\"/>\\n\t</pattern>\\n\\n\t<pattern id=\\\"pat-baseline-24px\\\" class=\\\"baseline base12\\\" x=\\\"0\\\" y=\\\"0\\\" width=\\\"20\\\" height=\\\"24\\\" patternUnits=\\\"userSpaceOnUse\\\">\\n\t\t<line x1=\\\"0\\\" x2=\\\"100%\\\" y1=\\\"0\\\" y2=\\\"0\\\" stroke-opacity=\\\"1.0\\\"/>\\n\t</pattern>\\n\\n\t<pattern id=\\\"pat-baseline-10px\\\" class=\\\"baseline base10\\\" x=\\\"0\\\" y=\\\"0\\\" width=\\\"20\\\" height=\\\"10\\\" patternUnits=\\\"userSpaceOnUse\\\">\\n\t\t<line x1=\\\"0\\\" x2=\\\"100%\\\" y1=\\\"0\\\" y2=\\\"0\\\" stroke-opacity=\\\"1.00\\\"/>\\n\t\t<line x1=\\\"0\\\" x2=\\\"100%\\\" y1=\\\"5\\\" y2=\\\"5\\\" stroke-opacity=\\\"0.75\\\"/>\\n\t</pattern>\\n\t<pattern id=\\\"pat-baseline-20px\\\" class=\\\"baseline base10\\\" x=\\\"0\\\" y=\\\"0\\\" width=\\\"20\\\" height=\\\"20\\\" patternUnits=\\\"userSpaceOnUse\\\">\\n\t\t<line x1=\\\"0\\\" x2=\\\"100%\\\" y1=\\\"0\\\" y2=\\\"0\\\" stroke-opacity=\\\"1.0\\\"/>\\n\t</pattern>\\n\t<pattern id=\\\"pat-cols-220px\\\" x=\\\"0\\\" y=\\\"0\\\" width=\\\"220\\\" height=\\\"36\\\" patternUnits=\\\"userSpaceOnUse\\\">\\n\t\t<rect transform=\\\"translate(0,0)\\\" x=\\\"0\\\" y=\\\"0\\\" width=\\\"20\\\" height=\\\"100%\\\" fill=\\\"hsl(336,50%,40%)\\\" fill-opacity=\\\"0.1\\\"/>\\n\t\t<rect transform=\\\"translate(200,0)\\\" x=\\\"0\\\" y=\\\"0\\\" width=\\\"20\\\" height=\\\"100%\\\" fill=\\\"hsl(336,50%,40%)\\\" fill-opacity=\\\"0.1\\\"/>\\n\t\t<line transform=\\\"translate(20 0)\\\" x1=\\\"0\\\" x2=\\\"0\\\" y1=\\\"0\\\" y2=\\\"100%\\\" stroke=\\\"hsl(336,50%,60%)\\\" stroke-opacity=\\\"0.2\\\"/>\\n\t\t<line transform=\\\"translate(200 0)\\\" x1=\\\"0\\\" x2=\\\"0\\\" y1=\\\"0\\\" y2=\\\"100%\\\" stroke=\\\"hsl(336,50%,40%)\\\" stroke-opacity=\\\"0.2\\\"/>\\n\\n\t\t<line transform=\\\"translate(140 0)\\\" x1=\\\"0\\\" x2=\\\"0\\\" y1=\\\"0\\\" y2=\\\"100%\\\" stroke=\\\"hsl(336,50%,40%)\\\" stroke-opacity=\\\"0.3\\\"/>\\n\t\t<line transform=\\\"translate(80 0)\\\" x1=\\\"0\\\" x2=\\\"0\\\" y1=\\\"0\\\" y2=\\\"100%\\\" stroke=\\\"hsl(336,50%,40%)\\\" stroke-opacity=\\\"0.3\\\"/>\\n\\n\t\t<line transform=\\\"translate(0 0)\\\" x1=\\\"0\\\" x2=\\\"0\\\" y1=\\\"0\\\" y2=\\\"100%\\\" stroke=\\\"hsl(236,50%,40%)\\\" stroke-opacity=\\\"0.4\\\" stroke-width=\\\"1\\\"/>\\n\t\t<line transform=\\\"translate(220 0)\\\" x1=\\\"0\\\" x2=\\\"0\\\" y1=\\\"0\\\" y2=\\\"100%\\\" stroke=\\\"hsl(236,50%,40%)\\\" stroke-opacity=\\\"0.4\\\" stroke-width=\\\"1\\\"/>\\n\t</pattern>\\n</defs>\\n<g id=\\\"debug-grid-body\\\" transform=\\\"translate(0 0.5)\\\">\\n\t<rect id=\\\"baseline\\\" x=\\\"0\\\" y=\\\"0\\\" width=\\\"100%\\\" height=\\\"100%\\\"/>\\n\t<g id=\\\"debug-grid-container\\\">\\n\t\t<g id=\\\"debug-grid-content\\\">\\n\t\t\t<rect id=\\\"baseline-content\\\" x=\\\"0\\\" y=\\\"0\\\" width=\\\"100%\\\" height=\\\"100%\\\"/>\\n\t\t\t<line id=\\\"gct0\\\" class=\\\"hguide\\\" x1=\\\"0\\\" x2=\\\"100%\\\" y1=\\\"0\\\" y2=\\\"0\\\"/>\\n\t\t\t<line id=\\\"gct1\\\" class=\\\"hguide\\\" x1=\\\"0\\\" x2=\\\"100%\\\" y1=\\\"0\\\" y2=\\\"0\\\"/>\\n\t\t</g>\\n\t\t<line id=\\\"gnv0\\\" class=\\\"hguide\\\" x1=\\\"0\\\" x2=\\\"100%\\\" y1=\\\"0\\\" y2=\\\"0\\\"/>\\n\t\t<line id=\\\"gnv1\\\" class=\\\"hguide\\\" x1=\\\"0\\\" x2=\\\"100%\\\" y1=\\\"0\\\" y2=\\\"0\\\"/>\\n\t</g>\\n\\n\t<g id=\\\"abs-cols\\\">\\n\t\t<rect id=\\\"columns\\\" x=\\\"0\\\" y=\\\"0\\\" width=\\\"100%\\\" height=\\\"100%\\\"/>\\n\t</g>\\n\\n\t<g id=\\\"rel-cols\\\">\\n\t\t<line id=\\\"le\\\" class=\\\"vguide edge\\\" x1=\\\"0\\\" x2=\\\"0\\\" y1=\\\"0\\\" y2=\\\"100%\\\"/>\\n\t\t<line id=\\\"re\\\" class=\\\"vguide edge\\\" x1=\\\"100%\\\" x2=\\\"100%\\\" y1=\\\"0\\\" y2=\\\"100%\\\"/>\\n\\n\t\t<line id=\\\"gl0\\\" class=\\\"vguide margin\\\" x1=\\\"0\\\" x2=\\\"0\\\" y1=\\\"0\\\" y2=\\\"100%\\\"/>\\n\t\t<line id=\\\"gl1\\\" class=\\\"vguide gutter\\\" x1=\\\"0\\\" x2=\\\"0\\\" y1=\\\"0\\\" y2=\\\"100%\\\"/>\\n\\n\t\t<line id=\\\"gr0\\\" class=\\\"vguide margin\\\" x1=\\\"0\\\" x2=\\\"0\\\" y1=\\\"0\\\" y2=\\\"100%\\\"/>\\n\t\t<line id=\\\"gr1\\\" class=\\\"vguide gutter\\\" x1=\\\"0\\\" x2=\\\"0\\\" y1=\\\"0\\\" y2=\\\"100%\\\"/>\\n\\n\t\t<line id=\\\"gm\\\" class=\\\"vguide\\\" x1=\\\"0\\\" x2=\\\"0\\\" y1=\\\"0\\\" y2=\\\"100%\\\"/>\\n\t</g>\\n</g>\\n</svg>\\n\";\n},\"useData\":true});\n",
    "// hbsfy compiled Handlebars template\nvar HandlebarsCompiler = require('hbsfy/runtime');\nvar partial$0 = require('../../view/template/svg/CogSymbol.hbs');\nHandlebarsCompiler.registerPartial('../../view/template/svg/CogSymbol.hbs', partial$0);\nmodule.exports = HandlebarsCompiler.template({\"1\":function(container,depth0,helpers,partials,data) {\n    var stack1;\n\n  return \"\t<dd id=\\\"select-layout\\\">\\n\t\t<select size=1>\\n\"\n    + ((stack1 = helpers.each.call(depth0 != null ? depth0 : (container.nullContext || {}),(depth0 != null ? depth0.layouts : depth0),{\"name\":\"each\",\"hash\":{},\"fn\":container.program(2, data, 0),\"inverse\":container.noop,\"data\":data})) != null ? stack1 : \"\")\n    + \"\t\t</select>\\n\t</dd>\\n\";\n},\"2\":function(container,depth0,helpers,partials,data) {\n    var alias1=container.lambda, alias2=container.escapeExpression;\n\n  return \"\t\t\t<option value=\\\"\"\n    + alias2(alias1(depth0, depth0))\n    + \"\\\">\"\n    + alias2(alias1(depth0, depth0))\n    + \"</option>\\n\";\n},\"4\":function(container,depth0,helpers,partials,data) {\n    var stack1, helper, alias1=depth0 != null ? depth0 : (container.nullContext || {});\n\n  return \"\t\t<li class=\\\"\"\n    + ((stack1 = helpers[\"if\"].call(alias1,depth0,{\"name\":\"if\",\"hash\":{},\"fn\":container.program(5, data, 0),\"inverse\":container.program(7, data, 0),\"data\":data})) != null ? stack1 : \"\")\n    + \"\\\">\"\n    + container.escapeExpression(((helper = (helper = helpers.key || (data && data.key)) != null ? helper : helpers.helperMissing),(typeof helper === \"function\" ? helper.call(alias1,{\"name\":\"key\",\"hash\":{},\"data\":data}) : helper)))\n    + \"</li>\\n\";\n},\"5\":function(container,depth0,helpers,partials,data) {\n    return \"passed\";\n},\"7\":function(container,depth0,helpers,partials,data) {\n    return \"failed\";\n},\"compiler\":[7,\">= 4.0.0\"],\"main\":function(container,depth0,helpers,partials,data) {\n    var stack1, alias1=depth0 != null ? depth0 : (container.nullContext || {}), alias2=container.escapeExpression;\n\n  return \"<dl class=\\\"debug-links color-bg\\\">\\n\t<dt id=\\\"links-toggle\\\">\\n\"\n    + ((stack1 = container.invokePartial(partials[\"../../view/template/svg/CogSymbol.hbs\"],depth0,{\"name\":\"../../view/template/svg/CogSymbol.hbs\",\"data\":data,\"indent\":\"\\t\\t\",\"helpers\":helpers,\"partials\":partials,\"decorators\":container.decorators})) != null ? stack1 : \"\")\n    + \"\t</dt>\\n\"\n    + ((stack1 = helpers[\"if\"].call(alias1,(depth0 != null ? depth0.layouts : depth0),{\"name\":\"if\",\"hash\":{},\"fn\":container.program(1, data, 0),\"inverse\":container.noop,\"data\":data})) != null ? stack1 : \"\")\n    + \"\t<dd id=\\\"edit-backend\\\">\\n\t\t<a href=\\\"\"\n    + alias2((helpers.global || (depth0 && depth0.global) || helpers.helperMissing).call(alias1,\"APP_ROOT\",{\"name\":\"global\",\"hash\":{},\"data\":data}))\n    + \"symphony/\\\" class=\\\"color-fg color-bg\\\" target=\\\"_blank\\\">CMS</a>\\n\t</dd>\\n\t<dd id=\\\"toggle-tests\\\">\\n\t\t<a href=\\\"#toggle-tests\\\" class=\\\"color-fg color-bg\\\">Tests</a>\\n\t</dd>\\n\t<dd id=\\\"toggle-state\\\">\\n\t\t<a href=\\\"#toggle-state\\\" class=\\\"color-fg color-bg\\\">Route</a>\\n\t</dd>\\n\t<dd id=\\\"toggle-blocks-nav\\\">\\n\t\t<a href=\\\"#toggle-blocks-nav\\\" class=\\\"color-fg color-bg\\\">Nav</a>\\n\t</dd>\\n\t<dd id=\\\"toggle-blocks-content\\\">\\n\t\t<a href=\\\"#toggle-blocks-content\\\" class=\\\"color-fg color-bg\\\">Content</a>\\n\t</dd>\\n\t<dd id=\\\"toggle-mdown\\\">\\n\t\t<a href=\\\"#toggle-mdown\\\" class=\\\"color-fg color-bg\\\">Markdown</a>\\n\t</dd>\\n\t<dd id=\\\"toggle-tx\\\">\\n\t\t<a href=\\\"#toggle-tx\\\" class=\\\"color-fg color-bg\\\">TX/FX</a>\\n\t</dd>\\n\t<dd id=\\\"toggle-grid-bg\\\">\\n\t\t<a href=\\\"#toggle-grid-bg\\\" class=\\\"color-fg color-bg\\\">Grid</a>\\n\t</dd>\\n\t<dd id=\\\"toggle-graph\\\">\\n\t\t<a href=\\\"#toggle-graph\\\" class=\\\"color-fg color-bg\\\">Graph</a>\\n\t</dd>\\n\t<dd id=\\\"toggle-logs\\\">\\n\t\t<a href=\\\"#toggle-logs\\\" class=\\\"color-fg color-bg\\\">Logs</a>\\n\t</dd>\\n\t<dd id=\\\"media-info\\\">\\n\t\t<span></span>\\n\t</dd>\\n\t<dd id=\\\"viewport-info\\\">\\n\t\t<span></span>\\n\t</dd>\\n\t<dd id=\\\"app-state\\\">\\n\t\t<span class=\\\"color-fg color-bg\\\" data-prop=\\\"collapsed\\\">c</span><span class=\\\"color-fg color-bg\\\" data-prop=\\\"withBundle\\\">b</span><span class=\\\"color-fg color-bg\\\" data-prop=\\\"withMedia\\\">m</span><span class=\\\"color-fg color-bg\\\" data-prop=\\\"withArticle\\\">a</span>\\n\t</dd>\\n</dl>\\n<div id=\\\"test-results\\\">\\n\t<h6>Tests <a id=\\\"toggle-passed\\\" href=\\\"#toggle-passed\\\">Passed</a></h6>\\n\t<p>\"\n    + alias2(container.lambda(((stack1 = (depth0 != null ? depth0.navigator : depth0)) != null ? stack1.userAgent : stack1), depth0))\n    + \"</p>\\n\t<ul>\\n\"\n    + ((stack1 = helpers.each.call(alias1,(depth0 != null ? depth0.tests : depth0),{\"name\":\"each\",\"hash\":{},\"fn\":container.program(4, data, 0),\"inverse\":container.noop,\"data\":data})) != null ? stack1 : \"\")\n    + \"\t</ul>\\n</div>\\n\";\n},\"usePartial\":true,\"useData\":true});\n",
    "/**\n * @module app/model/BaseItem\n * @requires module:backbone\n */\n/** @type {module:backbone} */\nconst BaseModel = require(\"backbone\").Model;\n// /** @type {module:app/model/BaseModel} */\n// var BaseModel = require(\"app/model/BaseModel\");\n\n// /** @type {module:utils/strings/stripTags} */\n// const stripTags = require(\"utils/strings/stripTags\");\n// /** @type {module:app/control/Globals} */\n// const Globals = require(\"app/control/Globals\");\n\nmodule.exports = BaseModel.extend({\n\n\tdefaults: {\n\t\trouteName: \"initial\",\n\t\tfromRouteName: \"\",\n\t\tpage: \"\",\n\t\tarticle: null,\n\t\tbundle: null,\n\t\tmedia: null,\n\t\twithArticle: false,\n\t\twithBundle: false,\n\t\twithMedia: false,\n\t\tcollapsed: false\n\t},\n\n\tgetters: [\n\t\t\"page\",\n\t\t\"routeName\",\n\t\t\"fromRouteName\",\n\t\t\"article\",\n\t\t\"bundle\",\n\t\t\"media\",\n\t\t\"withArticle\",\n\t\t\"withBundle\",\n\t\t\"withMedia\",\n\t\t\"collapsed\"\n\t],\n\n\t// mutators: {\n\t// \trouteName: {\n\t// \t\tset: function(key, value, opts, set) {\n\t// \t\t\t// Set fromRoute to avoid losing current \"changing\" state\n\t// \t\t\tthis._previousAttributes[\"fromRouteName\"] = this.attributes[\"fromRouteName\"];\n\t// \t\t\tthis.changed[\"fromRouteName\"] = this.attributes[\"fromRouteName\"] = this.previous(\"routeName\");\n\t// \t\t\t// set(\"fromRouteName\", this.previous(\"routeName\"), {\n\t// \t\t\t// \tsilent: true\n\t// \t\t\t// });\n\t// \t\t}\n\t// \t}\n\t// },\n\n\tinitialize: function() {\n\t\t// this.listenTo(this, {\n\t\t// \t\"change:routeName\": function() {\n\t\t// \t\tthis.set(\"fromRouteName\", this.previous(\"routeName\"));\n\t\t// \t},\n\t\t// \t\"change:article\": function(val) {\n\t\t// \t\tconsole.log(\"%s:[change] %o\", this.cid, arguments);\n\t\t// \t\tthis.set(\"withArticle\", (typeof val === 'object'));\n\t\t// \t},\n\t\t// \t\"change:bundle\": function(val) {\n\t\t// \t\tconsole.log(\"%s:[change] %o\", this.cid, arguments);\n\t\t// \t\tthis.set(\"withBundle\", (typeof val === 'object'));\n\t\t// \t},\n\t\t// \t\"change:media\": function(val) {\n\t\t// \t\tconsole.log(\"%s:[change] %o\", this.cid, arguments);\n\t\t// \t\tthis.set(\"withMedia\", (typeof val === 'object'));\n\t\t// \t},\n\t\t// });\n\n\t\t// this.set({\n\t\t// \tfromRouteName: \"\",\n\t\t// \t\twithArticle: false,\n\t\t// \t\twithBundle: false,\n\t\t// \t\twithMedia: false\n\t\t// });\n\t\tvar opts = { silent: false };\n\n\t\tthis.listenTo(this, \"change\", function(attrs) {\n\t\t\t// var opts = { silent: false };\n\t\t\tif (this.hasChanged(\"routeName\")) {\n\t\t\t\tthis.set(\"fromRouteName\", this.previous(\"routeName\"), opts);\n\t\t\t}\n\t\t\tif (this.hasChanged(\"article\")) {\n\t\t\t\tthis.set(\"withArticle\", this.has(\"article\"), opts);\n\t\t\t}\n\t\t\tif (this.hasChanged(\"bundle\")) {\n\t\t\t\tthis.set(\"withBundle\", this.has(\"bundle\"), opts);\n\t\t\t}\n\t\t\tif (this.hasChanged(\"media\")) {\n\t\t\t\tthis.set(\"withMedia\", this.has(\"media\"), opts);\n\t\t\t}\n\t\t\t// this.set(\"pageTitle\", this._getDocumentTitle(), { silent: true });\n\t\t});\n\n\t\tthis.listenTo(this, \"change:routeName\",\n\t\t\tfunction(val) {\n\t\t\t\tconsole.log(\"%s:[change:routeName] %o\", this.cid, val);\n\t\t\t\t// this.set(\"fromRouteName\", this.previous(\"routeName\"));\n\t\t\t});\n\t\tthis.listenTo(this, \"change:article\",\n\t\t\tfunction(val) {\n\t\t\t\tconsole.log(\"%s:[change:article] %o\", this.cid, val);\n\t\t\t\t// this.set(\"withArticle\", _.isObject(val));\n\t\t\t});\n\t\tthis.listenTo(this, \"change:bundle\",\n\t\t\tfunction(val) {\n\t\t\t\tconsole.log(\"%s:[change:bundle] %o\", this.cid, val);\n\t\t\t\t// this.set(\"withBundle\", _.isObject(val));\n\t\t\t});\n\t\tthis.listenTo(this, \"change:media\",\n\t\t\tfunction(val) {\n\t\t\t\tconsole.log(\"%s:[change:media] %o\", this.cid, val);\n\t\t\t\t// this.set(\"withMedia\", _.isObject(val));\n\t\t\t});\n\t},\n\n\thasAnyPrevious: function(attr) {\n\t\treturn this.previous(attr) != null;\n\t},\n\n\thasAnyChanged: function(attr) {\n\t\treturn this.hasChanged(attr) && (this.has(attr) != this.hasAnyPrevious(attr));\n\t},\n\n\t// _getDocumentTitle: function() {\n\t// \tlet docTitle = [];\n\t// \tdocTitle.push(Globals.APP_NAME);\n\t// \tif (this.get(\"bundle\")) {\n\t// \t\tdocTitle.push(stripTags(this.get(\"bundle\").get(\"name\")));\n\t// \t\tif (this.model.get(\"media\")) {\n\t// \t\t\tdocTitle.push(stripTags(this.get(\"media\").get(\"name\")));\n\t// \t\t}\n\t// \t} else if (this.get(\"article\")) {\n\t// \t\tdocTitle.push(stripTags(this.get(\"article\").get(\"name\")));\n\t// \t}\n\t// \treturn _.unescape(docTitle.join(\" / \"));\n\t// }\n\n\t// constructor: function() {\n\t// \tObject.keys(this.defaults).forEach(function(getterName) {\n\t// \t\tObject.defineProperty(this, getterName, {\n\t// \t\t\tenumerable: true,\n\t// \t\t\tget: function() {\n\t// \t\t\t\treturn this.get(getterName);\n\t// \t\t\t}\n\t// \t\t});\n\t// \t});\n\t// \tBaseModel.apply(this, arguments);\n\t// }\n});\n",
    "/**\n * @module app/model/BaseItem\n * @requires module:backbone\n */\n\n/** @type {module:app/model/BaseModel} */\nconst BaseModel = require(\"app/model/BaseModel\");\n\n// /** @type {module:app/control/Globals} */\n// var Globals = require(\"app/control/Globals\");\n// /** @type {module:app/utils/strings/stripTags} */\n// var stripTags = require(\"utils/strings/stripTags\");\n// /** @type {module:app/model/parseSymAttrs} */\n//var parseSymAttrs = require(\"app/model/parseSymAttrs\");\n\nvar parseSymAttrs = function(s) {\n\treturn s.replace(/(\\,|\\;)/g, function(m) {\n\t\treturn (m == \",\") ? \";\" : \",\";\n\t});\n};\nvar toAttrsHash = function(obj, attr) {\n\tif (_.isString(attr)) {\n\t\tvar idx = attr.indexOf(\":\");\n\t\tif (idx > 0) {\n\t\t\tobj[attr.substring(0, idx)] = parseSymAttrs(attr.substring(idx + 1));\n\t\t} else {\n\t\t\tobj[attr] = attr; // to match HTML5<>XHTML valueless attributes\n\t\t}\n\t} // else ignore non-string values\n\treturn obj;\n};\n/**\n * @constructor\n * @type {module:app/model/BaseItem}\n */\nmodule.exports = BaseModel.extend({\n\n\t_domPrefix: \"_\",\n\n\t/** @type {Object} */\n\tdefaults: {\n\t\t// attrs: function() { return {}; },\n\t\tget attrs() {\n\t\t\treturn {};\n\t\t},\n\t},\n\n\tgetters: [\"domid\"],\n\n\tmutators: {\n\t\tdomid: function() {\n\t\t\tif (!this.hasOwnProperty(\"_domId\"))\n\t\t\t\tthis._domId = this._domPrefix + this.id;\n\t\t\treturn this._domId;\n\t\t},\n\t\tattrs: {\n\t\t\tset: function(key, value, options, set) {\n\t\t\t\tif (Array.isArray(value)) {\n\t\t\t\t\tvalue = value.reduce(toAttrsHash, {});\n\t\t\t\t}\n\t\t\t\tif (!_.isObject(value)) {\n\t\t\t\t\tconsole.error(\"%s::attrs value not an object or string array\", this.cid, value);\n\t\t\t\t\tvalue = {};\n\t\t\t\t}\n\t\t\t\tset(key, value, options);\n\t\t\t}\n\t\t},\n\t},\n\n\tattr: function(attr) {\n\t\treturn this.attrs()[attr];\n\t},\n\n\tattrs: function() {\n\t\treturn this.get(\"attrs\");\n\t},\n\n\ttoString: function() {\n\t\treturn this.get(\"domid\");\n\t},\n\n\tgetDistanceToSelected: function() {\n\t\tif (this.collection && this.collection.selectedIndex > 0) {\n\t\t\treturn this.collection.indexOf(this) - this.collection.selectedIndex;\n\t\t}\n\t\treturn -1;\n\t},\n\n\tgetIndex: function() {\n\t\tif (this.collection) {\n\t\t\treturn this.collection.indexOf(this);\n\t\t}\n\t\treturn -1;\n\t}\n});\n",
    "/**\n * @module app/model/BaseModel\n * @requires module:backbone\n */\n\n/** @type {module:backbone} */\nconst Backbone = require(\"backbone\");\n\nvar BaseModelProto = {\n\t// constructor: function() {\n\t// \tif (this.properties) {\n\t// \t\tObject.defineProperties(this, this.properties);\n\t// \t}\n\t// \tBackbone.Model.apply(this, arguments);\n\t// }\n};\n\nvar BaseModel = {\n\textend: function(proto, obj) {\n\t\tvar constr, propName; //, propDef;\n\t\tfor (propName in proto) {\n\t\t\tif (proto.hasOwnProperty(propName) && _.isObject(proto[propName])) { //(Object.getPrototypeOf(proto[propName]) === Object.prototype)) {\n\t\t\t\tproto[propName] = _.defaults(proto[propName], this.prototype[propName]);\n\t\t\t\t// console.log(\"BaseModel::extend '%s:%s' is Object\\n%s\", proto._domPrefix, propName, JSON.stringify(proto[propName]));\n\t\t\t}\n\t\t}\n\n\t\t// if (_.isObject(proto.properties)) {\n\t\t// \tif (Array.isArray(proto.getters)) {\n\t\t// \t\tproto.properties = _.omit(proto.properties, proto.getters);\n\t\t// \t}\n\t\t// }\n\t\t// if (proto.properties && this.prototype.properties) {\n\t\t// \t_.defaults(proto.properties, this.prototype.properties);\n\t\t// }\n\n\t\tconstr = Backbone.Model.extend.apply(this, arguments);\n\n\t\tif (Array.isArray(constr.prototype.getters)) {\n\t\t\tconstr.prototype.getters.forEach(function(getterName) {\n\t\t\t\tObject.defineProperty(constr.prototype, getterName, {\n\t\t\t\t\tenumerable: true,\n\t\t\t\t\tget: function() {\n\t\t\t\t\t\treturn this.get(getterName);\n\t\t\t\t\t}\n\t\t\t\t});\n\t\t\t});\n\t\t}\n\t\t// if (Array.isArray(constr.prototype.properties)) {\n\t\t// }\n\n\t\t// if (_.isObject(proto.properties)) {\n\t\t// \tfor (propName in proto.properties) {\n\t\t// \t\tif (proto.properties.hasOwnProperty(propName)) {\n\t\t// \t\t\tpropDef = proto.properties[propName];\n\t\t// \t\t\tif (_.isFunction(propDef)) {\n\t\t// \t\t\t\tproto.properties[propName] = {\n\t\t// \t\t\t\t\tenumerable: true, get: propDef\n\t\t// \t\t\t\t};\n\t\t// \t\t\t} else if (_.isObject(propDef)){\n\t\t// \t\t\t\tpropDef.enumerable = true;\n\t\t// \t\t\t} else {\n\t\t// \t\t\t\tdelete proto.properties[propName];\n\t\t// \t\t\t}\n\t\t// \t\t}\n\t\t// \t}\n\t\t// \tObject.defineProperties(proto, proto.properties);\n\t\t// \tdelete proto.properties;\n\t\t// }\n\t\treturn constr;\n\t}\n};\n\n/**\n * @constructor\n * @type {module:app/model/BaseModel}\n */\nmodule.exports = Backbone.Model.extend.call(Backbone.Model, BaseModelProto, BaseModel);\n// module.exports = Model.extend(BaseModelProto, BaseModel);\n",
    "/**\n * @module app/model/SelectableCollection\n */\n\n/** @type {module:backbone} */\nconst Backbone = require(\"backbone\");\n\n/**\n * @constructor\n * @type {module:app/model/SelectableCollection}\n */\nvar SelectableCollection = Backbone.Collection.extend({\n\n\tinitialize: function(models, options) {\n\t\toptions = _.defaults({}, options, {\n\t\t\tinitialSelection: \"none\",\n\t\t\tsilentInitial: true\n\t\t});\n\t\tthis.initialSelection = options.initialSelection;\n\t\tthis.initialOptions = {\n\t\t\tsilent: options.silentInitial\n\t\t};\n\t},\n\n\treset: function(models, options) {\n\t\tthis.deselect(this.initialOptions);\n\t\tBackbone.Collection.prototype.reset.apply(this, arguments);\n\t\tif (this.initialSelection === \"first\" && this.length) {\n\t\t\tthis.select(this.at(0), this.initialOptions);\n\t\t}\n\t},\n\n\tselect: function(newModel, options) {\n\t\tif (newModel === void 0) {\n\t\t\tnewModel = null;\n\t\t}\n\t\tif (this.selected === newModel) {\n\t\t\treturn;\n\t\t}\n\t\tvar triggerEvents = !(options && options.silent);\n\t\tvar oldModel = this.selected;\n\n\t\tthis.lastSelected = this.selected;\n\t\tthis.lastSelectedIndex = this.selectedIndex;\n\t\tthis.selected = newModel;\n\t\tthis.selectedIndex = this.indexOf(newModel);\n\n\t\tif (oldModel) {\n\t\t\tif (_.isFunction(oldModel.deselect)) {\n\t\t\t\toldModel.deselect(options);\n\t\t\t} else if (triggerEvents) {\n\t\t\t\toldModel.selected = void 0;\n\t\t\t\toldModel.trigger(\"deselected\", newModel, oldModel);\n\t\t\t}\n\t\t\tif (triggerEvents) this.trigger(\"deselect:one\", oldModel);\n\t\t} else {\n\t\t\tif (triggerEvents) this.trigger(\"deselect:none\", null);\n\t\t}\n\n\t\tif (newModel) {\n\t\t\tif (_.isFunction(newModel.select)) {\n\t\t\t\tnewModel.select(options);\n\t\t\t} else if (triggerEvents) {\n\t\t\t\tnewModel.selected = true;\n\t\t\t\tnewModel.trigger(\"selected\", newModel, oldModel);\n\t\t\t}\n\t\t\tif (triggerEvents) this.trigger(\"select:one\", newModel);\n\t\t} else {\n\t\t\tif (triggerEvents) this.trigger(\"select:none\", null);\n\t\t}\n\t},\n\n\tdeselect: function(options) {\n\t\tthis.select(null, options);\n\t},\n\n\tselectAt: function(index, options) {\n\t\tif (0 > index || index >= this.length) {\n\t\t\tnew RangeError(\"index is out of bounds\");\n\t\t}\n\t\tthis.select(this.at(index), options);\n\t},\n\n\tdistance: function(a, b) {\n\t\tvar aIdx, bIdx;\n\n\t\tif (!a) return NaN;\n\t\taIdx = this.indexOf(a);\n\t\tif (aIdx == -1) return NaN;\n\n\t\tif (arguments.length == 1) {\n\t\t\tbIdx = this.selectedIndex;\n\t\t} else {\n\t\t\tif (!b) return NaN;\n\t\t\tbIdx = this.indexOf(b);\n\t\t\tif (bIdx == -1) return NaN;\n\t\t}\n\t\treturn Math.abs(bIdx - aIdx);\n\t},\n\n\t/* TODO: MOVE INTO MIXIN */\n\n\t/** @return boolean\t/*/\n\thasFollowing: function(model) {\n\t\tmodel || (model = this.selected);\n\t\treturn this.indexOf(model) < (this.length - 1);\n\t},\n\n\t/** @return next model\t*/\n\tfollowing: function(model) {\n\t\tmodel || (model = this.selected);\n\t\treturn this.hasFollowing(model) ? this.at(this.indexOf(model) + 1) : null;\n\t},\n\n\t/** @return next model or the beginning if at the end */\n\tfollowingOrFirst: function(model) {\n\t\tmodel || (model = this.selected);\n\t\treturn this.at((this.indexOf(model) + 1) % this.length);\n\t},\n\n\t/** @return boolean\t/*/\n\thasPreceding: function(model) {\n\t\tmodel || (model = this.selected);\n\t\treturn this.indexOf(model) > 0;\n\t},\n\n\t/** @return the previous model */\n\tpreceding: function(model) {\n\t\tmodel || (model = this.selected);\n\t\treturn this.hasPreceding(model) ? this.at(this.indexOf(model) - 1) : null;\n\t},\n\n\t/** @return the previous model or the end if at the beginning */\n\tprecedingOrLast: function(model) {\n\t\tmodel || (model = this.selected);\n\t\tvar index = this.indexOf(model) - 1;\n\t\treturn this.at(index > -1 ? index : this.length - 1);\n\t},\n\n});\n\nmodule.exports = SelectableCollection;\n",
    "/**\n * @module app/model/collection/ArticleCollection\n */\n\n/** @type {module:app/model/SelectableCollection} */\nconst SelectableCollection = require(\"app/model/SelectableCollection\");\n\n/** @type {module:app/model/item/ArticleItem} */\nconst ArticleItem = require(\"app/model/item/ArticleItem\");\n\n/**\n * @constructor\n * @type {module:app/model/collection/ArticleCollection}\n */\nvar ArticleCollection = SelectableCollection.extend({\n\n\t/** @type {Backbone.Model} */\n\tmodel: ArticleItem\n\n});\n\nmodule.exports = new ArticleCollection();\n",
    "/**\n * @module app/model/collection/BundleCollection\n */\n\n/** @type {module:app/model/SelectableCollection} */\nconst SelectableCollection = require(\"app/model/SelectableCollection\");\n\n/** @type {module:app/model/item/BundleItem} */\nconst BundleItem = require(\"app/model/item/BundleItem\");\n\n/**\n * @constructor\n * @type {module:app/model/collection/BundleCollection}\n */\nvar BundleCollection = SelectableCollection.extend({\n\n\t/** @type {Backbone.Model} */\n\tmodel: BundleItem,\n\n\t/** @type {Function} */\n\tcomparator: function(oa, ob) {\n\t\tvar a = oa.get(\"completed\");\n\t\tvar b = ob.get(\"completed\");\n\t\tif (a > b) {\n\t\t\treturn -1;\n\t\t} else if (a < b) {\n\t\t\treturn 1;\n\t\t} else {\n\t\t\treturn 0;\n\t\t}\n\t},\n\n\t/** @type {String} */\n\turl: \"/json/bundles/\",\n\n});\n\nmodule.exports = new BundleCollection();\n",
    "/**\n * @module app/model/collection/KeywordCollection\n * @requires module:backbone\n */\n\n/** @type {module:app/model/SelectableCollection} */\nconst SelectableCollection = require(\"app/model/SelectableCollection\");\n\n/** @type {module:app/model/item/KeywordItem} */\nconst KeywordItem = require(\"app/model/item/KeywordItem\");\n\n/**\n * @constructor\n * @type {module:app/model/collection/KeywordCollection}\n */\nvar KeywordCollection = SelectableCollection.extend({\n\n\t/** @type {Backbone.Model} */\n\tmodel: KeywordItem\n\n});\n\nmodule.exports = new KeywordCollection();\n",
    "/**\n * @module app/model/collection/TypeCollection\n * @requires module:backbone\n */\n\n/** @type {module:backbone} */\nconst Backbone = require(\"backbone\");\n\n/** @type {module:app/model/item/TypeItem} */\nconst TypeItem = require(\"app/model/item/TypeItem\");\n\n/**\n * @constructor\n * @type {module:app/model/collection/TypeCollection}\n */\nvar TypeCollection = Backbone.Collection.extend({\n\n\t/** @type {Backbone.Model} */\n\tmodel: TypeItem\n\n});\n\nmodule.exports = new TypeCollection();\n",
    "module.exports = function(bootstrap) {\n\n\t/** @type {module:app/control/Globals} */\n\tvar Globals = require(\"app/control/Globals\");\n\n\t// Globals.GA_TAGS = bootstrap[\"ga-tags\"];\n\t// Globals.PARAMS = bootstrap[\"params\"];\n\t// Globals.APP_ROOT = bootstrap[\"params\"][\"root\"];\n\t// Globals.MEDIA_DIR = bootstrap[\"params\"][\"uploads\"];\n\tGlobals.APP_NAME = bootstrap[\"params\"][\"website-name\"];\n\n\t/** @type {module:app/model/collection/TypeCollection} */\n\tvar typeList = require(\"app/model/collection/TypeCollection\");\n\t/** @type {module:app/model/collection/KeywordCollection} */\n\tvar keywordList = require(\"app/model/collection/KeywordCollection\");\n\t/** @type {module:app/model/collection/BundleCollection} */\n\tvar bundleList = require(\"app/model/collection/BundleCollection\");\n\t/** @type {module:app/model/collection/ArticleCollection} */\n\tvar articleList = require(\"app/model/collection/ArticleCollection\");\n\n\t// Fix-ups to bootstrap data.\n\tvar articles = bootstrap[\"articles-all\"];\n\tvar types = bootstrap[\"types-all\"];\n\tvar keywords = bootstrap[\"keywords-all\"];\n\tvar bundles = bootstrap[\"bundles-all\"];\n\tvar media = bootstrap[\"media-all\"];\n\n\t// Attach media to their bundles\n\tvar mediaByBundle = _.groupBy(media, \"bId\");\n\n\t// Fill-in back-references:\n\t// Create Keyword.bundleIds from existing Bundle.keywordIds,\n\t// then Bundle.typeIds from unique Keyword.typeId\n\n\t// _.each(bundles, function (bo, bi, ba) {\n\tbundles.forEach(function(bo, bi, ba) {\n\t\tbo.tIds = [];\n\t\tbo.media = mediaByBundle[bo.id];\n\t\t// _.each(keywords, function (ko, ki, ka) {\n\t\tkeywords.forEach(function(ko, ki, ka) {\n\t\t\tif (bi === 0) {\n\t\t\t\tko.bIds = [];\n\t\t\t}\n\t\t\t// if (_.contains(bo.kIds, ko.id)) {\n\t\t\tif (bo.kIds.indexOf(ko.id) != -1) {\n\t\t\t\tko.bIds.push(bo.id);\n\t\t\t\t// if (!_.contains(bo.tIds, ko.tId)) {\n\t\t\t\tif (bo.tIds.indexOf(ko.tId) == -1) {\n\t\t\t\t\tbo.tIds.push(ko.tId);\n\t\t\t\t}\n\t\t\t}\n\t\t});\n\t});\n\n\t// Fill collection singletons\n\tarticleList.reset(articles);\n\ttypeList.reset(types);\n\tkeywordList.reset(keywords);\n\tbundleList.reset(bundles);\n\n\t// bootstrap[\"params\"] = bootstrap[\"articles-all\"] = bootstrap[\"types-all\"] = bootstrap[\"keywords-all\"] = bootstrap[\"bundles-all\"] = bootstrap[\"media-all\"] = null;\n};\n",
    "/**\n * @module app/model/item/ArticleItem\n */\n\n// /** @type {module:backbone} */\n// var Backbone = require(\"backbone\");\n/** @type {module:app/model/item/SourceItem} */\nconst BaseItem = require(\"app/model/BaseItem\");\n\n/**\n * @constructor\n * @type {module:app/model/item/ArticleItem}\n */\nmodule.exports = BaseItem.extend({\n\n\t_domPrefix: \"a\",\n\n\t/** @type {Object} */\n\tdefaults: {\n\t\tname: \"\",\n\t\thandle: \"\",\n\t\ttext: \"\"\n\t},\n\n});\n",
    "/**\n * @module app/model/item/BundleItem\n * @requires module:backbone\n */\n\n// /** @type {module:backbone} */\n// var Backbone = require(\"backbone\");/** @type {Function} */\nconst Color = require(\"color\");\n\n/** @type {module:app/model/item/SourceItem} */\nconst BaseItem = require(\"app/model/BaseItem\");\n/** @type {module:app/model/item/MediaItem} */\nconst MediaItem = require(\"app/model/item/MediaItem\");\n/** @type {module:app/model/SelectableCollection} */\nconst SelectableCollection = require(\"app/model/SelectableCollection\");\n\n/** @type {module:app/control/Globals} */\nconst Globals = require(\"app/control/Globals\");\n/** @type {module:app/utils/strings/stripTags} */\nconst stripTags = require(\"utils/strings/stripTags\");\n// /** @type {module:app/utils/strings/parseTaglist} */\n// var parseSymAttrs = require(\"app/model/parseSymAttrs\");\n\n// /** @type {module:app/model/collection/KeywordCollection} */\n// var keywords = require(\"app/model/collection/KeywordCollection\");\n\n// Globals.DEFAULT_COLORS[\"color\"];\n// Globals.DEFAULT_COLORS[\"background-color\"];\nvar attrsDefault = _.defaults({\n\t\"has-colors\": \"defaults\"\n}, Globals.DEFAULT_COLORS);\n\n/** @private */\nvar MediaCollection = SelectableCollection.extend({\n\tmodel: MediaItem,\n\tcomparator: \"o\"\n});\n\n/**\n * @constructor\n * @type {module:app/model/item/BundleItem}\n */\nmodule.exports = BaseItem.extend({\n\n\t_domPrefix: \"b\",\n\n\t/** @type {Object|Function} */\n\t// defaults: function() {\n\t// \treturn {\n\t// \t\tname: \"\",\n\t// \t\thandle: \"\",\n\t// \t\tdesc: \"\",\n\t// \t\tcompleted: 0,\n\t// \t\tkIds: [],\n\t// \t};\n\t// },\n\tdefaults: {\n\t\tname: \"\",\n\t\thandle: \"\",\n\t\tdesc: \"\",\n\t\tcompleted: 0,\n\t\tget kIds() {\n\t\t\treturn [];\n\t\t},\n\t\t// get keywords() { return []; },\n\t},\n\n\tgetters: [\"name\", \"media\"],\n\n\tmutators: {\n\t\ttext: function() {\n\t\t\treturn stripTags(this.get(\"desc\"));\n\t\t},\n\t\t// kIds: {\n\t\t// \tset: function (key, value, options, set) {\n\t\t// \t\tif (Array.isArray(value)) {\n\t\t// \t\t\tset(\"keywords\", value.map(function(id) {\n\t\t// \t\t\t\tvar obj = keywords.get(id);\n\t\t// \t\t\t\treturn obj;\n\t\t// \t\t\t}, this), options;\n\t\t// \t\t}\n\t\t// \t\tset(key, value, options);\n\t\t// \t},\n\t\t// },\n\t\tmedia: {\n\t\t\ttransient: true,\n\t\t\tset: function(key, value, options, set) {\n\t\t\t\tif (Array.isArray(value)) {\n\t\t\t\t\tvalue.forEach(function(o) {\n\t\t\t\t\t\to.bundle = this;\n\t\t\t\t\t}, this);\n\t\t\t\t\tvalue = new MediaCollection(value);\n\t\t\t\t}\n\t\t\t\tset(key, value, options);\n\t\t\t},\n\t\t},\n\t},\n\n\tinitialize: function(attrs, options) {\n\t\tthis.colors = {\n\t\t\tfgColor: new Color(this.attr(\"color\")),\n\t\t\tbgColor: new Color(this.attr(\"background-color\")),\n\t\t\tlnColor: new Color(this.attr(\"link-color\")),\n\t\t};\n\t\tthis.colors.hasDarkBg = this.colors.fgColor.luminosity() > this.colors.bgColor.luminosity();\n\t},\n\n\tattrs: function() {\n\t\treturn this._attrs || (this._attrs = _.defaults({}, this.get(\"attrs\"), attrsDefault));\n\t},\n});\n",
    "/**\n * @module app/model/item/KeywordItem\n * @requires module:app/model/BaseItem\n */\n\n/** @type {module:app/model/BaseItem} */\nconst BaseItem = require(\"app/model/BaseItem\");\n\n// /** @type {module:app/model/collection/TypeCollection} */\n// var types = require(\"app/model/collection/TypeCollection\");\n\n/**\n * @constructor\n * @type {module:app/model/item/KeywordItem}\n */\nmodule.exports = BaseItem.extend({\n\n\t_domPrefix: \"k\",\n\n\t/** @type {Object} */\n\tdefaults: {\n\t\tname: \"\",\n\t\thandle: \"\",\n\t\ttId: -1,\n\t},\n\n\t// mutators: {\n\t// \ttId: {\n\t// \t\tset: function (key, value, options, set) {\n\t// \t\t\tvar type = types.get(value);\n\t// \t\t\tif (type) {\n\t// \t\t\t\ttype.get(\"keywords\").push(this);\n\t// \t\t\t\tset(\"type\", type, options);\n\t// \t\t\t}\n\t// \t\t\tset(key, value, options);\n\t// \t\t}\n\t// \t},\n\t// }\n});\n",
    "/**\n * @module app/model/item/MediaItem\n * @requires module:backbone\n */\n\n// /** @type {module:backbone} */\n// var Backbone = require(\"backbone\");/** @type {Function} */\nconst Color = require(\"color\");\n\n/** @type {module:app/model/item/SourceItem} */\nconst BaseItem = require(\"app/model/BaseItem\");\n/** @type {module:app/model/item/SourceItem} */\nconst SourceItem = require(\"app/model/item/SourceItem\");\n/** @type {module:app/model/SelectableCollection} */\nconst SelectableCollection = require(\"app/model/SelectableCollection\");\n\n/** @type {module:app/control/Globals} */\nconst Globals = require(\"app/control/Globals\");\n/** @type {module:app/utils/strings/stripTags} */\nconst stripTags = require(\"utils/strings/stripTags\");\n// /** @type {module:app/model/parseSymAttrs} */\n// var parseSymAttrs = require(\"app/model/parseSymAttrs\");\n\n// console.log(Globals.PARAMS);\n\nvar urlTemplates = {\n\t\"original\": _.template(Globals.MEDIA_DIR + \"/<%= src %>\"),\n\t\"constrain-width\": _.template(Globals.APP_ROOT + \"image/1/<%= width %>/0/uploads/<%= src %>\"),\n\t\"constrain-height\": _.template(Globals.APP_ROOT + \"image/1/0/<%= height %>/uploads/<%= src %>\"),\n\t\"debug-bandwidth\": _.template(Globals.MEDIA_DIR.replace(/(https?\\:\\/\\/[^\\/]+)/, \"$1/slow/<%= kbps %>\") + \"/<%= src %>\"),\n};\n\n/**\n * @constructor\n * @type {module:app/model/item/MediaItem.SourceCollection}\n */\nvar SourceCollection = SelectableCollection.extend({\n\tmodel: SourceItem\n});\n\n/**\n * @constructor\n * @type {module:app/model/item/MediaItem}\n */\nmodule.exports = BaseItem.extend({\n\n\t_domPrefix: \"m\",\n\n\t/** @type {Object} */\n\tdefaults: {\n\t\tname: \"<p><em>Untitled</em></p>\",\n\t\tsub: \"\",\n\t\to: 0,\n\t\tbId: -1,\n\t\tsrcIdx: 0,\n\t\tget srcset() {\n\t\t\treturn [];\n\t\t},\n\t\tget sources() {\n\t\t\treturn new SourceCollection();\n\t\t},\n\t},\n\n\tgetters: [\"name\", \"bundle\", \"source\", \"sources\"],\n\n\tmutators: {\n\t\t// desc: function() {\n\t\t// \treturn this.get(\"name\");\n\t\t// },\n\t\thandle: function() {\n\t\t\treturn this.get(\"src\");\n\t\t},\n\t\ttext: function() {\n\t\t\tif (!this.hasOwnProperty(\"_text\"))\n\t\t\t\tthis._text = _.unescape(stripTags(this.get(\"name\")));\n\t\t\treturn this._text;\n\t\t},\n\t\tattrs: {\n\t\t\tset: function(key, value, opts, set) {\n\t\t\t\tthis._attrs = null;\n\t\t\t\tBaseItem.prototype.mutators.attrs.set.apply(this, arguments);\n\t\t\t\tthis._updateSources();\n\t\t\t}\n\t\t},\n\t\tsrcset: {\n\t\t\tset: function(key, value, opts, set) {\n\t\t\t\tset(key, value, opts);\n\t\t\t\tthis.get(\"sources\").reset(value, opts);\n\t\t\t\tthis._updateSources();\n\t\t\t}\n\t\t},\n\t\tsource: {\n\t\t\ttransient: true,\n\t\t\tget: function() {\n\t\t\t\treturn this.get(\"sources\").at(this.get(\"srcIdx\"));\n\t\t\t},\n\t\t},\n\t},\n\n\tinitialize: function() {\n\t\tthis._updateColors();\n\t\tthis.listenTo(this, \"change:attrs change:bundle\", function() {\n\t\t\tthis._attrs = null;\n\t\t});\n\t},\n\n\tattrs: function() {\n\t\treturn this._attrs || (this._attrs = _.defaults({}, this.get(\"bundle\").attrs(), this.get(\"attrs\")));\n\t},\n\n\t_updateColors: function() {\n\t\tthis.colors = {\n\t\t\tfgColor: new Color(this.attr(\"color\")),\n\t\t\tbgColor: new Color(this.attr(\"background-color\"))\n\t\t};\n\t\tthis.colors.hasDarkBg = this.colors.fgColor.luminosity() > this.colors.bgColor.luminosity();\n\t},\n\n\t_updateSources: function() {\n\t\tvar srcObj = {\n\t\t\tkbps: this.attr(\"@debug-bandwidth\")\n\t\t};\n\t\tvar srcTpl = urlTemplates[srcObj.kbps ? \"debug-bandwidth\" : \"original\"];\n\t\tthis.get(\"sources\").forEach(function(item) {\n\t\t\tsrcObj.src = item.get(\"src\");\n\t\t\titem.set(\"original\", srcTpl(srcObj));\n\t\t});\n\t},\n\n\t// _updateSourcesArr: function() {\n\t// \tvar srcset = this.get(\"srcset\");\n\t// \tif (Array.isArray(srcset)) {\n\t// \t\tvar srcObj = { kbps: this.attr(\"@debug-bandwidth\") };\n\t// \t\tvar srcTpl = Globals.MEDIA_SRC_TPL[srcObj.kbps? \"debug-bandwidth\" : \"original\"];\n\t// \t\tsrcset.forEach(function(o) {\n\t// \t\t\tsrcObj.src = o.src;\n\t// \t\t\to.original = srcTpl(srcObj);\n\t// \t\t}, this);\n\t// \t}\n\t// \tthis.get(\"sources\").reset(srcset);\n\t// },\n\n});\n",
    "/**\n * @module app/model/item/SourceItem\n * @requires module:backbone\n */\n\n// /** @type {module:backbone} */\n// var Backbone = require(\"backbone\");\n// /** @type {module:app/control/Globals} */\n// var Globals = require(\"app/control/Globals\");\n/** @type {module:app/model/item/SourceItem} */\nconst BaseItem = require(\"app/model/BaseItem\");\n\n/** @type {String} */\nvar noCacheSuffix = \"?\" + Date.now();\n\n/**\n * @constructor\n * @type {module:app/model/item/SourceItem}\n */\n// module.exports = Backbone.Model.extend({\nmodule.exports = BaseItem.extend({\n\n\t/** @type {Object} */\n\tdefaults: {\n\t\tsrc: null,\n\t\tmime: null,\n\t\tw: null,\n\t\th: null,\n\t},\n\n\tgetters: [\"src\", \"original\"],\n\n\tmutators: {\n\t\tsrc: {\n\t\t\tset: function(key, value, options, set) {\n\t\t\t\tif (DEBUG) {\n\t\t\t\t\tvalue += noCacheSuffix;\n\t\t\t\t}\n\t\t\t\tset(key, value, options);\n\t\t\t}\n\t\t},\n\t\t// original: { \n\t\t// \ttransient: true,\n\t\t// \tget: function (key, value, options, set) {\n\t\t// \t\treturn this.attributes.original || (this.attributes.original = this._composeOriginalSrc());\n\t\t// \t},\n\t\t// },\n\t\t// media: {\n\t\t// \ttransient: true,\n\t\t// \tget: function () {\n\t\t// \t\tvar retval;\n\t\t// \t\tif (this._noRecusion) {\n\t\t// \t\t\tconsole.log(\"%s::media returning null\", this.cid);\n\t\t// \t\t\tretval = null;//this.id;\n\t\t// \t\t} else {\n\t\t// \t\t\tconsole.log(\"%s::media returning Object\", this.cid);\n\t\t// \t\t\tthis._noRecusion = true;\n\t\t// \t\t\tretval = this.attributes.media;\n\t\t// \t\t\tthis._noRecusion = false;\n\t\t// \t\t}\n\t\t// \t\treturn retval;\n\t\t// \t},\n\t\t// \tset: function (key, value, options, set) {\n\t\t// \t\tif (value instanceof BaseItem) {\n\t\t// \t\t\tset(key, value, options);\n\t\t// \t\t}\n\t\t// \t},\n\t\t// },\n\t},\n\n\t// initialize: function() {\n\t// \tif (DEBUG) {\n\t// \t\tvar cb = function() {\n\t// \t\t\t// console.log(\"@debug-bandwidth:\", JSON.stringify(this.get(\"media\").attr(\"@debug-bandwidth\")));\n\t// \t\t\tconsole.log(\"media:\", JSON.stringify(this.toJSON()));\n\t// \t\t\t// if ((this.get(\"media\") instanceof BaseItem) && this.get(\"media\").attr(\"@debug-bandwidth\")) {\n\t// \t\t\t// \tconsole.log(\"original\", this.get(\"original\"));\n\t// \t\t\t// \tconsole.log(\"media:\", JSON.stringify(this.get(\"media\").toJSON()));\n\t// \t\t\t// }\n\t// \t\t}.bind(this);\n\t// \t\twindow.requestAnimationFrame(cb);\n\t// \t}\n\t// },\n\t// \n\t// _composeOriginalSrc: function() {\n\t// \tvar values = { src: this.get(\"src\") };\n\t// \tif (this.has(\"media\") && (values.kbps = this.get(\"media\").attr(\"@debug-bandwidth\"))) {\n\t// \t// if (this.has(\"media\") && this.get(\"media\").attrs().hasOwnProperty(\"@debug-bandwidth\")) {\n\t// \t// \tvalues.kbps = this.get(\"media\").attrs()[\"@debug-bandwidth\"];\n\t// \t\treturn Globals.MEDIA_SRC_TPL[\"debug-bandwidth\"](values);\n\t// \t}\n\t// \treturn Globals.MEDIA_SRC_TPL[\"original\"](values);\n\t// },\n});\n",
    "/**\n * @module app/model/item/TypeItem\n */\n\n// /** @type {module:backbone} */\n// var Backbone = require(\"backbone\");\n/** @type {module:app/model/item/SourceItem} */\nconst BaseItem = require(\"app/model/BaseItem\");\n\n/**\n * @constructor\n * @type {module:app/model/item/TypeItem}\n */\nmodule.exports = BaseItem.extend({\n\n\t_domPrefix: \"t\",\n\n\t/** @type {Object} */\n\tdefaults: {\n\t\tname: \"\",\n\t\thandle: \"\",\n\t\t// get kIds() { return []; },\n\t\t// get keywords() { return []; },\n\t},\n\n});\n",
    "/**\n * @module app/view/AppView\n */\n\n/** @type {module:backbone} */\nconst Backbone = require(\"backbone\");\n\n/** @type {module:app/utils/debug/traceArgs} */\nconst stripTags = require(\"utils/strings/stripTags\");\n\n/** @type {module:app/control/Globals} */\nconst Globals = require(\"app/control/Globals\");\n/** @type {module:app/control/Controller} */\nconst controller = require(\"app/control/Controller\");\n/** @type {module:app/model/AppState} */\nconst AppState = require(\"app/model/AppState\");\n/** @type {module:app/model/collection/BundleCollection} */\nconst bundles = require(\"app/model/collection/BundleCollection\");\n/** @type {module:app/model/collection/ArticleCollection} */\nconst articles = require(\"app/model/collection/ArticleCollection\");\n\n/** @type {module:app/view/base/View} */\nconst View = require(\"app/view/base/View\");\n/** @type {module:app/view/NavigationView} */\nconst NavigationView = require(\"app/view/NavigationView\");\n/** @type {module:app/view/ContentView} */\nconst ContentView = require(\"app/view/ContentView\");\n\n\n/** @type {module:app/view/base/TouchManager} */\nconst TouchManager = require(\"app/view/base/TouchManager\");\n// /** @type {module:hammerjs} */\n// const Hammer = require(\"hammerjs\");\n// /** @type {module:utils/touch/SmoothPanRecognizer} */\n// const Pan = require(\"utils/touch/SmoothPanRecognizer\");\n// /** @type {module:hammerjs.Tap} */\n// const Tap = Hammer.Tap;\n\n// /** @type {module:utils/debug/traceElement} */\n// const traceElement = require(\"utils/debug/traceElement\");\n//\n// const vpanLogFn = _.debounce(console.log.bind(console), 100, false);\n// const hpanLogFn = _.debounce(console.log.bind(console), 100, false);\n\n/**\n * @constructor\n * @type {module:app/view/AppView}\n */\nmodule.exports = View.extend({\n\n\t/** @override */\n\tcidPrefix: \"app\",\n\t/** @override */\n\tel: \"html\",\n\t// /** @override */\n\tclassName: \"app\", // without-bundle without-media without-article\",\n\t/** @override */\n\tmodel: AppState,\n\n\t/** @override */\n\tevents: {\n\t\t\"visibilitychange\": function(ev) {\n\t\t\tconsole.log(\"%s:[%s]\", this.cid, ev.type);\n\t\t},\n\t\t\"fullscreenchange\": function(ev) {\n\t\t\tconsole.log(\"%s:[%s] fullscreen: %o\", this.cid, ev.type, (document.fullscreenElement !== null), document.fullscreen);\n\t\t},\n\t\t\"dragstart\": function(ev) {\n\t\t\tif (ev.target.nodeName == \"IMG\" || ev.target.nodeName == \"A\") {\n\t\t\t\tev.defaultPrevented || ev.preventDefault();\n\t\t\t}\n\t\t},\n\t\t// \"touchmove body\": function(ev) {\n\t\t// \tev.defaultPrevented || ev.preventDefault();\n\t\t// },\n\t},\n\n\tproperties: {\n\t\tcontainer: {\n\t\t\tget: function() {\n\t\t\t\treturn this._container ||\n\t\t\t\t\t(this._container = document.getElementById(\"container\"));\n\t\t\t\t// (this._container = document.body);\n\t\t\t}\n\t\t},\n\t\tnavigation: {\n\t\t\tget: function() {\n\t\t\t\treturn this._navigation ||\n\t\t\t\t\t(this._navigation = document.getElementById(\"navigation\"));\n\t\t\t}\n\t\t},\n\t\tcontent: {\n\t\t\tget: function() {\n\t\t\t\treturn this._content ||\n\t\t\t\t\t(this._content = document.getElementById(\"content\"));\n\t\t\t}\n\t\t},\n\t},\n\n\t/** @override */\n\tinitialize: function(options) {\n\t\t/* elements */\n\t\t// this.routeEl = this.el;\n\t\t// this.stateEl = this.el\n\t\tthis.breakpointEl = this.el;\n\n\t\t/* init HammerJS handlers */\n\t\tvar vtouch, htouch, touchEl;\n\t\t// var vpan, hpan, tap;\n\n\t\t// this._vpanEnableFn = function(mc, ev) {\n\t\t// \tvar retval = !this._hasOverflowY(this.container);\n\t\t// \tvpanLogFn(\"%s::_vpanEnableFn -> %o\\n%o\", this.cid, retval, arguments);\n\t\t// \treturn retval;\n\t\t// }.bind(this);\n\t\t//\n\t\t// this._hpanEnableFn = function(mc, ev) {\n\t\t// \tvar retval = this.model.get(\"withBundle\") && this.model.get(\"collapsed\");\n\t\t// \thpanLogFn(\"%s::_hpanEnableFn -> %o\\n%o\", this.cid, retval, arguments);\n\t\t// \treturn !!retval;\n\t\t// }.bind(this);\n\n\t\ttouchEl = this.content;\n\t\t// touchEl = document.body;\n\t\tvtouch = htouch = TouchManager.init(touchEl);\n\n\t\t// vtouch.get(\"vpan\").set({ enable: this._vpanEnableFn });\n\t\t// htouch.get(\"hpan\").set({ enable: this._hpanEnableFn });\n\t\t// \t\tvtouch.set({\n\t\t// \t\t\tenable: function() {\n\t\t// \t\t\t\tconsole.log(\"app1::hammerjs enable\", arguments);\n\t\t// \t\t\t\treturn true;\n\t\t// \t\t\t}\n\t\t// \t\t});\n\t\t// hpan = vpan;\n\n\t\t// this.el.style.touchAction = \"none\"; //\"pan-x pan-y\";\n\n\t\t// tap = new Hammer.Tap();\n\t\t// hpan = new Pan({\n\t\t// \tevent: \"hpan\",\n\t\t// \tdirection: Hammer.DIRECTION_HORIZONTAL\n\t\t// });\n\t\t// hpan.set({\n\t\t// \tenable: this._hpanEnableFn\n\t\t// });\n\t\t// vpan = new Pan({\n\t\t// \tevent: \"vpan\",\n\t\t// \tdirection: Hammer.DIRECTION_VERTICAL\n\t\t// });\n\t\t// vpan.set({\n\t\t// \tenable: this._vpanEnableFn\n\t\t// });\n\t\t// hpan.requireFailure(vpan);\n\t\t// vpan.requireFailure(hpan);\n\t\t// vtouch.add([]);\n\n\t\t// htouch = vtouch = new Hammer.Manager(this.content);\n\t\t// htouch.add([tap, hpan, vpan]);\n\t\t// htouch.add([hpan, vpan]);\n\t\t// htouch.set({ touchAction: \"pan-x pan-y\" });\n\n\t\t// vpan = new Hammer(this.navigation, {\n\t\t// \trecognizers: [\n\t\t// \t\t[Pan, {\n\t\t// \t\t\tevent: 'vpan',\n\t\t// \t\t\ttouchAction: \"pan-y\",\n\t\t// \t\t\tdirection: Hammer.DIRECTION_VERTICAL,\n\t\t// \t\t\tenable: vpanEnableFn\n\t\t// \t\t}],\n\t\t// \t]\n\t\t// });\n\t\t// hpan = new Hammer(this.content, {\n\t\t// \trecognizers: [\n\t\t// \t\t[Pan, {\n\t\t// \t\t\tevent: 'hpan',\n\t\t// \t\t\ttouchAction: \"pan-x\",\n\t\t// \t\t\tdirection: Hammer.DIRECTION_HORIZONTAL,\n\t\t// \t\t\tenable: hpanEnableFn\n\t\t// \t\t}],\n\t\t// \t\t[Tap]\n\t\t// \t]\n\t\t// });\n\t\t// hpan.get(\"hpan\").requireFailure(vpan.get(\"vpan\"));\n\n\t\t// this._afterRender = this._afterRender.bind(this);\n\t\tthis._onResize = this._onResize.bind(this);\n\n\t\t/* render on resize, onorientationchange, visibilitychange */\n\t\t// window.addEventListener(\"orientationchange\", this._onResize, false);\n\t\t// window.addEventListener(\"resize\", _.debounce(this._onResize.bind(this), 30, false), false);\n\t\twindow.addEventListener(\"resize\", this._onResize, false);\n\n\t\t// var h = function(ev) { console.log(ev.type, ev) };\n\t\t// window.addEventListener(\"scroll\", h, false);\n\t\t// window.addEventListener(\"wheel\", h, false);\n\n\t\t/* TODO: replace resize w/ mediaquery listeners. Caveat: some components\n\t\t(vg. Carousel) require update on resize */\n\t\t// this._onBreakpointChange = this._onBreakpointChange.bind(this);\n\t\t// Object.keys(Globals.BREAKPOINTS).forEach(function(s) {\n\t\t// \tGlobals.BREAKPOINTS[s].addListeners(this._onBreakpointChange);\n\t\t// }, this);\n\n\n\t\t/* initialize controller/model listeners BEFORE views register their own */\n\t\tthis.listenTo(controller, \"route\", this._onRoute);\n\t\t// this.listenTo(controller, \"change:after\", this._afterControllerChanged);\n\t\tthis.listenTo(this.model, \"change\", this._onModelChange); /* FIXME */\n\n\t\t/* initialize views */\n\t\tthis.navigationView = new NavigationView({\n\t\t\tel: this.navigation,\n\t\t\tmodel: this.model,\n\t\t\tvpan: vtouch,\n\t\t\thpan: htouch\n\t\t});\n\n\t\tthis.contentView = new ContentView({\n\t\t\tel: this.content,\n\t\t\tmodel: this.model,\n\t\t\tvpan: vtouch,\n\t\t\thpan: htouch,\n\t\t});\n\n\t\t/* TouchEvents fixups\n\t\t * ------------------------------- */\n\t\t// var traceTouchEvent = (msg, traceObj) => {\n\t\t// \tif (msg.hasOwnProperty(\"type\")) {\n\t\t// \t\tmsg = msg.type + \" : \" +\n\t\t// \t\t\t(msg.defaultPrevented ? \"prevented\" : \"not prevented\");\n\t\t// \t}\n\t\t// \tvar sy, sh, ch;\n\t\t// \tsy = this.el.scrollTop;\n\t\t// \tsh = this.el.scrollHeight - 1;\n\t\t// \tch = this.el.clientHeight;\n\t\t// \tconsole.log(\"%s:[%s] \" +\n\t\t// \t\t\"sy:[1>%o>=%s = %o] \" +\n\t\t// \t\t\"sh:[%o<=%o = %o] \" +\n\t\t// \t\t\"nav:[css:%o val:%o]\",\n\t\t// \t\tthis.cid, msg,\n\t\t// \t\tsy, sh - ch, (1 <= sy <= (sh - ch)),\n\t\t// \t\tsh, ch, (sh <= ch),\n\t\t// \t\tthis.navigationView.el.style.height,\n\t\t// \t\tthis.navigationView.el.scrollHeight,\n\t\t// \t\ttraceObj || \"\"\n\t\t// \t);\n\t\t// };\n\n\n\t\t// var scrolltouch = new Hammer.Manager(this.el);\n\t\t// scrolltouch.add(new Hammer.Pan({ direction: Hammer.DIRECTION_VERTICAL, threshold: 0 }));\n\t\t// scrolltouch.on(\"panmove\", function(ev) {\n\t\t//\n\t\t// \t// var sy, sh, ch;\n\t\t// \t// sy = this.el.scrollTop;\n\t\t// \t// sh = this.el.scrollHeight - 1;\n\t\t// \t// ch = this.el.clientHeight;\n\t\t// \t//\n\t\t// \t// if ((1 > sy) && (ev.direction | Hammer.DIRECTION_DOWN)) {\n\t\t// \t// \tev.preventDefault();\n\t\t// \t// \tconsole.log(\"%s:[panmove] %s\", this.cid, \"prevent at top\");\n\t\t// \t// } else\n\t\t// \t// if ((sy > (sh - ch)) && (ev.direction | Hammer.DIRECTION_UP)) {\n\t\t// \t// \tev.preventDefault();\n\t\t// \t// \tconsole.log(\"%s:[panmove] %s\", this.cid, \"prevent at bottom\");\n\t\t// \t// }\n\t\t// \tif ((this.el.scrollHeight - 1) <= this.el.clientHeight) {\n\t\t// \t\tev.srcEvent.preventDefault();\n\t\t// \t}\n\t\t// \t// traceTouchEvent(ev);\n\t\t// }.bind(this));\n\n\t\tvar touchOpts = { capture: false, passive: false };\n\t\tvar onTouchStart = (ev) => {\n\t\t\tthis.el.addEventListener(\"touchmove\", onTouchMove, touchOpts);\n\t\t\tthis.el.addEventListener(\"touchend\", onTouchEnd, touchOpts);\n\t\t\tthis.el.addEventListener(\"touchcancel\", onTouchEnd, touchOpts);\n\t\t};\n\n\t\tvar onTouchMove = (ev) => {\n\t\t\tif (!ev.defaultPrevented && (this.el.scrollHeight - 1) <= this.el.clientHeight) {\n\t\t\t\tev.preventDefault();\n\t\t\t}\n\t\t\t//traceTouchEvent(ev);\n\t\t};\n\n\t\tvar onTouchEnd = (ev) => {\n\t\t\tthis.el.removeEventListener(\"touchmove\", onTouchMove, touchOpts);\n\t\t\tthis.el.removeEventListener(\"touchend\", onTouchEnd, touchOpts);\n\t\t\tthis.el.removeEventListener(\"touchcancel\", onTouchEnd, touchOpts);\n\t\t};\n\n\t\tthis.el.addEventListener(\"touchstart\", onTouchStart);\n\n\t\tvar onMeasured = (view) => {\n\t\t\tthis.setImmediate(() => {\n\t\t\t\tthis.requestAnimationFrame(() => {\n\t\t\t\t\tif ((this.el.scrollHeight - 1) <= this.el.clientHeight) {\n\t\t\t\t\t\tthis.el.style.overflowY = \"hidden\";\n\t\t\t\t\t} else {\n\t\t\t\t\t\tthis.el.style.overflowY = \"\";\n\t\t\t\t\t}\n\t\t\t\t\tthis.el.scrollTop = 1;\n\t\t\t\t\t//traceTouchEvent(\"view:collapsed:measured\");\n\t\t\t\t});\n\t\t\t});\n\t\t};\n\t\tthis.listenTo(this.navigationView, \"view:collapsed:measured\", onMeasured);\n\n\n\t\t/* Google Analytics\n\t\t * ------------------------------- */\n\t\t// if (window.GTAG_ID) {\n\t\t// \t// let gaPageviewDisable = /(?:(localhost|\\.local))$/.test(location.hostname) || window.GTAG_ID === \"UA-9123564-8\";\n\t\t// \tif (window.gtag) {\n\t\t// \t\tcontroller\n\t\t// \t\t\t.on(\"route\", (name) => {\n\t\t// \t\t\t\tvar page = Backbone.history.getFragment();\n\t\t// \t\t\t\t// Add a slash if neccesary\n\t\t// \t\t\t\tif (page.charAt(0) !== '/') {\n\t\t// \t\t\t\t\tpage = '/' + page;\n\t\t// \t\t\t\t}\n\t\t// \t\t\t\t// page.replace(/^(?!\\/)/, \"/\");\n\t\t// \t\t\t\twindow.gtag('config', window.GTAG_ID, {\n\t\t// \t\t\t\t\t'page_title': page,\n\t\t// \t\t\t\t\t'page_path': page\n\t\t// \t\t\t\t});\n\t\t// \t\t\t\tconsole.warn(\"GTAG page set to '%s'\", page);\n\t\t// \t\t\t});\n\t\t// \t\t// } else\n\t\t// \t\t// if (window.ga) {\n\t\t// \t\t// \tcontroller\n\t\t// \t\t// \t\t.once(\"route\", () => {\n\t\t// \t\t// \t\t\twindow.ga(\"create\", window.GTAG_ID, \"auto\");\n\t\t// \t\t// \t\t\t// if localhost or dummy ID, disable analytics\n\t\t// \t\t// \t\t\tif (gaPageviewDisable) {\n\t\t// \t\t// \t\t\t\twindow.ga(\"set\", \"sendHitTask\", null);\n\t\t// \t\t// \t\t\t}\n\t\t// \t\t// \t\t\tconsole.warn(\"GA enabled tag '%s'\", window.GTAG_ID);\n\t\t// \t\t// \t\t})\n\t\t// \t\t// \t\t.on(\"route\", (name) => {\n\t\t// \t\t// \t\t\tvar page = Backbone.history.getFragment();\n\t\t// \t\t// \t\t\t// Add a slash if neccesary\n\t\t// \t\t// \t\t\tif (page.charAt(0) !== '/') {\n\t\t// \t\t// \t\t\t\tpage = '/' + page;\n\t\t// \t\t// \t\t\t}\n\t\t// \t\t// \t\t\t// page.replace(/^(?!\\/)/, \"/\");\n\t\t// \t\t// \t\t\twindow.ga(\"set\", \"page\", page);\n\t\t// \t\t// \t\t\twindow.ga(\"send\", \"pageview\");\n\t\t// \t\t//\n\t\t// \t\t// \t\t\tconsole.warn(\"GA page set to '%s'\", page);\n\t\t// \t\t// \t\t});\n\t\t// \t} else {\n\t\t// \t\tconsole.warn(\"GA/GTAG not loaded (LIB: %s, GA_ID: %s)\", !!(window.ga || window.gtag), window.GTAG_ID);\n\t\t// \t}\n\t\t// } else {\n\t\t// \tconsole.warn(\"GA/GTAG not enabled (LIB: %s, GA_ID: %s)\", !!(window.ga || window.gtag), window.GTAG_ID);\n\t\t// }\n\n\t\t// if (window.ga && window.GTAG_ID) {\n\t\t// \tcontroller\n\t\t// \t\t.once(\"route\", () => {\n\t\t// \t\t\twindow.ga(\"create\", window.GTAG_ID, \"auto\");\n\t\t// \t\t\t// if localhost or dummy ID, disable analytics\n\t\t// \t\t\tif (/(?:(localhost|\\.local))$/.test(location.hostname)\n\t\t// \t\t\t\t|| window.GTAG_ID == \"XX-0000000-0\") {\n\t\t// \t\t\t\twindow.ga(\"set\", \"sendHitTask\", null);\n\t\t// \t\t\t\twindow.gtag('config', 'GA_TRACKING_ID', { 'send_page_view': false });\n\t\t// \t\t\t\tconsole.warn(\"GA disabled for localhost\", window.GTAG_ID);\n\t\t// \t\t\t}\n\t\t// \t\t})\n\t\t// \t\t.on(\"route\", (name) => {\n\t\t// \t\t\tvar page = Backbone.history.getFragment();\n\t\t// \t\t\t// Add a slash if neccesary\n\t\t// \t\t\tif (page.charAt(0) !== '/') {\n\t\t// \t\t\t\tpage = '/' + page;\n\t\t// \t\t\t}\n\t\t// \t\t\t// page.replace(/^(?!\\/)/, \"/\");\n\t\t// \t\t\twindow.ga(\"set\", \"page\", page);\n\t\t// \t\t\twindow.ga(\"send\", \"pageview\");\n\t\t//\n\t\t// \t\t\tconsole.warn(\"GA page set to '%s'\", page);\n\t\t// \t\t});\n\t\t// } else {\n\t\t// \tconsole.warn(\"GA not enabled (LIB: %s, GA_ENABLED: %s, GA_ID: %s)\", !!window.ga, window.GA_ENABLED, window.GTAG_ID);\n\t\t// }\n\t\t// if (window.ga && window.GTAG_ID) {\n\t\t// \tcontroller.once(\"route\", () => {\n\t\t// \t\twindow.ga(\"create\", window.GTAG_ID, \"auto\");\n\t\t// \t});\n\t\t// }\n\t\t// console.info(\"Git: %s\", GIT_REV);\n\t\tconsole.info(\"Analytics GTAG_ENABLED: %s, GTAG_ID: %s, GA_LIB: %s\", GTAG_ENABLED, window.GTAG_ID, !!window.ga);\n\n\t\t/* Startup listener, added last */\n\t\tthis.listenToOnce(controller, \"route\", this._appStart);\n\n\t\t/* start router, which will request appropiate state */\n\t\tBackbone.history.start({\n\t\t\tpushState: false,\n\t\t\thashChange: true,\n\t\t});\n\t},\n\n\t/* -------------------------------\n\t/* _appStart\n\t/* ------------------------------- */\n\n\t_appStart: function(name, args) {\n\t\tconsole.info(\"%s::_appStart(%s, %s)\", this.cid, name, args.join());\n\t\tthis.skipTransitions = true;\n\t\tthis.el.classList.add(\"skip-transitions\");\n\n\t\tif (window.ga && window.GTAG_ID) {\n\t\t\twindow.ga(\"create\", window.GTAG_ID, \"auto\");\n\t\t}\n\n\t\tthis.requestRender(View.MODEL_INVALID | View.SIZE_INVALID)\n\t\t\t.requestChildrenRender(View.MODEL_INVALID | View.SIZE_INVALID)\n\t\t\t.listenToOnce(this, \"view:render:after\", function(view, flags) {\n\t\t\t\t// this.setImmediate(function() {\n\t\t\t\tthis.requestAnimationFrame(function() {\n\t\t\t\t\tconsole.log(\"%s::_appStart[view:render:after][raf]\", this.cid);\n\t\t\t\t\tthis.skipTransitions = false;\n\t\t\t\t\tthis.el.classList.remove(\"skip-transitions\");\n\t\t\t\t\tthis.el.classList.remove(\"app-initial\");\n\t\t\t\t});\n\t\t\t});\n\t},\n\n\t/* --------------------------- *\n\t/* route changed\n\t/* --------------------------- */\n\n\t_onRoute: function(name, args) {\n\t\tconsole.info(\"%s::_onRoute %o -> %o\", this.cid, this.model.get(\"routeName\"), name);\n\t\t// var o = _.defaults({ routeName: name }, AppState.prototype.defaults);\n\n\t\tvar o = {\n\t\t\trouteName: name,\n\t\t\tbundle: null,\n\t\t\tmedia: null,\n\t\t\tarticle: null,\n\t\t\tpage: Backbone.history.getFragment().replace(/^(?!\\/)/, \"/\"),\n\t\t};\n\t\tswitch (name) {\n\t\t\tcase \"media-item\":\n\t\t\t\to.bundle = bundles.selected;\n\t\t\t\t// o.withBundle = true;\n\t\t\t\to.media = o.bundle.media.selected;\n\t\t\t\t// o.withMedia = true;\n\t\t\t\to.collapsed = true;\n\t\t\t\tbreak;\n\t\t\tcase \"bundle-item\":\n\t\t\t\to.bundle = bundles.selected;\n\t\t\t\t// o.withBundle = true;\n\t\t\t\to.collapsed = true;\n\t\t\t\tbreak;\n\t\t\tcase \"article-item\":\n\t\t\t\to.article = articles.selected;\n\t\t\t\t// o.withArticle = true;\n\t\t\t\to.collapsed = true;\n\t\t\t\tbreak;\n\t\t\tcase \"bundle-list\":\n\t\t\tcase \"notfound\":\n\t\t\tcase \"root\":\n\t\t\tdefault:\n\t\t\t\to.collapsed = false;\n\t\t\t\tbreak;\n\t\t}\n\t\t// console.log(\"%s::_onRoute args: %o\", this.cid, name, args);\n\t\tthis.model.set(o);\n\t},\n\n\t/* --------------------------- *\n\t/* model changed\n\t/* --------------------------- */\n\n\t_onModelChange: function() {\n\t\tif (DEBUG) {\n\t\t\tconsole.groupCollapsed(this.cid + \"::_onModelChange\");\n\t\t\tconsole.groupCollapsed(\"changes\");\n\t\t\tObject.keys(this.model.changedAttributes()).forEach(function(key) {\n\t\t\t\tconsole.info(\"%s::_onModelChange %s: %s -> %s\", this.cid, key,\n\t\t\t\t\tthis.model.previous(key),\n\t\t\t\t\tthis.model.get(key));\n\t\t\t}, this);\n\n\t\t\t[\"Article\", \"Bundle\", \"Media\"].forEach(function(name) {\n\t\t\t\tvar key = name.toLowerCase();\n\t\t\t\tconsole[this.hasChanged(\"with\" + name) == this.hasAnyChanged(key) ? \"log\" : \"warn\"].call(console, \"%s::_onModelChange with%s: %o with%sChanged: %o\", this.cid,\n\t\t\t\t\tname, this.has(key),\n\t\t\t\t\tname, this.hasAnyChanged(key)\n\t\t\t\t);\n\t\t\t}, this.model);\n\t\t\tconsole.groupEnd();\n\n\t\t\tthis.once(\"view:render:after\", function(view, flags) {\n\t\t\t\tconsole.info(\"%s::_onModelChange [view:render:after]\", view.cid);\n\t\t\t\tconsole.groupEnd();\n\t\t\t});\n\t\t}\n\n\t\tthis.requestRender(View.MODEL_INVALID);\n\t\t// this.requestChildrenRender(View.MODEL_INVALID);\n\t},\n\n\t/* -------------------------------\n\t/* resize\n\t/* ------------------------------- */\n\n\t_onResize: function(ev) {\n\t\tconsole.group(this.cid + \"::_onResize [event]\");\n\t\tthis.skipTransitions = true;\n\t\tthis.el.classList.add(\"skip-transitions\");\n\n\t\tthis.requestRender(View.SIZE_INVALID)\n\t\t\t// .whenRendered().then(function(view) {\n\t\t\t.once(\"view:render:after\", function(view, flags) {\n\t\t\t\t// this.requestChildrenRender(View.SIZE_INVALID, true);\n\t\t\t\t// this.setImmediate(function() {\n\t\t\t\tthis.requestAnimationFrame(function() {\n\t\t\t\t\tconsole.info(\"%s::_onResize [view:render:after][raf]\", view.cid);\n\t\t\t\t\tview.skipTransitions = false;\n\t\t\t\t\tview.el.classList.remove(\"skip-transitions\");\n\t\t\t\t\tthis.el.scrollTop = 1;\n\t\t\t\t\tconsole.groupEnd();\n\t\t\t\t})\n\t\t\t});\n\t\tif (document.fullscreenElement === null) this.renderNow();\n\t},\n\n\t/* -------------------------------\n\t/* render\n\t/* ------------------------------- */\n\n\trenderFrame: function(tstamp, flags) {\n\t\tconsole.log(\"%s::renderFrame [%s]\", this.cid, View.flagsToString(flags));\n\n\t\t/* model: set route & model id classes */\n\t\tif (flags & View.MODEL_INVALID) {\n\t\t\tthis.renderModelChange(flags);\n\t\t}\n\n\t\t/* size: check breakpoints and set classes*/\n\t\tif (flags & View.SIZE_INVALID) {\n\t\t\t_.each(Globals.BREAKPOINTS, function(o, s) {\n\t\t\t\tthis.toggle(s, o.matches);\n\t\t\t}, this.breakpointEl.classList);\n\t\t}\n\t\t/* request children render:  always render now */\n\t\tthis.requestChildrenRender(flags, true);\n\t\t/* request children render:  set 'now' flag if size is invalid */\n\t\t// this.requestChildrenRender(flags, flags & View.SIZE_INVALID);\n\n\t\t// if ((this.el.scrollHeight - 1) <= this.el.clientHeight) {\n\t\t// \tthis.el.scrollTop = 1;\n\t\t// \tthis.el.style.overflowY = \"hidden\";\n\t\t// } else {\n\t\t// \tthis.el.style.overflowY = \"\";\n\t\t// }\n\t\t// this.navigationView.whenRendered().then(function(view) {\n\t\t// \tthis.requestAnimationFrame(function() {\n\t\t// \t\tconsole.log(\"%s::renderFrame [raf] css:%o val:%o\",\n\t\t// \t\t\tthis.cid,\n\t\t// \t\t\tthis.navigationView.el.style.height,\n\t\t// \t\t\tthis.navigationView.el.scrollHeight,\n\t\t// \t\t\tthis.el.scrollTop,\n\t\t// \t\t\tthis.el.scrollHeight - 1,\n\t\t// \t\t\tthis.el.clientHeight,\n\t\t// \t\t\t(this.el.scrollHeight - 1) <= this.el.clientHeight,\n\t\t// \t\t\tthis.el.style.overflowY\n\t\t// \t\t);\n\t\t// \t});\n\t\t// }.bind(this));\n\t},\n\n\t/* -------------------------------\n\t/* body classes etc\n\t/* ------------------------------- */\n\n\trenderModelChange: function() {\n\t\tlet cls = this.el.classList;\n\t\tlet prevAttr = null;\n\t\tlet hasDarkBg = false;\n\t\tlet docTitle = [];\n\n\t\tdocTitle.push(Globals.APP_NAME);\n\t\tif (this.model.get(\"bundle\")) {\n\t\t\tdocTitle.push(stripTags(this.model.get(\"bundle\").get(\"name\")));\n\t\t\tif (this.model.get(\"media\")) {\n\t\t\t\tdocTitle.push(stripTags(this.model.get(\"media\").get(\"name\")));\n\t\t\t}\n\t\t} else if (this.model.get(\"article\")) {\n\t\t\tdocTitle.push(stripTags(this.model.get(\"article\").get(\"name\")));\n\t\t}\n\t\tdocTitle = _.unescape(docTitle.join(\" / \"))\n\t\tdocument.title = docTitle;\n\n\t\tif (window.ga && window.GTAG_ID) {\n\t\t\twindow.ga('send', {\n\t\t\t\t'hitType': 'pageview',\n\t\t\t\t'page': this.model.get(\"page\"),\n\t\t\t\t'title': docTitle\n\t\t\t});\n\t\t}\n\n\t\t/* Set route class */\n\t\tif (this.model.hasChanged(\"routeName\")) {\n\t\t\tprevAttr = this.model.previous(\"fromRouteName\");\n\t\t\tif (prevAttr) {\n\t\t\t\tcls.remove(\"from-route-\" + prevAttr);\n\t\t\t}\n\t\t\tcls.add(\"from-route-\" + this.model.get(\"fromRouteName\"));\n\n\t\t\tprevAttr = this.model.previous(\"routeName\");\n\t\t\tif (prevAttr) {\n\t\t\t\tcls.remove(\"route-\" + prevAttr);\n\t\t\t\t// this.el.setAttribute(\"from-route\", prevAttr);\n\t\t\t}\n\t\t\t// this.el.setAttribute(\"to-route\", this.model.get(\"routeName\"));\n\t\t\tcls.add(\"route-\" + this.model.get(\"routeName\"));\n\t\t}\n\n\t\t/* Set model id classes for color styles */\n\t\t[\"article\", \"bundle\", \"media\"].forEach(function(prop) {\n\t\t\tvar item = this.model.get(prop);\n\t\t\tif (this.model.hasChanged(prop)) {\n\t\t\t\tprevAttr = this.model.previous(prop);\n\t\t\t\tif (prevAttr) {\n\t\t\t\t\tcls.remove(prevAttr.get(\"domid\"));\n\t\t\t\t}\n\t\t\t\tif (item) {\n\t\t\t\t\tcls.add(item.get(\"domid\"));\n\t\t\t\t}\n\t\t\t}\n\t\t\tcls.toggle(\"with-\" + prop, !!item);\n\t\t\tcls.toggle(\"without-\" + prop, !item);\n\t\t\thasDarkBg |= (item && item.colors && item.colors.hasDarkBg);\n\t\t}.bind(this));\n\n\t\t/* flag dark background */\n\t\tcls.toggle(\"color-dark\", hasDarkBg);\n\t},\n}, {\n\tgetInstance: function() {\n\t\tif (!(window.app instanceof this)) {\n\t\t\twindow.app = new(this)({\n\t\t\t\tmodel: new AppState()\n\t\t\t});\n\t\t}\n\t\treturn window.app;\n\t}\n});\n\nif (DEBUG) {\n\tmodule.exports = (function(AppView) {\n\t\t/** @type {module:app/debug/DebugToolbar} */\n\t\tvar DebugToolbar = require(\"app/debug/DebugToolbar\");\n\n\t\treturn AppView.extend({\n\t\t\tinitialize: function() {\n\t\t\t\tvar retval;\n\t\t\t\tvar view = new DebugToolbar({\n\t\t\t\t\tid: \"debug-toolbar\",\n\t\t\t\t\tmodel: this.model\n\t\t\t\t});\n\t\t\t\tdocument.body.appendChild(view.render().el);\n\t\t\t\tretval = AppView.prototype.initialize.apply(this, arguments);\n\t\t\t\tthis._logFlags[\"view.trace\"] = true;\n\t\t\t\tthis.navigationView._logFlags[\"view.trace\"] = true;\n\t\t\t\treturn retval;\n\t\t\t},\n\t\t})\n\t})(module.exports);\n}\n",
    "/**\n * @module app/view/ContentView\n */\n\n/** @type {module:app/control/Globals} */\nconst Globals = require(\"app/control/Globals\");\n/** @type {module:utils/TransformHelper} */\nconst TransformHelper = require(\"utils/TransformHelper\");\n// /** @type {module:app/view/base/TouchManager} */\n// var TouchManager = require(\"app/view/base/TouchManager\");\n\n/** @type {module:app/control/Controller} */\nconst controller = require(\"app/control/Controller\");\n/** @type {module:app/model/collection/BundleCollection} */\nconst bundles = require(\"app/model/collection/BundleCollection\");\n/** @type {module:app/model/collection/ArticleCollection} */\nconst articles = require(\"app/model/collection/ArticleCollection\");\n\n// /** @type {module:app/model/collection/BundleItem} */\n// var BundleItem = require(\"app/model/item/BundleItem\");\n\n/** @type {module:app/view/base/View} */\nconst View = require(\"app/view/base/View\");\n/** @type {module:app/view/component/ArticleView} */\nconst ArticleView = require(\"app/view/component/ArticleView\");\n/** @type {module:app/view/component/CollectionStack} */\nconst CollectionStack = require(\"app/view/component/CollectionStack\");\n/** @type {module:app/view/component/CollectionStack} */\nconst SelectableListView = require(\"app/view/component/SelectableListView\");\n/** @type {module:app/view/render/DotNavigationRenderer} */\nconst DotNavigationRenderer = require(\"app/view/render/DotNavigationRenderer\");\n/** @type {module:app/view/component/Carousel} */\nconst Carousel = require(\"app/view/component/Carousel\");\n\n/** @type {module:app/view/render/CarouselRenderer} */\nconst CarouselRenderer = require(\"app/view/render/CarouselRenderer\");\n/** @type {module:app/view/render/ImageRenderer} */\nconst ImageRenderer = require(\"app/view/render/ImageRenderer\");\n/** @type {module:app/view/render/VideoRenderer} */\nconst VideoRenderer = require(\"app/view/render/VideoRenderer\");\n/** @type {module:app/view/render/SequenceRenderer} */\nconst SequenceRenderer = require(\"app/view/render/SequenceRenderer\");\n// /** @type {module:app/view/component/CanvasProgressMeter} */\n// var ProgressMeter = require(\"app/view/component/CanvasProgressMeter\");\n\n/** @type {Function} */\nconst carouselEmptyTemplate = require(\"./template/Carousel.EmptyRenderer.Bundle.hbs\");\n/** @type {Function} */\nconst mediaStackTemplate = require(\"./template/CollectionStack.Media.hbs\");\n\n// var transitionEnd = View.prefixedEvent(\"transitionend\");\nvar transformProp = View.prefixedProperty(\"transform\");\nvar transitionProp = View.prefixedProperty(\"transition\");\n\nvar tx = Globals.transitions;\n\n\n// var clickEvent = window.hasOwnProperty(\"onpointerup\") ? \"pointerup\" : \"mouseup\",\n\n/**\n * @constructor\n * @type {module:app/view/ContentView}\n */\nmodule.exports = View.extend({\n\n\t/** @override */\n\tcidPrefix: \"contentView\",\n\n\t/** @override */\n\tclassName: \"container-expanded\",\n\n\t/** @override */\n\tevents: {\n\t\t\"transitionend .adding-child\": \"_onAddedTransitionEnd\",\n\t\t\"transitionend .removing-child\": \"_onRemovedTransitionEnd\",\n\t\t// \"transitionend\": \"_onTransitionEnd\",\n\t},\n\n\t/** @override */\n\tinitialize: function(options) {\n\t\t_.bindAll(this, \"_onVPanStart\", \"_onVPanMove\", \"_onVPanFinal\", \"_onCollapsedEvent\");\n\n\t\tthis.transforms = new TransformHelper();\n\t\t// this.touch = options.touch || new Error(\"no touch\"); //TouchManager.getInstance();\n\t\tthis.vpan = options.vpan || new Error(\"no vpan\");\n\t\tthis.hpan = options.hpan || new Error(\"no hpan\");\n\n\t\tthis.listenTo(this.model, \"change\", this._onModelChange);\n\n\t\t// disconnect children before last change\n\t\t// this.listenTo(bundles, \"deselect:one\", this._onDeselectOneBundle);\n\n\t\tthis.skipTransitions = true;\n\t\tthis.itemViews = [];\n\n\t\t// this.progressWrapper = this.createProgressWrapper(),\n\t\t// this.el.appendChild(this.progressWrapper.el);\n\t},\n\n\t/* --------------------------- *\n\t/* Render\n\t/* --------------------------- */\n\n\trenderFrame: function(tstamp, flags) {\n\t\t// values\n\t\tvar collapsed = this.model.get(\"collapsed\");\n\t\tvar collapsedChanged = (flags & View.MODEL_INVALID)\n\t\t\t&& this.model.hasChanged(\"collapsed\");\n\t\tvar childrenChanged = (flags & View.MODEL_INVALID)\n\t\t\t&& (this.model.hasChanged(\"bundle\") || this.model.hasChanged(\"article\"));\n\n\t\t// flags\n\t\tvar sizeChanged = !!(flags & View.SIZE_INVALID);\n\t\tvar transformsChanged = !!(flags & (View.MODEL_INVALID | View.SIZE_INVALID | View.LAYOUT_INVALID));\n\t\ttransformsChanged = transformsChanged || this._transformsChanged || this.skipTransitions;\n\n\t\t// debug\n\t\t// - - - - - - - - - - - - - - - - -\n\t\t// if (flags & View.MODEL_INVALID) {\n\t\t// \tconsole.group(this.cid + \"::renderFrame model changed:\");\n\t\t// \tObject.keys(this.model.changed).forEach(function(key) {\n\t\t// \t\tconsole.log(\"\\t%s: %s -> %s\", key, this.model._previousAttributes[key], this.model.changed[key]);\n\t\t// \t}, this);\n\t\t// \tconsole.groupEnd();\n\t\t// }\n\n\t\t// model:children\n\t\t// - - - - - - - - - - - - - - - - -\n\t\tif (childrenChanged) {\n\t\t\tthis.removeChildren();\n\t\t\tif (bundles.selected) {\n\t\t\t\tthis.createChildren(bundles.selected);\n\t\t\t} else\n\t\t\tif (articles.selected) {\n\t\t\t\tthis.createChildren(articles.selected);\n\t\t\t}\n\t\t}\n\n\t\t// model:collapsed\n\t\t// - - - - - - - - - - - - - - - - -\n\t\tif (collapsedChanged) {\n\t\t\tthis.el.classList.toggle(\"container-collapsed\", collapsed);\n\t\t\tthis.el.classList.toggle(\"container-expanded\", !collapsed);\n\t\t}\n\n\t\t// size\n\t\t// - - - - - - - - - - - - - - - - -\n\t\tif (sizeChanged) {\n\t\t\tthis.transforms.clearAllCaptures();\n\t\t}\n\n\t\t// transforms\n\t\t// - - - - - - - - - - - - - - - - -\n\t\tif (transformsChanged) {\n\t\t\tthis.el.classList.remove(\"container-changing\");\n\t\t\tif (this.skipTransitions) {\n\t\t\t\tthis.transforms.stopAllTransitions();\n\t\t\t\tthis.el.classList.remove(\"container-changed\");\n\t\t\t\tif (!childrenChanged) {\n\t\t\t\t\t// this.transforms.clearAllOffsets();\n\t\t\t\t\tif (collapsedChanged) {\n\t\t\t\t\t\tthis._setChildrenEnabled(collapsed);\n\t\t\t\t\t}\n\t\t\t\t}\n\t\t\t} else {\n\t\t\t\tif (!childrenChanged) {\n\t\t\t\t\tif (collapsedChanged) {\n\t\t\t\t\t\tvar afterTransitionsFn;\n\t\t\t\t\t\tthis.el.classList.add(\"container-changed\");\n\t\t\t\t\t\t// this.transforms.clearAllOffsets();\n\t\t\t\t\t\tif (collapsed) {\n\t\t\t\t\t\t\t// container-collapsed, enable last\n\t\t\t\t\t\t\tafterTransitionsFn = function() {\n\t\t\t\t\t\t\t\tthis._setChildrenEnabled(true);\n\t\t\t\t\t\t\t\tthis.el.classList.remove(\"container-changed\");\n\t\t\t\t\t\t\t};\n\t\t\t\t\t\t\tthis.transforms.runAllTransitions(tx.LAST);\n\t\t\t\t\t\t} else {\n\t\t\t\t\t\t\t// container-expanded, disable first\n\t\t\t\t\t\t\tafterTransitionsFn = function() {\n\t\t\t\t\t\t\t\tthis.el.classList.remove(\"container-changed\");\n\t\t\t\t\t\t\t};\n\t\t\t\t\t\t\tthis._setChildrenEnabled(false);\n\t\t\t\t\t\t\tthis.transforms.runAllTransitions(tx.FIRST);\n\t\t\t\t\t\t}\n\t\t\t\t\t\tafterTransitionsFn = afterTransitionsFn.bind(this);\n\t\t\t\t\t\tthis.transforms.whenAllTransitionsEnd().then(afterTransitionsFn, afterTransitionsFn);\n\t\t\t\t\t} else {\n\t\t\t\t\t\tthis.transforms.items.forEach(function(o) {\n\t\t\t\t\t\t\tif (o.hasOffset) {\n\t\t\t\t\t\t\t\to.runTransition(tx.NOW);\n\t\t\t\t\t\t\t\t// o.clearOffset();\n\t\t\t\t\t\t\t}\n\t\t\t\t\t\t});\n\t\t\t\t\t}\n\t\t\t\t}\n\t\t\t}\n\t\t\tif (!childrenChanged) {\n\t\t\t\tthis.transforms.clearAllOffsets();\n\t\t\t}\n\t\t\tthis.transforms.validate();\n\t\t}\n\t\tif (sizeChanged) {\n\t\t\tthis.itemViews.forEach(function(view) {\n\t\t\t\tview.skipTransitions = this.skipTransitions;\n\t\t\t\tview.requestRender(View.SIZE_INVALID).renderNow();\n\t\t\t}, this);\n\t\t\t/*Promise.all(this.itemViews.map(function(view) {\n\t\t\t\t\tview.skipTransitions = this.skipTransitions;\n\t\t\t\t\treturn view.requestRender(View.SIZE_INVALID).whenRendered();\n\t\t\t\t}, this))\n\t\t\t\t.then(\n\t\t\t\t\tfunction(views) {\n\t\t\t\t\t\tvar nh = this.el.offsetParent.offsetHeight - this.el.offsetTop;\n\t\t\t\t\t\t// var oh = views.reduce(function(h, view) {\n\t\t\t\t\t\t// \treturn Math.max(h, view.el.offsetHeight);\n\t\t\t\t\t\t// }, nh);\n\t\t\t\t\t\t// oh++;\n\t\t\t\t\t\t// console.log(\"%s:[whenRendered] [result: %s %s] %o\", this.cid,\n\t\t\t\t\t\t// \tnh, oh, this.el.parent, views);\n\t\t\t\t\t\tthis.el.style.minHeight = nh + \"px\";\n\t\t\t\t\t\treturn views;\n\t\t\t\t\t}.bind(this),\n\t\t\t\t\tfunction(reason) {\n\t\t\t\t\t\tconsole.warn(\"%s:[whenRendered] [rejected] %o\", this.cid, reason);\n\t\t\t\t\t\treturn reason;\n\t\t\t\t\t}.bind(this)\n\t\t\t\t);*/\n\t\t}\n\t\tthis.skipTransitions = this._transformsChanged = false;\n\t},\n\n\t_setChildrenEnabled: function(enabled) {\n\t\t// if (enabled) {\n\t\t// \tthis.el.removeEventListener(\"click\", this._onCollapsedClick, false);\n\t\t// } else {\n\t\t// \tthis.el.addEventListener(\"click\", this._onCollapsedClick, false);\n\t\t// }\n\t\tthis.itemViews.forEach(function(view) {\n\t\t\tview.setEnabled(enabled);\n\t\t});\n\t},\n\n\t/* -------------------------------\n\t/* Collapse UI gestures/events\n\t/* ------------------------------- */\n\n\t_onCollapsedEvent: function(ev) {\n\t\tconsole.log(\"%s:[%s -> _onCollapsedEvent] target: %s\", this.cid, ev.type, ev.target);\n\t\tif (!ev.defaultPrevented &&\n\t\t\tthis.model.has(\"bundle\") &&\n\t\t\t!this.model.get(\"collapsed\") &&\n\t\t\t!this.enabled) {\n\t\t\t// this.setImmediate(function() {\n\t\t\t// if (ev.type == \"click\") ev.stopPropagation();\n\t\t\tev.preventDefault();\n\t\t\tthis.setImmediate(function() {\n\t\t\t\t// if (ev.type == \"click\") ev.stopPropagation();\n\t\t\t\tthis.model.set(\"collapsed\", true);\n\t\t\t});\n\t\t\t// });\n\t\t}\n\t},\n\n\t/* --------------------------- *\n\t/* model changed\n\t/* --------------------------- */\n\n\t_onModelChange: function() {\n\t\tif (this.model.hasAnyChanged(\"bundle\")) {\n\t\t\tif (this.model.has(\"bundle\")) {\n\t\t\t\tthis.vpan.on(\"vpanstart\", this._onVPanStart);\n\t\t\t} else {\n\t\t\t\tthis.vpan.off(\"vpanstart\", this._onVPanStart);\n\t\t\t}\n\t\t}\n\t\t/*\n\t\tif (this.model.hasChanged(\"withBundle\") ||\n\t\t\tthis.model.hasChanged(\"collapsed\")) {\n\t\t\tif (this.model.get(\"withBundle\") &&\n\t\t\t\t!this.model.get(\"collapsed\")) {\n\t\t\t\tthis.hpan.on(\"hpanleft hpanright\", this._onCollapsedEvent);\n\t\t\t\tthis.el.addEventListener(View.CLICK_EVENT, this._onCollapsedEvent, false);\n\t\t\t} else {\n\t\t\t\tthis.hpan.off(\"hpanleft hpanright\", this._onCollapsedEvent);\n\t\t\t\tthis.el.removeEventListener(View.CLICK_EVENT, this._onCollapsedEvent, false);\n\t\t\t}\n\t\t}\n\t\t*/\n\t\tthis.requestRender(View.MODEL_INVALID);\n\t},\n\n\t/* -------------------------------\n\t/* Vertical touch/move (_onVPan*)\n\t/* ------------------------------- */\n\n\t_collapsedOffsetY: Globals.COLLAPSE_OFFSET,\n\n\t_onVPanStart: function(ev) {\n\t\tthis.vpan.on(\"vpanmove\", this._onVPanMove);\n\t\tthis.vpan.on(\"vpanend vpancancel\", this._onVPanFinal);\n\n\t\tthis.transforms.stopAllTransitions();\n\t\t// this.transforms.clearAllOffsets();\n\t\t// this.transforms.validate();\n\t\tthis.transforms.clearAllCaptures();\n\n\t\tthis.el.classList.add(\"container-changing\");\n\t\tthis._onVPanMove(ev);\n\t},\n\n\t_onVPanMove: function(ev) {\n\t\tvar collapsed = this.model.get(\"collapsed\");\n\t\tvar delta = ev.deltaY; //ev.thresholdDeltaY;\n\t\tvar maxDelta = this._collapsedOffsetY; // + Math.abs(ev.thresholdOffsetY);\n\n\t\t// check if direction is aligned with collapsed/expand\n\t\tvar isValidDir = collapsed ? (delta > 0) : (delta < 0);\n\t\tvar moveFactor = collapsed ? Globals.VPAN_DRAG : 1 - Globals.VPAN_DRAG;\n\n\t\tdelta = Math.abs(delta); // remove sign\n\t\tdelta *= moveFactor;\n\t\tmaxDelta *= moveFactor;\n\n\t\tif (isValidDir) {\n\t\t\tif (delta > maxDelta) { // overshooting\n\t\t\t\tdelta = ((delta - maxDelta) * Globals.VPAN_OUT_DRAG) + maxDelta;\n\t\t\t} else { // no overshooting\n\t\t\t\t// delta = delta;\n\t\t\t}\n\t\t} else {\n\t\t\tdelta = (-delta) * Globals.VPAN_OUT_DRAG; // delta is opposite\n\t\t}\n\t\tdelta *= collapsed ? 1 : -1; // reapply sign\n\n\t\tthis.transforms.offsetAll(0, delta);\n\t\tthis.transforms.validate();\n\t},\n\n\t_onVPanFinal: function(ev) {\n\t\tthis.vpan.off(\"vpanmove\", this._onVPanMove);\n\t\tthis.vpan.off(\"vpanend vpancancel\", this._onVPanFinal);\n\n\t\t// FIXME: model.collapsed may have already changed, _onVPanMove would run with wrong values:\n\t\t// model.collapsed is changed in a setImmediate callback from NavigationView.\n\n\t\tthis._onVPanMove(ev);\n\t\tthis.setImmediate(function() {\n\t\t\tthis._transformsChanged = true;\n\t\t\tthis.requestRender();\n\t\t});\n\t},\n\n\t// willCollapsedChange: function(ev) {\n\t// \tvar collapsed = this.model.get(\"collapsed\");\n\t// \treturn ev.type == \"vpanend\"? collapsed?\n\t// \t\tev.thresholdDeltaY > Globals.COLLAPSE_THRESHOLD :\n\t// \t\tev.thresholdDeltaY < -Globals.COLLAPSE_THRESHOLD :\n\t// \t\tfalse;\n\t// },\n\n\t/* -------------------------------\n\t/* create/remove children on bundle selection\n\t/* ------------------------------- */\n\n\t/** Create children on bundle select */\n\tcreateChildren: function(model) {\n\t\tvar view;\n\t\tif (model.__proto__.constructor === bundles.model) {\n\t\t\t// will be attached to dom in this order\n\t\t\tview = this.createMediaCaptionStack(model);\n\t\t\tthis.itemViews.push(view);\n\t\t\tthis.transforms.add(view.el);\n\t\t\tview = this.createMediaCarousel(model);\n\t\t\tthis.itemViews.push(view);\n\t\t\tthis.transforms.add(view.el);\n\t\t\tview = this.createMediaDotNavigation(model);\n\t\t\tthis.itemViews.push(view);\n\t\t} else\n\t\tif (model.__proto__.constructor === articles.model) {\n\t\t\tview = this.createArticleView(model);\n\t\t\tthis.itemViews.push(view);\n\t\t}\n\n\t\tthis.itemViews.forEach(function(view) {\n\t\t\tif (!this.skipTransitions) {\n\t\t\t\tview.el.classList.add(\"adding-child\");\n\t\t\t\tview.el.style.opacity = 0;\n\t\t\t}\n\t\t\tthis.el.appendChild(view.el);\n\t\t\tview.render();\n\t\t}, this);\n\n\t\tif (!this.skipTransitions) {\n\t\t\tthis.requestAnimationFrame(function() {\n\t\t\t\tconsole.log(\"%s::createChildren::[callback:requestAnimationFrame]\", this.cid);\n\t\t\t\tthis.itemViews.forEach(function(view) {\n\t\t\t\t\tif (!this.skipTransitions) {\n\t\t\t\t\t\tview.el.style[transitionProp] = \"opacity \" + tx.LAST.cssText;\n\t\t\t\t\t}\n\t\t\t\t\tview.el.style.removeProperty(\"opacity\");\n\t\t\t\t}, this);\n\t\t\t});\n\t\t}\n\t},\n\n\tremoveChildren: function() {\n\t\tthis.itemViews.forEach(function(view, i, arr) {\n\t\t\tthis.transforms.remove(view.el);\n\t\t\tif (this.skipTransitions) {\n\t\t\t\tview.remove();\n\t\t\t} else {\n\t\t\t\tvar s = window.getComputedStyle(view.el);\n\t\t\t\tif (s.opacity == \"0\" || s.visibility == \"hidden\") {\n\t\t\t\t\tconsole.log(\"%s::removeChildren [view:%s] removed immediately (invisible)\", this.cid, view.cid);\n\t\t\t\t\tview.remove();\n\t\t\t\t} else {\n\t\t\t\t\tview.el.classList.add(\"removing-child\");\n\t\t\t\t\tif (s[transformProp]) view.el.style[transformProp] = s[transformProp];\n\t\t\t\t\tview.el.style[transitionProp] = \"opacity \" + tx.FIRST.cssText;\n\t\t\t\t\tview.el.style.opacity = 0;\n\t\t\t\t}\n\t\t\t}\n\t\t\tarr[i] = null;\n\t\t}, this);\n\t\tthis.itemViews.length = 0;\n\t},\n\n\t_onAddedTransitionEnd: function(ev) {\n\t\tif (ev.target.cid && this.childViews.hasOwnProperty(ev.target.cid)) {\n\t\t\tconsole.log(\"%s::_onAddedTransitionEnd [view:%s] [prop:%s] [ev:%s]\", this.cid, ev.target.cid, ev.propertyName, ev.type);\n\t\t\tvar view = this.childViews[ev.target.cid];\n\t\t\tview.el.classList.remove(\"adding-child\");\n\t\t\tview.el.style.removeProperty(transitionProp);\n\t\t}\n\t},\n\n\t_onRemovedTransitionEnd: function(ev) {\n\t\tif (ev.target.cid && this.childViews.hasOwnProperty(ev.target.cid)) {\n\t\t\tconsole.log(\"%s::_onRemovedTransitionEnd [view:%s] [prop:%s] [ev:%s]\", this.cid, ev.target.cid, ev.propertyName, ev.type);\n\t\t\tvar view = this.childViews[ev.target.cid];\n\t\t\tview.el.classList.remove(\"removing-child\");\n\t\t\tview.remove();\n\t\t}\n\t},\n\n\t// purgeChildren: function() {\n\t// \tvar i, el, els = this.el.querySelectorAll(\".removing-child\");\n\t// \tfor (i = 0; i < els.length; i++) {\n\t// \t\tel = els.item(i);\n\t// \t\tif (el.parentElement === this.el) {\n\t// \t\t\ttry {\n\t// \t\t\t\tconsole.error(\"%s::purgeChildren\", this.cid, el.getAttribute(\"data-cid\"));\n\t// \t\t\t\tView.findByElement(el).remove();\n\t// \t\t\t} catch (err) {\n\t// \t\t\t\tconsole.error(\"s::purgeChildren\", this.cid, \"orphaned element\", err);\n\t// \t\t\t\tthis.el.removeChild(el);\n\t// \t\t\t}\n\t// \t\t}\n\t// \t}\n\t// },\n\n\t/* -------------------------------\n\t/* Components\n\t/* ------------------------------- */\n\n\n\t/**\n\t * media-carousel\n\t */\n\tcreateMediaCarousel: function(bundle) {\n\t\t// Create carousel\n\t\tvar EmptyRenderer = CarouselRenderer.extend({\n\t\t\tclassName: \"carousel-item empty-item\",\n\t\t\tmodel: bundle,\n\t\t\ttemplate: carouselEmptyTemplate,\n\t\t});\n\t\tvar rendererFunction = function(item, index, arr) {\n\t\t\tif (index === -1) {\n\t\t\t\treturn EmptyRenderer;\n\t\t\t}\n\t\t\tswitch (item.attr(\"@renderer\")) {\n\t\t\t\tcase \"video\":\n\t\t\t\t\treturn VideoRenderer;\n\t\t\t\tcase \"sequence\":\n\t\t\t\t\treturn SequenceRenderer;\n\t\t\t\tcase \"image\":\n\t\t\t\t\treturn ImageRenderer;\n\t\t\t\tdefault:\n\t\t\t\t\treturn ImageRenderer;\n\t\t\t}\n\t\t};\n\t\tvar view = new Carousel({\n\t\t\tclassName: \"media-carousel \" + bundle.get(\"domid\"),\n\t\t\tcollection: bundle.get(\"media\"),\n\t\t\trendererFunction: rendererFunction,\n\t\t\trequireSelection: !!(bundle.attr(\"@no-desc\")),\n\t\t\t// direction: Carousel.DIRECTION_HORIZONTAL,\n\t\t\ttouch: this.hpan,\n\t\t});\n\t\tcontroller.listenTo(view, {\n\t\t\t\"view:select:one\": (model) => {\n\t\t\t\tconsole.log(\"%s:[view:select:one] %s\", view.cid, model.cid);\n\t\t\t\tcontroller.selectMedia(model);\n\t\t\t},\n\t\t\t\"view:select:none\": controller.deselectMedia,\n\t\t\t// \"view:removed\": controller.stopListening\n\t\t});\n\t\tview.listenTo(bundle, \"deselected\", function() {\n\t\t\tthis.stopListening(this.collection);\n\t\t\tcontroller.stopListening(this);\n\t\t});\n\t\treturn view;\n\t},\n\n\t/**\n\t * media-caption-stack\n\t */\n\tcreateMediaCaptionStack: function(bundle) {\n\t\tvar view = new CollectionStack({\n\t\t\tclassName: \"media-caption-stack\",\n\t\t\tcollection: bundle.get(\"media\"),\n\t\t\ttemplate: mediaStackTemplate\n\t\t});\n\t\tview.listenTo(bundle, \"deselected\", function() {\n\t\t\tthis.stopListening(this.collection);\n\t\t});\n\t\treturn view;\n\t},\n\n\t/**\n\t * media-dotnav\n\t */\n\tcreateMediaDotNavigation: function(bundle) {\n\t\tvar view = new SelectableListView({\n\t\t\tclassName: \"media-dotnav dots-fontface color-fg05\",\n\t\t\tcollection: bundle.get(\"media\"),\n\t\t\trenderer: DotNavigationRenderer\n\t\t});\n\t\tcontroller.listenTo(view, {\n\t\t\t\"view:select:one\": controller.selectMedia,\n\t\t\t\"view:select:none\": controller.deselectMedia,\n\t\t\t// \"view:removed\": controller.stopListening\n\t\t});\n\t\tview.listenTo(bundle, \"deselected\", function() {\n\t\t\tthis.stopListening(this.collection);\n\t\t\tcontroller.stopListening(this);\n\t\t});\n\t\treturn view;\n\t},\n\n\t/**\n\t * @param el {module:app/model/item/ArticleView}\n\t * @return {module:app/view/base/View}\n\t */\n\tcreateArticleView: function(article) {\n\t\tvar view = new ArticleView({\n\t\t\tmodel: article,\n\t\t});\n\t\treturn view;\n\t},\n\n\t// createProgressWrapper: function() {\n\t// \t// var view = new ProgressMeter({\n\t// \t// \tid: \"media-progress-wrapper\",\n\t// \t// \t// className: \"color-bg color-fg05\",\n\t// \t// \tuseOpaque: false,\n\t// \t// \tlabelFn: function() { return \"0%\"; }\n\t// \t// });\n\t// \t// this.el.appendChild(this.progressWrapper.el);\n\t// \t// return view;\n\t// \treturn null;\n\t// },\n});\n",
    "/**\n * @module app/view/NavigationView\n */\n\n/** @type {module:hammerjs} */\nconst Hammer = require(\"hammerjs\");\n\n/** @type {module:app/control/Globals} */\nconst Globals = require(\"app/control/Globals\");\n/** @type {module:utils/TransformHelper} */\nconst TransformHelper = require(\"utils/TransformHelper\");\n// /** @type {module:app/view/base/TouchManager} */\n// var TouchManager = require(\"app/view/base/TouchManager\");\n\n/** @type {module:app/control/Controller} */\nconst controller = require(\"app/control/Controller\");\n/** @type {module:app/model/collection/TypeCollection} */\nconst types = require(\"app/model/collection/TypeCollection\");\n/** @type {module:app/model/collection/KeywordCollection} */\nconst keywords = require(\"app/model/collection/KeywordCollection\");\n/** @type {module:app/model/collection/BundleCollection} */\nconst bundles = require(\"app/model/collection/BundleCollection\");\n/** @type {module:app/model/collection/ArticleCollection} */\nconst articles = require(\"app/model/collection/ArticleCollection\");\n\n/** @type {module:app/view/base/View} */\nconst View = require(\"app/view/base/View\");\n/** @type {module:app/view/component/FilterableListView} */\nconst FilterableListView = require(\"app/view/component/FilterableListView\");\n/** @type {module:app/view/component/GroupingListView} */\nconst GroupingListView = require(\"app/view/component/GroupingListView\");\n// /** @type {module:app/view/component/CollectionPager} */\n// var CollectionPager = require(\"app/view/component/CollectionPager\");\n/** @type {module:app/view/component/GraphView} */\nconst GraphView = require(\"app/view/component/GraphView\");\n/** @type {module:app/view/component/ArticleButton} */\nconst ArticleButton = require(\"app/view/component/ArticleButton\");\n\n// /** @type {module:utils/prefixedProperty} */\n// var prefixedProperty = require(\"utils/prefixedProperty\");\n\n// var traceElement = require(\"utils/debug/traceElement\");\n\nvar tx = Globals.transitions;\n\nvar txNow = _.clone(tx.NOW);\ntxNow.easing = \"ease\";\n// var hTx = _.clone(collapsed ? tx.LAST : tx.FIRST);\n// hTx.easing = \"ease\";\n\n/**\n * @constructor\n * @type {module:app/view/NavigationView}\n */\nmodule.exports = View.extend({\n\n\t// /** @override */\n\t// tagName: \"div\",\n\t/** @override */\n\tcidPrefix: \"navigationView\",\n\t/** @override */\n\tclassName: \"navigation container-expanded\",\n\n\t/** @override */\n\tinitialize: function(options) {\n\t\t_.bindAll(this, \"_onVPanStart\", \"_onVPanMove\", \"_onVPanFinal\");\n\t\t_.bindAll(this, \"_onHPanStart\", \"_onHPanMove\", \"_onHPanFinal\");\n\t\t_.bindAll(this, \"_onNavigationClick\");\n\t\t// _.bindAll(this, \"_whenTransitionsEnd\", \"_whenTransitionsAbort\");\n\t\t// _.bindAll(this, \"_whenListsRendered\");\n\n\t\t// this._metrics = {\n\t\t// \tminHeight: 0\n\t\t// };\n\t\tthis.itemViews = [];\n\t\tthis.transforms = new TransformHelper();\n\t\t// this.touch = options.touch || new Error(\"no touch\"); //TouchManager.getInstance();\n\t\tthis.vpan = options.vpan || new Error(\"no vpan\");\n\t\tthis.hpan = options.hpan || new Error(\"no hpan\");\n\n\t\tthis.listenTo(this.model, \"change\", this._onModelChange);\n\t\tthis.listenTo(keywords, \"select:one select:none\", this._onKeywordSelect);\n\t\t// this.listenTo(this.model, \"withBundle:change\", this._onwithBundleChange);\n\n\t\tthis.vpanGroup = this.el.querySelector(\"#vpan-group\");\n\t\t// this.el.style.touchAction = \"none\";\n\t\t// this.el.style.webkitUserSelect = \"none\";\n\t\t// this.el.style.webkitUserDrag = \"none\";\n\n\t\tthis.keywordList = this.createKeywordList();\n\t\tthis.bundleList = this.createBundleList();\n\t\tthis.itemViews.push(this.keywordList);\n\t\tthis.itemViews.push(this.bundleList);\n\n\t\tthis.graph = this.createGraphView(this.bundleList,\n\t\t\tthis.keywordList, this.vpanGroup);\n\n\t\tthis.sitename = this.createSitenameButton();\n\t\tthis.about = this.createAboutButton();\n\n\t\t/* NOTE: .list-group .label moves horizontally (cf. sass/layouts/*.scss) */\n\t\tthis.hGroupings = this.keywordList.el.querySelectorAll(\".list-group .label\");\n\n\t\tthis.transforms.add(\n\t\t\tthis.vpanGroup,\n\t\t\tthis.bundleList.wrapper,\n\t\t\tthis.keywordList.wrapper,\n\t\t\tthis.bundleList.el,\n\t\t\tthis.keywordList.el,\n\t\t\tthis.hGroupings,\n\t\t\tthis.sitename.wrapper,\n\t\t\tthis.about.wrapper,\n\t\t\tthis.sitename.el,\n\t\t\tthis.about.el,\n\t\t\tthis.graph.el\n\t\t);\n\t\t// this.itemViews.push(this.graph);\n\t\t// this.listenTo(this.graph, {\n\t\t// \t\"canvas:update\": this._onGraphUpdate,\n\t\t// \t\"canvas:redraw\": this._onGraphRedraw,\n\t\t// });\n\n\t\t/*this.listenTo(this.graph, \"view:render:before\", function(view, flags) {\n\t\t\tvar vmax;\n\t\t\tif (!view.el.style.height) {\n\t\t\t\t// if (flags & (View.SIZE_INVALID | View.MODEL_INVALID)) {\n\t\t\t\t// if ((this.bundleList.renderFlags | View.SIZE_INVALID) ||\n\t\t\t\t// \t(this.keywordList.renderFlags | View.SIZE_INVALID)) {\n\t\t\t\t// }\n\t\t\t\tvmax = Math.max(\n\t\t\t\t\tthis.bundleList._metrics.height,\n\t\t\t\t\tthis.keywordList._metrics.height\n\t\t\t\t);\n\t\t\t\tif (_.isNumber(vmax)) {\n\t\t\t\t\tview.el.style.height = vmax + \"px\";\n\t\t\t\t\tconsole.log(\"%s:[view:render:before][once]:%s [%s] heights:[%i, %i] (max %i)\",\n\t\t\t\t\t\tthis.cid, view.cid, View.flagsToString(flags),\n\t\t\t\t\t\tthis.bundleList._metrics.height,\n\t\t\t\t\t\tthis.keywordList._metrics.height,\n\t\t\t\t\t\tvmax);\n\t\t\t\t}\n\t\t\t}\n\t\t});*/\n\t\t// this.listenTo(this.bundleList, \"view:render:after\", function(view, flags) {\n\t\t// \tconsole.info(\"%s:[view:render:after %s]\", this.cid, view.cid, View.flagsToString(flags & View.SIZE_INVALID));\n\t\t// \t\tif (flags & View.SIZE_INVALID) {\n\t\t// \t\t\t// console.info(\"%s:[%s view:render:after] bundleList height\", this.cid, view.cid, this.bundleList.el.style.height);\n\t\t// \t\t\t// this.graph.el.style.height = this.bundleList.el.style.height;\n\t\t// \t\t\tthis.graph.el.style.opacity = this.bundleList.collapsed? 0 : 1;\n\t\t// \t\t\tthis.graph.requestRender(View.SIZE_INVALID).renderNow();\n\t\t// \t// \t}\n\t\t// });\n\t\t// this.listenTo(this.bundleList, \"view:render:after\", this._onListResize);\n\t\t// this.listenTo(this.keywordList, \"view:render:after\", this._onListResize);\n\t},\n\n\t/* --------------------------- *\n\t/* Render\n\t/* --------------------------- */\n\n\trenderFrame: function(tstamp, flags) {\n\t\tif (flags & View.MODEL_INVALID) {\n\t\t\tif (this.model.hasChanged(\"collapsed\")) {\n\t\t\t\tthis.el.classList.toggle(\"container-collapsed\", this.model.get(\"collapsed\"));\n\t\t\t\tthis.el.classList.toggle(\"container-expanded\", !this.model.get(\"collapsed\"));\n\t\t\t}\n\t\t\tif (this.model.hasChanged(\"collapsed\")\n\t\t\t\t|| this.model.hasChanged(\"withBundle\")) {\n\t\t\t\tthis.el.classList.add(\"container-changing\");\n\t\t\t}\n\t\t\tif (this.model.hasChanged(\"routeName\")) {\n\t\t\t\tthis.bundleList.requestRender(View.SIZE_INVALID | View.LAYOUT_INVALID);\n\t\t\t\tthis.keywordList.requestRender(View.SIZE_INVALID | View.LAYOUT_INVALID);\n\t\t\t}\n\t\t}\n\n\t\t// transforms\n\t\t// - - - - - - - - - - - - - - - - -\n\t\tif (this.skipTransitions ||\n\t\t\t(flags & View.ALL_INVALID)) {\n\t\t\t// (flags & (View.MODEL_INVALID | View.SIZE_INVALID | View.LAYOUT_INVALID))) {\n\t\t\t// if (transformsChanged) {\n\t\t\tif (this.skipTransitions) {\n\t\t\t\tthis.transforms.stopAllTransitions();\n\t\t\t\tthis.transforms.validate();\n\t\t\t\tthis.transforms.clearAllOffsets();\n\t\t\t} else {\n\t\t\t\tthis.renderTransitions(flags);\n\t\t\t}\n\t\t\tthis.transforms.validate();\n\t\t\t// console.log(\"%s::renderFrame %o\", this.cid,\n\t\t\t// \tthis.transforms.items.map(function(o) {\n\t\t\t// \t\treturn traceElement(o.el) + \":\" +\n\t\t\t// \t\t\t(o.hasTransition ? o.transition.name : \"-\");\n\t\t\t// \t}));\n\t\t}\n\t\t// if (this.model.hasChanged(\"collapsed\") && this.model.get(\"collapsed\")) {\n\t\t// \tthis.el.style.height = \"\";\n\t\t// \t// this.el.style.minHeight = hval + \"px\";\n\t\t// \tthis.graph.el.style.height = \"\";\n\t\t// }\n\n\t\t// promise handlers\n\t\t// - - - - - - - - - - - - - - - - -\n\n\t\tvar measureRenderedLists = function(result) {\n\t\t\t// var hval = result.reduce(function(a, o) {\n\t\t\t// \treturn Math.max(a, o.metrics.height);\n\t\t\t// }, 0);\n\t\t\tvar hval = Math.max(\n\t\t\t\tthis.bundleList.metrics.height,\n\t\t\t\tthis.keywordList.metrics.height);\n\n\t\t\tif (this.model.get(\"collapsed\")) {\n\t\t\t\tthis.el.style.height = \"\";\n\t\t\t\t// this.el.style.minHeight = hval + \"px\";\n\t\t\t\tthis.graph.el.style.height = \"\";\n\t\t\t} else {\n\t\t\t\tthis.el.style.height = hval + \"px\";\n\t\t\t\t// this.el.style.minHeight = \"\";\n\t\t\t\tthis.graph.el.style.height = hval + \"px\";\n\t\t\t}\n\t\t\t// this.el.style.height = this.model.get(\"collapsed\") ? \"\" : \"100%\";\n\t\t\t// this.vpanGroup.style.height = hval;\n\t\t\tthis.graph.requestRender(View.SIZE_INVALID | View.LAYOUT_INVALID);\n\t\t\tconsole.log(\"%s:[whenListsRenderedDone] height set to %s\", this.cid, this.model.get(\"collapsed\") ? hval + \"px\" : \"[not set]\", result);\n\t\t\tthis.trigger(\"view:collapsed:measured\", this);\n\t\t\treturn result;\n\t\t}.bind(this);\n\n\t\tvar toggleGraph = function(result) {\n\t\t\tthis.graph.enabled = !this.model.get(\"collapsed\");\n\t\t\tthis.graph.valueTo(\"a2b\", 0, 0);\n\t\t\tif (!this.model.get(\"collapsed\")) {\n\t\t\t\tthis.graph.valueTo(\"a2b\", 1, Globals.TRANSITION_DURATION);\n\t\t\t}\n\t\t\treturn result;\n\t\t}.bind(this);\n\n\t\tvar whenCollapsedChangeDone = function(result) {\n\t\t\tconsole.log(\"%s:[whenCollapsedChangeDone][flags: %s]\", this.cid, View.flagsToString(flags), result);\n\t\t\tthis.el.classList.remove(\"container-changing\");\n\t\t\tthis.trigger(\"view:collapsed:end\", this);\n\t\t\treturn result;\n\t\t}.bind(this);\n\n\t\t// promises\n\t\t// - - - - - - - - - - - - - - - - -\n\t\tvar p;\n\t\t// p = Promise.all([\n\t\t// \t\tthis.bundleList.whenRendered(),\n\t\t// \t\tthis.keywordList.whenRendered(),\n\t\t// \t\tthis.bundleList.whenCollapseChangeEnds(),\n\t\t// \t\tthis.keywordList.whenCollapseChangeEnds(),\n\t\t// \t\tthis.transforms.whenAllTransitionsEnd(),\n\t\t// \t]);\n\n\t\tp = Promise.all([\n\t\t\t\tthis.bundleList.whenCollapseChangeEnds(),\n\t\t\t\tthis.keywordList.whenCollapseChangeEnds(),\n\t\t\t])\n\t\t\t.then(measureRenderedLists);\n\n\t\tif ((flags & View.MODEL_INVALID) && this.model.hasChanged(\"collapsed\")) {\n\t\t\tp = p.then(toggleGraph);\n\t\t}\n\t\tp\n\t\t\t.then(this.transforms.whenAllTransitionsEnd())\n\t\t\t.then(whenCollapsedChangeDone, function(reason) {\n\t\t\t\tconsole.error(reason);\n\t\t\t})\n\t\t\t.catch(function(reason) {\n\t\t\t\tconsole.warn(\"%s::renderFrame promise rejected\", this.cid);\n\t\t\t}.bind(this));\n\n\t\t/*\n\t\tvar whenListsRendered = Promise.all([\n\t\t\tthis.bundleList.whenRendered(),\n\t\t\tthis.keywordList.whenRendered()\n\t\t]);\n\n\t\tvar whenTransformsEnd = this.transforms.promise();\n\n\t\twhenListsRendered.then(\n\t\t\twhenListsRenderedDone,\n\t\t\tfunction(reason) {\n\t\t\t\tconsole.warn(\"%s:[whenListsRendered] failed: %o\", this.cid, reason);\n\t\t\t\treturn reason;\n\t\t\t}.bind(this)\n\t\t);\n\n\t\tPromise.all([\n\t\t\twhenListsRendered,\n\t\t\twhenTransformsEnd\n\t\t])\n\t\t\t.then(\n\t\t\t\tfunction(result) {\n\t\t\t\t\tconsole.log(\"%s:[whenListsRendered+whenTransformsEnd] [%s]\", this.cid, View.flagsToString(flags), result);\n\t\t\t\t\tthis.el.classList.remove(\"container-changing\");\n\t\t\t\t\tthis.graph.requestRender(View.SIZE_INVALID | View.LAYOUT_INVALID);\n\t\t\t\t}.bind(this),\n\t\t\t\tfunction(reason) {\n\t\t\t\t\tconsole.warn(\"%s:[whenListsRendered+whenTransformsEnd] [%s]\", this.cid, View.flagsToString(flags), reason);\n\t\t\t\t\tthis.el.classList.remove(\"container-changing\");\n\t\t\t\t\tthis.graph.requestRender(View.SIZE_INVALID | View.LAYOUT_INVALID);\n\t\t\t\t}.bind(this)\n\t\t\t);*/\n\n\n\t\t// trace result handlers\n\t\t// - - - - - - - - - - - - - - - - -\n\t\t/*if (this.model.hasChanged(\"collapsed\")) {\n\t\t\tvar msgBase = this.model.get(\"collapsed\") ? \"collaps\" : \"expand\";\n\t\t\tPromise.all([\n\t\t\t\tPromise.all([\n\t\t\t\t\t\tthis.bundleList.whenRendered(),\n\t\t\t\t\t\tthis.keywordList.whenRendered()\n\t\t\t\t\t])\n\t\t\t\t\t.then(\n\t\t\t\t\t\tfunction() {\n\t\t\t\t\t\t\tconsole.log(\"nav-tx:%sing\", msgBase, arguments);\n\t\t\t\t\t\t}),\n\t\t\t\tthis.transforms.promise()\n\t\t\t])\n\t\t\t\t.catch(\n\t\t\t\t\tfunction() {\n\t\t\t\t\t\tconsole.warn(\"nav-tx:%sed [rejected]\", msgBase, arguments);\n\t\t\t\t\t})\n\t\t\t\t.finally(\n\t\t\t\t\tfunction() {\n\t\t\t\t\t\tconsole.log(\"nav-tx:%sed\", msgBase, arguments);\n\t\t\t\t\t}\n\t\t\t\t);\n\t\t}*/\n\n\t\t// graph\n\t\t// - - - - - - - - - - - - - - - - -\n\t\t// if ((flags & (View.SIZE_INVALID | ~View.MODEL_INVALID))\n\t\t// \t/* collapsed has not changed, no bundle selected */\n\t\t// \t&& !this.model.hasChanged(\"collapsed\")\n\t\t// \t&& !this.model.get(\"withBundle\")) {\n\t\t// \tthis.graph.requestRender(View.SIZE_INVALID | View.LAYOUT_INVALID);\n\t\t// \tif (!this.skipTransitions) {\n\t\t// \t\tthis.graph.renderNow();\n\t\t// \t}\n\t\t// }\n\t\t// else\n\t\t// if ((flags & View.SIZE_INVALID) && !this.model.get(\"collapsed\")) {\n\t\t// \t/* NavigationView has resized while uncollapsed,\n\t\t// \tbut model is unchanged */\n\t\t// \tthis.graph.requestRender(View.SIZE_INVALID | View.LAYOUT_INVALID);\n\t\t// }\n\n\n\t\t// children loop\n\t\t// - - - - - - - - - - - - - - - - -\n\t\tthis.itemViews.forEach(function(view) {\n\t\t\t// view.skipTransitions = view.skipTransitions || this.skipTransitions;\n\t\t\tif (this.skipTransitions) {\n\t\t\t\tview.skipTransitions = true;\n\t\t\t}\n\t\t\tif (flags & View.SIZE_INVALID) {\n\t\t\t\tview.requestRender(View.SIZE_INVALID);\n\t\t\t}\n\t\t\t// if (!view.skipTransitions) {\n\t\t\tview.renderNow();\n\t\t\t// }\n\t\t}, this);\n\n\t\tthis.requestAnimationFrame(function() {\n\t\t\tthis.skipTransitions = false;\n\t\t});\n\t},\n\n\t/*_whenListsRendered: function(result) {\n\t\tvar hval;\n\t\tif (this.model.get(\"collapsed\")) {\n\t\t\tthis.el.style.height = \"\";\n\t\t\t// this.graph.el.style.height = \"100%\";\n\t\t} else {\n\t\t\t// hval = result.reduce(function(a, o) {\n\t\t\t// \treturn Math.max(a, o.metrics.height);\n\t\t\t// }, 0);\n\t\t\thval = Math.max(\n\t\t\t\tthis.bundleList.metrics.height,\n\t\t\t\tthis.keywordList.metrics.height);\n\t\t\tthis.el.style.height = hval + \"px\";\n\t\t\t// this.graph.el.style.height = hval + \"px\";\n\t\t}\n\t\tthis.graph.requestRender(View.SIZE_INVALID | View.LAYOUT_INVALID).renderNow();\n\t\tconsole.log(\"%s:[_whenListsRendered] height set to %opx\", this.cid, hval ? hval : \"[empty]\", arguments);\n\t\treturn result\n\t},\n\n\t_whenTransitionsEnd: function(result) {\n\t\tconsole.info(\"%s::_whenTransitionsEnd\", this.cid);\n\t\tthis.el.classList.remove(\"container-changing\");\n\t\t// if (!Globals.BREAKPOINTS[\"medium-wide\"].matches)\n\t\t// \treturn;\n\t\t// if (!this.model.get(\"collapsed\")) {\n\t\t// \tthis.graph.requestRender(View.SIZE_INVALID | View.LAYOUT_INVALID); //.renderNow();\n\t\t// }\n\t\treturn result;\n\t},\n\n\t_whenTransitionsAbort: function(reason) {\n\t\tconsole.warn(\"%s::_whenTransitionsAbort %o\", this.cid, reason);\n\t\tthis.el.classList.remove(\"container-changing\");\n\t\t// if (!Globals.BREAKPOINTS[\"medium-wide\"].matches)\n\t\t// \treturn;\n\t\t// if (!this.model.get(\"collapsed\")) {\n\t\t// \tthis.graph.requestRender(View.SIZE_INVALID | View.LAYOUT_INVALID); //.renderNow();\n\t\t// }\n\t\treturn result;\n\t},*/\n\n\t/* -------------------------------\n\t/* renderTransitions\n\t/* ------------------------------- */\n\n\trenderTransitions: function(flags) {\n\n\t\tvar modelChanged = (flags & View.MODEL_INVALID);\n\n\t\tvar fromRoute = this.model.get(\"fromRouteName\");\n\t\tvar toRoute = this.model.get(\"routeName\");\n\t\tvar routeChanged = modelChanged && this.model.hasChanged(\"routeName\");\n\n\t\t/* bundle */\n\t\tvar withBundle = this.model.has(\"bundle\");\n\t\tvar withBundleChanged = modelChanged && this.model.hasAnyChanged(\"bundle\");\n\t\tvar bundleChanged = modelChanged && this.model.hasChanged(\"bundle\");\n\t\t/* media */\n\t\tvar withMedia = this.model.has(\"media\");\n\t\tvar withMediaChanged = modelChanged && this.model.hasAnyChanged(\"media\");\n\t\t//var mediaChanged = modelChanged && this.model.hasChanged(\"media\");\n\t\t/* article */\n\t\t// var withArticle = this.model.has(\"article\");\n\t\tvar withArticleChanged = modelChanged && this.model.hasAnyChanged(\"article\");\n\t\t//var articleChanged = modelChanged && this.model.hasChanged(\"article\");\n\t\t/* collapsed */\n\t\tvar collapsed = this.model.get(\"collapsed\");\n\t\tvar collapsedChanged = modelChanged && this.model.hasChanged(\"collapsed\");\n\n\t\tvar tf;\n\t\t/* this.vpanGroup */\n\t\ttf = this.transforms.get(this.vpanGroup);\n\t\tif (tf && tf.hasOffset) {\n\t\t\ttf.runTransition(collapsedChanged ? tx.BETWEEN : tx.NOW);\n\t\t\ttf.clearOffset();\n\t\t}\n\t\t/* this.bundleList.el */\n\t\t// tf = this.transforms.get(this.bundleList.el);\n\t\t// if (tf.hasOffset) {\n\t\t// \ttf.runTransition(collapsedChanged ? tx.BETWEEN : tx.NOW);\n\t\t// \ttf.clearOffset();\n\t\t// }\n\t\t/* this.keywordList.el */\n\t\t// tf = this.transforms.get(this.keywordList.el);\n\t\t// if (tf.hasOffset) {\n\t\t// \ttf.runTransition(collapsedChanged ? tx.BETWEEN : tx.NOW);\n\t\t// \ttf.clearOffset();\n\t\t// }\n\t\t/* this.graph.el */\n\t\t// tf = this.transforms.get(this.graph.el);\n\t\t// if (tf && tf.hasOffset) {\n\t\t// \ttf.runTransition(collapsedChanged ? tx.BETWEEN : tx.NOW);\n\t\t// \ttf.clearOffset();\n\t\t// }\n\n\t\t/*\n\t\t * NOTE:\n\t\t * Vertical:\n\t\t *\t\tsite-name-wrapper,\n\t\t *\t\tarticle-list-wrapper\n\t\t * Horizontal:\n\t\t *\t\tsite-name,\n\t\t *\t\tarticle-buttons,\n\t\t *\t\tkeywordList.wrapper,\n\t\t *\t\tbundleList.wrapper,\n\t\t *\t\thGroupings\n\t\t */\n\t\tif (Globals.BREAKPOINTS[\"medium-wide\"].matches || Globals.BREAKPOINTS[\"medium-wide-stretch\"].matches) {\n\t\t\t/* HORIZONTAL: keywordList.wrapper */\n\t\t\ttf = this.transforms.get(this.keywordList.wrapper);\n\t\t\tif (collapsedChanged && !withArticleChanged) {\n\t\t\t\t// if (collapsedChanged) {\n\t\t\t\tif (withBundleChanged) {\n\t\t\t\t\tif (withMediaChanged)\n\t\t\t\t\t\ttf.runTransition(withBundle ? tx.LAST : tx.FIRST);\n\t\t\t\t} else {\n\t\t\t\t\tif (withMedia)\n\t\t\t\t\t\ttf.runTransition(collapsed ? tx.LAST : tx.FIRST);\n\t\t\t\t}\n\t\t\t} else {\n\t\t\t\tif (!withBundleChanged && withMediaChanged)\n\t\t\t\t\ttf.runTransition(bundleChanged ? tx.BETWEEN : txNow); //tx.NOW);\n\t\t\t}\n\t\t\tif (tf.hasOffset)\n\t\t\t\ttf.clearOffset();\n\n\t\t\t/* HORIZONTAL: the rest */\n\t\t\tif (collapsedChanged ^ withArticleChanged) {\n\t\t\t\tthis.transforms.runTransition(collapsed ? tx.LAST : tx.FIRST,\n\t\t\t\t\tthis.sitename.el, this.about.el, this.bundleList.wrapper);\n\t\t\t\t// if (fromRoute != 'article-item' && toRoute != 'media-item') {\n\t\t\t\tthis.transforms.runTransition(collapsed ? tx.LAST : tx.FIRST, this.hGroupings);\n\t\t\t\t// }\n\t\t\t}\n\t\t\t/* VERTICAL */\n\t\t\tif (routeChanged && (fromRoute == 'root' || toRoute == 'root')) {\n\t\t\t\tthis.transforms.runTransition(tx.BETWEEN,\n\t\t\t\t\tthis.sitename.wrapper, this.about.wrapper);\n\t\t\t}\n\t\t\t/* this.hGroupings */\n\t\t\t// if (collapsedChanged ^ withArticleChanged) {\n\t\t\t// \t// if (collapsedChanged && !withArticleChanged) {\n\t\t\t// \tthis.transforms.runTransition(collapsed ? tx.LAST : tx.FIRST, this.hGroupings);\n\t\t\t// }\n\t\t\t// if (collapsedChanged) {\n\t\t\t// \tif (!withArticleChanged) {\n\t\t\t// \t\t// if (fromRoute == 'root' || toRoute == 'root') {\n\t\t\t// \t\tthis.transforms.runTransition(collapsed ? tx.LAST : tx.FIRST, this.bundleList.wrapper);\n\t\t\t// \t}\n\t\t\t// } else {\n\t\t\t// \tif (withArticleChanged && withBundleChanged) {\n\t\t\t// \t\tthis.transforms.runTransition(withArticle ? tx.BETWEEN : tx.LAST, this.bundleList.wrapper);\n\t\t\t// \t}\n\t\t\t// }\n\t\t} else if (Globals.BREAKPOINTS[\"small-stretch\"].matches) {\n\t\t\t// if (collapsedChanged ) {\n\t\t\tif (collapsedChanged ^ withArticleChanged) {\n\t\t\t\tthis.transforms.runTransition(collapsed ? tx.FIRST : tx.LAST,\n\t\t\t\t\tthis.sitename.el, this.about.el);\n\t\t\t}\n\t\t} else {\n\t\t\tif (withBundleChanged) {\n\t\t\t\tthis.transforms.runTransition(tx.BETWEEN,\n\t\t\t\t\tthis.sitename.el, this.about.el);\n\t\t\t}\n\t\t}\n\t\t// this.transforms.clearOffset(\n\t\t// \t// this.bundleList.el,\n\t\t// \t// this.keywordList.el,\n\t\t// \tthis.bundleList.wrapper);\n\t},\n\n\t/* --------------------------- *\n\t/* own model changed\n\t/* --------------------------- */\n\n\t_onModelChange: function() {\n\t\t// \tthis.setImmediate(this.commitModel);\n\t\t// },\n\t\t//\n\t\t// commitModel: function() {\n\t\t// this.requestRender(View.MODEL_INVALID | View.LAYOUT_INVALID);\n\t\tthis.requestRender(View.MODEL_INVALID);\n\t\t// keywords.deselect();\n\t\tif (this.model.hasChanged(\"collapsed\")) {\n\t\t\tif (this.model.get(\"collapsed\")) {\n\t\t\t\t// clear keyword selection\n\t\t\t\tkeywords.deselect();\n\t\t\t} // else {}\n\t\t\tthis.keywordList.collapsed = this.model.get(\"collapsed\");\n\t\t\tthis.bundleList.collapsed = this.model.get(\"collapsed\");\n\t\t}\n\t\tif (this.model.hasChanged(\"bundle\")) {\n\t\t\tthis.bundleList.selectedItem = this.model.get(\"bundle\");\n\t\t\tthis.keywordList.refreshFilter();\n\n\t\t\t// if (!this.model.get(\"collapsed\") && this.graph) {\n\t\t\t// \tthis.listenToOnce(this.keywordList, \"view:render:after\", function(view, flags) {\n\t\t\t// \t\tconsole.log(\"%s::_onBundleSelect -> %s:[view:render:after] flags:%s\", this.cid, view.cid, View.flagsToString(flags));\n\t\t\t// \t\tthis.graph.valueTo( \"a2b\", 0,  0);\n\t\t\t// \t\t// this.graph.renderNow();\n\t\t\t// \t\tthis.graph.valueTo( \"a2b\", 1,  Globals.TRANSITION_DURATION);\n\t\t\t// \t});\n\t\t\t// }\n\t\t\t// keywords.deselect();\n\t\t\t// this.graph && this.graph.requestRender(View.SIZE_INVALID);\n\t\t}\n\t\t// var clickEv = \"click\";//View.CLICK_EVENT\n\t\tif (this.model.hasChanged(\"withBundle\")) {\n\t\t\t// this.keywordList.refreshFilter()\n\t\t\tif (this.model.get(\"withBundle\")) {\n\n\t\t\t\tthis.el.addEventListener(View.CLICK_EVENT, this._onNavigationClick);\n\t\t\t\tthis.vpan.on(\"vpanstart\", this._onVPanStart);\n\t\t\t\tthis.hpan.on(\"hpanstart\", this._onHPanStart);\n\t\t\t\t// this.hpan.on(\"tap\", this._onTap);\n\t\t\t} else {\n\t\t\t\tthis.el.removeEventListener(View.CLICK_EVENT, this._onNavigationClick);\n\t\t\t\tthis.vpan.off(\"vpanstart\", this._onVPanStart);\n\t\t\t\tthis.hpan.off(\"hpanstart\", this._onHPanStart);\n\t\t\t\tkeywords.deselect();\n\t\t\t\t// this.hpan.off(\"tap\", this._onTap);\n\t\t\t}\n\t\t\t// this.graph.valueTo()\n\t\t}\n\t},\n\n\t// _onwithBundleChange: function(withBundle) {\n\t// \tif (withBundle) {\n\t// \t\tthis.listenTo(this.model, \"collapsed:change\", function(collapsed){\n\t//\n\t// \t\t});\n\t// \t} else {\n\t// \t\tthis.stopListening(this.model, \"collapsed:change\", function(collapsed){\n\t//\n\t// \t\t});\n\t// \t}\n\t// },\n\n\t/* --------------------------- *\n\t/* keyword collection changed\n\t/* --------------------------- */\n\n\t_onKeywordSelect: function(keyword) {\n\t\t// use collection listener to avoid redundant refreshFilter calls\n\t\tif (!this.model.get(\"collapsed\") && this.graph) {\n\t\t\tthis.listenToOnce(this.bundleList, \"view:render:after\", function(view, flags) {\n\t\t\t\t// console.log(\"%s::_onKeywordSelect -> %s:[view:render:after] flags:%s\", this.cid, view.cid, View.flagsToString(flags));\n\t\t\t\tthis.graph.valueTo(\"b2a\", 0, 0);\n\t\t\t\tthis.graph.valueTo(\"b2a\", 1, Globals.TRANSITION_DURATION);\n\t\t\t});\n\t\t}\n\t\tthis.bundleList.refreshFilter();\n\t},\n\n\t/* --------------------------- *\n\t/* UI Events: bundleList keywordList buttons\n\t/* --------------------------- */\n\n\t_onNavigationClick: function(ev) {\n\t\tconsole.log(\"%s::_onNavigationClick [%s] defaultPrevented:%s\", this.cid, ev.type, ev.defaultPrevented);\n\t\tif (ev.defaultPrevented) return;\n\t\t// if (ev.target !== this.graph.el && ev.target !== this.el) return;\n\n\t\tev.preventDefault();\n\t\tif (this.model.has(\"bundle\")) {\n\t\t\t// this.transforms.offset(0, 1, this.graph.el);\n\t\t\t// this.transforms.validate();\n\t\t\t// this._setCollapsed(!this.model.get(\"collapsed\"));\n\t\t\t// this.setImmediate(function() {\n\t\t\tthis.model.set(\"collapsed\", !this.model.get(\"collapsed\"));\n\t\t\t// });\n\t\t}\n\t},\n\n\t_setCollapsed: function(value) {\n\t\tif (value !== this.model.get(\"collapsed\")) {\n\t\t\t// this.transforms.offset(0, 1, this.graph.el);\n\t\t\t// this.transforms.validate();\n\t\t\tthis.setImmediate(function() {\n\t\t\t\t// console.log(\"%s::_setCollapsed -> %s (setImmediate)\", this.cid, value);\n\t\t\t\tthis.model.set(\"collapsed\", value);\n\t\t\t});\n\t\t}\n\t},\n\n\t/* -------------------------------\n\t/* Horizontal touch/move (HammerJS)\n\t/* ------------------------------- */\n\n\t_onHPanStart: function(ev) {\n\t\tthis.transforms.get(this.keywordList.wrapper)\n\t\t\t.stopTransition()\n\t\t\t.clearOffset()\n\t\t\t.validate();\n\t\t// if (this.model.get(\"layoutName\") != \"left-layout\"\n\t\t// \t&& this.model.get(\"layoutName\") != \"default-layout\") {\n\t\t// \treturn;\n\t\t// }\n\t\tif ((Globals.BREAKPOINTS[\"medium-wide\"].matches || Globals.BREAKPOINTS[\"medium-wide-stretch\"].matches)\n\t\t\t&& (this.model.get(\"routeName\") === \"bundleItem\")\n\t\t\t&& (this.model.get(\"bundle\").get(\"media\").selectedIndex <= 0)\n\t\t\t&& this.model.get(\"collapsed\")) {\n\t\t\tthis.transforms.get(this.keywordList.wrapper).clearCapture();\n\t\t\tthis._onHPanMove(ev);\n\n\t\t\tthis.hpan.on(\"hpanmove\", this._onHPanMove);\n\t\t\tthis.hpan.on(\"hpanend hpancancel\", this._onHPanFinal);\n\t\t}\n\t},\n\n\t_onHPanMove: function(ev) {\n\t\t// var HPAN_DRAG = 1;\n\t\t// var HPAN_DRAG = 0.75;\n\t\tvar HPAN_DRAG = 720 / 920;\n\t\tvar delta = ev.deltaX; //ev.thresholdDeltaX;\n\t\t// var mediaItems = this.model.get(\"bundle\").get(\"media\");\n\n\t\tif (this.model.has(\"media\")) {\n\t\t\tdelta *= (ev.offsetDirection & Hammer.DIRECTION_LEFT) ?\n\t\t\t\t0.0 : HPAN_DRAG;\n\t\t} else {\n\t\t\tdelta *= (ev.offsetDirection & Hammer.DIRECTION_LEFT) ?\n\t\t\t\tHPAN_DRAG : Globals.HPAN_OUT_DRAG;\n\t\t}\n\t\tthis.transforms.offset(delta, null, this.keywordList.wrapper);\n\t\tthis.transforms.validate();\n\t},\n\n\t_onHPanFinal: function(ev) {\n\t\tthis.hpan.off(\"hpanmove\", this._onHPanMove);\n\t\tthis.hpan.off(\"hpanend hpancancel\", this._onHPanFinal);\n\n\t\t/* NOTE: if there is no model change, set tx here. Otherwise just wait for render */\n\t\tvar kTf = this.transforms.get(this.keywordList.wrapper);\n\t\tif (!(this._renderFlags & View.MODEL_INVALID) && kTf.hasOffset) {\n\t\t\tif (kTf.offsetX != 0) {\n\t\t\t\tkTf.runTransition(tx.NOW);\n\t\t\t}\n\t\t\tkTf.clearOffset().validate();\n\t\t}\n\t},\n\n\t/* -------------------------------\n\t/* Vertical touch/move (_onVPan*)\n\t/* ------------------------------- */\n\n\t_collapsedOffsetY: Globals.COLLAPSE_OFFSET,\n\n\t_onVPanStart: function(ev) {\n\t\tthis.vpan.on(\"vpanmove\", this._onVPanMove);\n\t\tthis.vpan.on(\"vpanend vpancancel\", this._onVPanFinal);\n\n\n\t\tthis.transforms.stopTransition(this.vpanGroup);\n\t\tthis.transforms.clearCapture(this.vpanGroup);\n\t\t// this.transforms.stopTransition(this.bundleList.el, this.keywordList.el); //, this.graph.el);\n\t\t// // this.transforms.clearOffset(this.bundleList.el, this.keywordList.el);\n\t\t// // this.transforms.validate();\n\t\t// this.transforms.clearCapture(this.bundleList.el, this.keywordList.el); //, this.graph.el);\n\t\t//\n\t\t// if (!this.model.get(\"collapsed\")) {\n\t\t// \tthis.transforms.stopTransition(this.graph.el);\n\t\t// \tthis.transforms.clearCapture(this.graph.el);\n\t\t// }\n\t\t// // this.el.classList.add(\"container-changing\");\n\n\t\t// this._onVPanMove(ev);\n\t},\n\n\t_onVPanMove: function(ev) {\n\t\tvar delta = this._computeVPanDelta(ev.deltaY); //ev.thresholdDeltaY);\n\n\t\tthis.transforms.offset(0, delta, this.vpanGroup);\n\t\t// this.transforms.offset(0, delta,\n\t\t// \tthis.bundleList.el, this.keywordList.el);\n\t\t// if (!this.model.get(\"collapsed\")) {\n\t\t// \tthis.transforms.offset(0, delta, this.graph.el);\n\t\t// }\n\t\tthis.transforms.validate();\n\t},\n\n\t_onVPanFinal: function(ev) {\n\t\tthis.vpan.off(\"vpanmove\", this._onVPanMove);\n\t\tthis.vpan.off(\"vpanend vpancancel\", this._onVPanFinal);\n\n\t\t// this._onVPanMove(ev);\n\t\t// this.transforms.validate();\n\n\t\tthis.setImmediate(function() {\n\t\t\t// this.transforms.clearOffset(this.bundleList.el, this.keywordList.el, this.graph.el);\n\t\t\tif (this.willCollapsedChange(ev)) {\n\t\t\t\t// this._setCollapsed(!this.model.get(\"collapsed\"));\n\t\t\t\tthis.model.set(\"collapsed\", !this.model.get(\"collapsed\"));\n\t\t\t}\n\t\t\tthis.requestRender(View.LAYOUT_INVALID); //.renderNow();\n\t\t});\n\t},\n\n\twillCollapsedChange: function(ev) {\n\t\treturn ev.type == \"vpanend\" ? this.model.get(\"collapsed\") ?\n\t\t\tev.deltaY > Globals.COLLAPSE_THRESHOLD :\n\t\t\tev.deltaY < -Globals.COLLAPSE_THRESHOLD :\n\t\t\tfalse;\n\t},\n\n\t_computeVPanDelta: function(delta) {\n\t\tvar collapsed = this.model.get(\"collapsed\");\n\t\tvar maxDelta = this._collapsedOffsetY; // + Math.abs(ev.thresholdOffsetY);\n\t\t// check if direction is aligned with collapsed/expand\n\t\tvar isValidDir = collapsed ? (delta > 0) : (delta < 0);\n\t\tvar moveFactor = collapsed ? 1 - Globals.VPAN_DRAG : Globals.VPAN_DRAG;\n\n\t\tdelta = Math.abs(delta); // remove sign\n\t\tdelta *= moveFactor;\n\t\tmaxDelta *= moveFactor;\n\n\t\tif (isValidDir) {\n\t\t\tif (delta > maxDelta) { // overshooting\n\t\t\t\tdelta = ((delta - maxDelta) * Globals.VPAN_OUT_DRAG) + maxDelta;\n\t\t\t} else { // no overshooting\n\t\t\t\t// delta = delta;\n\t\t\t}\n\t\t} else {\n\t\t\tdelta = (-delta) * Globals.VPAN_OUT_DRAG; // delta is opposite\n\t\t}\n\t\tdelta *= collapsed ? 0.5 : -1; // reapply sign\n\t\treturn delta;\n\t},\n\n\t/* -------------------------------\n\t/* Create children components\n\t/* ------------------------------- */\n\n\t// -------------------------------\n\t// #site-name\n\t// -------------------------------\n\n\tcreateSitenameButton: function() {\n\t\tvar view = new View({\n\t\t\tel: \"#site-name\",\n\t\t\tevents: {\n\t\t\t\t\"click a\": function(domev) {\n\t\t\t\t\tdomev.defaultPrevented || domev.preventDefault();\n\t\t\t\t\tthis.trigger(\"view:click\");\n\t\t\t\t}\n\t\t\t}\n\t\t});\n\t\tview.wrapper = view.el.parentElement;\n\t\tthis.listenTo(view, \"view:click\", this._onSitenameClick);\n\t\treturn view;\n\t},\n\n\t_onSitenameClick: function() {\n\t\tswitch (this.model.get(\"routeName\")) {\n\t\t\tcase \"media-item\":\n\t\t\tcase \"bundle-item\":\n\t\t\t\t// if (this.model.get(\"collapsed\")) {\n\t\t\t\t// \tthis._setCollapsed(false);\n\t\t\t\t// } else {\n\t\t\t\tcontroller.deselectBundle();\n\t\t\t\t// }\n\t\t\t\tbreak;\n\t\t\tcase \"article-item\":\n\t\t\t\tcontroller.deselectArticle();\n\t\t\t\tbreak;\n\t\t}\n\t},\n\n\t// -------------------------------\n\t// .article-button\n\t// -------------------------------\n\n\tcreateArticleButton: function(articleItem) {\n\t\tvar view = new ArticleButton({\n\t\t\tel: \".article-button[data-handle='about']\",\n\t\t\tmodel: articleItem\n\t\t}).render();\n\t\tview.wrapper = view.el.parentElement;\n\t\tthis.listenTo(view, \"view:click\", this._onArticleClick);\n\t\treturn view;\n\t},\n\n\t_onArticleClick: function(item) {\n\t\tswitch (this.model.get(\"routeName\")) {\n\t\t\tcase \"article-item\":\n\t\t\t\tcontroller.deselectArticle();\n\t\t\t\tbreak;\n\t\t\tcase \"root\":\n\t\t\tdefault:\n\t\t\t\tcontroller.selectArticle(item);\n\t\t\t\tbreak;\n\t\t}\n\t},\n\n\tcreateAboutButton: function() {\n\t\treturn this.createArticleButton(articles.findWhere({ handle: \"about\" }));\n\t},\n\n\t// -------------------------------\n\t// #bundle-list\n\t// -------------------------------\n\n\t/**\n\t * @param el {HTMLElement}\n\t * @return {module:app/base/view/component/FilterableListView}\n\t */\n\tcreateBundleList: function(el) {\n\t\tvar view = new FilterableListView({\n\t\t\tel: \"#bundle-list\",\n\t\t\tcollection: bundles,\n\t\t\tcollapsed: false,\n\t\t\tfilterFn: function(bundle, index, arr) {\n\t\t\t\treturn keywords.selected ?\n\t\t\t\t\tbundle.get(\"kIds\").indexOf(keywords.selected.id) !== -1 : false;\n\t\t\t},\n\t\t});\n\t\tview.wrapper = view.el.parentElement;\n\t\tthis.listenTo(view, \"view:select:one view:select:none\", function(bundle) {\n\t\t\tthis.setImmediate(function() {\n\t\t\t\tcontroller.selectBundle(bundle);\n\t\t\t});\n\t\t})\n\t\tthis.listenTo(view, \"view:select:same\", this._onBundleListSame);\n\t\treturn view;\n\t},\n\n\t_onBundleListSame: function(bundle) {\n\t\t// this.transforms.offset(0, 1, this.graph.el);\n\t\t// this.transforms.validate();\n\t\t// this.setImmediate(function() {\n\t\tthis.model.set(\"collapsed\", !this.model.get(\"collapsed\"));\n\t\t// });\n\t},\n\n\t// -------------------------------\n\t// #keyword-list\n\t// -------------------------------\n\n\t/**\n\t * @param el {HTMLElement}\n\t * @return {module:app/base/view/component/GroupingListView}\n\t */\n\tcreateKeywordList: function(el) {\n\t\tvar view = new GroupingListView({\n\t\t\tel: \"#keyword-list\",\n\t\t\tcollection: keywords,\n\t\t\tcollapsed: false,\n\t\t\tfilterFn: function(item, idx, arr) {\n\t\t\t\treturn bundles.selected ?\n\t\t\t\t\t(bundles.selected.get(\"kIds\").indexOf(item.id) !== -1) : false;\n\t\t\t},\n\t\t\tgroupingFn: function(item, idx, arr) {\n\t\t\t\treturn types.get(item.get(\"tId\"));\n\t\t\t},\n\t\t});\n\t\tview.wrapper = view.el.parentElement;\n\t\tview.listenTo(keywords, \"select:one select:none\", function(item) {\n\t\t\tview.selectedItem = item;\n\t\t});\n\t\tthis.listenTo(view, \"view:select:one view:select:none\", this._onKeywordListChange);\n\t\treturn view;\n\t},\n\n\t_onKeywordListChange: function(keyword) {\n\t\tif (!this.model.get(\"collapsed\")) {\n\t\t\tkeywords.select(keyword);\n\t\t}\n\t},\n\n\t// -------------------------------\n\t// #nav-graph\n\t// -------------------------------\n\n\t/**\n\t * @param listA {module:app/base/view/component/FilterableListView}\n\t * @param listB {module:app/base/view/component/FilterableListView}\n\t * @param parentEl {HTMLElement}\n\t * @return {module:app/base/view/component/GraphView}\n\t */\n\tcreateGraphView: function(listA, listB, parentEl) {\n\t\tvar view = new GraphView({\n\t\t\tid: \"nav-graph\",\n\t\t\tlistA: listA,\n\t\t\tlistB: listB,\n\t\t\tmodel: this.model,\n\t\t\tuseOpaque: false\n\t\t});\n\t\tparentEl || (parentEl = this.el);\n\t\tparentEl.insertBefore(view.el, parentEl.firstElementChild);\n\t\treturn view;\n\t},\n\n\t/* -------------------------------\n\t/* Horizontal touch/move (MutationObserver)\n\t/* ------------------------------- */\n\n\t/*\n\t_beginTransformObserve: function() {\n\t\tif (!(Globals.BREAKPOINTS[\"medium-wide\"].matches && this.model.get(\"bundle\").get(\"media\").selectedIndex <= 0 && this.model.get(\"collapsed\"))) {\n\t\t\treturn;\n\t\t}\n\t\tvar target = document.querySelector(\".carousel > .empty-item\");\n\t\tif (target === null) {\n\t\t\treturn;\n\t\t}\n\t\tif (!this._transformObserver) {\n\t\t\tthis._transformObserver = new MutationObserver(this._onTransformMutation);\n\t\t}\n\t\tthis._transformObserver.observe(target, { attributes: true, attributeFilter: [\"style\"] });\n\t\tthis.hpan.on(\"hpanend hpancancel\", this._endTransformObserve);\n\t\tthis.transforms.get(this.keywordList.wrapper)\n\t\t\t.stopTransition()\n\t\t\t.clearOffset()\n\t\t\t.clearCapture()\n\t\t\t.validate();\n\t},\n\n\t_endTransformObserve: function() {\n\t\tthis._transformObserver.disconnect();\n\t\tthis.hpan.off(\"hpanend hpancancel\", this._endTransformObserve);\n\t\tthis.transforms.get(this.keywordList.wrapper)\n\t\t\t.clearOffset()\n\t\t\t.runTransition(tx.NOW)\n\t\t\t.validate();\n\t},\n\n\t_onTransformMutation: function(mutations) {\n\t\tvar tView, tMetrics, tCss, dTxObj, pos;\n\n\t\t// this.keywordList.wrapper.style[prefixedProperty(\"transform\")];\n\t\t// transform = mutations[0].target.style.getPropertyValue(prefixedProperty(\"transform\"));\n\n\t\ttView = View.findByElement(mutations[0].target);\n\t\tif (tView) {\n\t\t\ttMetrics = tView.metrics;\n\t\t\tdTxObj = this.transforms.get(this.keywordList.wrapper);\n\t\t\tconsole.log(\"%s::_onTransformMutation [withMedia: %s] target: (%f\\+%f) %f wrapper: (%f) %f\", this.cid,\n\t\t\t\tthis.model.has(\"media\"),\n\t\t\t\ttMetrics.translateX, tMetrics.width, tMetrics.translateX + tMetrics.width,\n\t\t\t\tdTxObj.capturedX, tMetrics.translateX - dTxObj.capturedX,\n\t\t\t\ttMetrics\n\t\t\t);\n\n\t\t\tthis.transforms.offset(tMetrics.translateX - dTxObj.capturedX, void 0, this.keywordList.wrapper);\n\t\t\tthis.transforms.validate();\n\t\t}\n\t},\n\t*/\n});\n",
    "var PriorityQueue = function(offset) {\n\tthis._offset = offset | 0;\n\tthis._items = [];\n\tthis._priorities = [];\n\tthis._numItems = 0;\n};\n\nPriorityQueue.prototype = Object.create({\n\tenqueue: function(item, priority) {\n\t\tvar i = this._items.length;\n\t\tthis._items[i] = item;\n\t\tthis._priorities[i] = {\n\t\t\tpriority: (priority | 0),\n\t\t\tindex: i\n\t\t};\n\t\tthis._numItems++;\n\t\t// console.log(\"FrameQueue::RequestQueue::enqueue() [numItems:%i] ID:%i\", this._numItems, this._offset + i);\n\t\treturn this._offset + i;\n\t},\n\n\tcontains: function(index) {\n\t\tindex -= this.offset;\n\t\treturn 0 <= index && index < this._items.length;\n\t},\n\n\tskip: function(index) {\n\t\tvar i, item;\n\t\ti = index - this._offset;\n\t\tif (0 > i || i >= this._items.length) {\n\t\t\t// \tconsole.warn(\"FrameQueue::RequestQueue::skip(id:%i) out of range (%i-%i)\", index, this._offset, this._offset + (this._numItems - 1));\n\t\t\treturn void 0;\n\t\t}\n\t\titem = this._items[i];\n\t\tif (item !== null) {\n\t\t\t// if (item = this._items[i]) {\n\t\t\tthis._items[i] = null;\n\t\t\tthis._numItems--;\n\t\t}\n\t\treturn item;\n\t},\n\n\tindexes: function() {\n\t\tvar items = this._priorities.concat();\n\t\titems.sort(function(a, b) {\n\t\t\tif (a.priority > b.priority)\n\t\t\t\treturn 1;\n\t\t\tif (a.priority < b.priority)\n\t\t\t\treturn -1;\n\t\t\treturn 0;\n\t\t});\n\t\titems.forEach(function(o, i, a) {\n\t\t\ta[i] = o.index;\n\t\t}, this);\n\t\treturn items;\n\t},\n\n\titems: function() {\n\t\tvar items = this._priorities.concat();\n\t\titems.sort(function(a, b) {\n\t\t\tif (a.priority > b.priority)\n\t\t\t\treturn 1;\n\t\t\tif (a.priority < b.priority)\n\t\t\t\treturn -1;\n\t\t\treturn 0;\n\t\t});\n\t\titems.forEach(function(o, i, a) {\n\t\t\ta[i] = this._items[o.index];\n\t\t}, this);\n\t\treturn items;\n\t},\n\n\t_empty: function(offset) {\n\t\tthis._offset = offset;\n\t\tthis._items.length = 0;\n\t\tthis._priorities.length = 0;\n\t\tthis._numItems = 0;\n\t}\n}, {\n\n\toffset: {\n\t\tget: function() {\n\t\t\treturn this._offset;\n\t\t}\n\t},\n\n\tlength: {\n\t\tget: function() {\n\t\t\treturn this._items.length;\n\t\t}\n\t},\n\n\tnumItems: {\n\t\tget: function() {\n\t\t\treturn this._numItems;\n\t\t}\n\t},\n});\n\nvar CallbackQueue = function(requestFn, cancelFn) {\n\tthis._nextQueue = new PriorityQueue(0);\n\tthis._currQueue = null;\n\n\t// this._pending = false;\n\tthis._running = false;\n\tthis._runId = -1;\n\n\tthis._requestFn = requestFn;\n\tthis._cancelFn = cancelFn;\n\tthis._runQueue = this._runQueue.bind(this)\n};\n\nCallbackQueue.prototype = Object.create({\n\t/**\n\t * @param tstamp {int}\n\t */\n\t_runQueue: function() {\n\t\tif (this._running) throw new Error(\"wtf!!!\");\n\n\t\tthis._currQueue = this._nextQueue;\n\t\tthis._nextQueue = new PriorityQueue(this._currQueue.offset + this._currQueue.length);\n\n\t\tthis._runId = -1;\n\t\tthis._running = true;\n\n\t\tvar i, item;\n\t\tvar indexes = this._currQueue.indexes();\n\t\tvar items = this._currQueue._items;\n\t\tfor (i = 0; i < indexes.length; i++) {\n\t\t\titem = items[indexes[i]];\n\t\t\tif (item !== null) {\n\t\t\t\titem.apply(null, arguments);\n\t\t\t}\n\t\t}\n\n\t\t// var self = this;\n\t\t// this._currQueue.indexes().forEach(function(index) {\n\t\t// \tvar fn = self._currQueue._items[index];\n\t\t// \tif (fn !== null) {\n\t\t// \t\tfn.apply(null, arguments);\n\t\t// \t}\n\t\t// });\n\t\tthis._running = false;\n\t\tthis._currQueue = null;\n\n\t\tif (this._nextQueue.numItems > 0) {\n\t\t\tthis._runId = this._requestFn.call(null, this._runQueue);\n\t\t\t// this._runId = this._requestFn(this._runQueue);\n\t\t}\n\t},\n\n\t/**\n\t * @param fn {Function}\n\t * @param priority {int}\n\t * @return {int}\n\t */\n\trequest: function(fn, priority) {\n\t\t// if (!this._running && !this._pending) {\n\t\t// \tthis._pending = true;\n\t\t// \tconsole.warn(\"FrameQueue::request setImmediate: pending\");\n\t\t// \tsetImmediate(function() {\n\t\t// \t\tthis._pending = false;\n\t\t// \t\tif (this._nextQueue.numItems > 0) {\n\t\t// \t\t\tthis._runId = window.requestAnimationFrame(_runQueue);\n\t\t// \t\t\tconsole.warn(\"FrameQueue::request setImmediate: raf:%i for %i items\", this._runId, this._nextQueue.numItems);\n\t\t// \t\t} else {\n\t\t// \t\t\tconsole.warn(\"FrameQueue::request setImmediate: no items\");\n\t\t// \t\t}\n\t\t// \t});\n\t\t// }\n\t\tif (!this._running && this._runId === -1) {\n\t\t\tthis._runId = this._requestFn.call(null, this._runQueue);\n\t\t\t// this._runId = this._requestFn(this._runQueue);\n\t\t}\n\t\treturn this._nextQueue.enqueue(fn, priority);\n\t},\n\n\t/**\n\t * @param id {int}\n\t * @return {Function?}\n\t */\n\tcancel: function(id) {\n\t\tvar fn;\n\t\tif (this._running) {\n\t\t\tfn = this._currQueue.skip(id) || this._nextQueue.skip(id);\n\t\t} else {\n\t\t\tfn = this._nextQueue.skip(id);\n\t\t\tif ((this._runId !== -1) && (this._nextQueue.numItems === 0)) {\n\t\t\t\tthis._cancelFn.call(null, this._runId);\n\t\t\t\t// this._cancelFn(this._runId);\n\t\t\t\tthis._runId = -1;\n\t\t\t}\n\t\t}\n\t\treturn fn;\n\t},\n}, {\n\trunning: {\n\t\tget: function() {\n\t\t\treturn this._running;\n\t\t}\n\t}\n});\n\nmodule.exports = CallbackQueue;\n",
    "/* global Path2D */\n/**\n * @module app/view/component/progress/CanvasView\n */\n\n// /** @type {module:color} */\n// var Color = require(\"color\");\n/** @type {module:app/view/base/View} */\nconst View = require(\"app/view/base/View\");\n/** @type {module:app/control/Globals} */\nconst Globals = require(\"app/control/Globals\");\n/** @type {module:app/view/base/Interpolator} */\nconst Interpolator = require(\"app/view/base/Interpolator\");\n/** @type {module:utils/css/getBoxEdgeStyles} */\nconst getBoxEdgeStyles = require(\"utils/css/getBoxEdgeStyles\");\n\nvar MIN_CANVAS_RATIO = 1; // /Firefox/.test(window.navigator.userAgent)? 2 : 1;\n\n/**\n * @constructor\n * @type {module:app/view/component/progress/CanvasView}\n */\nvar CanvasView = View.extend({\n\n\t/** @type {string} */\n\tcidPrefix: \"canvasView\",\n\t/** @type {string} */\n\ttagName: \"canvas\",\n\t/** @type {string} */\n\tclassName: \"canvas-view\",\n\n\tproperties: {\n\t\tpaused: {\n\t\t\tget: function() {\n\t\t\t\treturn this._paused;\n\t\t\t},\n\t\t\tset: function(paused) {\n\t\t\t\tpaused = !!(paused);\n\t\t\t\tif (this._interpolator.paused !== paused) {\n\t\t\t\t\tthis._interpolator.paused = paused;\n\t\t\t\t\tif (!paused) {\n\t\t\t\t\t\tthis.requestRender();\n\t\t\t\t\t}\n\t\t\t\t}\n\t\t\t}\n\t\t},\n\t\tcontext: {\n\t\t\tget: function() {\n\t\t\t\treturn this._ctx;\n\t\t\t}\n\t\t},\n\t\tinterpolator: {\n\t\t\tget: function() {\n\t\t\t\treturn this._interpolator;\n\t\t\t}\n\t\t},\n\t\tcanvasRatio: {\n\t\t\tget: function() {\n\t\t\t\treturn this._canvasRatio;\n\t\t\t}\n\t\t},\n\t},\n\n\t/** @type {Object} */\n\tdefaults: {\n\t\tvalues: {\n\t\t\tvalue: 0\n\t\t},\n\t\tmaxValues: {\n\t\t\tvalue: 1\n\t\t},\n\t\tpaused: false,\n\t\tuseOpaque: false,\n\t},\n\n\t/* --------------------------- *\n\t * children/layout\n\t * --------------------------- */\n\n\t/** @override */\n\tinitialize: function(options) {\n\t\t// TODO: cleanup this options mess\n\t\toptions = _.defaults(options || {}, this.defaults);\n\t\toptions.values = _.defaults(options.values || {}, this.defaults.values);\n\t\toptions.maxValues = _.defaults(options.maxValues || {}, this.defaults.maxValues);\n\n\t\tthis._interpolator = new Interpolator(options.values, options.maxValues);\n\t\tthis._interpolator.paused = options.paused;\n\n\t\tthis._useOpaque = options.useOpaque;\n\t\tthis._options = _.pick(options, \"color\", \"backgroundColor\");\n\n\t\t// opaque background\n\t\t// --------------------------------\n\t\tvar ctxOpts = {};\n\t\t// if (this._useOpaque) {\n\t\t// \tthis._opaqueProp = Modernizr.prefixed(\"opaque\", this.el, false);\n\t\t// \tif (this._opaqueProp) {\n\t\t// \t\tthis.el[this._opaqueProp] = true;\n\t\t// \t} else {\n\t\t// \t\tctxOpts.alpha = true;\n\t\t// \t}\n\t\t// \tthis.el.classList.add(\"color-bg\");\n\t\t// }\n\n\t\t// canvas' context init\n\t\t// --------------------------------\n\t\tthis._ctx = this.el.getContext(\"2d\", ctxOpts);\n\n\t\t// adjust canvas size to pixel ratio\n\t\t// upscale the canvas if the two ratios don't match\n\t\t// --------------------------------\n\t\tvar ratio = MIN_CANVAS_RATIO;\n\t\tvar ctxRatio = this._ctx.webkitBackingStorePixelRatio || 1;\n\t\tif (window.devicePixelRatio !== ctxRatio) {\n\t\t\t// ratio = Math.max(window.devicePixelRatio / ctxRatio, MIN_CANVAS_RATIO);\n\t\t\tratio = window.devicePixelRatio / ctxRatio;\n\t\t\tratio = Math.max(ratio, MIN_CANVAS_RATIO);\n\t\t}\n\t\tthis._canvasRatio = ratio;\n\t\t// console.log(\"%s::init canvasRatio: %f\", this.cid, this._canvasRatio);\n\n\t\tthis.listenTo(this, \"view:attached\", function() {\n\t\t\t// this.invalidateSize();\n\t\t\t// this.renderNow();\n\t\t\tthis.requestRender(View.SIZE_INVALID | View.LAYOUT_INVALID).renderNow();\n\t\t});\n\t},\n\n\t// _computeCanvasRatio: function() {\n\t// \tvar ratio = MIN_CANVAS_RATIO;\n\t// \tvar ctxRatio = this._ctx.webkitBackingStorePixelRatio || 1;\n\t// \tif (window.devicePixelRatio !== ctxRatio) {\n\t// \t\t// ratio = Math.max(window.devicePixelRatio / ctxRatio, MIN_CANVAS_RATIO);\n\t// \t\tratio = window.devicePixelRatio / ctxRatio;\n\t// \t\tratio = Math.max(ratio, MIN_CANVAS_RATIO);\n\t// \t}\n\t// \tthis._canvasRatio = ratio;\n\t// },\n\n\t_updateCanvas: function() {\n\t\t// adjust canvas size to pixel ratio\n\t\t// upscale the canvas if the two ratios don't match\n\t\t// --------------------------------\n\n\t\tvar s = getComputedStyle(this.el);\n\n\t\t// this._canvasWidth = this.el.offsetWidth;\n\t\t// this._canvasHeight = this.el.offsetHeight;\n\t\tthis._canvasWidth = this.el.scrollWidth;\n\t\tthis._canvasHeight = this.el.scrollHeight;\n\n\t\tif (s.boxSizing === \"border-box\") {\n\t\t\tvar m = getBoxEdgeStyles(s);\n\t\t\tthis._canvasWidth -= m.paddingLeft + m.paddingRight + m.borderLeftWidth + m.borderRightWidth;\n\t\t\tthis._canvasHeight -= m.paddingTop + m.paddingBottom + m.borderTopWidth + m.borderBottomWidth;\n\t\t}\n\n\t\tthis._canvasWidth *= this._canvasRatio;\n\t\tthis._canvasHeight *= this._canvasRatio;\n\n\t\tthis.measureCanvas(this._canvasWidth, this._canvasHeight, s);\n\t\tthis.el.width = this._canvasWidth;\n\t\tthis.el.height = this._canvasHeight;\n\t\t// this.el.style.height = h + \"px\";\n\t\t// this.el.style.width = w + \"px\";\n\n\t\t// colors\n\t\t// --------------------------------\n\t\tthis._color = this._options.color ||\n\t\t\ts.color || Globals.DEFAULT_COLORS[\"color\"];\n\t\tthis._backgroundColor = this._options.backgroundColor ||\n\t\t\ts.backgroundColor || Globals.DEFAULT_COLORS[\"background-color\"];\n\n\t\t// mozOpaque\n\t\t// --------------------------------\n\t\tif (this._useOpaque && this._opaqueProp) {\n\t\t\t// this.el.style.backgroundColor = this._backgroundColor;\n\t\t\tthis.el[this._opaqueProp] = true;\n\t\t}\n\n\t\t// fontSize\n\t\t// --------------------------------\n\t\tthis._fontSize = parseFloat(s.fontSize) * this._canvasRatio;\n\t\tthis._fontFamily = s.fontFamily;\n\n\t\t// prepare canvas context\n\t\t// --------------------------------\n\t\tthis._ctx.restore();\n\n\t\tthis._ctx.font = [s.fontWeight, s.fontStyle, this._fontSize + \"px/1\", s.fontFamily].join(\" \");\n\t\tthis._ctx.textAlign = \"left\";\n\t\tthis._ctx.lineCap = \"butt\";\n\t\tthis._ctx.lineJoin = \"miter\";\n\t\tthis._ctx.strokeStyle = this._color;\n\t\tthis._ctx.fillStyle = this._color;\n\n\t\tthis.updateCanvas(this._ctx, s);\n\t\tthis._ctx.save();\n\n\t\t// console.group(this.cid+\"::_updateCanvas\");\n\t\t// console.log(\"ratio:    %f (min: %f, device: %f, context: %s)\", this._canvasRatio, MIN_CANVAS_RATIO, window.devicePixelRatio, this._ctx.webkitBackingStorePixelRatio || \"(webkit-only)\");\n\t\t// console.log(\"colors:   fg: %s bg: %s\", this._color, this._backgroundColor);\n\t\t// console.log(\"style:    %s, %s, padding: %s (%s)\", s.width, s.height, s.padding, s.boxSizing);\n\t\t// console.log(\"box:      %f x %f px\", m.width, m.height);\n\t\t// console.log(\"measured: %f x %f px\", w, h);\n\t\t// console.log(\"canvas:   %f x %f px\", this._canvasWidth, this._canvasHeight);\n\t\t// console.groupEnd();\n\t},\n\n\tmeasureCanvas: function(w, h, s) {\n\t\t/* abstract */\n\t},\n\n\tupdateCanvas: function(ctx, s) {\n\t\t/* abstract */\n\t},\n\n\t_getFontMetrics: function(str) {\n\t\tvar key, idx, mObj, mIdx = str.length;\n\t\tfor (key in Globals.FONT_METRICS) {\n\t\t\tidx = str.indexOf(key);\n\t\t\tif (idx !== -1 && idx < mIdx) {\n\t\t\t\tmIdx = idx;\n\t\t\t\tmObj = Globals.FONT_METRICS[key];\n\t\t\t}\n\t\t}\n\t\treturn mObj || {\n\t\t\t\"unitsPerEm\": 1024,\n\t\t\t\"ascent\": 939,\n\t\t\t\"descent\": -256\n\t\t};\n\t},\n\n\t_clearCanvas: function() {\n\t\tif (arguments.length == 4) {\n\t\t\tthis._clearCanvasRect.apply(this, arguments);\n\t\t} else {\n\t\t\tthis._ctx.save();\n\t\t\tthis._ctx.setTransform(1, 0, 0, 1, 0, 0);\n\t\t\tthis._clearCanvasRect(0, 0, this.el.width, this.el.height);\n\t\t\tthis._ctx.restore();\n\t\t}\n\t},\n\n\t_clearCanvasRect: function(x, y, w, h) {\n\t\tthis._ctx.clearRect(x, y, w, h);\n\t\tif (this._useOpaque) {\n\t\t\tthis._ctx.save();\n\t\t\tthis._ctx.fillStyle = this._backgroundColor;\n\t\t\tthis._ctx.fillRect(x, y, w, h);\n\t\t\tthis._ctx.restore();\n\t\t}\n\t},\n\n\t_setStyle: function(s) {\n\t\tCanvasView.setStyle(this._ctx, s);\n\t},\n\n\t/* --------------------------- *\n\t * render\n\t * --------------------------- */\n\n\t/** @override */\n\trender: function() {\n\t\tif (this.attached) {\n\t\t\treturn this.renderNow();\n\t\t}\n\t\treturn this;\n\t},\n\n\t/** @override */\n\trenderFrame: function(tstamp, flags) {\n\t\tif (!this.attached) {\n\t\t\treturn flags;\n\t\t}\n\t\tif (flags & View.SIZE_INVALID) {\n\t\t\tthis._updateCanvas();\n\t\t}\n\t\tif (this._interpolator.valuesChanged) {\n\t\t\tflags |= View.LAYOUT_INVALID;\n\t\t\tthis._interpolator.interpolate(tstamp);\n\t\t}\n\t\tif (flags & (View.LAYOUT_INVALID | View.SIZE_INVALID)) {\n\t\t\tthis.redraw(this._ctx, this._interpolator, flags);\n\t\t\tif (this._interpolator.valuesChanged) {\n\t\t\t\tthis.requestRender();\n\t\t\t}\n\t\t}\n\t},\n\n\t// setEnabled: function(enabled) {\n\t// \tView.prototype.setEnabled.apply(this, arguments);\n\t// \tif (this.attached) {\n\t// \t\tconsole.info(\"[%s] %s::setEnabled\", this.parentView.cid, this.cid, this.enabled);\n\t// \t\t// if (this._enabled && this._interpolator.valuesChanged) {\n\t// \t\t// this.requestRender();\n\t// \t\t// this.requestRender(CanvasView.LAYOUT_INVALID);\n\t// \t\t// }\n\t// \t}\n\t// },\n\n\t/* --------------------------- *\n\t/* public\n\t/* --------------------------- */\n\n\tgetTargetValue: function(key) {\n\t\treturn this._interpolator.getTargetValue(key);\n\t},\n\n\tgetRenderedValue: function(key) {\n\t\treturn this._interpolator.getRenderedValue(key);\n\t},\n\n\tvalueTo: function(key, value, duration) {\n\t\tthis._interpolator.valueTo(key, value, duration);\n\t\tthis.requestRender(View.MODEL_INVALID | View.LAYOUT_INVALID);\n\t},\n\n\t// updateValue: function(key) {\n\t// \treturn this._interpolator.updateValue(key || this.defaultKey);\n\t// },\n\n\t/* --------------------------- *\n\t/* redraw\n\t/* --------------------------- */\n\n\tredraw: function(ctx, interp, flags) {},\n\n}, {\n\tsetStyle: function(ctx, s) {\n\t\tif (typeof s != \"object\") return;\n\t\tfor (var p in s) {\n\t\t\tswitch (typeof ctx[p]) {\n\t\t\t\tcase \"undefined\":\n\t\t\t\t\tbreak;\n\t\t\t\tcase \"function\":\n\t\t\t\t\tif (Array.isArray(s[p])) ctx[p].apply(ctx, s[p]);\n\t\t\t\t\telse ctx[p].call(ctx, s[p]);\n\t\t\t\t\tbreak;\n\t\t\t\tdefault:\n\t\t\t\t\tctx[p] = s[p];\n\t\t\t}\n\t\t}\n\t}\n});\n\nif (DEBUG) {\n\tCanvasView.prototype._logFlags = \"\";\n}\n\nmodule.exports = CanvasView;\n",
    "/**\n * @module app/view/base/Interpolator\n */\n\n/** @type {module:utils/ease/fn/linear} */\nconst linear = require(\"utils/ease/fn/linear\");\n\n/**\n * @constructor\n * @type {module:app/view/base/Interpolator}\n */\nvar Interpolator = function(values, maxValues, easeValues) {\n\tthis._tstamp = 0;\n\n\t// gets thrown away by first interpolate() but avoid null access errors\n\tthis._renderableKeys = [];\n\tthis._renderedKeys = [];\n\n\tthis._paused = false;\n\tthis._pausedChanging = false;\n\t//this._pausedKeys = [];\n\n\tthis._maxValues = _.isObject(maxValues) ? _.extend({}, maxValues) : {};\n\tthis._easeFn = _.isObject(easeValues) ? _.extend({}, easeValues) : {};\n\tthis._valueData = {};\n\n\t// var key, val, maxVal, easeFn;\n\tfor (var key in values) {\n\t\t_.isNumber(this._maxValues[key]) || (this._maxValues[key] = null);\n\t\t_.isFunction(this._easeFn[key]) || (this._easeFn[key] = linear);\n\n\t\t// create value object and store it\n\t\tthis._valueData[key] = this._initValue(values[key], 0, this._maxValues[key]);\n\n\t\t// add to next render list\n\t\tthis._renderableKeys.push(key);\n\t}\n};\n\nInterpolator.prototype = Object.create({\n\n\t/* --------------------------- *\n\t/* public interface\n\t/* --------------------------- */\n\n\tisAtTarget: function(key) {\n\t\treturn this._renderableKeys.indexOf(key) === -1;\n\t},\n\n\tgetCurrentValue: function(key) {\n\t\treturn this._valueData[key]._renderedValue || this._valueData[key]._value;\n\t},\n\n\tgetTargetValue: function(key) {\n\t\treturn this._valueData[key]._value;\n\t},\n\n\tgetStartValue: function(key) {\n\t\treturn this._valueData[key]._startValue;\n\t},\n\n\tgetRenderedValue: function(key) {\n\t\treturn this._valueData[key]._renderedValue;\n\t},\n\n\tgetOption: function(key, opt) {\n\t\tif (opt === \"max\") return this._maxValues[key];\n\t\tif (opt === \"ease\") return this._easeFn[key];\n\t},\n\n\tvalueTo: function(key, value, duration, ease) {\n\t\tvar changed, dataObj = this._valueData[key];\n\t\tif (_.isFunction(ease)) {\n\t\t\tthis._easeFn[key] = ease;\n\t\t}\n\t\t// console.log(\"%s::valueTo [%s]\", \"[interpolator]\", key, value);\n\t\tif (Array.isArray(dataObj)) {\n\t\t\tchanged = value.reduce(function(prevChanged, itemValue, i) {\n\t\t\t\tif (dataObj[i]) {\n\t\t\t\t\tdataObj[i] = this._initNumber(itemValue, duration, this._maxValues[key]);\n\t\t\t\t\treturn true;\n\t\t\t\t}\n\t\t\t\treturn this._setValue(dataObj[i], itemValue, duration) || prevChanged;\n\t\t\t}.bind(this), changed);\n\t\t} else {\n\t\t\tchanged = this._setValue(dataObj, value, duration);\n\t\t}\n\t\tif (changed) {\n\t\t\tthis._renderableKeys.indexOf(key) !== -1 || this._renderableKeys.push(key);\n\t\t}\n\t\treturn this;\n\t},\n\n\tupdateValue: function(key) {\n\t\t// Call _interpolateKey only if needed. _interpolateKey() returns false\n\t\t// once interpolation is done, in which case remove key from _renderableKeys.\n\t\tvar kIndex = this._renderableKeys.indexOf(key);\n\t\tif (kIndex !== -1 && !this._interpolateKey(key)) {\n\t\t\tthis._renderableKeys.splice(kIndex, 1);\n\t\t}\n\t\treturn this;\n\t},\n\n\t/* --------------------------- *\n\t/* private: valueData\n\t/* --------------------------- */\n\n\t_initValue: function(value, duration, maxVal) {\n\t\tif (Array.isArray(value)) {\n\t\t\treturn value.map(function(val) {\n\t\t\t\treturn this._initNumber(val, duration, maxVal);\n\t\t\t}, this);\n\t\t}\n\t\treturn this._initNumber(value, duration, maxVal);\n\t},\n\n\t_initNumber: function(value, duration, maxVal) {\n\t\tvar o = {};\n\t\to._value = value;\n\t\to._startValue = value;\n\t\to._valueDelta = 0;\n\n\t\to._duration = duration || 0;\n\t\to._startTime = NaN;\n\t\to._elapsedTime = NaN;\n\n\t\to._lastRenderedValue = null;\n\t\to._renderedValue = o._startValue;\n\n\t\to._maxVal = maxVal;\n\t\t// if (maxVal !== void 0) o._maxVal = maxVal;\n\t\t// o._maxVal = this._maxValues[key];\n\t\t// o._maxVal = this._maxVal;// FIXME\n\t\treturn o;\n\t},\n\n\t_setValue: function(o, value, duration) {\n\t\tif (o._value !== value) {\n\t\t\to._startValue = o._value;\n\t\t\to._valueDelta = value - o._value;\n\t\t\to._value = value;\n\n\t\t\to._duration = duration || 0;\n\t\t\to._startTime = NaN;\n\t\t\to._elapsedTime = NaN;\n\n\t\t\t// o._lastRenderedValue = o._renderedValue;\n\t\t\t// o._renderedValue = o._startValue;\n\n\t\t\treturn true;\n\t\t}\n\t\treturn false;\n\t},\n\n\t/* --------------------------- *\n\t/* private: interpolate\n\t/* --------------------------- */\n\n\t_tstamp: 0,\n\n\t/** @override */\n\tinterpolate: function(tstamp) {\n\t\tthis._tstamp = tstamp;\n\n\t\tif (this.valuesChanged) {\n\t\t\tif (this._pausedChanging) {\n\t\t\t\tthis._renderableKeys.forEach(function(key) {\n\t\t\t\t\tvar o = this._valueData[key];\n\t\t\t\t\tif (!isNaN(o._elapsedTime)) {\n\t\t\t\t\t\to._startTime = tstamp - o._elapsedTime;\n\t\t\t\t\t}\n\t\t\t\t}, this);\n\t\t\t\tthis._pausedChanging = false;\n\t\t\t}\n\t\t\tvar changedKeys = this._renderableKeys;\n\t\t\tthis._renderableKeys = changedKeys.filter(function(key) {\n\t\t\t\treturn this._interpolateValue(tstamp, this._valueData[key], this._easeFn[key]);\n\t\t\t}, this);\n\t\t\tthis._renderedKeys = changedKeys;\n\t\t}\n\t\treturn this;\n\t},\n\n\t_interpolateKey: function(key) {\n\t\treturn this._interpolateValue(this._tstamp, this._valueData[key], this._easeFn[key]);\n\t},\n\n\t_interpolateValue: function(tstamp, o, fn) {\n\t\tif (Array.isArray(o)) {\n\t\t\treturn o.reduce(function(changed, item, index, arr) {\n\t\t\t\treturn this._interpolateNumber(tstamp, item, fn) || changed;\n\t\t\t}.bind(this), false);\n\t\t}\n\t\treturn this._interpolateNumber(tstamp, o, fn);\n\t},\n\n\t_interpolateNumber: function(tstamp, o, fn) {\n\t\tif (isNaN(o._startTime)) {\n\t\t\to._startTime = tstamp;\n\t\t}\n\t\to._lastRenderedValue = o._renderedValue;\n\n\t\tvar elapsed = Math.max(0, tstamp - o._startTime);\n\t\tif (elapsed < o._duration) {\n\t\t\tif (o._maxVal && o._valueDelta < 0) {\n\t\t\t\t// upper-bound values\n\t\t\t\to._renderedValue = fn(elapsed, o._startValue,\n\t\t\t\t\to._valueDelta + o._maxVal, o._duration) - o._maxVal;\n\t\t\t} else {\n\t\t\t\t// unbound values\n\t\t\t\to._renderedValue = fn(elapsed, o._startValue,\n\t\t\t\t\to._valueDelta, o._duration);\n\t\t\t}\n\t\t\to._elapsedTime = elapsed;\n\t\t\treturn true;\n\t\t}\n\t\to._renderedValue = o._value;\n\t\to._elapsedTime = NaN;\n\t\to._startTime = NaN;\n\t\treturn false;\n\t},\n}, {\n\t/**\n\t * @type {boolean}\n\t */\n\tpaused: {\n\t\tget: function() {\n\t\t\treturn this._paused;\n\t\t},\n\t\tset: function(value) {\n\t\t\tvalue = !!(value); // Convert to boolean\n\t\t\tif (this._paused !== value) {\n\t\t\t\tthis._paused = value;\n\t\t\t\tthis._pausedChanging = true;\n\t\t\t}\n\t\t}\n\t},\n\t/**\n\t * @type {boolean} Has any value been changed by valueTo() since last interpolate()\n\t */\n\tvaluesChanged: {\n\t\tget: function() {\n\t\t\treturn !this._paused && this._renderableKeys.length > 0;\n\t\t}\n\t},\n\t/**\n\t * @type {array} Keys that are not yet at target value\n\t */\n\trenderableKeys: {\n\t\tget: function() {\n\t\t\treturn this._renderableKeys;\n\t\t}\n\t},\n\t/**\n\t * @type {array} Keys that have been rendered in the last interpolate()\n\t */\n\trenderedKeys: {\n\t\tget: function() {\n\t\t\treturn this._renderedKeys;\n\t\t}\n\t},\n\t/**\n\t * @type {array} All keys\n\t */\n\tkeys: {\n\t\tget: function() {\n\t\t\treturn Object.keys(this._valueData);\n\t\t}\n\t},\n});\n\nmodule.exports = Interpolator;\n",
    "/** @type {module:utils/prefixedEvent} */\nconst prefixedEvent = require(\"utils/prefixedEvent\");\n\nvar eventMap = {\n\t\"transitionend\": prefixedEvent(\"transitionend\"),\n\t\"fullscreenchange\": prefixedEvent(\"fullscreenchange\", document),\n\t\"fullscreenerror\": prefixedEvent(\"fullscreenerror\", document),\n\t\"visibilitychange\": prefixedEvent(\"visibilitychange\", document, \"hidden\")\n};\n\nvar eventNum = 0;\nfor (var eventName in eventMap) {\n\tif (eventName === eventMap[eventName]) {\n\t\tdelete eventMap[eventName];\n\t} else {\n\t\tObject.defineProperty(eventMap, eventName, {\n\t\t\tvalue: eventMap[eventName],\n\t\t\tenumerable: true\n\t\t});\n\t\tObject.defineProperty(eventMap, eventNum, {\n\t\t\tvalue: eventName,\n\t\t\tenumerable: false\n\t\t});\n\t\teventNum++;\n\t}\n}\nObject.defineProperty(eventMap, \"length\", {\n\tvalue: eventNum\n});\n\nif (DEBUG) {\n\tconsole.log(\"prefixes enabled for %i events\", eventMap.length, Object.keys(eventMap));\n}\n\nmodule.exports = eventMap;\n\n// module.exports = eventNum > 0? eventMap : null;\n",
    "/**\n * @module app/view/base/TouchManager\n */\n\n/** @type {module:app/control/Globals} */\nconst Globals = require(\"app/control/Globals\");\n/** @type {module:hammerjs} */\nconst Hammer = require(\"hammerjs\");\n// /** @type {module:hammerjs.Tap} */\n// const Tap = Hammer.Tap;\n/** @type {module:utils/touch/SmoothPanRecognizer} */\nconst Pan = require(\"utils/touch/SmoothPanRecognizer\");\n/** @type {module:hammerjs.Pan} */\n// const Pan = Hammer.Pan;\n\n/* -------------------------------\n/* Static private\n/* ------------------------------- */\n\n/**\n * @param el HTMLElement\n * @return {Hammer.Manager}\n */\nfunction createInstance(el) {\n\tlet manager = new Hammer.Manager(el);\n\t// manager.set({ domevents: true });\n\n\t// let tap = new Hammer.Tap({\n\t// \tthreshold: Globals.PAN_THRESHOLD - 1\n\t// });\n\t// manager.add(tap);\n\tlet hpan = new Pan({\n\t\tevent: \"hpan\",\n\t\tdirection: Hammer.DIRECTION_HORIZONTAL,\n\t\tthreshold: Globals.PAN_THRESHOLD,\n\t\t// touchAction: \"pan-y\",\n\t});\n\tmanager.add(hpan);\n\n\t// let vpan = new Pan({\n\t// \tevent: \"vpan\",\n\t// \tdirection: Hammer.DIRECTION_VERTICAL,\n\t// \t// threshold: Globals.PAN_THRESHOLD,\n\t// \t// touchAction: \"pan-x\",\n\t// });\n\t// manager.add(vpan);\n\t// vpan.requireFailure(hpan);\n\n\treturn manager;\n}\n\n/* -------------------------------\n * hammerjs fixup handlers\n * ------------------------------- */\n\n/* eslint-disable no-unused-vars */\nconst PANEND_THRES_MS = 300; // millisecs\nconst PANEND_THRES_PX = 25; // pixels\nconst UP_EVENT = window.hasOwnProperty(\"onpointerup\") ? \"pointerup\" : \"mouseup\";\n\nlet touchHandlers = {};\nlet captureHandlers = {};\nlet bubblingHandlers = {};\n\n/*https://gist.githubusercontent.com/jtangelder/361052976f044200ea17/raw/f54c2cef78d59da3f38286fad683471e1c976072/PreventGhostClick.js*/\nvar lastTimeStamp = NaN;\nvar panSessionOpened = false;\n\nlet saveTimeStamp = function(hev) {\n\tpanSessionOpened = !hev.isFinal;\n\tif (hev.isFinal) {\n\t\tlastTimeStamp = hev.srcEvent.timeStamp;\n\t}\n\tif (DEBUG) {\n\t\tlogPanEvent(hev);\n\t}\n};\n\n// let preventSrcEvent = function(hev) {\n// \t//console.log(hev.type, \"preventDefault\");\n// \thev.srcEvent.preventDefault();\n// };\n\n// let preventWhilePanning = function(domev) {\n// \tpanSessionOpened && domev.preventDefault();\n// };\n\n// let preventWhileNotPanning = function(domev) {\n// \t!panSessionOpened && domev.preventDefault();\n// };\n\nlet stopEventAfterPan = function(domev) {\n\tif ((domev.timeStamp - lastTimeStamp) < PANEND_THRES_MS) {\n\t\t// domev.defaultPrevented ||\n\t\tdomev.preventDefault();\n\t\tdomev.stopPropagation();\n\t}\n\tif (DEBUG) {\n\t\tlogEvent(domev, (domev.timeStamp - lastTimeStamp).toFixed(3));\n\t}\n\tlastTimeStamp = NaN;\n};\n\ntouchHandlers[\"hpanstart hpanend hpancancel\"] = saveTimeStamp;\n// touchHandlers[\"vpanstart vpanend vpancancel\"] = saveTimeStamp;\n// touchHandlers[\"hpanmove hpanend hpancancel\"] = preventSrcEvent;\n// touchHandlers[\"vpanmove vpanend vpancancel\"] = preventSrcEvent;\n\ncaptureHandlers[\"click\"] = stopEventAfterPan;\n// bubblingHandlers[\"click\"] = stopEventAfterPan;\n\n// touchHandlers[[\n// \t\"vpanstart\", \"vpanend\", \"vpancancel\", \"vpanmove\",\n// \t\"hpanstart\", \"hpanend\", \"hpancancel\", \"hpanmove\"\n// ].join(\" \")] = logHammerEvent;\n\n/* -------------------------------\n/* DOM event handlers\n/* ------------------------------- */\n\n\n// captureHandlers[UP_EVENT] = preventWhilePanning;\n// captureHandlers[\"touchmove\"] = captureHandlers[\"mousemove\"] = logDOMEvent;\n\nif (DEBUG) {\n\tvar logPanEvent = function(hev) {\n\t\tlogEvent(hev.srcEvent, `[${hev.type}]`);\n\t};\n\tvar logEvent = function(domev, msg) {\n\t\tlet msgs = [];\n\t\tif (domev.defaultPrevented)\n\t\t\tmsgs.push(\"prevented\");\n\t\tif (msg)\n\t\t\tmsgs.push(msg);\n\t\tmsgs.push(`${panSessionOpened ? \"panning\" : \"pan ended\"} ${(domev.timeStamp - lastTimeStamp).toFixed(3)}`);\n\t\tconsole.log(\"TouchManager %s [%s]\",\n\t\t\tdomev.timeStamp.toFixed(3),\n\t\t\tdomev.type,\n\t\t\tmsgs.join(\", \")\n\t\t);\n\t};\n}\n\n/* eslint-enable no-unsused-vars */\n\n// -------------------------------\n//\n// -------------------------------\n\nfunction addHandlers() {\n\tlet eventName;\n\tconst el = instance.element;\n\tfor (eventName in touchHandlers)\n\t\tif (touchHandlers.hasOwnProperty(eventName))\n\t\t\tinstance.on(eventName, touchHandlers[eventName]);\n\tfor (eventName in captureHandlers)\n\t\tif (captureHandlers.hasOwnProperty(eventName))\n\t\t\tel.addEventListener(eventName, captureHandlers[eventName], true);\n\tfor (eventName in bubblingHandlers)\n\t\tif (bubblingHandlers.hasOwnProperty(eventName))\n\t\t\tel.addEventListener(eventName, bubblingHandlers[eventName], false);\n\t// document.addEventListener(\"touchmove\", preventWhileNotPanning, false);\n}\n\nfunction removeHandlers() {\n\tlet eventName;\n\tconst el = instance.element;\n\tfor (eventName in captureHandlers)\n\t\tif (captureHandlers.hasOwnProperty(eventName))\n\t\t\tel.removeEventListener(eventName, captureHandlers[eventName], true);\n\tfor (eventName in bubblingHandlers)\n\t\tif (captureHandlers.hasOwnProperty(eventName))\n\t\t\tel.removeEventListener(eventName, bubblingHandlers[eventName], true);\n\t// document.removeEventListener(\"touchmove\", preventWhileNotPanning, false);\n}\n\n/** @type {Hammer.Manager} */\nlet instance = null;\n\n/* -------------------------------\n/* Static public\n/* ------------------------------- */\n\nlet TouchManager = {\n\tinit: function(target) {\n\t\tif (instance === null) {\n\t\t\tinstance = createInstance(target);\n\t\t\taddHandlers();\n\t\t} else if (instance.element !== target) {\n\t\t\tconsole.warn(\"TouchManager already initialized with another element\");\n\t\t}\n\t\treturn instance;\n\t},\n\n\tdestroy: function() {\n\t\tif (instance !== null) {\n\t\t\tremoveHandlers();\n\t\t\tinstance.destroy();\n\t\t\tinstance = null;\n\t\t} else {\n\t\t\tconsole.warn(\"no instance to destroy\");\n\t\t}\n\t},\n\n\tgetInstance: function() {\n\t\tif (instance === null) {\n\t\t\tconsole.error(\"TouchManager has not been initialized\");\n\t\t}\n\t\treturn instance;\n\t}\n};\n\nmodule.exports = TouchManager;\n\n/*\n// alt syntax\nfunction createInstance(el) {\n\treturn new Hammer(el, {\n\t\trecognizers: [\n\t\t\t[Tap],\n\t\t\t[Pan, {\n\t\t\t\tevent: 'hpan',\n\t\t\t\tdirection: Hammer.DIRECTION_HORIZONTAL,\n\t\t\t\tthreshold: Globals.THRESHOLD\n\t\t\t}],\n\t\t\t[Pan, {\n\t\t\t\tevent: 'vpan',\n\t\t\t\tdirection: Hammer.DIRECTION_VERTICAL,\n\t\t\t\tthreshold: Globals.THRESHOLD\n\t\t\t}, ['hpan']]\n\t\t]\n\t});\n}\n*/\n",
    "/* global HTMLElement, MutationObserver */\n/**\n * @module app/view/base/View\n */\n\n/** @type {module:setimmediate} */\nrequire(\"setimmediate\");\n\n/** @type {module:backbone} */\nconst Backbone = require(\"backbone\");\n\n/* -------------------------------\n/* MutationObserver\n/* ------------------------------- */\n\nvar _cidSeed = 1;\nvar _viewsByCid = {};\n\nfunction addChildViews(el) {\n\tvar view, els = el.querySelectorAll(\"*[data-cid]\");\n\tfor (var i = 0, ii = els.length; i < ii; i++) {\n\t\tview = View.findByElement(els.item(i));\n\t\tif (view) {\n\t\t\tif (!view.attached) {\n\t\t\t\t// console.log(\"View::[attached (parent)] %s\", view.cid);\n\t\t\t\tview._elementAttached();\n\t\t\t\t// } else {\n\t\t\t\t// \tconsole.warn(\"View::[attached (parent)] %s (ignored)\", view.cid);\n\t\t\t}\n\t\t}\n\t}\n}\n\nfunction removeChildViews(el) {\n\tvar view, els = el.querySelectorAll(\"*[data-cid]\");\n\tfor (var i = 0, ii = els.length; i < ii; i++) {\n\t\tview = View.findByElement(els.item(i));\n\t\tif (view) {\n\t\t\tif (view.attached) {\n\t\t\t\tconsole.log(\"View::[detached (parent)] %s\", view.cid);\n\t\t\t\tview._elementDetached();\n\t\t\t} else {\n\t\t\t\tconsole.warn(\"View::[detached (parent)] %s (ignored)\", view.cid);\n\t\t\t}\n\t\t}\n\t}\n}\n\nvar observer = new MutationObserver(function(mm) {\n\t// console.log(\"View::mutations %s\", JSON.stringify(mm, null, \" \"));\n\tvar i, ii, m;\n\tvar j, jj, e;\n\tvar view;\n\tfor (i = 0, ii = mm.length; i < ii; i++) {\n\t\tm = mm[i];\n\t\tif (m.type == \"childList\") {\n\t\t\tfor (j = 0, jj = m.addedNodes.length; j < jj; j++) {\n\t\t\t\te = m.addedNodes.item(j);\n\t\t\t\tview = View.findByElement(e);\n\t\t\t\tif (view) {\n\t\t\t\t\tif (!view.attached) {\n\t\t\t\t\t\t// console.log(\"View::[attached (childList)] %s\", view.cid);\n\t\t\t\t\t\tview._elementAttached();\n\t\t\t\t\t\t// } else {\n\t\t\t\t\t\t// \tconsole.warn(\"View::[attached (childList)] %s (ignored)\", view.cid);\n\t\t\t\t\t}\n\t\t\t\t}\n\t\t\t\tif (e instanceof HTMLElement) addChildViews(e);\n\t\t\t}\n\t\t\tfor (j = 0, jj = m.removedNodes.length; j < jj; j++) {\n\t\t\t\te = m.removedNodes.item(j);\n\t\t\t\t// console.log(\"View::[detached (childList)] %s\", e.cid);\n\t\t\t\tview = View.findByElement(e);\n\t\t\t\tif (view) {\n\t\t\t\t\tif (view.attached) {\n\t\t\t\t\t\tconsole.log(\"View::[detached (childList)] %s\", view.cid, view.attached);\n\t\t\t\t\t\tview._elementDetached();\n\t\t\t\t\t} else {\n\t\t\t\t\t\tconsole.warn(\"View::[detached (childList)] %s (ignored)\", view.cid, view.attached);\n\t\t\t\t\t}\n\t\t\t\t}\n\t\t\t\tif (e instanceof HTMLElement) removeChildViews(e);\n\t\t\t}\n\t\t} else if (m.type == \"attributes\") {\n\t\t\tview = View.findByElement(m.target);\n\t\t\tif (view) {\n\t\t\t\tif (!view.attached) {\n\t\t\t\t\t// console.log(\"View::[attached (attribute)] %s\", view.cid);\n\t\t\t\t\tview._elementAttached();\n\t\t\t\t\t// } else {\n\t\t\t\t\t// \tconsole.warn(\"View::[attached (attribute)] %s (ignored)\", view.cid);\n\t\t\t\t}\n\t\t\t}\n\t\t\t// else {\n\t\t\t// \tconsole.warn(\"View::[attributes] target has no cid (%s='%s')\", m.attributeName, m.target.getAttribute(m.attributeName), m);\n\t\t\t// }\n\t\t}\n\t}\n});\n\nobserver.observe(document.body, {\n\tattributes: true,\n\tchildList: true,\n\tsubtree: true,\n\tattributeFilter: [\"data-cid\"]\n});\n\n/* -------------------------------\n/* static private\n/* ------------------------------- */\n\nvar _now = window.performance ?\n\twindow.performance.now.bind(window.performance) :\n\tDate.now.bind(Date);\n// var _now = window.performance?\n// \tfunction() { return window.performance.now(); }:\n// \tfunction() { return Date.now(); };\n\n// /** @type {module:app/view/base/renderQueue} */\n// var renderQueue = require(\"app/view/base/renderQueue\");\n//\n/** @type {module:app/view/base/CallbackQueue} */\nvar renderQueue = (function(CallbackQueue) {\n\treturn new CallbackQueue(\n\t\tfunction(callback) {\n\t\t\treturn window.requestAnimationFrame(callback);\n\t\t},\n\t\tfunction(id) {\n\t\t\treturn window.cancelAnimationFrame(id);\n\t\t}\n\t);\n})(require(\"app/view/base/CallbackQueue\"));\n\n/** @type {module:app/view/base/CallbackQueue} */\nvar modelQueue = (function(CallbackQueue) {\n\treturn new CallbackQueue(\n\t\tfunction(callback) {\n\t\t\treturn window.setImmediate(function() {\n\t\t\t\tcallback.call(null, _now());\n\t\t\t});\n\t\t},\n\t\tfunction(id) {\n\t\t\treturn window.clearImmediate(id);\n\t\t}\n\t);\n})(require(\"app/view/base/CallbackQueue\"));\n\n/** @type {module:app/view/base/PrefixedEvents} */\nconst PrefixedEvents = require(\"app/view/base/PrefixedEvents\");\n\nvar applyEventPrefixes = function(events) {\n\tvar selector, unprefixed;\n\tfor (selector in events) {\n\t\tunprefixed = selector.match(/^\\w+/i)[0];\n\t\tif (PrefixedEvents.hasOwnProperty(unprefixed)) {\n\t\t\tevents[selector.replace(unprefixed, PrefixedEvents[unprefixed])] = events[selector];\n\t\t\t// console.log(\"applyEventPrefixes\", unprefixed, prefixedEvents[unprefixed]);\n\t\t\tdelete events[selector];\n\t\t}\n\t}\n\treturn events;\n};\n\nvar getViewDepth = function(view) {\n\tif (!view) {\n\t\treturn null;\n\t}\n\tif (!view.attached) {\n\t\treturn NaN;\n\t}\n\tif (view.parentView === null) {\n\t\treturn 0;\n\t}\n\treturn view.parentView.viewDepth + 1;\n};\n\nfunction logAttachInfo(view, name, level) {\n\tif ([\"log\", \"info\", \"warn\", \"error\"].indexOf(level) != -1) {\n\t\tlevel = \"log\";\n\t}\n\tconsole[level].call(console, \"%s::%s [parent:%s %s %s depth:%s]\", view.cid, name, view.parentView && view.parentView.cid, view.attached ? \"attached\" : \"detached\", view._viewPhase, view.viewDepth);\n}\n\n/* -------------------------------\n/* static public\n/* ------------------------------- */\n\n\nvar View = {\n\n\t/** @const */\n\tNONE_INVALID: 0,\n\t/** @const */\n\tALL_INVALID: ~0 >>> 1,\n\n\t/** @const */\n\tCHILDREN_INVALID: 1,\n\t/** @const */\n\tMODEL_INVALID: 2,\n\t/** @const */\n\tSTYLES_INVALID: 4,\n\t/** @const */\n\tSIZE_INVALID: 8,\n\t/** @const */\n\tLAYOUT_INVALID: 16,\n\n\t/** @const */\n\tCLICK_EVENT: \"click\", //window.hasOwnProperty(\"onpointerup\") ? \"pointerup\" : \"mouseup\",\n\n\t/** @type {module:app/view/base/ViewError} */\n\tViewError: require(\"app/view/base/ViewError\"),\n\n\t/** @type {module:utils/prefixedProperty} */\n\tprefixedProperty: require(\"utils/prefixedProperty\"),\n\n\t/** @type {module:utils/prefixedStyleName} */\n\tprefixedStyleName: require(\"utils/prefixedStyleName\"),\n\n\t/** @type {module:utils/prefixedEvent} */\n\tprefixedEvent: require(\"utils/prefixedEvent\"),\n\n\t/** @type {module:app/view/promise/whenViewIsAttached} */\n\twhenViewIsAttached: require(\"app/view/promise/whenViewIsAttached\"),\n\n\t/** @type {module:app/view/promise/whenViewIsRendered} */\n\twhenViewIsRendered: require(\"app/view/promise/whenViewIsRendered\"),\n\n\t/**\n\t/* @param el {HTMLElement}\n\t/* @return {module:app/view/base/View}\n\t/*/\n\tfindByElement: function(el) {\n\t\tif (_viewsByCid[el.cid]) {\n\t\t\treturn _viewsByCid[el.cid];\n\t\t}\n\t\treturn null;\n\t},\n\n\t/**\n\t/* @param el {HTMLElement}\n\t/* @return {module:app/view/base/View}\n\t/*/\n\tfindByDescendant: function(el) {\n\t\tdo {\n\t\t\tif (_viewsByCid[el.cid]) {\n\t\t\t\treturn _viewsByCid[el.cid];\n\t\t\t}\n\t\t} while ((el = el.parentElement || el.parentNode));\n\t\treturn null;\n\t},\n\n\t/** @override */\n\textend: function(proto, obj) {\n\t\tif (PrefixedEvents.length && proto.events) {\n\t\t\tif (_.isFunction(proto.events)) {\n\t\t\t\tproto.events = _.wrap(proto.events, function(fn) {\n\t\t\t\t\treturn applyEventPrefixes(fn.apply(this));\n\t\t\t\t});\n\t\t\t} else\n\t\t\tif (_.isObject(proto.events)) {\n\t\t\t\tproto.events = applyEventPrefixes(proto.events);\n\t\t\t}\n\t\t}\n\t\tif (proto.properties && this.prototype.properties) {\n\t\t\t_.defaults(proto.properties, this.prototype.properties);\n\t\t}\n\t\treturn Backbone.View.extend.apply(this, arguments);\n\t},\n\n\t_flagsToStrings: [\"-\"],\n\n\tflagsToString: function(flags) {\n\t\tvar s = View._flagsToStrings[flags | 0];\n\t\tif (!s) {\n\t\t\ts = [];\n\t\t\tif (flags & View.CHILDREN_INVALID) s.push(\"children\");\n\t\t\tif (flags & View.MODEL_INVALID) s.push(\"model\");\n\t\t\tif (flags & View.STYLES_INVALID) s.push(\"styles\");\n\t\t\tif (flags & View.SIZE_INVALID) s.push(\"size\");\n\t\t\tif (flags & View.LAYOUT_INVALID) s.push(\"layout\");\n\t\t\tView._flagsToStrings[flags] = s = s.join(\" \");\n\t\t}\n\t\treturn s;\n\t\t// return (flags | 0).toString(2);\n\t},\n};\n\nObject.defineProperty(View, \"instances\", {\n\tvalue: _viewsByCid,\n\tenumerable: true\n});\n\n/* -------------------------------\n/* prototype\n/* ------------------------------- */\n\n// module.exports = Backbone.View.extend({\nvar ViewProto = {\n\n\t/** @type {string} */\n\tcidPrefix: \"view\",\n\t/** @type {Boolean} */\n\t_attached: false,\n\t/** @type {HTMLElement|null} */\n\t_parentView: null,\n\t/** @type {int|null} */\n\t_viewDepth: null,\n\t/** @type {string} initializing > initialized > disposing > disposed */\n\t_viewPhase: \"initializing\",\n\t/** @type {int} */\n\t_renderQueueId: -1,\n\t/** @type {int} */\n\t_renderFlags: 0,\n\t/** @type {Boolean} */\n\t_enabled: null,\n\n\t/** @type {object} */\n\tproperties: {\n\t\tcid: {\n\t\t\tget: function() {\n\t\t\t\treturn this._cid || (this._cid = this.cidPrefix + _cidSeed++);\n\t\t\t},\n\t\t\tset: function(value) {\n\t\t\t\t// ignored\n\t\t\t}\n\t\t},\n\t\tattached: {\n\t\t\tget: function() {\n\t\t\t\treturn this._attached;\n\t\t\t}\n\t\t},\n\t\tparentView: {\n\t\t\tget: function() {\n\t\t\t\treturn this._parentView;\n\t\t\t}\n\t\t},\n\t\tviewDepth: {\n\t\t\tget: function() {\n\t\t\t\treturn this._getViewDepth();\n\t\t\t}\n\t\t},\n\t\tinvalidated: {\n\t\t\tget: function() {\n\t\t\t\treturn this._renderQueueId !== -1;\n\t\t\t}\n\t\t},\n\t\tenabled: {\n\t\t\tget: function() {\n\t\t\t\treturn this._enabled;\n\t\t\t},\n\t\t\tset: function(enabled) {\n\t\t\t\tthis.setEnabled(enabled);\n\t\t\t}\n\t\t},\n\t\trenderFlags: {\n\t\t\tget: function() {\n\t\t\t\treturn this._renderFlags;\n\t\t\t}\n\t\t}\n\t},\n\n\t$: Backbone.$,\n\n\t/**\n\t * @constructor\n\t * @type {module:app/view/base/View}\n\t */\n\tconstructor: function(options) {\n\t\tthis.transform = {};\n\t\tthis.childViews = {};\n\t\tthis._applyRender = this._applyRender.bind(this);\n\n\t\tif (this.properties) {\n\t\t\t// Object.defineProperties(this, getPrototypeChainValue(this, \"properties\", Backbone.View));\n\t\t\tObject.defineProperties(this, this.properties);\n\t\t}\n\t\tif (options && options.className && this.className) {\n\t\t\toptions.className += \" \" + _.result(this, \"className\");\n\t\t}\n\t\tif (options && options.parentView) {\n\t\t\tthis._setParentView(options.parentView, true);\n\t\t}\n\t\tBackbone.View.apply(this, arguments);\n\n\t\t// console.log(\"%s::initialize viewPhase:[%s => initialized]\", this.cid, this._viewPhase);\n\t\tthis._viewPhase = \"initialized\";\n\n\t\tif (this.parentView !== null) {\n\t\t\tthis.trigger(\"view:parentChange\", this.parentView, null);\n\t\t}\n\t\tif (this.attached) {\n\t\t\tthis.trigger(\"view:attached\", this);\n\t\t}\n\t},\n\n\t/* -------------------------------\n\t/* remove\n\t/* ------------------------------- */\n\n\t/** @override */\n\tremove: function() {\n\t\tif (this._viewPhase == \"disposing\") {\n\t\t\tlogAttachInfo(this, \"remove\", \"warn\");\n\t\t} else {\n\t\t\t// logAttachInfo(this, \"remove\", \"log\");\n\t\t}\n\n\t\t// before removal\n\t\tthis._viewPhase = \"disposing\";\n\t\tthis._cancelRender();\n\n\t\t// call Backbone impl\n\t\t// Backbone.View.prototype.remove.apply(this, arguments);\n\n\t\t// NOTE: from Backbone impl\n\t\tthis.$el.remove(); // from Backbone impl\n\n\t\tthis._attached = false;\n\t\tthis.trigger(\"view:removed\", this);\n\n\t\t// remove parent/child references\n\t\tthis._setParentView(null);\n\n\t\t// NOTE: from Backbone impl. No more events after this\n\t\tthis.stopListening();\n\n\t\t// check for invalidations that may have been triggered by \"view:removed\"\n\t\tif (this.invalidated) {\n\t\t\tconsole.warn(\"%s::remove invalidated after remove()\", this.cid);\n\t\t\tthis._cancelRender();\n\t\t}\n\t\t// // check for children still here\n\t\t// var ccids = Object.keys(this.childViews);\n\t\t// if (ccids.length) {\n\t\t// \tconsole.warn(\"%s::remove %i children not removed [%s]\", this.cid, ccids.length, ccids.join(\", \"), this.childViews);\n\t\t// }\n\t\t// // remove childViews\n\t\t// for (var cid in this.childViews) {\n\t\t// \tthis.childViews[cid].remove();\n\t\t// }\n\t\t// clear reference in view map\n\t\tdelete _viewsByCid[this.cid];\n\t\t// delete this.el.cid;\n\t\t// update phase\n\t\tthis._viewPhase = \"disposed\";\n\t\treturn this;\n\t},\n\n\t/* -------------------------------\n\t/* _elementAttached _elementDetached\n\t/* ------------------------------- */\n\n\t_elementAttached: function() {\n\t\t// this._addToParentView();\n\t\tthis._attached = true;\n\t\tthis._viewDepth = null;\n\t\tthis.setEnabled(true);\n\t\tthis._setParentView(View.findByDescendant(this.el.parentElement));\n\n\t\t// if (this.parentView) {\n\t\t// \tconsole.log(\"[attach] [%i] %s > %s::_elementAttached\", this.viewDepth, this.parentView.cid, this.cid);\n\t\t// } else {\n\t\t// \tconsole.log(\"[attach] [%i] %s::_elementAttached\", this.viewDepth, this.cid);\n\t\t// }\n\n\t\t// if (this._viewPhase == \"initializing\") {\n\t\t// \t// this.trigger(\"view:attached\", this);\n\t\t// } else\n\t\tif (this._viewPhase == \"initialized\") {\n\t\t\tthis.trigger(\"view:attached\", this);\n\t\t} else\n\t\tif (this._viewPhase == \"replacing\") {\n\t\t\tthis._viewPhase = \"initialized\";\n\t\t\tthis.trigger(\"view:replaced\", this);\n\t\t}\n\t},\n\n\t_elementDetached: function() {\n\t\tif (!this.attached || (this._viewPhase == \"disposing\") || (this._viewPhase == \"disposed\")) {\n\t\t\tlogAttachInfo(this, \"_elementDetached\", \"error\");\n\t\t\t// } else {\n\t\t\t// \tlogAttachInfo(this, \"_elementDetached\", \"log\");\n\t\t}\n\t\tthis._attached = false;\n\t\tthis._viewDepth = null;\n\t\tthis.setEnabled(false);\n\n\t\tif (this._viewPhase != \"disposing\" || this._viewPhase == \"disposed\") {\n\t\t\tthis.remove();\n\t\t}\n\t},\n\n\t/* -------------------------------\n\t/* parentView\n\t/* ------------------------------- */\n\n\t_setParentView: function(newParent, silent) {\n\t\tif (newParent === void 0) {\n\t\t\tconsole.warn(\"$s::_setParentView invalid value '%s'\", this.cid, newParent);\n\t\t\tnewParent = null;\n\t\t}\n\t\tvar oldParent = this._parentView;\n\t\tthis._parentView = newParent;\n\n\t\t// force update of _viewDepth\n\t\tthis._viewDepth = null; //getViewDepth(this);\n\n\t\t// skip the rest if arg is the same\n\t\tif (newParent === oldParent) {\n\t\t\treturn;\n\t\t}\n\t\tif (oldParent !== null) {\n\t\t\tif (this.cid in oldParent.childViews) {\n\t\t\t\tdelete oldParent.childViews[this.cid];\n\t\t\t}\n\t\t}\n\t\tif (newParent !== null) {\n\t\t\tnewParent.childViews[this.cid] = this;\n\t\t}\n\t\tif (!silent)\n\t\t\tthis.trigger(\"view:parentChange\", this, newParent, oldParent);\n\t},\n\n\twhenAttached: function() {\n\t\treturn View.whenViewIsAttached(this);\n\t},\n\n\t_getViewDepth: function() {\n\t\tif (this._viewDepth === null) {\n\t\t\tthis._viewDepth = getViewDepth(this);\n\t\t}\n\t\treturn this._viewDepth;\n\t},\n\n\t/* -------------------------------\n\t/* Backbone.View overrides\n\t/* ------------------------------- */\n\n\t/** @override */\n\tsetElement: function(element, delegate) {\n\t\t// setElement always initializes this.el, so check it to be non-null before calling super\n\t\tif (this.el) {\n\t\t\tif (this.el !== element && this.el.parentElement) {\n\t\t\t\t// Element is being replaced\n\t\t\t\tif (this.attached) {\n\t\t\t\t\t// Since old element is attached to document tree, _elementAttached will be\n\t\t\t\t\t// triggered by replaceChild: set _viewPhase = \"replacing\" to flag this\n\t\t\t\t\t// change and trigger 'view:replaced' instead of 'view:added'.\n\t\t\t\t\tthis._viewPhase = \"replacing\";\n\t\t\t\t}\n\t\t\t\tthis.el.parentElement.replaceChild(element, this.el);\n\t\t\t}\n\t\t\tBackbone.View.prototype.setElement.apply(this, arguments);\n\t\t\t// Merge classes specified by this view with the ones already in the element,\n\t\t\t// as backbone will not:\n\t\t\tif (this.className) {\n\t\t\t\t_.result(this, \"className\").split(\" \").forEach(function(item) {\n\t\t\t\t\tthis.el.classList.add(item);\n\t\t\t\t}, this);\n\t\t\t}\n\t\t} else {\n\t\t\tBackbone.View.prototype.setElement.apply(this, arguments);\n\t\t}\n\n\t\tif (this.el === void 0) {\n\t\t\tthrow new Error(\"Backbone view has no element\");\n\t\t}\n\t\t_viewsByCid[this.cid] = this;\n\t\tthis.el.cid = this.cid;\n\t\tthis.el.setAttribute(\"data-cid\", this.cid);\n\t\tif (this.model) {\n\t\t\tthis.el.setAttribute(\"data-mcid\", this.model.cid);\n\t\t}\n\n\t\treturn this;\n\t},\n\n\t/* ---------------------------\n\t/* event helpers\n\t/* --------------------------- */\n\n\taddListeners: function(target, events, handler, useCapture) {\n\t\tif (!_.isObject(useCapture)) useCapture = !!useCapture;\n\t\tif (typeof events === \"string\") { events = events.split(\" \"); }\n\t\tfor (var i = 0; i < events.length; i++) {\n\t\t\ttarget.addEventListener(events[i], handler, useCapture);\n\t\t}\n\t\treturn this;\n\t},\n\n\tremoveListeners: function(target, events, handler, useCapture) {\n\t\tif (!_.isObject(useCapture)) useCapture = !!useCapture;\n\t\tif (typeof events === \"string\") { events = events.split(\" \"); }\n\t\tfor (var i = 0; i < events.length; i++) {\n\t\t\ttarget.removeEventListener(events[i], handler, useCapture);\n\t\t}\n\t\treturn this;\n\t},\n\n\tlistenToElement: function(target, events, handler) {\n\t\ttarget = Backbone.$(target);\n\t\tif (typeof events === \"string\") { events = events.split(\" \"); }\n\t\tfor (var i = 0; i < events.length; i++) {\n\t\t\tthis.listenTo(target, events[i], handler);\n\t\t}\n\t},\n\tstopListeningToElement: function(target, events, handler) {\n\t\ttarget = Backbone.$(target);\n\t\tif (typeof events === \"string\") { events = events.split(\" \"); }\n\t\tfor (var i = 0; i < events.length; i++) {\n\t\t\tthis.stopListening(target, events[i], handler);\n\t\t}\n\t},\n\n\t// listenToElementOnce: function(target, event, handler, useCapture) {\n\t// \tthis.listenToOnce(this.$(target), event, handler);\n\t// },\n\t// stopListenToElement: function(target, event, handler, useCapture) {\n\t// \tthis.stopListening(Backbone.$(target), event, handler);\n\t// },\n\n\tlistenToElementOnce: function(target, event, handler, useCapture) {\n\t\tif (!_.isObject(useCapture)) useCapture = !!useCapture;\n\t\tvar cleanup, wrapper, ctx;\n\t\tctx = this;\n\t\tcleanup = function() {\n\t\t\tctx.off(\"view:remove\", cleanup);\n\t\t\ttarget.removeEventListener(event, wrapper, useCapture);\n\t\t};\n\t\twrapper = function(ev) {\n\t\t\tcleanup();\n\t\t\thandler.call(ctx, ev);\n\t\t};\n\t\tctx.on(\"view:remove\", cleanup);\n\t\ttarget.addEventListener(event, wrapper, useCapture);\n\t\treturn this;\n\t},\n\n\t/* -------------------------------\n\t/* requestAnimationFrame\n\t/* ------------------------------- */\n\n\trequestAnimationFrame: function(callback, priority, ctx) {\n\t\treturn renderQueue.request(callback.bind(ctx || this), priority);\n\t},\n\n\tcancelAnimationFrame: function(id) {\n\t\treturn renderQueue.cancel(id);\n\t},\n\n\tsetImmediate: function(callback, priority, ctx) {\n\t\treturn modelQueue.request(callback.bind(ctx || this), priority);\n\t},\n\n\tclearImmediate: function(id) {\n\t\treturn modelQueue.cancel(id);\n\t\t// return window.clearImmediate(id);\n\t},\n\n\t/* -------------------------------\n\t/* deferred render: private methods\n\t/* ------------------------------- */\n\n\t_traceRenderStatus: function() {\n\t\treturn [\n\t\t\t(this._renderQueueId != -1 ? \"async id:\" + this._renderQueueId : \"sync\"),\n\t\t\tView.flagsToString(this._renderFlags),\n\t\t\t(this.attached ? \"attached\" : \"detached\"),\n\t\t\t(this.skipTransitions ? \"skip\" : \"run\") + \"-tx\"\n\t\t].join(\", \");\n\t},\n\n\t/** @private */\n\t_applyRender: function(tstamp) {\n\t\tif (DEBUG) {\n\t\t\tif (this._logFlags[\"view.render\"]) {\n\t\t\t\tconsole.log(\"%s::_applyRender [%s]\",\n\t\t\t\t\tthis.cid, this._traceRenderStatus(),\n\t\t\t\t\tthis._logFlags[\"view.trace\"] ?\n\t\t\t\t\tthis._logRenderCallers.join(\"\\n\") : \"\");\n\t\t\t}\n\t\t\tthis._logRenderCallers.length = 0;\n\t\t}\n\n\t\tvar flags = this._renderFlags;\n\t\tthis.trigger(\"view:render:before\", this, flags);\n\t\tthis._renderFlags = 0;\n\t\tthis._renderQueueId = -1;\n\t\tthis._renderFlags |= this.renderFrame(tstamp, flags);\n\t\tthis.trigger(\"view:render:after\", this, flags);\n\n\t\tif (this._renderFlags != 0) {\n\t\t\tconsole.warn(\"%s::_applyRender [returned] phase: %s flags: %s (%s)\", this.cid, this._viewPhase, View.flagsToString(this._renderFlags), this._renderFlags);\n\t\t}\n\t},\n\n\t_cancelRender: function() {\n\t\tif (this._renderQueueId != -1) {\n\t\t\tvar cancelId, cancelFn;\n\n\t\t\tcancelId = this._renderQueueId;\n\t\t\tthis._renderQueueId = -1;\n\t\t\tcancelFn = renderQueue.cancel(cancelId);\n\n\t\t\tif (cancelFn === void 0) {\n\t\t\t\tconsole.warn(\"%s::_cancelRender [id:%i] not found\", this.cid, cancelId);\n\t\t\t} else if (cancelFn === null) {\n\t\t\t\tconsole.warn(\"%s::_cancelRender [id:%i] already cancelled\", this.cid, cancelId);\n\t\t\t\t// } else {\n\t\t\t\t// \tif (this._logFlags[\"view.render\"] && !renderQueue.running)\n\t\t\t\t// \t\tconsole.log(\"%s::_cancelRender ID:%i cancelled\", this.cid, cancelId);\n\t\t\t}\n\t\t}\n\t},\n\n\t_requestRender: function() {\n\t\tif (renderQueue.running) {\n\t\t\tthis._cancelRender();\n\t\t\t// if (DEBUG) {\n\t\t\t// \tif (this._logFlags[\"view.render\"]) {\n\t\t\t// \t\tconsole.info(\"%s::_requestRender rescheduled [%s (%s)]\", this.cid, View.flagsToString(this._renderFlags), this._renderFlags);\n\t\t\t// \t}\n\t\t\t// }\n\t\t}\n\t\tif (this._renderQueueId == -1) {\n\t\t\tthis._renderQueueId = renderQueue.request(this._applyRender, isNaN(this.viewDepth) ? Number.MAX_VALUE : this.viewDepth);\n\t\t}\n\t\tif (DEBUG) {\n\t\t\tif (this._logFlags[\"view.trace\"]) {\n\t\t\t\t// if (this._logFlags[\"view.trace\"]) {\n\t\t\t\t// \tconsole.groupCollapsed(this.cid + \"::_requestRender [\" + this._traceRenderStatus() + \"] trace\");\n\t\t\t\t// \tconsole.trace();\n\t\t\t\t// \tconsole.groupEnd();\n\t\t\t\t// } else {\n\t\t\t\tconsole.log(\"%s::_requestRender %s [%s]\", this.cid,\n\t\t\t\t\t(renderQueue.running ? \"rescheduled \" : \"\"),\n\t\t\t\t\tthis._traceRenderStatus()\n\t\t\t\t);\n\t\t\t\t// }\n\t\t\t}\n\t\t}\n\t},\n\n\t/* -------------------------------\n\t/* render: public / abstract methods\n\t/* ------------------------------- */\n\n\tinvalidate: function(flags) {\n\t\tif (flags !== void 0) {\n\t\t\t/*if (DEBUG) {\n\t\t\t\tif (this._logFlags[\"view.render\"]) {\n\t\t\t\t\tif (this._renderFlags > 0) {\n\t\t\t\t\t\tconsole.log(\"%s::invalidate [%s (%s)] + [%s (%s)]\", this.cid, View.flagsToString(this._renderFlags), this._renderFlags, View.flagsToString(flags), flags);\n\t\t\t\t\t} else {\n\t\t\t\t\t\tconsole.log(\"%s::invalidate [%s (%s)]\", this.cid, View.flagsToString(flags), flags);\n\t\t\t\t\t}\n\t\t\t\t}\n\t\t\t}*/\n\t\t\tthis._renderFlags |= flags;\n\t\t}\n\t\treturn this;\n\t},\n\n\trequestRender: function(flags) {\n\t\t// if (DEBUG) {\n\t\t// \tif (this._logFlags[\"view.trace\"]) {\n\t\t// \t\tvar fnPath = [];\n\t\t// \t\tvar fn = arguments.callee.caller;\n\t\t// \t\twhile (fn) {\n\t\t// \t\t\tif (fnPath.length > 5) break;\n\t\t// \t\t\tfnPath.push(fn.name);\n\t\t// \t\t\tfn = fn.caller;\n\t\t// \t\t}\n\t\t// \t\t// this._logRenderCallers.push(fnPath.join(\"\\n\\t->\"));\n\t\t// \t\tthis._logRenderCallers.push(fnPath.join(\" -> \"));\n\t\t// \t}\n\t\t// }\n\t\t// if (flags !== void 0) {\n\t\t// \tthis._renderFlags |= flags;\n\t\t// }\n\t\tthis.invalidate(flags);\n\t\tthis._requestRender();\n\t\treturn this;\n\t},\n\n\t/** @abstract */\n\trenderFrame: function(tstamp, flags) {\n\t\t// subclasses should override this method\n\t\treturn View.NONE_INVALID;\n\t},\n\n\trenderNow: function(alwaysRun) {\n\t\tif (this._renderQueueId != -1) {\n\t\t\tthis._cancelRender();\n\t\t\talwaysRun = true;\n\t\t}\n\t\t// if (alwaysRun === true) {\n\t\tif (alwaysRun) {\n\t\t\tthis._applyRender(_now());\n\t\t}\n\t\treturn this;\n\t},\n\n\twhenRendered: function() {\n\t\treturn View.whenViewIsRendered(this);\n\t},\n\n\t/* -------------------------------\n\t/* render bitwise flags\n\t/* - check: this._renderFlags & flags\n\t/* - add: this._renderFlags |= flags\n\t/* - remove: this._renderFlags &= ~flags\n\t/* ------------------------------- */\n\n\t/* helpers ------------------ */\n\n\trequestChildrenRender: function(flags, now, force) {\n\t\tvar ccid, view;\n\t\tfor (ccid in this.childViews) {\n\t\t\tview = this.childViews[ccid];\n\t\t\tview.skipTransitions = view.skipTransitions || this.skipTransitions;\n\t\t\tview.requestRender(flags);\n\t\t\tif (now) {\n\t\t\t\tview.renderNow(force);\n\t\t\t}\n\t\t}\n\t\treturn this;\n\t},\n\n\trender: function() {\n\t\treturn this.renderNow(true);\n\t},\n\n\t/* -------------------------------\n\t/* common abstract\n\t/* ------------------------------- */\n\n\t/**\n\t/* @param {Boolean}\n\t/*/\n\tsetEnabled: function(enable) {\n\t\tif (this._enabled == enable) return;\n\t\tthis._enabled = !!(enable);\n\t\tif (this._enabled) {\n\t\t\tthis.delegateEvents();\n\t\t} else {\n\t\t\tthis.undelegateEvents();\n\t\t}\n\t},\n};\n//, View);\n\nif (DEBUG) {\n\tViewProto._logFlags = [\n\t\t\"view.render\",\n\t\t// \"view.trace\"\n\t].join(\" \");\n\n\tViewProto.constructor = (function(fn) {\n\t\treturn function() {\n\t\t\tvar retval;\n\t\t\tthis._logRenderCallers = [];\n\t\t\tthis._logFlags = this._logFlags.split(\" \").reduce(function(r, o) {\n\t\t\t\tr[o] = true;\n\t\t\t\treturn r;\n\t\t\t}, {});\n\t\t\tretval = fn.apply(this, arguments);\n\t\t\t// console.log(\"------ %s %o\", this.cid, this._logFlags);\n\t\t\treturn retval;\n\t\t};\n\t})(ViewProto.constructor);\n}\n\nmodule.exports = Backbone.View.extend(ViewProto, View);\n",
    "function ViewError(view, err) {\n\tthis.view = view;\n\tthis.err = err;\n\tthis.message = err.message;\n}\nViewError.prototype = Object.create(Error.prototype);\nViewError.prototype.constructor = ViewError;\nViewError.prototype.name = \"ViewError\";\n\nmodule.exports = ViewError;\n",
    "// hbsfy compiled Handlebars template\nvar HandlebarsCompiler = require('hbsfy/runtime');\nmodule.exports = HandlebarsCompiler.template({\"compiler\":[7,\">= 4.0.0\"],\"main\":function(container,depth0,helpers,partials,data) {\n    var stack1, helper, alias1=depth0 != null ? depth0 : (container.nullContext || {}), alias2=helpers.helperMissing, alias3=container.escapeExpression, alias4=\"function\";\n\n  return \"<a href=\\\"\"\n    + alias3((helpers.global || (depth0 && depth0.global) || alias2).call(alias1,\"APP_ROOT\",{\"name\":\"global\",\"hash\":{},\"data\":data}))\n    + \"#\"\n    + alias3(((helper = (helper = helpers.handle || (depth0 != null ? depth0.handle : depth0)) != null ? helper : alias2),(typeof helper === alias4 ? helper.call(alias1,{\"name\":\"handle\",\"hash\":{},\"data\":data}) : helper)))\n    + \"\\\"><span class=\\\"label\\\">\"\n    + ((stack1 = ((helper = (helper = helpers.name || (depth0 != null ? depth0.name : depth0)) != null ? helper : alias2),(typeof helper === alias4 ? helper.call(alias1,{\"name\":\"name\",\"hash\":{},\"data\":data}) : helper))) != null ? stack1 : \"\")\n    + \"</span></a>\\n\";\n},\"useData\":true});\n",
    "/**\n/* @module app/view/component/ArticleView\n/*/\n\n/** @type {module:app/view/base/View} */\nconst View = require(\"app/view/base/View\");\n/** @type {Function} */\nconst viewTemplate = require(\"./ArticleButton.hbs\");\n\n/**\n/* @constructor\n/* @type {module:app/view/component/ArticleButton}\n/*/\nvar ArticleButton = View.extend({\n\n\t/** @type {string} */\n\tcidPrefix: \"articleButton\",\n\t/** @override */\n\ttagName: \"h2\",\n\t/** @override */\n\tclassName: \"article-button\",\n\t/** @type {Function} */\n\ttemplate: viewTemplate,\n\n\tevents: {\n\t\t\"click a\": function(domev) {\n\t\t\tdomev.defaultPrevented || domev.preventDefault();\n\t\t\tthis.trigger(\"view:click\", this.model);\n\t\t}\n\t},\n\n\t// /** @override */\n\t// initialize: function(options) {},\n\n\t/* --------------------------- *\n\t/* Render\n\t/* --------------------------- */\n\n\trenderFrame: function(tstamp, flags) {\n\t\tthis.el.innerHTML = this.template(this.model.toJSON());\n\t},\n});\nmodule.exports = ArticleButton;\n",
    "/**\n/* @module app/view/component/ArticleView\n/*/\n\n/** @type {module:app/view/base/View} */\nconst View = require(\"app/view/base/View\");\n\n// /** @type {module:utils/net/toAbsoluteURL} */\n// var toAbsoluteURL = require(\"utils/net/toAbsoluteURL\");\n//\n// /** @type {string} */\n// var ABS_APP_ROOT = toAbsoluteURL(require(\"app/control/Globals\").APP_ROOT);\n\nconst RECAPTCHA_KEYS = {\n\t'canillas.name': '6LcaPHwUAAAAAAfzEnqRchIx8jY1YkUEpuswJDHx'\n};\nconst RECAPTCHA_URL = (key) => `https://www.google.com/recaptcha/api.js?render=${RECAPTCHA_KEYS[key]}`;\n\n/**\n/* @constructor\n/* @type {module:app/view/component/ArticleView}\n/*/\nvar ArticleView = View.extend({\n\n\t/** @type {string} */\n\tcidPrefix: \"articleView\",\n\t/** @override */\n\ttagName: \"article\",\n\t/** @override */\n\tclassName: \"article-view mdown\",\n\n\t/** @override */\n\tinitialize: function(options) {},\n\n\t/* --------------------------- *\n\t/* Render\n\t/* --------------------------- */\n\n\trenderFrame: function(tstamp, flags) {\n\t\tthis.el.innerHTML = this.model.get(\"text\");\n\n\t\t// let linkEls = this.el.querySelectorAll(\"a[href]\");\n\t\t// if (linkEls.length) {\n\t\t// \tRECAPTCHA_URL('canillas.name');\n\t\t// }\n\t\t// linkEls.forEach(el => {\n\t\t// });\n\n\t\t// FIXME: now done in xslt\n\t\t// this.el.querySelectorAll(\"a[href]\").forEach(function(el) {\n\t\t// \tvar url = toAbsoluteURL(el.getAttribute(\"href\"));\n\t\t// \tif (url.indexOf(ABS_APP_ROOT) !== 0) {\n\t\t// \t\tel.setAttribute(\"target\", \"_blank\");\n\t\t// \t}\n\t\t// });\n\t},\n});\nmodule.exports = ArticleView;\n",
    "/**\n * @module app/view/component/progress/CanvasProgressMeter\n */\n\n/** @type {module:app/view/base/CanvasView} */\nconst CanvasView = require(\"app/view/base/CanvasView\");\n\nvar PI2 = Math.PI * 2;\n/* NOTE: avoid negative rotations */\nvar BASE_ROTATION = 1 - 0.25; // of PI2 (-90 degrees)\nvar GAP_ARC = PI2 / 48;\n\n/** @type {module:utils/ease/fn/easeInQuad} */\nconst easeIn = require(\"utils/ease/fn/easeInQuad\");\n/** @type {module:utils/ease/fn/easeOutQuad} */\nconst easeOut = require(\"utils/ease/fn/easeOutQuad\");\n\nvar LOOP_OFFSET = 1.833333;\nvar STEP_MS = 400; // tween time base\n\nvar ARC_DEFAULTS = {\n\t\"amount\": {\n\t\tlineWidth: 0.75,\n\t\tradiusOffset: 0\n\t},\n\t\"available\": {\n\t\tlineWidth: 0.75,\n\t\t// lineDash: [1.3, 0.7],\n\t\tinverse: \"not-available\"\n\t},\n\t\"not-available\": {\n\t\tlineWidth: 0.8,\n\t\tlineDash: [0.3, 0.7],\n\t\tlineDashOffset: 0\n\t},\n\t\"indeterminate\": {\n\t\tlineWidth: 2.0, //0.8,\n\t\tlineDash: [0.3, 1.7],\n\t\t// lineDash: [0.6, 1.4],\n\t\tlineDashOffset: 0\n\t},\n};\n\n/**\n * @constructor\n * @type {module:app/view/component/progress/CanvasProgressMeter}\n */\nmodule.exports = CanvasView.extend({\n\n\t/** @type {string} */\n\tcidPrefix: \"canvasProgressMeter\",\n\t/** @type {string} */\n\tclassName: \"progress-meter canvas-progress-meter\",\n\n\tdefaultKey: \"amount\",\n\n\tdefaults: {\n\t\tvalues: {\n\t\t\tamount: 0,\n\t\t\tavailable: 0,\n\t\t\t_loop: 0,\n\t\t\t_stalled_arc: 0,\n\t\t\t_stalled_loop: 0,\n\t\t},\n\t\tmaxValues: {\n\t\t\tamount: 1,\n\t\t\tavailable: 1,\n\t\t\t_stalled_loop: 1,\n\t\t},\n\t\tuseOpaque: true,\n\t\tlabelFn: function(value, max) {\n\t\t\treturn ((value / max) * 100) | 0;\n\t\t},\n\t},\n\n\tproperties: {\n\t\tstalled: {\n\t\t\tget: function() {\n\t\t\t\treturn false; //this._stalled;\n\t\t\t},\n\t\t\tset: function(value) {\n\t\t\t\t// this._setStalled(value)\n\t\t\t}\n\t\t}\n\t},\n\n\t_setStalled: function(value) {\n\t\tif (this._stalled !== value) {\n\t\t\tthis._stalled = value;\n\t\t\tthis.requestRender(CanvasView.MODEL_INVALID | CanvasView.LAYOUT_INVALID);\n\t\t}\n\t},\n\n\t/* --------------------------- *\n\t/* children/layout\n\t/* --------------------------- */\n\n\t/** @override */\n\tinitialize: function(options) {\n\t\t// TODO: cleanup options mess in CanvasView\n\t\tCanvasView.prototype.initialize.apply(this, arguments);\n\t\t// options = _.defaults(options, this.defaults);\n\n\t\tthis._labelFn = options.labelFn;\n\t\tthis._stalled = !!(options.stalled);\n\t\tthis._valueStyles = {};\n\t\tthis._canvasSize = null;\n\t\tthis._canvasOrigin = null;\n\t},\n\n\t_needsLoop: false,\n\n\t/** @override */\n\tvalueTo: function(key, value, duration) {\n\t\tif (key === \"amount\" && value < this.interpolator.getCurrentValue(\"amount\")) {\n\t\t\tthis._needsLoop = true;\n\t\t}\n\t\tCanvasView.prototype.valueTo.apply(this, arguments);\n\t},\n\n\t/* --------------------------- *\n\t/* private\n\t/* --------------------------- */\n\n\t/** @override */\n\tmeasureCanvas: function(w, h, s) {\n\t\t// make canvas square\n\t\tthis._canvasHeight = this._canvasWidth = Math.min(w, h);\n\t},\n\n\t/** @override */\n\tupdateCanvas: function() {\n\t\t// CanvasView.prototype._updateCanvas.apply(this, arguments);\n\n\t\t// size, lines, gaps, dashes (this._valueStyles, GAP_ARC, this._arcRadius)\n\t\t// --------------------------------\n\t\t// var arcName, s, arcDefault;\n\t\t// var mapLineDash = function(n) {\n\t\t// \treturn n * this.radius * GAP_ARC;\n\t\t// };\n\t\t// var sumFn = function(s, n) {\n\t\t// \treturn s + n;\n\t\t// };\n\n\t\t// this._canvasSize = Math.min(this._canvasWidth, this._canvasHeight);\n\n\t\tvar s;\n\t\t// this._maxDashArc = 0\n\t\tfor (var styleName in ARC_DEFAULTS) {\n\t\t\ts = _.defaults({}, ARC_DEFAULTS[styleName]);\n\t\t\ts.lineWidth *= this._canvasRatio;\n\t\t\ts.radius = (this._canvasWidth - s.lineWidth) / 2;\n\t\t\tif (s.radiusOffset) {\n\t\t\t\ts.radius += s.radiusOffset * this._canvasRatio;\n\t\t\t}\n\t\t\tif (_.isArray(s.lineDash)) {\n\t\t\t\ts.lineDash = s.lineDash.map(function(val, i, arr) {\n\t\t\t\t\treturn val * this.radius * GAP_ARC;\n\t\t\t\t}, s);\n\t\t\t\ts.lineDashLength = s.lineDash.reduce(function(res, val, i, arr) {\n\t\t\t\t\treturn res + val;\n\t\t\t\t}, 0);\n\t\t\t\ts.lineDashArc = s.lineDash[0] * GAP_ARC;\n\t\t\t\t// this._maxDashArc = Math.max(this._maxDashArc, s.lineDashArc);\n\t\t\t} else {\n\t\t\t\ts.lineDashArc = 0;\n\t\t\t}\n\t\t\tthis._valueStyles[styleName] = s;\n\t\t}\n\n\t\t// baselineShift\n\t\t// --------------------------------\n\t\t// NOTE: Center baseline: use ascent data to center to x-height, or sort-of.\n\t\t// with ascent/descent values (0.7, -0.3), x-height is 0.4\n\t\tvar mObj = this._getFontMetrics(this._fontFamily);\n\t\tthis._baselineShift = mObj ? (mObj.ascent + mObj.descent) / mObj.unitsPerEm : 0.7; // default value\n\t\tthis._baselineShift *= this._fontSize * 0.5; // apply to font-size, halve it\n\t\tthis._baselineShift = Math.round(this._baselineShift);\n\n\t\t// save canvas context\n\t\t// --------------------------------\n\t\t// reset matrix and translate 0,0 to center\n\t\tthis._ctx.restore();\n\t\tthis._ctx.setTransform(1, 0, 0, 1, this._canvasWidth / 2, this._canvasHeight / 2);\n\t\tthis._ctx.save();\n\t},\n\n\t/** @override */\n\tredraw: function(ctx, intrp, flags) {\n\t\tthis._clearCanvas(-this._canvasWidth / 2, -this._canvasHeight / 2,\n\t\t\tthis._canvasWidth, this._canvasHeight\n\t\t);\n\n\t\tvar s, // reused style objects\n\t\t\tvalData, // reused for interpolated data\n\t\t\tarcVal; // reused arc values\n\n\t\t// amount label\n\t\t// --------------------------------\n\t\tvalData = intrp._valueData[\"amount\"];\n\t\tthis.drawLabel(this._labelFn(valData._renderedValue, valData._maxVal));\n\n\t\t// indeterminate\n\t\t// --------------------------------\n\n\t\t/*\n\t\tvar indVal;\n\t\tif (this.stalled) {\n\t\t\t// _ind loop indefinitely while indeterminate: restart if at end\n\t\t\tif (intrp.isAtTarget(\"_ind\")) {\n\t\t\t\t// if (intrp.renderedKeys && (intrp.renderedKeys.indexOf(\"_ind\") === -1)) {\n\t\t\t\tintrp.valueTo(\"_ind\", 0, 0);\n\t\t\t\tintrp.valueTo(\"_ind\", 1, 1000);\n\t\t\t\tintrp.updateValue(\"_ind\");\n\t\t\t}\n\t\t\tindVal = intrp.getCurrentValue(\"_ind\");\n\t\t\t//indVal = intrp._valueData[\"_ind\"]._renderedValue || 0;\n\n\t\t\t// draw spinning arc\n\t\t\t// --------------------------------\n\t\t\t// s = this._valueStyles[\"amount\"];\n\t\t\t// ctx.save();\n\t\t\t// ctx.rotate(PI2 * (BASE_ROTATION + (indVal))); // + GAP_ARC);\n\t\t\t// lastEndArc = this.drawArc(1,\n\t\t\t// \tGAP_ARC,\n\t\t\t// \tPI2 - GAP_ARC,\n\t\t\t// \t0, s);\n\t\t\t// ctx.restore();\n\t\t\t// return;\n\n\t\t\t// lineDashOffset animation\n\t\t\t// --------------------------------\n\t\t\ts = this._valueStyles[\"indeterminate\"];\n\t\t\ts.lineDashOffset = s.lineDashLength * ((1 - indVal) % 3) * 3;\n\t\t\tthis._valueStyles[\"available\"].inverse = \"indeterminate\";\n\n\t\t\t// console.log(\"%s::redraw indVal:%o s.lineDashOffset:%o s.lineDash:%o\", this.cid, indVal, s.lineDashOffset, s.lineDash[0]);\n\n\t\t\t// draw spinning wheel\n\t\t\t// --------------------------------\n\t\t\t// ctx.save();\n\t\t\t// ctx.rotate((PI2 / WHEEL_NUM) * indVal); // + GAP_ARC);\n\t\t\t// this.drawWheel(this._valueStyles[\"amount\"], 2 / 5, 3 / 5);\n\t\t\t// ctx.restore();\n\n\t\t} else {\n\t\t\tif (!intrp.isAtTarget(\"_ind\")) {\n\t\t\t\t// if (intrp.renderedKeys && (intrp.renderedKeys.indexOf(\"_ind\") !== -1)) {\n\t\t\t\tintrp.valueTo(\"_ind\", 0, 0);\n\t\t\t\tintrp.updateValue(\"_ind\");\n\t\t\t}\n\t\t\t// lineDashOffset animation\n\t\t\t// --------------------------------\n\t\t\tthis._valueStyles[\"available\"].inverse = \"not-available\";\n\t\t}*/\n\n\t\t// save ctx before drawing arcs\n\t\tctx.save();\n\n\t\t// loop (amount)\n\t\t// --------------------------------\n\t\tvar loopVal;\n\t\t/*\n\t\tNOTE: If value \"amount\" has changed (with valueTo()) but no yet\n\t\tinterpolated, and its last rendered value is less, then its been reset\n\t\t(a reload, a loop, etc): we trigger a 'loop' of the whole arc.\n\t\t*/\n\t\t// if ((intrp.renderedKeys.indexOf(\"amount\") !== -1) && (valData._lastRenderedValue > valData._renderedValue)) {\n\t\tif (this._needsLoop) {\n\t\t\tthis._needsLoop = false;\n\t\t\t// trigger loop\n\t\t\tintrp.valueTo(\"_loop\", 1, 0);\n\t\t\tintrp.valueTo(\"_loop\", 0, 750);\n\t\t\tintrp.updateValue(\"_loop\");\n\t\t}\n\t\t// loopVal = intrp._valueData[\"_loop\"]._renderedValue || 0;\n\t\tloopVal = intrp.getCurrentValue(\"_loop\");\n\t\tctx.rotate((PI2 * (BASE_ROTATION + (1 - loopVal)))); // + GAP_ARC);\n\n\t\t// amount arc\n\t\t// --------------------------------\n\t\t// var amountGapArc = GAP_ARC;\n\t\tvar lastEndArc = 0;\n\n\t\ts = this._valueStyles[\"amount\"];\n\t\tarcVal = loopVal + valData._renderedValue / valData._maxVal;\n\n\t\tif (arcVal > 0) {\n\t\t\tlastEndArc = this.drawArc(arcVal,\n\t\t\t\tGAP_ARC,\n\t\t\t\tPI2 - GAP_ARC,\n\t\t\t\tlastEndArc, s);\n\t\t\tthis.drawEndCap(lastEndArc, s);\n\t\t\tlastEndArc = lastEndArc + GAP_ARC * 2;\n\t\t}\n\n\t\t// available arc\n\t\t// --------------------------------\n\t\ts = this._valueStyles[\"available\"];\n\t\tvalData = intrp._valueData[\"available\"];\n\n\t\tvar stepsNum = valData.length || 1;\n\t\tvar stepBaseArc = PI2 / stepsNum;\n\t\tvar stepAdjustArc = stepBaseArc % GAP_ARC;\n\t\tvar stepGapArc = GAP_ARC + (stepAdjustArc - s.lineDashArc) / 2;\n\n\t\tif (Array.isArray(valData)) {\n\t\t\tfor (var i = 0; i < stepsNum; i++) {\n\t\t\t\tarcVal = valData[i]._renderedValue / (valData[i]._maxVal / stepsNum);\n\t\t\t\tthis.drawArc(arcVal,\n\t\t\t\t\t(i * stepBaseArc) + stepGapArc,\n\t\t\t\t\t((i + 1) * stepBaseArc) - stepGapArc,\n\t\t\t\t\tlastEndArc, s);\n\t\t\t}\n\t\t} else {\n\t\t\tarcVal = valData._renderedValue / valData._maxVal;\n\t\t\tthis.drawArc(arcVal,\n\t\t\t\tstepGapArc,\n\t\t\t\tPI2 - stepGapArc,\n\t\t\t\tlastEndArc, s);\n\t\t}\n\t\t// restore ctx after drawing arcs\n\t\t// keep rotation transform\n\t\t//ctx.restore();\n\n\t\tif (this._stalled) {\n\t\t\tif (intrp.getTargetValue('_stalled_arc') === 0) {\n\t\t\t\tintrp.valueTo('_stalled_arc', 1, 1 * STEP_MS, easeIn).updateValue('_stalled_arc');\n\t\t\t}\n\t\t} else {\n\t\t\tif (intrp.getTargetValue('_stalled_arc') === 1) {\n\t\t\t\tintrp.valueTo('_stalled_arc', 0, 1 * STEP_MS, easeOut).updateValue('_stalled_arc');\n\t\t\t}\n\t\t}\n\t\tvar a = intrp.getRenderedValue(\"_stalled_arc\");\n\t\t// while arc is > 0, loop indefinitely while spinning and restart\n\t\t// if at end. Otherwise let interp exhaust arc duration\n\t\tif (a > 0) {\n\t\t\tif (!intrp.paused && intrp.isAtTarget('_stalled_loop')) {\n\t\t\t\tintrp\n\t\t\t\t\t.valueTo('_stalled_loop', 0, 0)\n\t\t\t\t\t.valueTo('_stalled_loop', 1, 2 * STEP_MS)\n\t\t\t\t\t.updateValue('_stalled_loop');\n\t\t\t}\n\t\t}\n\t\tvar l = intrp.getRenderedValue(\"_stalled_loop\");\n\t\t// always render while arc is > 0\n\t\tif (a > 0) {\n\t\t\t// arc span bounce\n\t\t\tvar b = (l < 0.5 ? (l % 0.5) : 0.5 - (l % 0.5)) * 2;\n\t\t\t// bounce + main arc span\n\t\t\tvar aa = (a * b * 0.25) + (a * 0.125) + .0001;\n\t\t\t// rotation loop\n\t\t\tvar ll = l + LOOP_OFFSET;\n\n\t\t\tctx.save();\n\t\t\tctx.lineWidth = 10 * this._canvasRatio;\n\t\t\tctx.globalAlpha = 1;\n\t\t\tctx.globalCompositeOperation = \"destination-out\";\n\t\t\tctx.strokeColor = 'red';\n\t\t\tctx.beginPath();\n\t\t\tctx.arc(0, 0, (this._canvasWidth) / 2, ((1 - aa) + ll) * PI2, (aa + ll) * PI2, false);\n\t\t\tctx.stroke();\n\t\t\tctx.restore();\n\t\t}\n\t\tctx.restore();\n\t},\n\n\tdrawArc: function(value, startArc, endArc, prevArc, style) {\n\t\tvar valArc,\n\t\t\tvalStartArc,\n\t\t\tvalEndArc,\n\t\t\tinvStyle,\n\t\t\tinvStartArc,\n\t\t\tinvEndArc;\n\n\t\tprevArc || (prevArc = 0);\n\n\t\tvalArc = endArc - startArc;\n\t\tvalEndArc = startArc + (valArc * value);\n\t\tvalStartArc = Math.max(startArc, prevArc);\n\t\tif (valEndArc > valStartArc) {\n\t\t\tthis._ctx.save();\n\t\t\tthis.applyValueStyle(style);\n\t\t\tthis._ctx.beginPath();\n\t\t\tthis._ctx.arc(0, 0, style.radius, valEndArc, valStartArc, true);\n\t\t\tthis._ctx.stroke();\n\t\t\tthis._ctx.restore();\n\t\t}\n\n\t\t// if there's valueStyle, draw rest of span, minus prevArc overlap too\n\t\tif (style.inverse !== void 0) {\n\t\t\tinvStyle = this._valueStyles[style.inverse];\n\n\t\t\tinvEndArc = valEndArc + (valArc * (1 - value));\n\t\t\tinvStartArc = Math.max(valEndArc, prevArc);\n\t\t\tif (invEndArc > invStartArc) {\n\t\t\t\tthis._ctx.save();\n\t\t\t\tthis.applyValueStyle(invStyle);\n\t\t\t\tthis._ctx.beginPath();\n\t\t\t\tthis._ctx.arc(0, 0, invStyle.radius, invEndArc, invStartArc, true);\n\t\t\t\tthis._ctx.stroke();\n\t\t\t\tthis._ctx.restore();\n\t\t\t}\n\t\t}\n\n\t\treturn valEndArc;\n\t},\n\n\tapplyValueStyle: function(s) {\n\t\tthis._ctx.lineWidth = s.lineWidth;\n\t\tif (_.isArray(s.lineDash)) {\n\t\t\tthis._ctx.setLineDash(s.lineDash);\n\t\t}\n\t\tif (_.isNumber(s.lineDashOffset)) {\n\t\t\tthis._ctx.lineDashOffset = s.lineDashOffset;\n\t\t}\n\t},\n\n\n\tdrawNotch: function(arcPos, length, s) {\n\t\tvar ex, ey, ec1, ec2;\n\n\t\tex = Math.cos(arcPos);\n\t\tey = Math.sin(arcPos);\n\t\tec1 = s.radius;\n\t\tec2 = s.radius - length;\n\n\t\tthis._ctx.save();\n\t\tthis.applyValueStyle(s);\n\t\tthis._ctx.lineCap = \"square\";\n\t\tthis._ctx.beginPath();\n\t\tthis._ctx.moveTo(ec1 * ex, ec1 * ey);\n\t\tthis._ctx.lineTo(ec2 * ex, ec2 * ey);\n\t\tthis._ctx.stroke();\n\t\tthis._ctx.restore();\n\t},\n\n\tdrawEndCap: function(arcPos, s) {\n\t\tvar radius = s.radius;\n\t\tthis._ctx.save();\n\t\tthis._ctx.lineWidth = s.lineWidth;\n\n\t\tthis._ctx.rotate(arcPos - GAP_ARC * 2); // 1.5);\n\t\tthis._ctx.beginPath();\n\t\tthis._ctx.arc(0, 0, radius, GAP_ARC * 0.5, GAP_ARC * 2, false);\n\t\tthis._ctx.lineTo(radius - (GAP_ARC * radius), 0);\n\t\tthis._ctx.closePath();\n\n\t\tthis._ctx.fill();\n\t\tthis._ctx.stroke();\n\t\tthis._ctx.restore();\n\t},\n\n\tdrawLabel: function(s) {\n\t\tif (this._labelText !== s) {\n\t\t\tthis._labelText = s;\n\t\t\tthis._labelWidth = this._ctx.measureText(s).width;\n\t\t}\n\t\tthis._ctx.fillText(s, this._labelWidth * -0.5, this._baselineShift, this._labelWidth);\n\t},\n});\n\nif (DEBUG) {\n\tmodule.exports.prototype._logFlags = \"\";\n}\n",
    "/**\n * @module app/view/component/Carousel\n */\n\n/** @type {module:backbone.babysitter} */\nconst Container = require(\"backbone.babysitter\");\n\n/** @type {module:hammerjs} */\nconst Hammer = require(\"hammerjs\");\n/** @type {module:utils/touch/SmoothPanRecognizer} */\nconst Pan = require(\"utils/touch/SmoothPanRecognizer\");\n/** @type {module:hammerjs.Tap} */\nvar Tap = Hammer.Tap;\n\n/** @type {module:app/control/Globals} */\nconst Globals = require(\"app/control/Globals\");\n/** @type {module:app/view/base/View} */\nconst View = require(\"app/view/base/View\");\n// /** @type {module:app/view/base/DeferredView} */\n// var View = require(\"app/view/base/DeferredView\");\n\n/** @type {module:app/view/render/CarouselRenderer} */\nconst CarouselRenderer = require(\"app/view/render/CarouselRenderer\");\n\n/** @type {module:utils/prefixedProperty} */\nconst prefixedProperty = require(\"utils/prefixedProperty\");\n/** @type {module:utils/prefixedStyleName} */\nconst prefixedStyleName = require(\"utils/prefixedStyleName\");\n\nvar transformStyleName = prefixedStyleName(\"transform\");\nvar transformProperty = prefixedProperty(\"transform\");\nvar translateTemplate = Globals.TRANSLATE_TEMPLATE;\n\n// var cssToPx = function(cssVal, el) {\n// \treturn parseInt(cssVal);\n// };\n\n// var defaultRendererFunction = (function() {\n// \tvar defaultRenderer = CarouselRenderer.extend({ className: \"carousel-item default-renderer\"}),\n// \t\temptyRenderer = CarouselRenderer.extend({ className: \"carousel-item empty-renderer\"});\n// \treturn function(item, index, arr) {\n// \t\treturn (index === -1)? emptyRenderer: defaultRenderer;\n// \t};\n// })();\n\n/** @const */\nvar MAX_SELECT_THRESHOLD = 20;\n\n// /** @const */\n// var CHILDREN_INVALID = View.CHILDREN_INVALID,\n// \tSTYLES_INVALID = View.STYLES_INVALID,\n// \tMODEL_INVALID = View.MODEL_INVALID,\n// \tSIZE_INVALID = View.SIZE_INVALID,\n// \tLAYOUT_INVALID = View.LAYOUT_INVALID;\n\nvar VERTICAL = Hammer.DIRECTION_VERTICAL,\n\tHORIZONTAL = Hammer.DIRECTION_HORIZONTAL;\n\n// x: [\"x\", \"y\"],\n// y: [\"y\", \"x\"],\n// offsetLeft: [\"offsetLeft\", \"offsetTop\"],\n// offsetTop: [\"offsetTop\", \"offsetLeft\"],\n// offsetWidth: [\"offsetWidth\", \"offsetHeight\"],\n// offsetHeight: [\"offsetHeight\", \"offsetWidth\"],\n// width: [\"width\",\"height\"],\n// height: [\"height\",\"width\"],\n// marginLeft: [\"marginLeft\",\"marginTop\"],\n// marginRight: [\"marginRight\",\"marginBottom\"],\n\n/*\nvar HORIZONTAL_PROPS = {\n\tpos: \"x\",\n\tsize: \"width\",\n\toffsetPos: \"offsetLeft\",\n\toffsetSize: \"offsetWidth\",\n\tmarginBefore: \"marginLeft\",\n\tmarginAfter: \"marginRight\",\n};\nvar VERTICAL_PROPS = {\n\tpos: \"y\",\n\tsize: \"height\",\n\toffsetPos: \"offsetTop\",\n\toffsetSize: \"offsetHeight\",\n\tmarginBefore: \"marginTop\",\n\tmarginAfter: \"marginBottom\",\n};\n*/\n\n// var DIRECTION_NONE = 1;\n// var DIRECTION_LEFT = 2;\n// var DIRECTION_RIGHT = 4;\n// var DIRECTION_UP = 8;\n// var DIRECTION_DOWN = 16;\n\nvar dirToStr = function(dir) {\n\tif (dir === Hammer.DIRECTION_NONE) return 'NONE';\n\tif (dir === Hammer.DIRECTION_LEFT) return 'LEFT';\n\tif (dir === Hammer.DIRECTION_RIGHT) return 'RIGHT';\n\tif (dir === Hammer.DIRECTION_UP) return 'UP';\n\tif (dir === Hammer.DIRECTION_DOWN) return 'DOWN';\n\tif (dir === Hammer.DIRECTION_HORIZONTAL) return 'HOR'; //IZONTAL';\n\tif (dir === Hammer.DIRECTION_VERTICAL) return 'VER'; //TICAL';\n\tif (dir === Hammer.DIRECTION_ALL) return 'ALL';\n\treturn 'UNREC'; //OGNIZED';\n}\n\nvar isValidTouchManager = function(touch, direction) {\n\t// var retval;\n\ttry {\n\t\treturn touch.get(\"hpan\").options.direction == direction;\n\t} catch (err) {\n\t\treturn false;\n\t}\n\t// return retval;\n};\n\n// /** @type {int} In pixels */\n// var panThreshold: 15;\n\nvar createTouchManager = function(el, dir, thres) {\n\tvar touch = new Hammer.Manager(el);\n\tvar pan = new Pan({\n\t\tevent: \"hpan\",\n\t\tthreshold: Globals.THRESHOLD,\n\t\tdirection: Hammer.DIRECTION_HORIZONTAL,\n\t});\n\tvar tap = new Tap({\n\t\tthreshold: Globals.THRESHOLD - 1,\n\t\tinterval: 50,\n\t\ttime: 200,\n\t});\n\ttap.recognizeWith(pan);\n\ttouch.add([pan, tap]);\n\treturn touch;\n};\n\n\nvar Carousel = {\n\t/** const */\n\tANIMATED: false,\n\t/** const */\n\tIMMEDIATE: true,\n\n\t/** copy of Hammer.DIRECTION_VERTICAL */\n\tDIRECTION_VERTICAL: VERTICAL,\n\t/** copy of Hammer.DIRECTION_HORIZONTAL */\n\tDIRECTION_HORIZONTAL: HORIZONTAL,\n\t/** @type {Object} */\n\tdefaults: {\n\t\t/** @type {boolean} */\n\t\tselectOnScrollEnd: false,\n\t\t/** @type {boolean} */\n\t\trequireSelection: false,\n\t\t/** @type {int} */\n\t\tdirection: HORIZONTAL,\n\t\t/** @type {int} In pixels */\n\t\tselectThreshold: 20,\n\t\t/** @type {Function} */\n\t\trendererFunction: (function() {\n\t\t\tvar defaultRenderer = CarouselRenderer.extend({\n\t\t\t\t\tclassName: \"carousel-item default-renderer\"\n\t\t\t\t}),\n\t\t\t\temptyRenderer = CarouselRenderer.extend({\n\t\t\t\t\tclassName: \"carousel-item empty-renderer\"\n\t\t\t\t});\n\t\t\treturn function(item, index, arr) {\n\t\t\t\treturn (index === -1) ? emptyRenderer : defaultRenderer;\n\t\t\t};\n\t\t})(),\n\t},\n};\nCarousel.validOptions = _.keys(Carousel.defaults);\n\n/**\n/* @constructor\n/* @type {module:app/view/component/Carousel}\n/*/\nvar CarouselProto = {\n\n\t/** @override */\n\tcidPrefix: \"carousel\",\n\t/** @override */\n\ttagName: \"div\",\n\t/** @override */\n\tclassName: \"carousel skip-transitions\",\n\n\t/* --------------------------- *\n\t/* properties\n\t/* --------------------------- */\n\n\tproperties: {\n\t\tscrolling: {\n\t\t\tget: function() {\n\t\t\t\treturn this._scrolling;\n\t\t\t}\n\t\t},\n\t\tselectedItem: {\n\t\t\tget: function() {\n\t\t\t\treturn this._selectedView.model;\n\t\t\t},\n\t\t\tset: function(value) {\n\t\t\t\tif (value)\n\t\t\t\t\tthis._onSelectOne(value)\n\t\t\t\telse\n\t\t\t\t\tthis._onSelectNone();\n\t\t\t}\n\t\t},\n\t},\n\n\tevents: {\n\t\t// \"mousedown\": \"_onMouseDown\", \"mouseup\": \"_onMouseUp\",\n\t\t\"transitionend .carousel-item.selected\": \"_onScrollTransitionEnd\",\n\t\t\"click .carousel-item:not(.selected)\": \"_onClick\",\n\t},\n\n\t/** @override */\n\tinitialize: function(options) {\n\t\t_.bindAll(this, \"_onPointerEvent\", \"_onClick\");\n\n\t\tthis.itemViews = new Container();\n\t\tthis.metrics = {};\n\n\t\t_.extend(this, _.defaults(_.pick(options, Carousel.validOptions), Carousel.defaults));\n\n\t\t// this.childGap = 0; //this.dirProp(20, 18);\n\t\tthis._precedingDir = (Hammer.DIRECTION_LEFT | Hammer.DIRECTION_UP) & this.direction;\n\t\tthis._followingDir = (Hammer.DIRECTION_RIGHT | Hammer.DIRECTION_DOWN) & this.direction;\n\n\t\t// use supplied touch mgr or create private\n\t\tif (isValidTouchManager(options.touch, this.direction)) {\n\t\t\tthis.touch = options.touch;\n\t\t} else {\n\t\t\tconsole.warn(\"%s::initialize creating Hammer instance\", this.cid);\n\t\t\tthis.touch = createTouchManager(this.el, this.direction);\n\t\t\t// this.on(\"view:removed\", this.touch.destroy, this.touch);\n\t\t\tthis.listenTo(this, \"view:removed\", function() {\n\t\t\t\tthis.touch.destroy();\n\t\t\t});\n\t\t}\n\n\t\t/* create children and props */\n\t\tthis.setEnabled(true);\n\t\tthis.skipTransitions = true;\n\t\tthis._renderFlags = View.CHILDREN_INVALID;\n\t\t// this.invalidateChildren();\n\n\t\tthis.listenTo(this, \"view:attached\", function() {\n\t\t\tthis.skipTransitions = true;\n\t\t\t// this.invalidateSize();\n\t\t\t// this.renderNow();\n\t\t\t// this.requestRender();\n\t\t\tthis.requestRender(View.SIZE_INVALID | View.LAYOUT_INVALID);\n\t\t});\n\n\t\t/* collection listeners */\n\t\tthis.listenTo(this.collection, {\n\t\t\t\"reset\": this._onReset,\n\t\t\t\"select:one\": this._onSelectOne,\n\t\t\t\"select:none\": this._onSelectNone,\n\t\t\t\"deselect:one\": this._onDeselectAny,\n\t\t\t\"deselect:none\": this._onDeselectAny,\n\t\t});\n\t},\n\t/* --------------------------- *\n\t/* Hammer init\n\t/* --------------------------- */\n\n\t// validateTouchManager: function(touch, direction) {\n\t// \ttry {\n\t// \t\treturn touch.get(\"pan\").options.direction === direction);\n\t// \t} catch (err) {\n\t// \t\treturn false;\n\t// \t}\n\t// },\n\n\t// initializeHammer: function(options) {\n\t// \t// direction from opts/defaults\n\t// \tif (options.direction === VERTICAL) {\n\t// \t\tthis.direction = VERTICAL;\n\t// \t} // do nothing: the default is horizontal\n\t//\n\t// \t// validate hammer instance or create local\n\t// \tif ((touch = options.touch) && (pan = touch.get(\"pan\"))) {\n\t// \t\t// Override direction only if specific\n\t// \t\tif (pan.options.direction !== Hammer.DIRECTION_ALL) {\n\t// \t\t\tthis.direction = pan.options.direction;\n\t// \t\t}\n\t// \t\tthis.panThreshold = pan.options.threshold;\n\t// \t} else {\n\t// \t\tconsole.warn(\"%s::initializeHammer using private Hammer instance\", this.cid);\n\t// \t\ttouch = createHammerInstance(this.el, this.panThreshold, this.direction);\n\t// \t\tthis.on(\"view:removed\", touch.destroy, touch);\n\t// \t}\n\t// \tthis.touch = touch;\n\t// },\n\n\tremove: function() {\n\t\t// this._scrollPendingAction && this._scrollPendingAction(true);\n\t\t// if (this._enabled) {\n\t\t// \tthis.touch.off(\"tap\", this._onTap);\n\t\t// \tthis.touch.off(\"hpanstart hpanmove hpanend hpancancel\", this._onPan);\n\t\t// }\n\t\tthis._togglePointerEvents(false);\n\t\tthis.removeChildren();\n\t\tView.prototype.remove.apply(this, arguments);\n\t\treturn this;\n\t},\n\n\n\t/* --------------------------- *\n\t/* helper functions\n\t/* --------------------------- */\n\n\tdirProp: function(hProp, vProp) {\n\t\treturn (this.direction & HORIZONTAL) ? hProp : vProp;\n\t},\n\n\t/* --------------------------- *\n\t/* Render\n\t/* --------------------------- */\n\n\t// render: function() {\n\t// \tif (this.attached) {\n\t// \t\tthis.skipTransitions = true;\n\t// \t\t// this.invalidateSize();\n\t// \t\tthis.renderNow(true);\n\t// \t}\n\t// },\n\n\t// /** @override */\n\t// render: function () {\n\t// \tif (!this.attached) {\n\t// \t\tif (!this._renderPending) {\n\t// \t\t\tthis._renderPending = true;\n\t// \t\t\tthis.listenTo(this, \"view:attached\", this.render);\n\t// \t\t}\n\t// \t} else {\n\t// \t\tif (this._renderPending) {\n\t// \t\t\tthis._renderPending = false;\n\t// \t\t\tthis.stopListening(this, \"view:attached\", this.render);\n\t// \t\t}\n\t// \t\tthis._delta = 0;\n\t// \t\tthis.skipTransitions = true;\n\t// \t\tthis.invalidateSize();\n\t// \t\t// this.invalidateLayout();\n\t// \t\tthis.renderNow();\n\t// \t}\n\t// \treturn this;\n\t// },\n\n\t// render: function () {\n\t// \tthis.measureLater();\n\t// \tthis.scrollBy(0, Carousel.IMMEDIATE);\n\t//\n\t// \tif (this.el.parentElement) {\n\t// \t\tthis.renderNow();\n\t// \t}\n\t// \treturn this;\n\t// },\n\n\t/** @override */\n\trenderFrame: function(tstamp, flags) {\n\t\tif (flags & View.CHILDREN_INVALID) {\n\t\t\tthis._createChildren();\n\t\t\t// clear this flag now: render may be deferred until attached\n\t\t\tflags &= ~View.CHILDREN_INVALID;\n\t\t}\n\t\tif (this.attached) {\n\t\t\tif (flags & View.SIZE_INVALID) {\n\t\t\t\tthis._measure();\n\t\t\t}\n\t\t\tif (flags & (View.LAYOUT_INVALID | View.SIZE_INVALID)) {\n\t\t\t\tthis._scrollBy(this._delta, this.skipTransitions);\n\t\t\t}\n\t\t} else if (flags) {\n\t\t\tthis.listenToOnce(this, \"view:attached\", function() {\n\t\t\t\tthis.requestRender(flags);\n\t\t\t});\n\t\t}\n\t},\n\n\t/* --------------------------- *\n\t/* enabled\n\t/* --------------------------- */\n\n\t// /** @override */\n\t// _enabled: undefined,\n\n\t/** @override */\n\tsetEnabled: function(enabled) {\n\t\tif (this._enabled !== enabled) {\n\t\t\tthis._enabled = enabled;\n\t\t\t// toggle events immediately\n\t\t\tthis._togglePointerEvents(enabled);\n\t\t\t// dom manipulation on render (_renderEnabled)\n\t\t\t// this._renderFlags |= View.STYLES_INVALID;\n\t\t\t// this.requestRender();\n\t\t\tthis.setImmediate(this._renderEnabled);\n\t\t\t// this._renderEnabled();\n\t\t}\n\t},\n\n\t_renderEnabled: function() {\n\t\tthis.el.classList.toggle(\"disabled\", !this.enabled);\n\t\tthis.itemViews.each(function(view) {\n\t\t\tview.setEnabled(this.enabled);\n\t\t}, this);\n\t},\n\n\t/* --------------------------- *\n\t/* Create children\n\t/* --------------------------- */\n\n\t_createChildren: function() {\n\t\t// var sIndex;\n\t\tvar buffer, renderer, view, viewOpts;\n\n\t\tthis.removeChildren();\n\n\t\tif (this.collection.length) {\n\t\t\tviewOpts = {\n\t\t\t\t// viewDepth: this.viewDepth + 1,\n\t\t\t\t// parentView: this,\n\t\t\t\tenabled: this.enabled\n\t\t\t};\n\t\t\tbuffer = document.createDocumentFragment();\n\t\t\t// buffer = this.el;\n\n\t\t\tif (!this.requireSelection) {\n\t\t\t\trenderer = this.rendererFunction(null, -1, this.collection);\n\t\t\t\tview = new renderer(viewOpts);\n\t\t\t\tthis.itemViews.add(view);\n\t\t\t\tbuffer.appendChild(view.el);\n\t\t\t\tthis.emptyView = view;\n\t\t\t}\n\n\t\t\tthis.collection.each(function(item, index, arr) {\n\t\t\t\tviewOpts.model = item;\n\t\t\t\trenderer = this.rendererFunction(item, index, arr);\n\t\t\t\tview = new renderer(viewOpts);\n\t\t\t\tthis.itemViews.add(view);\n\t\t\t\tbuffer.appendChild(view.el);\n\t\t\t}, this);\n\n\t\t\t// if (!this.requireSelection) {\n\t\t\t// \tbuffer = this.appendItemView(buffer, this.model, -1, this.collection);\n\t\t\t// \tthis.emptyView = this.itemViews.first();\n\t\t\t// }\n\t\t\t// buffer = this.collection.reduce(this.appendItemView, buffer, this);\n\n\t\t\tthis.adjustToSelection();\n\t\t\tthis._selectedView.el.classList.add(\"selected\");\n\n\t\t\tthis.el.appendChild(buffer);\n\t\t}\n\t},\n\n\t// appendItemView: function (parentEl, model, index, arr) {\n\t// \tvar renderer = this.rendererFunction(model, index, arr);\n\t// \tvar view = new renderer({\n\t// \t\tmodel: model,\n\t// \t\tparentView: this,\n\t// \t\tenabled: this.enabled\n\t// \t});\n\t// \tthis.itemViews.add(view);\n\t// \tparentEl.appendChild(view.el);\n\t// \treturn parentEl;\n\t// },\n\n\t// createItemView: function (renderer, opts) {\n\t// \tvar view = new renderer(opts);\n\t// \tthis.itemViews.add(view);\n\t// \treturn view;\n\t// },\n\n\tremoveChildren: function() {\n\t\tthis.itemViews.each(this.removeItemView, this);\n\t\tthis.emptyView = (void 0);\n\t},\n\n\tremoveItemView: function(view) {\n\t\tthis.itemViews.remove(view);\n\t\tview.remove();\n\t\treturn view;\n\t},\n\n\t/* --------------------------- *\n\t/* measure\n\t/* --------------------------- */\n\n\t_measure: function() {\n\t\tvar m, mm;\n\t\tvar pos = 0,\n\t\t\tposInner = 0;\n\t\tvar maxAcross = 0,\n\t\t\tmaxOuter = 0;\n\t\tvar maxOuterView, maxAcrossView;\n\n\t\tmaxOuterView = maxAcrossView = this.emptyView || this.itemViews.first();\n\n\t\t// chidren metrics\n\t\tthis.itemViews.each(function(view) {\n\t\t\tview.render();\n\t\t});\n\n\t\tthis.itemViews.each(function(view) {\n\t\t\tm = this.measureItemView(view);\n\t\t\tm.pos = pos;\n\t\t\tpos += m.outer; // + this.childGap;\n\t\t\tm.posInner = posInner;\n\t\t\tposInner += m.inner; //+ this.childGap;\n\t\t\tif (view !== this.emptyView) {\n\t\t\t\tif (m.across > maxAcross) {\n\t\t\t\t\tmaxAcross = m.across;\n\t\t\t\t\tmaxAcrossView = view;\n\t\t\t\t}\n\t\t\t\tif (m.outer > maxOuter) {\n\t\t\t\t\tmaxOuter = m.outer;\n\t\t\t\t\tmaxOuterView = view;\n\t\t\t\t}\n\t\t\t}\n\t\t}, this);\n\n\t\t// measure self + max child metrics\n\t\tmm = this.metrics[this.cid] || (this.metrics[this.cid] = {});\n\t\tmm.outer = this.el[this.dirProp(\"offsetWidth\", \"offsetHeight\")];\n\t\tmm.before = maxOuterView.el[this.dirProp(\"offsetLeft\", \"offsetTop\")];\n\t\tmm.inner = maxOuterView.el[this.dirProp(\"offsetWidth\", \"offsetHeight\")];\n\t\tmm.after = mm.outer - (mm.inner + mm.before);\n\t\tmm.across = maxAcross;\n\n\t\t// m = this.metrics[maxOuterView.cid];\n\t\t// mm.inner = m.inner;\n\n\t\t// tap area\n\t\tthis._tapAcrossBefore = maxAcrossView.el[this.dirProp(\"offsetTop\", \"offsetLeft\")];\n\t\tthis._tapAcrossAfter = this._tapAcrossBefore + maxAcross;\n\t\tthis._tapBefore = mm.before + this._tapGrow;\n\t\tthis._tapAfter = mm.before + mm.inner - this._tapGrow;\n\n\t\tthis.selectThreshold = Math.min(MAX_SELECT_THRESHOLD, mm.outer * 0.1);\n\t},\n\n\tmeasureItemView: function(view) {\n\t\tvar m, viewEl;\n\t\t// var s, sizeEl;\n\n\t\tviewEl = view.el;\n\t\tm = this.metrics[view.cid] || (this.metrics[view.cid] = {});\n\n\t\tm.outer = viewEl[this.dirProp(\"offsetWidth\", \"offsetHeight\")];\n\t\tm.across = viewEl[this.dirProp(\"offsetHeight\", \"offsetWidth\")];\n\n\t\tif (view.metrics) {\n\t\t\tm.before = view.metrics[this.dirProp(\"marginLeft\", \"marginTop\")];\n\t\t\tm.outer += m.before;\n\t\t\tm.outer += view.metrics[this.dirProp(\"marginRight\", \"marginBottom\")];\n\t\t\tm.inner = view.metrics.content[this.dirProp(\"width\", \"height\")];\n\t\t\tm.before += view.metrics.content[this.dirProp(\"x\", \"y\")];\n\t\t\tm.after = m.outer - (m.inner + m.before);\n\n\t\t\t// var marginBefore = view.metrics[this.dirProp(\"marginLeft\",\"marginTop\")];\n\t\t\t// var marginAfter = view.metrics[this.dirProp(\"marginRight\",\"marginBottom\")];\n\t\t\t// var pos = view.metrics.content[this.dirProp(\"x\",\"y\")];\n\t\t\t//\n\t\t\t// m.inner = view.metrics.content[this.dirProp(\"width\",\"height\")];\n\t\t\t// m.before = marginBefore + pos;\n\t\t\t// m.outer += marginBefore + marginAfter;\n\t\t\t// m.after = m.outer - (m.inner + m.before);\n\t\t} else {\n\t\t\t// throw new Error(\"renderer has no metrics\");\n\t\t\tconsole.warn(\"%s::measureItemView view '%s' has no metrics\", this.cid, view.cid);\n\t\t\tm.inner = m.outer;\n\t\t\tm.after = m.before = 0;\n\t\t}\n\n\t\treturn m;\n\t},\n\n\t/* --------------------------- *\n\t/* scrolling property\n\t/* --------------------------- */\n\n\t_delta: 0,\n\n\t_scrolling: false,\n\n\t_setScrolling: function(scrolling) {\n\t\t// console.warn(\"_setScrolling current/requested\", this._scrolling, scrolling);\n\t\tif (this._scrolling != scrolling) {\n\t\t\tthis._scrolling = scrolling;\n\t\t\tthis.el.classList.toggle(\"scrolling\", scrolling);\n\t\t\tthis.trigger(scrolling ? \"view:scrollstart\" : \"view:scrollend\");\n\t\t}\n\t},\n\n\t/* --------------------------- *\n\t/* Scroll/layout\n\t/* --------------------------- */\n\n\tscrollBy: function(delta, skipTransitions) {\n\t\tthis._delta = delta || 0;\n\t\tthis.skipTransitions = !!skipTransitions;\n\t\t// this.invalidateLayout();\n\t\tthis.requestRender(View.LAYOUT_INVALID);\n\t},\n\n\t_scrollBy: function(delta, skipTransitions) {\n\t\tvar sMetrics, metrics, pos;\n\n\t\tsMetrics = this.metrics[(this._scrollCandidateView || this._selectedView).cid];\n\t\tthis.itemViews.each(function(view) {\n\t\t\tmetrics = this.metrics[view.cid];\n\t\t\tpos = Math.floor(this._getScrollOffset(delta, metrics, sMetrics));\n\t\t\tview.metrics.translateX = (this.direction & HORIZONTAL) ? pos : 0;\n\t\t\tview.metrics.translateY = (this.direction & HORIZONTAL) ? 0 : pos;\n\t\t\tview.metrics._transform = translateTemplate(view.metrics.translateX, view.metrics.translateY);\n\t\t\tview.el.style[transformProperty] = view.metrics._transform;\n\t\t\t// view.el.style[transformProperty] = (this.direction & HORIZONTAL)?\n\t\t\t// \t\"translate3d(\" + pos + \"px,0,0)\":\n\t\t\t// \t\"translate3d(0,\" + pos + \"px,0)\";\n\t\t}, this);\n\n\t\tthis.el.classList.toggle(\"skip-transitions\", skipTransitions);\n\t\tthis.selectFromView();\n\t},\n\n\t_getScrollOffset: function(delta, mCurr, mSel) {\n\t\tvar pos, offset = 0;\n\n\t\tpos = mCurr.pos - mSel.pos + delta;\n\t\tif (pos < 0) {\n\t\t\tif (Math.abs(pos) < mSel.outer) {\n\t\t\t\toffset += (-mCurr.after) / mSel.outer * pos;\n\t\t\t} else {\n\t\t\t\toffset += mCurr.after;\n\t\t\t}\n\t\t} else\n\t\tif (0 <= pos) {\n\t\t\tif (Math.abs(pos) < mSel.outer) {\n\t\t\t\toffset -= mCurr.before / mSel.outer * pos;\n\t\t\t} else {\n\t\t\t\toffset -= mCurr.before;\n\t\t\t}\n\t\t}\n\t\treturn pos + offset;\n\t},\n\n\t_onScrollTransitionEnd: function(ev) {\n\t\tif (ev.propertyName === transformStyleName && this.scrolling) {\n\t\t\tconsole.log(\"%s::_onScrollTransitionEnd selected: %s\", this.cid, ev.target.cid);\n\t\t\tthis._setScrolling(false);\n\t\t}\n\t},\n\n\t/* --------------------------- *\n\t/* toggle touch events\n\t/* --------------------------- */\n\n\t_togglePointerEvents: function(enable) {\n\t\t// console.log(\"%s::_togglePointerEvents\", this.cid, enable);\n\t\tif (this._pointerEventsEnabled == enable) return;\n\n\t\tthis._pointerEventsEnabled = enable;\n\t\tif (enable) {\n\t\t\tthis.touch.on(\"hpanstart hpanmove hpanend hpancancel\", this._onPointerEvent);\n\t\t\tthis.el.addEventListener(View.CLICK_EVENT, this._onClick, true);\n\t\t} else {\n\t\t\tthis.touch.off(\"hpanstart hpanmove hpanend hpancancel\", this._onPointerEvent);\n\t\t\tthis.el.removeEventListener(View.CLICK_EVENT, this._onClick, true);\n\t\t}\n\t},\n\n\t_onPointerEvent: function(ev) {\n\t\t// NOTE: https://github.com/hammerjs/hammer.js/pull/1118\n\t\tif (ev.srcEvent.type === 'pointercancel')\n\t\t\treturn;\n\n\t\tconsole.log(\"%s:[%s (%s)]:_onPointerEvent offs:%s [%s|%s==%s] [%s]\", this.cid, ev.type, ev.srcEvent.type,\n\t\t\tdirToStr(ev.offsetDirection),\n\t\t\tdirToStr(ev.direction),\n\t\t\tdirToStr(this.direction),\n\t\t\tdirToStr(ev.direction | this.direction),\n\t\t\t(ev.srcEvent.defaultPrevented ? \"prevented\" : \"-\"));\n\n\t\t// if (ev.direction & this.direction) {\n\t\tswitch (ev.type) {\n\t\t\t// case View.CLICK_EVENT:\n\t\t\t// \treturn this._onClick(ev);\n\t\t\t// case \"tap\":\n\t\t\t// \treturn this._onTap(ev);\n\t\t\tcase \"hpanstart\":\n\t\t\t\treturn this._onPanStart(ev);\n\t\t\tcase \"hpanmove\":\n\t\t\t\treturn this._onPanMove(ev);\n\t\t\tcase \"hpanend\":\n\t\t\t\treturn this._onPanFinal(ev);\n\t\t\tcase \"hpancancel\":\n\t\t\t\treturn this._onPanFinal(ev);\n\t\t}\n\t\t// }\n\t},\n\n\t/* --------------------------- *\n\t/* touch event: pan\n\t/* --------------------------- */\n\n\tgetViewAtPanDir: function(dir) {\n\t\t// return (dir & this._precedingDir) ? this._precedingView : this._followingView;\n\t\treturn (dir & this._followingDir) ? this._precedingView : this._followingView;\n\t},\n\n\t// _panCapturedOffset: 0,\n\n\t/** @param {Object} ev */\n\t_onPanStart: function(ev) {\n\t\tthis.selectFromView();\n\t\tthis.el.classList.add(\"panning\");\n\t\tthis._setScrolling(true);\n\t},\n\n\t/** @param {Object} ev */\n\t_onPanMove: function(ev) {\n\t\t// var delta = (this.direction & HORIZONTAL) ? ev.thresholdDeltaX : ev.thresholdDeltaY;\n\t\tvar delta = (this.direction & HORIZONTAL) ? ev.deltaX : ev.deltaY;\n\t\tvar view = this.getViewAtPanDir(ev.offsetDirection);\n\t\tvar cView = this._panCandidateView;\n\n\t\tif (cView !== view) {\n\t\t\tcView && cView.el.classList.remove(\"candidate\");\n\t\t\tview && view.el.classList.add(\"candidate\");\n\t\t\tthis._panCandidateView = view;\n\t\t}\n\t\tif (cView === (void 0)) {\n\t\t\tdelta *= Globals.HPAN_OUT_DRAG;\n\t\t}\n\n\t\tif (this._renderRafId !== -1) {\n\t\t\tthis.scrollBy(delta, Carousel.IMMEDIATE);\n\t\t\tthis.renderNow();\n\t\t} else {\n\t\t\tthis._scrollBy(delta, Carousel.IMMEDIATE);\n\t\t}\n\t},\n\n\t/** @param {Object} ev */\n\t_onPanFinal: function(ev) {\n\t\tvar scrollCandidate;\n\t\t// NOTE: this delta is used for determining selection, NOT for layout\n\t\t// var delta = (this.direction & HORIZONTAL) ? ev.thresholdDeltaX : ev.thresholdDeltaY;\n\t\tvar delta = (this.direction & HORIZONTAL) ? ev.deltaX : ev.deltaY;\n\n\t\tif ((ev.type == \"hpanend\")\n\t\t\t/* pan direction (current event) and offsetDirection (whole gesture) must match */\n\t\t\t&& (ev.direction ^ ev.offsetDirection ^ this.direction)\n\t\t\t// && (ev.direction & ev.offsetDirection & this.direction)\n\t\t\t/* gesture must overshoot selectThreshold */\n\t\t\t&& (Math.abs(delta) > this.selectThreshold)) {\n\t\t\t/* choose next scroll target */\n\t\t\tscrollCandidate = this.getViewAtPanDir(ev.offsetDirection);\n\t\t}\n\t\tthis._scrollCandidateView = scrollCandidate || (void 0);\n\n\t\tif (this._panCandidateView && (this._panCandidateView !== scrollCandidate)) {\n\t\t\tthis._panCandidateView.el.classList.remove(\"candidate\");\n\t\t}\n\t\tthis._panCandidateView = (void 0);\n\t\tthis.el.classList.remove(\"panning\");\n\n\t\tconsole.log(\"%s:[%s]:_onPanFinal thres:(%s>%s) dir:(e:%s o:%s c:%s)=%s\\n\", this.cid, ev.type,\n\t\t\tMath.abs(delta), this.selectThreshold,\n\t\t\tdirToStr(ev.direction),\n\t\t\tdirToStr(ev.offsetDirection),\n\t\t\tdirToStr(this.direction),\n\t\t\tdirToStr(ev.direction ^ ev.offsetDirection ^ this.direction),\n\t\t\tscrollCandidate ? (scrollCandidate.cid + \":\" + scrollCandidate.model.cid) : \"none\");\n\t\t// console.log(\"%s::_onPanFinal\", this.cid, ev);\n\n\t\tthis.scrollBy(0, Carousel.ANIMATED);\n\t\tthis.selectFromView();\n\n\t\t// if (this._renderRafId !== -1) {\n\t\t// \tthis.scrollBy(0, Carousel.ANIMATED);\n\t\t// \tthis.renderNow();\n\t\t// } else {\n\t\t// \tthis._scrollBy(0, Carousel.ANIMATED);\n\t\t// }\n\t},\n\n\t/* --------------------------- *\n\t/* touch event: tap\n\t/* --------------------------- */\n\n\t/** @type {int} In pixels */\n\t_tapGrow: 10,\n\n\tgetViewAtTapPos: function(posAlong, posAcross) {\n\t\tif ((this._tapAcrossBefore < posAcross) && (posAcross < this._tapAcrossAfter)) {\n\t\t\tif (posAlong < this._tapBefore) {\n\t\t\t\treturn this._precedingView;\n\t\t\t} else\n\t\t\tif (posAlong > this._tapAfter) {\n\t\t\t\treturn this._followingView;\n\t\t\t}\n\t\t}\n\t\treturn (void 0);\n\t},\n\n\t_onClick: function(ev) {\n\t\tconsole.log(\"%s::_onClick [%s]\", this.cid, ev.type, ev.defaultPrevented ? \"prevented\" : \"not-prevented\");\n\t\tthis._onTap(ev);\n\t},\n\n\t_onTap: function(ev) {\n\t\tif (ev.defaultPrevented) return;\n\n\t\tvar tapCandidate;\n\t\tvar targetView = View.findByDescendant(ev.target);\n\t\t// console.log(\"%s::_onTap %o\", this.cid, targetView.cid, ev.target);\n\t\t// if (!this.itemViews.contains(targetView)) {\n\t\t// \treturn;\n\t\t// }\n\t\tdo {\n\t\t\tif (this._selectedView === targetView) {\n\t\t\t\ttapCandidate = null;\n\t\t\t\tbreak;\n\t\t\t} else if (this === targetView.parentView) {\n\t\t\t\ttapCandidate = targetView;\n\t\t\t\tbreak;\n\t\t\t} else if (this === targetView) {\n\t\t\t\tvar bounds, tapX, tapY;\n\t\t\t\tbounds = this.el.getBoundingClientRect();\n\t\t\t\ttapX = (ev.type === \"tap\" ? ev.center.x : ev.clientX) - bounds.left;\n\t\t\t\ttapY = (ev.type === \"tap\" ? ev.center.y : ev.clientY) - bounds.top;\n\t\t\t\ttapCandidate = this.getViewAtTapPos(\n\t\t\t\t\tthis.dirProp(tapX, tapY),\n\t\t\t\t\tthis.dirProp(tapY, tapX)\n\t\t\t\t);\n\t\t\t\tbreak;\n\t\t\t}\n\t\t} while ((targetView = targetView.parentView))\n\n\t\tif (tapCandidate) {\n\t\t\tev.preventDefault();\n\t\t\t// ev.stopPropagation();\n\n\t\t\t// this._scrollCandidateView = tapCandidate;\n\t\t\t// this._setScrolling(true);\n\t\t\t// this.scrollBy(0, Carousel.ANIMATED);\n\t\t\t// this._scrollCandidateView.el.classList.add(\"candidate\");\n\t\t\t// this.selectFromView();\n\n\t\t\t//// NOT using internalSelection\n\t\t\t// this.triggerSelectionEvents(tapCandidate, false);\n\n\t\t\t// using internalSelection\n\t\t\tthis._scrollCandidateView = tapCandidate;\n\t\t\tthis._setScrolling(true);\n\t\t\tthis.scrollBy(0, Carousel.ANIMATED);\n\n\t\t\tthis.triggerSelectionEvents(tapCandidate, true);\n\t\t\t// this.renderNow();\n\t\t}\n\t},\n\n\t/* --------------------------- *\n\t/* Private\n\t/* --------------------------- */\n\n\ttriggerSelectionEvents: function(view, internal) {\n\t\tif (view === (void 0) || this._internalSelection) {\n\t\t\treturn;\n\t\t}\n\n\t\tthis._internalSelection = !!internal;\n\t\tif (view === this.emptyView) {\n\t\t\tthis.trigger(\"view:select:none\");\n\t\t} else {\n\t\t\tthis.trigger(\"view:select:one\", view.model);\n\t\t}\n\t\tthis._internalSelection = false;\n\t},\n\n\tselectFromView: function() {\n\t\tif (this._scrollCandidateView) {\n\t\t\tthis.triggerSelectionEvents(this._scrollCandidateView, true);\n\t\t}\n\t\t// if (this._scrollCandidateView === (void 0)) {\n\t\t// \treturn;\n\t\t// }\n\t\t// var view = this._scrollCandidateView;\n\t\t// this.triggerSelectionEvents(view, true);\n\t},\n\n\tadjustToSelection: function() {\n\t\tvar m, i = this.collection.selectedIndex;\n\t\t// assume -1 < index < this.collection.length\n\t\tif (this.requireSelection) {\n\t\t\t(i == -1) && i++; // if selection is null (index -1), set _selectedView to first item (index 0)\n\t\t\tthis._selectedView = (m = this.collection.at(i)) && this.itemViews.findByModel(m);\n\t\t\tthis._precedingView = (m = this.collection.at(i - 1)) && this.itemViews.findByModel(m);\n\t\t\tthis._followingView = (m = this.collection.at(i + 1)) && this.itemViews.findByModel(m);\n\t\t} else {\n\t\t\tthis._selectedView = (m = this.collection.at(i)) ? this.itemViews.findByModel(m) : this.emptyView;\n\t\t\tthis._precedingView = m && ((m = this.collection.at(i - 1)) ? this.itemViews.findByModel(m) : this.emptyView);\n\t\t\tthis._followingView = (m = this.collection.at(i + 1)) && this.itemViews.findByModel(m);\n\t\t}\n\t},\n\n\t/* --------------------------- *\n\t/* Model listeners\n\t/* --------------------------- */\n\n\t/** @private */\n\t_onSelectOne: function(model) {\n\t\tif (model === this._selectedView.model) {\n\t\t\t// console.info(\"INTERNAL\");\n\t\t\treturn;\n\t\t}\n\t\tthis._onSelectAny(model);\n\t},\n\n\t/** @private */\n\t_onSelectNone: function() {\n\t\tif ((this.requireSelection ? this.itemViews.first() : this.emptyView) === this._selectedView) {\n\t\t\t// console.info(\"INTERNAL\");\n\t\t\treturn;\n\t\t}\n\t\tthis._onSelectAny();\n\t},\n\n\t/** @private */\n\t_onSelectAny: function(model) {\n\t\tthis._selectedView.el.classList.remove(\"selected\");\n\t\tthis.adjustToSelection();\n\t\tthis._selectedView.el.classList.add(\"selected\");\n\t\tif (this._scrollCandidateView) {\n\t\t\tthis._scrollCandidateView.el.classList.remove(\"candidate\");\n\t\t\tthis._scrollCandidateView = (void 0);\n\t\t}\n\n\t\tif (!this._internalSelection) {\n\t\t\tthis._setScrolling(true);\n\t\t\tthis.scrollBy(0, Carousel.ANIMATED);\n\t\t}\n\t},\n\n\t// _onDeselectAny: function (model) {},\n\n\t/** @private */\n\t_onReset: function() {\n\t\t// this._createChildren();\n\t\t// this.invalidateChildren();\n\t\tthis.requestRender(View.CHILDREN_INVALID | View.MODEL_INVALID);\n\t},\n\n\n\t/* --------------------------- *\n\t/* TEMP\n\t/* --------------------------- */\n\n\t// _scrollBy2: function (delta, skipTransitions) {\n\t// \tvar metrics, pos;\n\t// \tvar sMetrics = this.metrics[(this._scrollCandidateView || this._selectedView).cid];\n\t// \tvar cMetrics = this.metrics[(this._panCandidateView || this._selectedView).cid];\n\t//\n\t// \tthis.itemViews.each(function (view) {\n\t// \t\tmetrics = this.metrics[view.cid];\n\t// \t\tpos = Math.floor(this._getScrollOffset(delta, metrics, sMetrics, cMetrics));\n\t// \t\tview.el.style[transformProperty] = (this.direction & HORIZONTAL)?\n\t// \t\t\t\t\"translate3d(\" + pos + \"px,0,0)\" : \"translate3d(0,\" + pos + \"px,0)\";\n\t// \t\t\t\t// \"translate(\" + pos + \"px,0)\" : \"translate(0,\" + pos + \"px)\";\n\t// \t\t\t\t// \"translateX(\" + pos + \"px)\" : \"translateY(\" + pos + \"px)\";\n\t// \t}, this);\n\t// \tthis.el.classList.toggle(\"skip-transitions\", skipTransitions);\n\t// \tthis.selectFromView();\n\t// },\n\n\t// _getScrollOffset2: function (delta, mCurr, mSel, mCan) {\n\t// \tvar offset = 0;\n\t// \tvar posInner = mCurr.posInner - mSel.posInner + delta;\n\t//\n\t// \tif (posInner < -mSel.inner) {\n\t// \t\toffset = -(mCurr.before);\n\t// \t} else if (posInner > mSel.inner) {\n\t// \t\toffset = (mSel.after);\n\t// \t} else {\n\t// \t\tif (posInner < 0) {\n\t// \t\t\toffset = (mCurr.before) / (mCurr.inner) * posInner;\n\t// \t\t} else {\n\t// \t\t\toffset = (mSel.after) / (mCan.inner) * posInner;\n\t// \t\t}\n\t// \t}\n\t// \treturn posInner + offset;\n\t// },\n\n\t// captureSelectedOffset: function() {\n\t// \tvar val, view, cssval, m, mm;\n\t//\n\t// \tval = 0;\n\t// \tview = this._scrollCandidateView || this._selectedView;\n\t// \tcssval = getComputedStyle(view.el)[transformProperty];\n\t//\n\t// \tmm = cssval.match(/(matrix|matrix3d)\\(([^\\)]+)\\)/);\n\t// \tif (mm) {\n\t// \t\tm = mm[2].split(\",\");\n\t// \t\tif (this.direction & HORIZONTAL) {\n\t// \t\t\tval = m[mm[1]==\"matrix\"? 4 : 12];\n\t// \t\t} else {\n\t// \t\t\tval = m[mm[1]==\"matrix\"? 5 : 13];\n\t// \t\t}\n\t// \t\tval = parseFloat(val);\n\t// \t}\n\t//\n\t// \tconsole.log(\"%s::captureSelectedOffset\", this.cid, cssval, val, cssval.match(/matrix\\((?:\\d\\,){3}(\\d)\\,(\\d)|matrix3d\\((?:\\d\\,){11}(\\d)\\,(\\d)/));\n\t//\n\t// \treturn val;\n\t// },\n\n\t// _onScrollEnd: function(exec) {\n\t// \tthis._scrollEndCancellable = (void 0);\n\t// \t// this.el.classList.remove(\"disabled-changing\");\n\t// \tif (exec) {\n\t// \t\tthis._setScrolling(false);\n\t// \t\t// this.el.classList.remove(\"scrolling\");\n\t// \t\t// this.trigger(\"view:scrollend\");\n\t// \t\tconsole.log(\"%s::_onScrollEnd\", this.cid);\n\t// \t}\n\t// },\n\t// _onMouseDown: function(ev) {\n\t// \tif (this._scrolling) {\n\t// \t\tthis._panCapturedOffset = this.captureSelectedOffset();\n\t// \t\tconsole.log(\"%s::events[mousedown] scrolling interrupted (pos %f)\", this.cid, this._panCapturedOffset);\n\t// \t}\n\t// },\n\t// _onMouseUp:function(ev) {\n\t// \tthis._panCapturedOffset = 0;\n\t// },\n\n};\n\nif (DEBUG) {\n\tCarouselProto._logFlags = \"\";\n}\n\nmodule.exports = Carousel = View.extend(CarouselProto, Carousel);\n",
    "// hbsfy compiled Handlebars template\nvar HandlebarsCompiler = require('hbsfy/runtime');\nmodule.exports = HandlebarsCompiler.template({\"compiler\":[7,\">= 4.0.0\"],\"main\":function(container,depth0,helpers,partials,data) {\n    var helper;\n\n  return container.escapeExpression(((helper = (helper = helpers.id || (depth0 != null ? depth0.id : depth0)) != null ? helper : helpers.helperMissing),(typeof helper === \"function\" ? helper.call(depth0 != null ? depth0 : (container.nullContext || {}),{\"name\":\"id\",\"hash\":{},\"data\":data}) : helper)));\n},\"useData\":true});\n",
    "/**\n * @module app/view/component/CollectionStack\n */\n\n/** @type {module:app/view/base/View} */\nconst View = require(\"app/view/base/View\");\n\n/** @type {string} */\nconst viewTemplate = require(\"./CollectionStack.hbs\");\n\n/**\n * @constructor\n * @type {module:app/component/CollectionStack}\n */\nmodule.exports = View.extend({\n\n\t/** @override */\n\tcidPrefix: \"stack\",\n\t/** @override */\n\ttagName: \"div\",\n\t/** @override */\n\tclassName: \"stack\",\n\t/** @override */\n\ttemplate: viewTemplate,\n\n\tevents: {\n\t\t\"transitionend\": function(ev) {\n\t\t\t// console.log(\"%s::transitionend [invalid: %s] [transition: %s]\", this.cid, this._contentInvalid, (this._skipTransitions? \"skip\": \"run\"), ev.target.id, ev.target.className);\n\t\t\tthis._renderContent();\n\t\t}\n\t},\n\n\tinitialize: function(options) {\n\t\tthis._enabled = true;\n\t\tthis._skipTransitions = true;\n\t\tthis._contentInvalid = true;\n\n\t\toptions.template && (this.template = options.template);\n\t\tthis.content = document.createElement(\"div\");\n\t\tthis.content.className = \"stack-item\";\n\t\tthis.el.appendChild(this.content);\n\n\t\tthis.listenTo(this.collection, \"select:one select:none\", this._onSelectChange);\n\t},\n\n\tsetEnabled: function(enabled) {\n\t\tif (this._enabled !== enabled) {\n\t\t\tthis._enabled = enabled;\n\t\t\tthis.el.classList.toggle(\"disabled\", !this._enabled);\n\t\t}\n\t},\n\n\t_onSelectChange: function(item) {\n\t\tif (this._renderedItem === this.collection.selected) {\n\t\t\tthrow new Error(\"change event received but item is identical\");\n\t\t}\n\t\tthis._renderedItem = this.collection.selected;\n\n\t\tthis._contentInvalid = true;\n\t\tthis.render();\n\t},\n\n\t/* --------------------------- *\n\t/* render\n\t/* --------------------------- */\n\n\trender: function() {\n\t\tif (this._skipTransitions) {\n\t\t\t// execute even if content has not changed to apply styles immediately\n\t\t\tthis._skipTransitions = false;\n\t\t\tthis.el.classList.add(\"skip-transitions\");\n\t\t\tthis.setImmediate(function() {\n\t\t\t\tthis.el.classList.remove(\"skip-transitions\");\n\t\t\t});\n\n\t\t\t// render changed content immediately\n\t\t\tif (this._contentInvalid) {\n\t\t\t\tthis._renderContent();\n\t\t\t}\n\t\t} else {\n\t\t\t// else remove 'current' class and render on transitionend\n\t\t\tif (this._contentInvalid) {\n\t\t\t\tthis.content.classList.remove(\"current\");\n\t\t\t\t// this.content.className = \"stack-item\";\n\t\t\t}\n\t\t}\n\t\treturn this;\n\t},\n\n\t_renderContent: function() {\n\t\tif (this._contentInvalid) {\n\t\t\tthis._contentInvalid = false;\n\t\t\tvar item = this.collection.selected;\n\t\t\tthis.content.innerHTML = item ? this.template(item.toJSON()) : \"\";\n\t\t\tthis.content.classList.add(\"current\");\n\t\t\t// this.content.className = \"stack-item current\";\n\t\t}\n\t},\n});\n",
    "/**\n/* @module app/view/component/FilterableListView\n/*/\n\n/** @type {module:backbone.babysitter} */\nconst Container = require(\"backbone.babysitter\");\n\n/** @type {module:app/view/base/View} */\nconst View = require(\"app/view/base/View\");\n/** @type {module:app/view/component/ClickableRenderer} */\nconst ClickableRenderer = require(\"app/view/render/ClickableRenderer\");\n/** @type {module:utils/prefixedProperty} */\nconst prefixedProperty = require(\"utils/prefixedProperty\");\n/** @type {module:utils/css/getBoxEdgeStyles} */\nconst getBoxEdgeStyles = require(\"utils/css/getBoxEdgeStyles\");\n/** @type {module:utils/array/difference} */\nconst diff = require(\"utils/array/difference\");\n/** @type {module:utils/promise/resolveAll} */\nconst resolveAll = require(\"utils/promise/resolveAll\");\n/** @type {module:utils/promise/rejectAll} */\nconst rejectAll = require(\"utils/promise/rejectAll\");\n\n// var resolveAll = function(pp, result) {\n// \tif (pp.length != 0) {\n// \t\tpp.forEach(function(p, i, a) {\n// \t\t\tp.resolve(result);\n// \t\t\ta[i] = null;\n// \t\t});\n// \t\tpp.length = 0;\n// \t}\n// \treturn pp;\n// };\n\n// var rejectAll = function(pp, reason) {\n// \tif (pp.length != 0) {\n// \t\tpp.forEach(function(p, i, a) {\n// \t\t\tp.reject(reason);\n// \t\t\ta[i] = null;\n// \t\t});\n// \t\tpp.length = 0;\n// \t}\n// \treturn pp;\n// };\n\n/** @type {module:app/control/Globals.TRANSLATE_TEMPLATE} */\nconst translateCssValue = require(\"app/control/Globals\").TRANSLATE_TEMPLATE;\n\n/** @const */\nvar transformProp = prefixedProperty(\"transform\");\n\n/**\n/* @constructor\n/* @type {module:app/view/component/FilterableListView}\n/*/\nvar FilterableListView = View.extend({\n\n\t/** @type {string} */\n\tcidPrefix: \"filterableList\",\n\t/** @override */\n\ttagName: \"ul\",\n\t/** @override */\n\tclassName: \"list selectable filterable\",\n\n\t/** @override */\n\tdefaults: {\n\t\tcollapsed: true,\n\t\tfilterFn: function() {\n\t\t\treturn true;\n\t\t},\n\t\trenderer: ClickableRenderer.extend({\n\t\t\t/** @override */\n\t\t\tcidPrefix: \"listItem\",\n\t\t\t/** @override */\n\t\t\tclassName: \"list-item list-node\",\n\t\t}),\n\t},\n\n\t/** @override */\n\tproperties: {\n\t\tcollapsed: {\n\t\t\tget: function() {\n\t\t\t\treturn this._collapsed;\n\t\t\t},\n\t\t\tset: function(value) {\n\t\t\t\tthis._setCollapsed(value);\n\t\t\t}\n\t\t},\n\t\tselectedItem: {\n\t\t\tget: function() {\n\t\t\t\treturn this._selectedItem;\n\t\t\t},\n\t\t\tset: function(value) {\n\t\t\t\tthis._setSelection(value);\n\t\t\t}\n\t\t},\n\t\tfilteredItems: {\n\t\t\tget: function() {\n\t\t\t\treturn this._filteredItems;\n\t\t\t}\n\t\t},\n\t\tmetrics: {\n\t\t\tget: function() {\n\t\t\t\treturn this._metrics;\n\t\t\t}\n\t\t}\n\t},\n\n\t/** @override */\n\tevents: {\n\t\t\"transitionend .list-node\": function(ev) {\n\t\t\t// if (!ev.target.classList.contains(\"list-node\")) {}\n\t\t\tif (ev.propertyName == transformProp\n\t\t\t\t&& ev.target.parentElement === this.el) {\n\t\t\t\tthis._changedPosNum--;\n\t\t\t\t// console.log(\"%s:[%s (%s)] [%s]\", this.cid, ev.type, ev.target.className, ev.propertyName, this._changedPosNum, ev);\n\t\t\t}\n\t\t\tif (!this._collapsedChanging) {\n\t\t\t\treturn;\n\t\t\t}\n\n\t\t\tif (this._changedPosNum == 0) {\n\t\t\t\t// if ((ev.propertyName == transformProp) ||\n\t\t\t\t// \t(ev.propertyName == \"visibility\")) {\n\t\t\t\tconsole.log(\"%s:[%s .list-item] [%s] collapsed-changing end (resolving %s promises)\", this.cid, ev.type, ev.propertyName, this._collapsePromises.length);\n\t\t\t\tthis._collapsedChanging = false;\n\t\t\t\tthis.el.classList.remove(\"collapsed-changing\");\n\t\t\t\tresolveAll(this._collapsePromises, this);\n\t\t\t}\n\t\t},\n\t},\n\n\t/** @override */\n\tinitialize: function(options) {\n\t\tthis._filteredItems = [];\n\t\tthis._filteredIncoming = [];\n\t\tthis._filteredOutgoing = [];\n\n\t\tthis._metrics = {};\n\t\tthis._itemMetrics = [];\n\t\tthis._collapsePromises = [];\n\t\tthis.itemViews = new Container();\n\n\t\t_.defaults(options, this.defaults);\n\t\tthis.renderer = options.renderer;\n\t\tthis._filterFn = options.filterFn;\n\n\t\t// this.computeFilter();\n\t\t// this.collection.each(this.createItemView, this);\n\n\t\tthis.collection.each(this.createItemView, this);\n\t\tthis._setSelection(this.collection.selected);\n\t\tthis._setCollapsed(options.collapsed);\n\t\tthis.refreshFilter();\n\t\t// this.skipTransitions = true;\n\t\t// this.renderNow();\n\n\t\t// this.listenTo(this.collection, \"select:one select:none\", this._setSelection);\n\t\tthis.listenTo(this.collection, \"reset\", function() {\n\t\t\tthis._allItems = null;\n\t\t\tthrow new Error(\"not implemented\");\n\t\t});\n\n\t\t// will trigger on return if this.el is already attached\n\t\t// this.skipTransitions = true;\n\t\t// this.el.classList.add(\"skip-transitions\");\n\t\t// this.requestRender(View.ALL_INVALID);\n\n\t\tconsole.log(\"%s::initialize attached: %o\", this.cid, this.attached);\n\n\t\tthis.once(\"view:attached\", function(view) {\n\t\t\tconsole.log(\"%s::initialize -> [view:attached] attached: %o\", view.cid, view.attached);\n\t\t\t// view.requestRender(View.ALL_INVALID).renderNow();\n\t\t\tview.skipTransitions = true;\n\t\t\tview.el.classList.add(\"skip-transitions\");\n\t\t\tview.setImmediate(function() {\n\t\t\t\t// this.skipTransitions = true;\n\t\t\t\tview.renderNow();\n\t\t\t});\n\t\t});\n\t},\n\n\t/**\n\t * Get an array with a collection contens\n\t * @private\n\t */\n\t_getAllItems: function() {\n\t\treturn this._allItems || (this._allItems = this.collection.slice());\n\t},\n\n\t/* --------------------------- *\n\t/* Transition promises\n\t/* --------------------------- */\n\n\t_whenCollapseChangeEnds: function() {\n\t\tif (this._collapsedChanged) {\n\t\t\tvar view = this;\n\t\t\treturn new Promise(function(resolve, reject) {\n\t\t\t\tview.on(\"view:render:after\", resolve);\n\t\t\t})\n\t\t} else {\n\t\t\treturn Promise.resolve(this);\n\t\t}\n\t},\n\n\twhenCollapseChangeEnds: function() {\n\t\tvar d, p, pp;\n\t\tif (this._collapsedChanging || this._collapsedChanged) {\n\t\t\td = {};\n\t\t\tp = new Promise(function(resolve, reject) {\n\t\t\t\td.resolve = resolve;\n\t\t\t\td.reject = reject;\n\t\t\t});\n\t\t\tpp = this._collapsePromises;\n\t\t\tpp.push(d);\n\t\t} else {\n\t\t\tp = Promise.resolve(this);\n\t\t}\n\t\treturn p;\n\t},\n\n\t/* --------------------------- *\n\t/* Render\n\t/* --------------------------- */\n\n\t/** @override */\n\trenderFrame: function(tstamp, flags) {\n\t\t// if (DEBUG) {\n\t\t// \tvar changed = [];\n\t\t// \tthis._collapsedChanged && changed.push(\"collapsed\");\n\t\t// \tthis._selectionChanged && changed.push(\"selection\");\n\t\t// \tthis._filterChanged && changed.push(\"filter\");\n\t\t// \tconsole.log(\"%s::renderFrame [%s]\", this.cid, changed.join(\" \"));\n\t\t// }\n\n\t\t// collapsed transition flag\n\t\tif (this._collapsedChanging) {\n\t\t\tconsole.warn(\"%s::renderFrame collapsed tx interrupted\", this.cid);\n\t\t\tthis._collapsedChanging = false;\n\t\t\tthis.el.classList.remove(\"collapsed-changing\");\n\t\t\trejectAll(this._collapsePromises, this);\n\t\t}\n\t\tif (this.skipTransitions) {\n\t\t\tthis.el.classList.add(\"skip-transitions\");\n\t\t\t// this.requestAnimationFrame(function() {\n\t\t\tthis.setImmediate(function() {\n\t\t\t\tthis.skipTransitions = false;\n\t\t\t\tthis.el.classList.remove(\"skip-transitions\");\n\t\t\t});\n\t\t}\n\n\t\tif (this._collapsedChanged) {\n\t\t\tthis._collapsedChanged = false;\n\t\t\tflags |= View.SIZE_INVALID;\n\t\t\tthis.el.classList.toggle(\"collapsed\", this._collapsed);\n\n\t\t\tif (this.skipTransitions) {\n\t\t\t\tthis._collapsedChanging = false;\n\t\t\t\t// resolveAll(this._collapsePromises, this.el);\n\t\t\t\tthis.once(\"view:render:after\", function(view) {\n\t\t\t\t\tthis._changedPosNum = 0;\n\t\t\t\t\tresolveAll(view._collapsePromises, view);\n\t\t\t\t});\n\t\t\t} else {\n\t\t\t\tthis._collapsedChanging = true;\n\t\t\t\tthis.el.classList.add(\"collapsed-changing\");\n\t\t\t\t// this will be resolved on transitionend\n\t\t\t}\n\t\t\tconsole.log(\"%s:[collapse changed] %s promises\", this.cid,\n\t\t\t\tthis._collapsePromises.length,\n\t\t\t\tthis._collapsedChanging ? \"resolving now\" : \"resolving on transitionend\"\n\t\t\t);\n\t\t}\n\n\t\tif (this._selectionChanged) {\n\t\t\tthis._selectionChanged = false;\n\t\t\tflags |= View.LAYOUT_INVALID;\n\t\t\tthis.renderSelection(this.collection.selected, this.collection.lastSelected);\n\t\t}\n\n\t\tif (this._filterChanged) {\n\t\t\tthis._filterChanged = false;\n\t\t\tflags |= View.LAYOUT_INVALID;\n\t\t\tvar lastFilteredItems = this.filteredItems;\n\t\t\t// this._printStats(lastFilteredItems);\n\t\t\tthis.computeFilter();\n\t\t\tthis.applyFilter();\n\t\t\tif (DEBUG) {\n\t\t\t\tthis._printStats(lastFilteredItems);\n\t\t\t}\n\t\t}\n\n\t\tif (flags & View.SIZE_INVALID) {\n\t\t\tthis.measure(); // NOTE: measures children\n\t\t}\n\n\t\tif (flags & (View.LAYOUT_INVALID | View.SIZE_INVALID)) {\n\t\t\tthis.renderLayout();\n\t\t}\n\t},\n\n\tmeasure: function() {\n\t\t// var i, ii, el, els, m, mm;\n\t\t// els = this.el.children;\n\t\t// ii = els.length;\n\t\t// mm = this._itemMetrics;\n\t\t// for (i = 0; i < ii; i++) {\n\t\t// \tmm[i] = _.pick(els[i], \"offsetTop\", \"offsetHeight\");\n\t\t// }\n\n\t\tthis._metrics = getBoxEdgeStyles(this.el, this._metrics);\n\n\t\t// var itemEl, itemView, baseline = 0;\n\t\t// if (itemEl = this.el.querySelector(\".list-item:not(.excluded) .label\")) {\n\t\t// \t// itemView = this.itemViews.findByCid(itemEl.cid);\n\t\t// \tvar elA = itemEl, elB = itemEl.parentElement;\n\t\t// \tvar yA = elA.offsetTop,\n\t\t// \t\thA = elA.offsetHeight,\n\t\t// \t\tyB = elB.offsetTop,\n\t\t// \t\thB = elB.offsetHeight;\n\t\t// \tbaseline = ((yA + hA) - (yB + hB));\n\t\t// \tconsole.log(\"%s::measure fontSize: %spx (%s+%s)-(%s+%s)=%s\", this.cid, this._metrics.fontSize,\n\t\t// \t\tyA, hA, yB, hB, baseline\n\t\t// \t);\n\t\t// }\n\n\t\tthis.itemViews.forEach(function(view) {\n\t\t\tif (!view._metrics) view._metrics = {};\n\t\t\t// view._metrics.baseline = this._metrics.fontSize - baseline;\n\t\t\tview._metrics.offsetTop = view.el.offsetTop;\n\t\t\tview._metrics.offsetHeight = view.el.offsetHeight;\n\t\t\tview._metrics.offsetLeft = view.el.offsetLeft;\n\t\t\tview._metrics.offsetWidth = view.el.offsetWidth;\n\t\t\tif (!this._collapsed && view.label) {\n\t\t\t\tview._metrics.textLeft = view.label.offsetLeft;\n\t\t\t\tview._metrics.textWidth = view.label.offsetWidth;\n\t\t\t} else {\n\t\t\t\tview._metrics.textLeft = view._metrics.offsetLeft;\n\t\t\t\tview._metrics.textWidth = view._metrics.offsetWidth;\n\t\t\t}\n\t\t}, this);\n\n\t\t// this._metrics.baseline = this._metrics.fontSize - baseline;\n\t},\n\n\trenderLayout: function() {\n\t\tvar posX, posY, lastX, lastY;\n\t\tposX = this._metrics.paddingLeft;\n\t\tposY = this._metrics.paddingTop;\n\n\t\tthis._changedPosNum = 0;\n\t\t// use HTMLElement.children to keep layout order\n\t\tfor (var i = 0, ii = this.el.children.length; i < ii; i++) {\n\t\t\tvar view = this.itemViews.findByCid(this.el.children[i].cid);\n\t\t\tlastX = view.transform.tx;\n\t\t\tlastY = view.transform.ty;\n\t\t\tif (((this.collection.selected && !view.model.selected) ||\n\t\t\t\t\tview.el.classList.contains(\"excluded\")) && this._collapsed) {\n\t\t\t\tview.transform.tx = posX;\n\t\t\t\tview.transform.ty = posY;\n\t\t\t} else {\n\t\t\t\tif (view._metrics.offsetHeight == 0) {\n\t\t\t\t\tposY -= view._metrics.offsetTop;\n\t\t\t\t}\n\t\t\t\tview.transform.tx = posX;\n\t\t\t\tview.transform.ty = posY;\n\t\t\t\tposY += view._metrics.offsetHeight + view._metrics.offsetTop;\n\t\t\t}\n\t\t\tview.el.style[transformProp] = translateCssValue(view.transform.tx, view.transform.ty);\n\t\t\tif (view.transform.tx != lastX || view.transform.ty != lastY) {\n\t\t\t\tthis._changedPosNum++;\n\t\t\t}\n\t\t}\n\n\t\t// posY += this._metrics.paddingBottom;\n\t\tthis._metrics.height = Math.max(0, posY + this._metrics.paddingBottom);\n\t\tthis.el.style.height = this._metrics.height + \"px\";\n\t\t// this.el.style.height = (posY > 0) ? posY + \"px\" : \"\";\n\t},\n\n\t/* --------------------------- *\n\t/* Child views\n\t/* --------------------------- */\n\n\t/** @private */\n\tcreateItemView: function(item, index) {\n\t\tvar view = new this.renderer({\n\t\t\tmodel: item,\n\t\t\tel: this.el.querySelector(\".list-item[data-id=\\\"\" + item.id + \"\\\"]\")\n\t\t});\n\t\t// item.set(\"excluded\", false, { silent: true });\n\t\t// view.listenTo(item, \"change:excluded\", function(item, newVal) {\n\t\t// \t// console.log(arguments);\n\t\t// \tif (this.el.classList.contains(\"excluded\") !== newVal) {\n\t\t// \t\tconsole.warn(\"%s:[change:excluded] m:%o css: %o\", this.cid, newVal, this.el.classList.contains(\"excluded\"));\n\t\t// \t}\n\t\t// \t// this.el.classList.toggle(\"excluded\", excluded);\n\t\t// });\n\t\tthis.listenTo(view, \"renderer:click\", this._onRendererClick);\n\t\tthis.itemViews.add(view);\n\t\treturn view;\n\t},\n\n\t/** @private */\n\t_onRendererClick: function(item, ev) {\n\t\tif (this._collapsedChanging\n\t\t\t|| (this._collapsed && item.get(\"excluded\"))) {\n\t\t\treturn;\n\t\t}\n\t\tif (this.collection.selected !== item) {\n\t\t\tthis.trigger(\"view:select:one\", item);\n\t\t} else {\n\t\t\tif (ev.altKey) {\n\t\t\t\tthis.trigger(\"view:select:none\");\n\t\t\t} else {\n\t\t\t\tthis.trigger(\"view:select:same\", item);\n\t\t\t}\n\t\t\t// this.trigger(\"view:select:none\");\n\t\t}\n\t},\n\n\t/* --------------------------- *\n\t/* Collapsed\n\t/* --------------------------- */\n\n\t/** @private */\n\t_collapsed: undefined,\n\n\t/**\n\t * @param {Boolean}\n\t */\n\t_setCollapsed: function(collapsed) {\n\t\tif (collapsed !== this._collapsed) {\n\t\t\tthis._collapsed = collapsed;\n\t\t\tthis._collapsedChanged = true;\n\t\t\tthis.requestRender();\n\t\t}\n\t},\n\n\t/* --------------------------- *\n\t/* Selection\n\t/* --------------------------- */\n\n\t/** @private */\n\t_selectedItem: undefined,\n\n\t/** @param {Backbone.Model|null} */\n\t_setSelection: function(item) {\n\t\tif (item !== this._selectedItem) {\n\t\t\tthis._selectedItem = item;\n\t\t\tthis._selectionChanged = true;\n\t\t\tthis.requestRender(View.MODEL_INVALID);\n\t\t}\n\t},\n\n\t/** @private */\n\trenderSelection: function(newItem, oldItem) {\n\t\tvar view;\n\t\tif (oldItem) {\n\t\t\tview = this.itemViews.findByModel(oldItem);\n\t\t\tview.el.classList.remove(\"selected\");\n\t\t\t// view.label.classList.remove(\"color-fg\");\n\t\t\t// view.label.classList.remove(\"color-reverse\");\n\t\t}\n\t\tif (newItem) {\n\t\t\tview = this.itemViews.findByModel(newItem);\n\t\t\tview.el.classList.add(\"selected\");\n\t\t\t// view.label.classList.add(\"color-fg\");\n\t\t\t// view.label.classList.add(\"color-reverse\");\n\t\t}\n\t\tthis.el.classList.toggle(\"has-selected\", this.selectedItem !== null);\n\t},\n\n\t/* --------------------------- *\n\t/* Filter\n\t/* --------------------------- */\n\n\trefreshFilter: function() {\n\t\tif (this._filterFn) {\n\t\t\tthis._filterChanged = true;\n\t\t\tthis.requestRender(View.MODEL_INVALID);\n\t\t}\n\t},\n\n\t/* --------------------------- *\n\t/* Filter impl 2\n\t/* --------------------------- */\n\n\tcomputeFilter: function() {\n\t\tvar newItems, oldItems;\n\t\tvar hasNew, hasOld;\n\t\tthis._filteredIncoming.length = 0;\n\t\tthis._filteredOutgoing.length = 0;\n\n\t\tnewItems = this._filterFn ? this.collection.filter(this._filterFn, this) : this._getAllItems();\n\t\toldItems = this._filteredItems;\n\t\thasNew = !!(newItems && newItems.length);\n\t\thasOld = !!(oldItems && oldItems.length);\n\t\t// NOTE: diff third arg is destination array\n\t\tif (hasNew) {\n\t\t\t// incoming exclusions\n\t\t\tdiff((hasOld ? oldItems : this._getAllItems()), newItems, this._filteredIncoming);\n\t\t\t// this._filteredIncoming.forEach(function(item) {\n\t\t\t// \titem.set(\"excluded\", true);\n\t\t\t// });\n\t\t}\n\t\tif (hasOld) {\n\t\t\t// outgoing exclusions\n\t\t\tdiff((hasNew ? newItems : this._getAllItems()), oldItems, this._filteredOutgoing);\n\t\t\t// this._filteredOutgoing.forEach(function(item) {\n\t\t\t// \titem.set(\"excluded\", false);\n\t\t\t// });\n\t\t}\n\t\t// console.log(\"%s::renderFilterFn\", this.cid, newItems);\n\t\tthis._filteredItems = newItems;\n\t},\n\n\tapplyFilter: function() {\n\t\t// this.itemViews.forEach(function(view) {\n\t\t// \tview.el.classList.toggle(\"excluded\", view.model.get(\"excluded\"));\n\t\t// });\n\t\tthis._filteredIncoming.forEach(function(item) {\n\t\t\tthis.itemViews.findByModel(item).el.classList.add(\"excluded\");\n\t\t\titem.set(\"excluded\", true);\n\t\t}, this);\n\t\tthis._filteredOutgoing.forEach(function(item) {\n\t\t\tthis.itemViews.findByModel(item).el.classList.remove(\"excluded\");\n\t\t\titem.set(\"excluded\", false);\n\t\t}, this);\n\n\t\tthis.el.classList.toggle(\"has-excluded\", this.filteredItems.length > 0);\n\t},\n\n\t/* --------------------------- *\n\t/* Filter impl 1\n\t/* --------------------------- */\n\n\t/*\n\tcomputeFilter_1: function() {\n\t\tvar items = this._filterFn ? this.collection.filter(this._filterFn, this) : this._getAllItems();\n\t\tthis.renderFilters(items, this._filteredItems);\n\t\tthis._filteredItems = items;\n\t},\n\n\trenderFilters: function(newItems, oldItems) {\n\t\tvar hasNew = !!(newItems && newItems.length);\n\t\tvar hasOld = !!(oldItems && oldItems.length);\n\t\tvar inExcl = [];\n\t\tvar outExcl = [];\n\n\t\t// console.log(\"%s::renderFilterFn\", this.cid, newItems);\n\t\t// NOTE: diff third arg is destination array\n\t\tif (hasNew) {\n\t\t\tdiff((hasOld ? oldItems : this._getAllItems()), newItems, inExcl)\n\t\t\t// .forEach(function(item) {\n\t\t\t// \tthis.itemViews.findByModel(item).el.classList.add(\"excluded\");\n\t\t\t// \titem.set(\"excluded\", true);\n\t\t\t// }, this);\n\t\t}\n\t\tif (hasOld) {\n\t\t\tdiff((hasNew ? newItems : this._getAllItems()), oldItems, outExcl)\n\t\t\t// .forEach(function(item) {\n\t\t\t// \tthis.itemViews.findByModel(item).el.classList.remove(\"excluded\");\n\t\t\t// \titem.set(\"excluded\", false);\n\t\t\t// }, this);\n\t\t}\n\t\tthis._filteredIncoming = inExcl;\n\t\tthis._filteredOutgoing = outExcl;\n\t\t// this.el.classList.toggle(\"has-excluded\", hasNew);\n\t\t// this.applyFilter();\n\t},\n\t*/\n\n\t// computeFiltered: function() {\n\t// \tthis._filterResult = this.collection.map(this._filterFn, this);\n\t// },\n\t//\n\t// renderFiltered: function() {\n\t// \tthis.collection.forEach(function(item, index) {\n\t// \t\tthis.itemViews.findByModel(item).el.classList.toggle(\"excluded\", !this._filterResult[index]);\n\t// \t}, this);\n\t// },\n\n});\n\nif (DEBUG) {\n\tFilterableListView.prototype._logFlags = [\n\t\t\"view.render\",\n\t\t// \"view.trace\"\n\t].join(\" \");\n\n\tFilterableListView.prototype._printStats = function(lastFilteredItems) {\n\t\tif (this._logFlags[\"view.trace\"]) console.log(\"%s::renderFrame %s filtered:%o(=%o)/%o (changed:%o, in:%o, out:%o)\", this.cid,\n\t\t\tthis.filteredItems.length > 0 ? \"has\" : \"has not\",\n\t\t\tthis.filteredItems.length,\n\t\t\tlastFilteredItems ? (this.filteredItems.length + this._filteredIncoming.length) - this._filteredOutgoing.length : this.filteredItems.length,\n\t\t\tthis.collection.length,\n\t\t\t(this._filteredIncoming.length + this._filteredOutgoing.length),\n\t\t\tthis._filteredIncoming.length,\n\t\t\tthis._filteredOutgoing.length);\n\t};\n}\n\nmodule.exports = FilterableListView;\n",
    "/**\n * @module app/view/component/GraphView\n */\n\n/** @type {Function} */\nconst Color = require(\"color\");\n\n/** @type {module:app/view/base/CanvasView} */\nconst CanvasView = require(\"app/view/base/CanvasView\");\n\n/** @type {module:app/control/Globals} */\nconst Globals = require(\"app/control/Globals\");\n\n/** @type {module:utils/canvas/calcArcHConnector} */\nconst calcArcHConnector = require(\"utils/canvas/calcArcHConnector\");\n\n/** @type {module:utils/canvas/CanvasHelper} */\nconst CanvasHelper = require(\"utils/canvas/CanvasHelper\");\n\n/** @type {module:utils/geom/inflateRect} */\nconst inflateRect = require(\"utils/geom/inflateRect\");\n\n// /** @type {module:utils/dom/getAbsoluteClientRect} */\n// var getAbsoluteClientRect = require(\"utils/dom/getAbsoluteClientRect\");\n\n\n// var BEZIER_CIRCLE = 0.551915024494;\n// var MIN_CANVAS_RATIO = 2;\n// var PI2 = Math.PI * 2;\n\nvar styleBase = {\n\tlineCap: \"butt\", // round, butt, square\n\tlineWidth: 0.75,\n\tlineDashOffset: 0,\n\tsetLineDash: [[]],\n\t// radiusBase: 2,\n\t// /* factored to rem unit */ //6,\n\t// radiusIncrement: 0.21, //3, //0.25,\n\t// /* uses lineWidth multiplier */\n\t// outlineWidth: 3,\n\t// /* uses lineWidth multiplier */\n\t// arrowSize: 0.3,\n};\nvar paramsBase = {\n\tradiusBase: 1.25,\n\t/* factored to rem unit */ //6,\n\tradiusIncrement: 0.21, //3, //0.25,\n\t/* uses lineWidth multiplier */\n\toutlineWidth: 3,\n\t/* factored to rem unit */\n\tarrowSize: 0.4, //0.3,\n};\n\n// var overlayStyleBase = {\n// \tglobalAlpha: 0.75,\n// \tglobalCompositeOperation: \"destination-out\",\n// \tlineWidth: 4,\n// \tlineJoin: \"round\",\n// \ttextBaseline: \"top\",\n// \ttextAlign: \"left\",\n// };\n\nif (DEBUG) {\n\t/* eslint-disable no-unused-vars */\n\tvar _dStyles = {\n\t\tdefaults: {\n\t\t\tglobalAlpha: 0.66,\n\t\t\tlineWidth: 0,\n\t\t\tfillStyle: \"transparent\",\n\t\t\tstrokeStyle: \"transparent\",\n\t\t\tlineDashOffset: 0,\n\t\t\tsetLineDash: [[]]\n\t\t}\n\t};\n\n\t/* Stroke */\n\t[\n\t\t\"red\", \"salmon\", \"sienna\",\n\t\t\"green\", \"yellowgreen\", \"olive\",\n\t\t\"blue\", \"lightskyblue\", \"midnightblue\",\n\t\t\"grey\", \"silver\"\n\t]\n\t.forEach(function(colorName) {\n\t\tvar rgbaValue = Color(colorName).alpha(0.75).string();\n\n\t\t_dStyles[colorName] = _.defaults({\n\t\t\tlineWidth: 0.75,\n\t\t\tstrokeStyle: rgbaValue,\n\t\t}, _dStyles[\"defaults\"]);\n\n\t\t_dStyles[colorName + \"_dashed\"] = _.defaults({\n\t\t\tsetLineDash: [[4, 2]],\n\t\t\tstrokeStyle: rgbaValue,\n\t\t}, _dStyles[\"defaults\"]);\n\n\t\t_dStyles[colorName + \"_thick\"] = _.defaults({\n\t\t\tlineWidth: 5,\n\t\t\tstrokeStyle: rgbaValue,\n\t\t}, _dStyles[\"defaults\"]);\n\n\t\t_dStyles[colorName + \"_fill\"] = _.defaults({\n\t\t\tfillStyle: rgbaValue\n\t\t}, _dStyles[\"defaults\"]);\n\t})\n\t/* eslint-enable no-unused-vars */\n}\n\nvar getRectDirX = function(r1, r2) {\n\tif (r1.right < r2.left) {\n\t\treturn 1;\n\t}\n\tif (r2.right < r1.left) {\n\t\treturn -1;\n\t}\n\treturn 0;\n};\n\n/**\n * @constructor\n * @type {module:app/view/component/GraphView}\n */\nvar GraphView = CanvasView.extend({\n\n\t/** @type {string} */\n\tcidPrefix: \"graph\",\n\t/** @override */\n\ttagName: \"canvas\",\n\t/** @override */\n\tclassName: \"graph\",\n\n\tdefaultKey: \"a2b\",\n\n\tdefaults: {\n\t\tvalues: {\n\t\t\ta2b: 0,\n\t\t\tb2a: 0,\n\t\t},\n\t\tmaxValues: {\n\t\t\ta2b: 1,\n\t\t\tb2a: 1,\n\t\t},\n\t\t// useOpaque: true,\n\t\t// labelFn: function(value, max) {\n\t\t// \treturn ((value / max) * 100) | 0;\n\t\t// },\n\t},\n\n\t/** @override */\n\tinitialize: function(options) {\n\t\tCanvasView.prototype.initialize.apply(this, arguments);\n\n\t\tthis._listA = options.listA;\n\t\tthis._listB = options.listB;\n\t\tthis._a2b = {\n\t\t\tsrcView: options.listA,\n\t\t\tdestView: options.listB,\n\t\t\ts: _.defaults({\n\t\t\t\tlineWidth: 0.7, //1.25\n\t\t\t\t// radiusIncrement: 0.25,\n\t\t\t}, styleBase, paramsBase),\n\t\t\tp: _.defaults({}, paramsBase),\n\t\t\tstrokeStyleFn: (fg, bg, ln) => Color(ln).mix(bg, 0.1).hex()\n\t\t};\n\t\tthis._b2a = {\n\t\t\tsrcView: options.listB,\n\t\t\tdestView: options.listA,\n\t\t\ts: _.defaults({\n\t\t\t\tlineWidth: 0.7,\n\t\t\t\t// arrowSize: 0.25,\n\t\t\t\t// radiusIncrement: 0,\n\t\t\t\t// outlineWidth: 0,\n\t\t\t}, styleBase, paramsBase),\n\t\t\tp: _.defaults({}, paramsBase),\n\t\t\tstrokeStyleFn: (fg, bg, ln) => Color(fg).mix(bg, 0.4).hex()\n\t\t};\n\n\t\t// this.listenTo(this._a2b.srcView.collection, \"view:select:one view:select:none\", function(item) {\n\t\t// \tthis._a2b.connectorsOut = this._a2b.connectors;\n\t\t// \tthis._a2b.connectors = null;\n\t\t// });\n\t\t//\n\t\t// this.listenTo(this._b2a.srcView.collection, \"view:select:one view:select:none\", function(item) {\n\t\t// \tthis._b2a.connectorsOut = this._b2a.connectors;\n\t\t// \tthis._b2a.connectors = null;\n\t\t// });\n\n\t\t// this.listenTo(this, \"view:render:before\", this._beforeViewRender);\n\n\t\t// this._traceScroll = _.debounce(this.__raceScroll, 100, false);\n\n\t\t// var viewportChanged = function(ev) {\n\t\t// \tconsole.log(\"%s:[%s]\", this.cid, ev.type);\n\t\t//\n\t\t// \t// this._traceScroll(ev.type);\n\t\t// \t// this._labelOverlays = null;\n\t\t// \tthis.invalidate(CanvasView.LAYOUT_INVALID | CanvasView.SIZE_INVALID);\n\t\t// \t// this.requestRender(CanvasView.LAYOUT_INVALID | CanvasView.SIZE_INVALID);\n\t\t// \t// this.requestRender().renderNow();\n\t\t// }.bind(this);\n\t\t// viewportChanged = _.debounce(viewportChanged, 60, false);\n\n\t\t// window.addEventListener(\"scroll\",\n\t\t// \t\t_.debounce(viewportChanged, 100, false), false);\n\t\t// window.addEventListener(\"wheel\",\n\t\t// \t_.debounce(viewportChanged, 100, false), false);\n\t\t// window.addEventListener(\"scroll\", viewportChanged, false);\n\t\t// window.addEventListener(\"wheel\", viewportChanged, false);\n\t\t// window.addEventListener(\"resize\", viewportChanged, false);\n\t\t// window.addEventListener(\"orientationchange\", viewportChanged, false);\n\n\t\t// this._addListListeners(this._a2b);\n\t\t// this._addListListeners(this._b2a);\n\t},\n\n\t/** @override */\n\tmeasureCanvas: function(w, h, s) {\n\t\tconsole.log(\"%s::measureCanvas style:%o scroll:%o offset:%o client:%o arg:%o\", this.cid, s.height, this.el.offsetHeight, this.el.scrollHeight, this.el.clientHeight, h);\n\t},\n\n\t/** @override */\n\tupdateCanvas: function() {\n\t\tthis._updateMetrics();\n\t\tthis._updateStyles();\n\t},\n\n\t/* --------------------------- *\n\t/* styles\n\t/* --------------------------- */\n\n\t_updateStyles: function() {\n\t\tvar b, bgColor, lnColor;\n\t\tif (this.model.has(\"bundle\")) {\n\t\t\tb = this.model.get(\"bundle\");\n\t\t\tlnColor = Color(b.colors.lnColor); //.clone();\n\t\t\tbgColor = Color(b.colors.bgColor); //.clone();\n\t\t} else {\n\t\t\tbgColor = Color(Globals.DEFAULT_COLORS[\"background-color\"]);\n\t\t\tlnColor = Color(Globals.DEFAULT_COLORS[\"link-color\"]);\n\t\t}\n\n\t\tthis._a2b.s.strokeStyle = this._a2b.s.fillStyle =\n\t\t\tthis._a2b.strokeStyleFn(this._color, bgColor, lnColor);\n\t\tthis._b2a.s.strokeStyle = this._b2a.s.fillStyle =\n\t\t\tthis._b2a.strokeStyleFn(this._color, bgColor, lnColor);\n\n\t\tif (DEBUG) {\n\t\t\tthis._debugBlocks = this.el.matches(\".debug-blocks .\" + this.className);\n\t\t\tthis._debugGraph = this.el.matches(\".debug-graph .\" + this.className);\n\t\t}\n\t},\n\n\t_setStyle: function(s) {\n\t\tif (typeof s == \"string\") {\n\t\t\ts = this._styleData[s];\n\t\t}\n\t\tCanvasView.setStyle(this._ctx, s);\n\t},\n\n\t/* --------------------------- *\n\t/* metrics\n\t/* --------------------------- */\n\n\t_updateMetrics: function() {\n\t\tvar bounds;\n\n\t\tthis._rootFontSize = parseFloat(\n\t\t\tgetComputedStyle(document.documentElement).fontSize);\n\n\t\tbounds = this.el.getBoundingClientRect();\n\t\t// bounds = getAbsoluteClientRect(this.el);\n\t\tthis._ctx.setTransform(this._canvasRatio, 0, 0, this._canvasRatio,\n\t\t\t(-(bounds.left + window.pageXOffset) * this._canvasRatio) - 0.5,\n\t\t\t(-(bounds.top + window.pageYOffset) * this._canvasRatio) - 0.5\n\t\t);\n\n\t\tvar i, ii, els;\n\t\tvar srcRect, destRect;\n\t\tvar srcMin, destMin;\n\n\t\tsrcRect = this._a2b.srcView.el.getBoundingClientRect();\n\t\tdestRect = this._a2b.destView.el.getBoundingClientRect();\n\t\tthis._a2b.qx = getRectDirX(srcRect, destRect);\n\n\t\tels = this._listA.el.querySelectorAll(\".label\");\n\t\tsrcMin = srcRect.left + window.pageXOffset;\n\t\tfor (i = 0, ii = els.length; i < ii; i++) {\n\t\t\tsrcMin = Math.max(srcMin,\n\t\t\t\tels[i].getBoundingClientRect().right + window.pageXOffset);\n\t\t}\n\t\tthis._a2b.xMin = srcMin;\n\n\t\tels = this._listB.el.querySelectorAll(\".label\");\n\t\tdestMin = destRect.left + window.pageXOffset;\n\t\tfor (i = 0, ii = els.length; i < ii; i++) {\n\t\t\tdestMin = Math.min(destMin,\n\t\t\t\tels[i].getBoundingClientRect().left + window.pageXOffset);\n\t\t}\n\t\tthis._a2b.destMinX = destMin;\n\n\t\tthis._b2a.qx = -this._a2b.qx;\n\t\tthis._b2a.xMin = this._a2b.destMinX;\n\t\tthis._b2a.destMinX = this._a2b.xMin;\n\n\t\t// var s = getComputedStyle(document.documentElement);\n\t\t// this._rootFontSize = parseFloat(s.fontSize); // * this._canvasRatio;\n\t\t// console.log(\"%s::_updateMetrics _rootFontSize: %s %o\", this.cid, this._rootFontSize, s);\n\n\t\t// var c = Math.abs(sData.xMin - dData.xMin) / 6;\n\t\t// sMin = sData.xMin + c * qx;\n\t\t// dMin = dData.xMin - c * qx;\n\n\t\t// this._a2b.targets = this._measureListItems(listView);\n\t\t// this._b2a.targets = this._measureListItems(listView);\n\n\t\t// // connector minimum branch x2\n\t\t// listView = this._listB;\n\t\t// for (i = 0, ii = listView.groups.length; i < ii; i++) {\n\t\t// \titemView = listView.itemViews.findByModel(listView.groups[i]);\n\t\t// \titemRect = (itemView.label || itemView.el).getBoundingClientRect();\n\t\t// \tthis._b2a.xMin = Math.min(this._b2a.xMin, itemRect.left);\n\t\t// \t// if (itemView._metrics) this._b2a.rect.left + itemView.transform.tx + itemView._metrics.textLeft;\n\t\t// }\n\t},\n\n\t/* --------------------------- *\n\t/* redraw\n\t/* --------------------------- */\n\n\tredraw: function(ctx, interp, flags) {\n\t\tthis._clearCanvas(0, 0, this._canvasWidth, this._canvasHeight);\n\t\tctx.save();\n\t\tthis._redraw_fromElements(ctx, interp, flags);\n\t\t// this._redraw_fromViews(ctx, interp);\n\t\tctx.restore();\n\t},\n\n\t_redraw_fromElements: function(ctx, interp, flags) {\n\t\t// b2a: keyword to bundles, right to left\n\t\t// a2b: bundle to keywords, left to right\n\t\tif (flags & (CanvasView.SIZE_INVALID | CanvasView.MODEL_INVALID)) {\n\t\t\tconsole.log(\"%s::redraw [valuesChanged: %s] [flags: %s]\", this.cid, interp.valuesChanged, CanvasView.flagsToString(flags));\n\t\t\tthis._a2b.connectorsOut = this._a2b.connectors;\n\t\t\tthis._b2a.connectorsOut = this._b2a.connectors;\n\t\t\tthis._b2a.connectors = this._computeConnectors(this._b2a);\n\t\t\tthis._a2b.connectors = this._computeConnectors(this._a2b);\n\t\t\tthis._labelOverlays = this._computeLabelOverlays(this._listB);\n\t\t}\n\n\t\t/* line dash value interpolation */\n\t\tvar b2aVal, a2bVal;\n\t\tb2aVal = interp.getRenderedValue(\"b2a\") / interp.getOption(\"b2a\", \"max\"); //_valueData[\"b2a\"]._maxVal;\n\t\t// b2aVal = interp._valueData[\"b2a\"]._renderedValue / interp._valueData[\"b2a\"]._maxVal;\n\t\ta2bVal = interp.getRenderedValue(\"a2b\") / interp.getOption(\"a2b\", \"max\"); //interp._valueData[\"a2b\"]._maxVal;\n\t\t// a2bVal = interp._valueData[\"a2b\"]._renderedValue / interp._valueData[\"a2b\"]._maxVal;\n\n\t\t/* draw */\n\t\tthis._drawConnectors(this._b2a.connectors, this._b2a.s, b2aVal, 1);\n\t\tthis._drawConnectors(this._b2a.connectorsOut, this._b2a.s, 1 - b2aVal, 1);\n\t\tthis._drawConnectors(this._a2b.connectors, this._a2b.s, a2bVal, 2);\n\t\t// this._drawConnectors(this._a2b.connectorsOut, this._a2b.s, 1 - a2bVal, 2);\n\t\tthis._drawLabelOverlays(this._labelOverlays);\n\t},\n\n\t/* --------------------------- *\n\t * label overlays\n\t * --------------------------- */\n\n\t_computeLabelOverlays: function(list) {\n\t\tvar data = { rects: [] };\n\t\tvar els = list.el.querySelectorAll(\".list-group .label span\");\n\n\t\tvar i, ii, r;\n\t\tfor (i = 0, ii = els.length; i < ii; i++) {\n\t\t\t// r = inflateRect(els[i].getBoundingClientRect(), 0, 0);\n\t\t\tr = _.clone(els[i].getBoundingClientRect());\n\t\t\tr.top += window.pageYOffset; // - 0.5;\n\t\t\tr.left += window.pageXOffset; // - 0.5;\n\t\t\t// r.innerText = els[i].innerText;\n\t\t\tdata.rects[i] = r;\n\t\t}\n\t\t// data.cssStyle = getComputedStyle(els[0]);\n\t\t// data.boxStyle = getBoxEdgeStyles(overlayData.cssStyle);\n\t\t// data.ctxStyle = {\n\t\t// \tfont: [s.fontWeight, s.fontStyle, s.fontSize + \"/\" + s.lineHeight, s.fontFamily].join(\" \")\n\t\t// };\n\t\treturn data;\n\t},\n\n\t_drawLabelOverlays: function(data) {\n\t\tthis._ctx.save();\n\t\t// CanvasView.setStyle(this._ctx, s);\n\t\tthis._ctx.globalAlpha = 0.85;\n\t\tthis._ctx.globalCompositeOperation = \"destination-out\";\n\t\t// this._ctx.canvas.style.letterSpacing = overlayData.cssStyle.letterSpacing;\n\n\t\tdata.rects.forEach(function(r) {\n\t\t\t// this._ctx.clearRect(r.left, r.top, r.width, r.height);\n\t\t\tthis._ctx.fillRect(r.left, r.top, r.width, r.height);\n\t\t\t// this._ctx.strokeText(r.innerText, r.left, r.top);\n\t\t}, this);\n\t\tthis._ctx.restore();\n\n\t\tif (DEBUG) {\n\t\t\tif (this._debugGraph || this._debugBlocks) {\n\t\t\t\tdata.rects.forEach(function(r) {\n\t\t\t\t\tr = inflateRect(r, 0, 0);\n\t\t\t\t\tCanvasHelper.drawRect(this._ctx, _dStyles[\"silver_dashed\"],\n\t\t\t\t\t\tr.left, r.top, r.width, r.height);\n\t\t\t\t}, this);\n\t\t\t}\n\t\t}\n\t},\n\n\t/* --------------------------- *\n\t * connectors\n\t * --------------------------- */\n\n\t_computeConnectors: function(d) {\n\t\tvar sMin = d.xMin;\n\t\tvar dMin = d.destMinX;\n\t\tvar qx = d.qx;\n\n\t\tvar rBase, rInc;\n\t\trBase = this._roundTo(d.s.radiusBase * this._rootFontSize, 0.5);\n\t\trInc = this._roundTo(d.s.radiusIncrement * this._rootFontSize, 0.5);\n\n\t\t// var root = {};\n\t\tvar i, p, ddNum, connectors = [];\n\t\tvar x1, y1, tx;\n\n\t\tvar sView, ddView, ddItems;\n\t\tif (d.srcView.collection.selected && d.destView.filteredItems) {\n\t\t\tsView = d.srcView.itemViews.findByModel(d.srcView.collection.selected);\n\n\t\t\tvar rect = sView.label.getBoundingClientRect();\n\t\t\tx1 = rect.left;\n\t\t\ty1 = rect.top + rect.height / 2;\n\t\t\tif (qx > 0) x1 += rect.width;\n\t\t\tx1 += window.pageXOffset;\n\t\t\ty1 += window.pageYOffset;\n\n\t\t\t// if (!sView._metrics) return;\n\t\t\t// x1 = d.rect.left + sView.transform.tx\n\t\t\t// \t+ sView._metrics.textLeft;\n\t\t\t// y1 = d.rect.top + sView.transform.ty\n\t\t\t// \t+ sView._metrics.offsetHeight / 2;\n\t\t\t// if (qx > 0) x1 += sView._metrics.textWidth;\n\n\t\t\tddItems = d.destView.filteredItems;\n\t\t\tddNum = d.destView.filteredItems.length;\n\n\t\t\tfor (i = 0; i < ddNum; i++) {\n\t\t\t\tp = {};\n\t\t\t\tddView = d.destView.itemViews.findByModel(ddItems[i]);\n\n\t\t\t\trect = ddView.label.getBoundingClientRect();\n\t\t\t\tp.x2 = rect.left;\n\t\t\t\tp.y2 = rect.top + rect.height / 2;\n\t\t\t\tif (qx < 0) p.x2 += rect.width;\n\t\t\t\tp.x2 += window.pageXOffset;\n\t\t\t\tp.y2 += window.pageYOffset;\n\n\t\t\t\t// p.x2 = d.destRect.left + ddView.transform.tx\n\t\t\t\t// \t+ ddView._metrics.textLeft;\n\t\t\t\t// p.y2 = d.destRect.top + ddView.transform.ty\n\t\t\t\t// \t+ ddView._metrics.offsetHeight / 2;\n\t\t\t\t// if (qx < 0) p.x2 += ddView._metrics.textWidth;\n\n\t\t\t\tp.x1 = x1;\n\t\t\t\tp.y1 = y1;\n\t\t\t\tp.qx = qx;\n\t\t\t\tconnectors[i] = p;\n\t\t\t}\n\t\t\tconnectors.sort((a, b) => a.y2 - b.y2);\n\t\t\t// ssEl's number of items above in the Y axis\n\t\t\tvar si = 0;\n\t\t\t// Node first arc (r0) max radius (cx0)\n\t\t\t// They are centered to the label, so halve it\n\t\t\tvar rMax0 = ddNum * rInc * 0.5;\n\t\t\t// cy1 offset from y1\n\t\t\tvar a;\n\n\t\t\t// First pass, calc first radius (r0, at the source of the connector),\n\t\t\t// and the amount of dest connectors vertically closer to the source (di)\n\t\t\tfor (i = 0; i < ddNum; i++) {\n\t\t\t\tp = connectors[i];\n\n\t\t\t\ta = (i - (ddNum - 1) / 2) * rInc;\n\t\t\t\tp.cy1 = p.y1 + a;\n\t\t\t\tp.cy2 = p.y2;\n\t\t\t\tp.r0 = Math.abs(a);\n\t\t\t\tp.cx0 = p.x1 + (rMax0 - p.r0) * qx;\n\n\t\t\t\t// If src (cy1) is above dest (y2), decrease index diff (di)\n\t\t\t\tp.di = ((p.cy1 - p.y2) > 0) ? i : ddNum - (i + 1);\n\t\t\t\tsi = Math.max(si, p.di);\n\n\t\t\t\t// p.dx = x1 - p.x2;\n\t\t\t\t// p.dy = y1 - p.y2;\n\t\t\t}\n\n\t\t\t// Calc max radius that fits sMin to dMin:\n\t\t\t// from space btw sMin to dMin, remove first arc and max arc increase,\n\t\t\t// then halve (there's two arcs left)\n\t\t\tvar rBaseMax = (Math.abs(dMin - sMin) - (rMax0 + (si * rInc))) / 2;\n\t\t\t// Ensure 0 > rBase > rBaseMax\n\t\t\trBase = Math.max(0, Math.min(rBase, rBaseMax));\n\t\t\t// console.log(\"%s::_computeConnectors 1rem = %spx rBase:%s rBaseMax:%s\", this.cid, this._rootFontSize, rBase, rBaseMax);\n\n\t\t\tfor (i = 0; i < ddNum; i++) {\n\t\t\t\tp = connectors[i];\n\t\t\t\tp.r1 = p.di * rInc + rBase;\n\t\t\t\tp.r2 = rBase;\n\n\t\t\t\t// p.r1 = p.di * rInc + rBase;\n\t\t\t\t// p.r2 = (si - p.di) * rInc + rBase;\n\n\t\t\t\tp.cx1 = sMin + (rMax0 * qx);\n\t\t\t\tp.cx2 = dMin - ((si - p.di) * rInc) * qx;\n\t\t\t\t//\n\t\t\t\t// p.cx1 = sMin + (rMax0 * qx);\n\t\t\t\t// p.cx2 = dMin;\n\n\t\t\t\ttx = calcArcHConnector(p.cx1, p.cy1, p.r1, p.cx2, p.cy2, p.r2, 0.7);\n\t\t\t\tif (tx) {\n\t\t\t\t\tp.tx1 = tx[0];\n\t\t\t\t\tp.tx2 = tx[1];\n\t\t\t\t} else {\n\t\t\t\t\tp.tx1 = p.cx1;\n\t\t\t\t\tp.tx2 = p.cx2;\n\t\t\t\t}\n\t\t\t\tp.length = Math.abs(p.x1 - p.x2) + Math.abs(p.cy1 - p.cy2);\n\n\t\t\t\t// Find out longest node connection for setLineDash\n\t\t\t\t// root.maxLength = Math.max(root.maxLength, p.length);\n\t\t\t}\n\t\t\tconnectors.sort((a, b) =>\n\t\t\t\ta.di - b.di // Sort by index distance to from source point\n\t\t\t\t// a.r0 - b.r0 // Sort by first arc (centered)\n\t\t\t\t// (a.r1 + a.r2) - (b.r1 + b.r2)\n\t\t\t\t// a.tx2 - b.tx2\n\t\t\t);\n\n\t\t\tconnectors.si = si;\n\t\t\tconnectors.qx = qx;\n\t\t\tconnectors.sMin = sMin;\n\t\t\tconnectors.dMin = dMin;\n\t\t\t// root.x = x1;\n\t\t\t// root.y = y1;\n\t\t\t// root.qx = qx;\n\t\t\t// root.r0 = si * rInc;\n\t\t}\n\t\t// d.connectors = connectors;\n\t\t// d.root = root;\n\t\t// return d;\n\t\treturn connectors;\n\t},\n\n\t_drawConnectors: function(pp, s, lVal, dir) {\n\t\tvar i, ii, p;\n\t\tvar ow, ra1, ra2, ta;\n\n\t\tif (!(pp && pp.length && lVal)) return;\n\n\t\tii = pp.length;\n\n\t\t/* outline width */\n\t\tow = s.lineWidth + s.outlineWidth;\n\t\t// ow = Math.min(\n\t\t// \tthis._roundTo(s.radiusIncrement * this._rootFontSize, 0.5),\n\t\t// \tthis._roundTo(s.lineWidth * (1 + s.outlineWidth), 0.5)\n\t\t// );\n\n\t\t/* arrow radiuses, direction */\n\t\t// ra1 = (s.radiusIncrement * this._rootFontSize) + s.lineWidth;\n\t\tra1 = s.arrowSize * this._rootFontSize;\n\t\tra2 = ra1 + (ow - s.lineWidth);\n\t\tta = Math.PI * dir;\n\t\t// dir -= 2;\n\n\t\tthis._setStyle(s);\n\n\t\t// if (lVal < 1) {\n\t\t// \tthis._ctx.lineDashOffset = lMax * (1 + lVal);\n\t\t// \tthis._ctx.setLineDash([lMax, lMax])\n\t\t// \t// this._ctx.lineDashOffset = lMax * (1 + lVal);;\n\t\t// \t// this._ctx.setLineDash([lMax * (1 - lVal), lMax]);\n\t\t// }\n\n\t\t// for (i = 0; i < ii; i++) {\n\t\t// p = pp[i];\n\t\tif (s.outlineWidth) {\n\t\t\tthis._ctx.save();\n\t\t\tthis._ctx.globalCompositeOperation = \"destination-out\";\n\t\t\tthis._ctx.lineWidth = ow;\n\t\t\tfor (i = 0; i < ii; i++) {\n\t\t\t\tp = pp[i];\n\n\t\t\t\tif (lVal < 1) {\n\t\t\t\t\tthis._ctx.lineDashOffset = p.length * (1 + lVal);\n\t\t\t\t\tthis._ctx.setLineDash([p.length, p.length])\n\t\t\t\t}\n\t\t\t\tthis._drawConnector(p, i, pp);\n\t\t\t\tif (lVal == 1) {\n\t\t\t\t\tthis._drawArrowhead(p.x2, p.y2, ra2, dir * ta);\n\t\t\t\t}\n\t\t\t}\n\t\t\tthis._ctx.restore();\n\t\t}\n\n\t\tfor (i = 0; i < ii; i++) {\n\t\t\tp = pp[i];\n\t\t\tif (lVal < 1) {\n\t\t\t\tthis._ctx.lineDashOffset = p.length * (1 + lVal);\n\t\t\t\tthis._ctx.setLineDash([p.length, p.length])\n\t\t\t}\n\t\t\tthis._drawConnector(p, i, pp);\n\t\t\tif (lVal == 1) {\n\t\t\t\tthis._drawArrowhead(p.x2, p.y2, ra1, dir * ta);\n\t\t\t}\n\t\t}\n\t},\n\n\t_drawArrowhead: function(x, y, r, t) {\n\t\t// this._ctx.save();\n\t\t// this._ctx.lineDashOffset = 0;\n\t\t// this._ctx.setLineDash([]);\n\t\tCanvasHelper.arrowhead2(this._ctx, x, y, r, t);\n\t\tthis._ctx.stroke();\n\t\t// this._ctx.restore();\n\t},\n\n\t_drawArrowhead2: function(x, y, r, t) {\n\t\tCanvasHelper.arrowhead(this._ctx, x, y, r, t);\n\t\tthis._ctx.fill();\n\t},\n\n\t// _drawArrowheadH: function(x, y, r, a) {\n\t// \tthis._ctx.save();\n\t// \tthis._ctx.lineDashOffset = 0;\n\t// \tthis._ctx.setLineDash([]);\n\t// \tthis._ctx.beginPath();\n\t// \tthis._ctx.moveTo(x + r * 1 / dir, y - r);\n\t// \tthis._ctx.lineTo(x, y);\n\t// \tthis._ctx.lineTo(x + r * 1 / dir, y + r);\n\t// \tthis._ctx.stroke();\n\t// \tthis._ctx.restore();\n\t// },\n\n\t_drawConnector: function(p, i, pp) {\n\t\tthis._ctx.beginPath();\n\t\tthis._ctx.moveTo(p.x2, p.cy2);\n\t\tthis._ctx.arcTo(p.tx2, p.cy2, p.tx1, p.cy1, p.r2);\n\t\tthis._ctx.arcTo(p.tx1, p.cy1, p.cx1, p.cy1, p.r1);\n\t\tthis._ctx.arcTo(p.cx0, p.cy1, p.cx0, p.y1, p.r0);\n\n\t\t// p.cx00 = p.x1 + ((p.r0 + p.di) * p.qx);\n\t\t// p.cy00 = (p.cy1 + p.y1) / 2;\n\t\t// this._ctx.arcTo(p.cx00, p.cy1, p.cx00, p.cy00, p.r0 / 2);\n\t\t// this._ctx.arcTo(p.cx00, p.y1, p.x1, p.y1, p.r0 / 2);\n\t\t// this._ctx.lineTo(p.x1, p.y1);\n\n\t\t// p.cx00 = p.x1 + (p.r0 * p.qx * 2);\n\t\t// this._ctx.lineTo(p.cx00, p.cy1);\n\t\t// this._ctx.quadraticCurveTo(p.cx0, p.cy1, p.cx0, p.y1);\n\n\t\t// this._ctx.lineTo(p.cx0, p.y1);\n\t\tthis._ctx.stroke();\n\t},\n\n\t_roundTo: function(n, p) {\n\t\tif (p > 1) p = 1 / p;\n\t\treturn Math.round(n / p) * p;\n\t},\n\n\t/*\n\t_computeConnectors: function(d) {\n\t\tvar rBase = d.s.radiusBase;\n\t\tvar rInc = d.s.radiusIncrement;\n\t\tvar sMin = d.xMin;\n\t\tvar dMin = d.destMinX;\n\n\t\tvar lMax = 0;\n\t\tvar p, connectors = [];\n\t\tvar qx, x1, y1, tx;\n\t\tvar si; // ssEl's number of items above in the Y axis\n\n\t\tif (d.rect.right < d.destRect.left) {\n\t\t\tqx = 1;\n\t\t} else if (d.destRect.right < d.rect.left) {\n\t\t\tqx = -1;\n\t\t} else {\n\t\t\tqx = 0;\n\t\t}\n\n\t\tvar ssEl, ddEls, ddNum, ssRect, ddRect, i;\n\t\tssEl = d.srcView.el.querySelector(\".list-item.selected .label\");\n\t\tif (ssEl) {\n\t\t\tssRect = ssEl.getBoundingClientRect();\n\t\t\tx1 = ssRect.left;\n\t\t\tif (qx > 0) x1 += ssRect.width;\n\t\t\ty1 = ssRect.top + ssRect.height / 2;\n\t\t\t// r2 = rBase;\n\t\t\t// cx1 = d.xMin;\n\n\t\t\tsi = 0;\n\t\t\tddEls = d.destView.el.querySelectorAll(\".list-item:not(.excluded) .label\");\n\t\t\tddNum = ddEls.length;\n\t\t\t// dx = Math.abs(d.xMin - dData.xMin);\n\n\t\t\tfor (i = 0; i < ddNum; i++) {\n\t\t\t\tp = {};\n\t\t\t\tddRect = ddEls[i].getBoundingClientRect();\n\t\t\t\tp.x2 = ddRect.left;\n\t\t\t\tif (qx < 0) p.x2 += ddRect.width;\n\t\t\t\tp.y2 = ddRect.top + ddRect.height / 2;\n\t\t\t\tp.x1 = x1;\n\t\t\t\tp.y1 = y1;\n\t\t\t\tp.dx = p.x1 - p.x2;\n\t\t\t\tp.dy = p.y1 - p.y2;\n\t\t\t\tp.qx = qx;\n\t\t\t\tp.qy = Math.sign(p.dy);\n\t\t\t\t// p.dLength = Math.abs(p.x) + Math.abs(p.y);\n\t\t\t\tp.di = p.dy > 0 ? i : ddNum - (i + 1);\n\t\t\t\tsi = Math.max(si, p.di);\n\t\t\t\tconnectors[i] = p;\n\t\t\t}\n\n\t\t\tvar a, rMax0 = ddNum * 0.5 * rInc;\n\t\t\tfor (i = 0; i < ddNum; i++) {\n\t\t\t\tp = connectors[i];\n\t\t\t\tp.r1 = p.di * rInc + rBase;\n\t\t\t\tp.r2 = rBase;\n\t\t\t\t// p.r2 = (si - p.di) * rInc + rBase;\n\n\t\t\t\tp.cx1 = sMin;\n\t\t\t\tp.cx2 = dMin - ((si - p.di) * rInc) * qx;\n\t\t\t\t// p.cx2 = dMin;\n\n\t\t\t\ta = (i - (ddNum - 1) / 2) * rInc;\n\t\t\t\tp.cy1 = p.y1 + a;\n\t\t\t\tp.cy2 = p.y2;\n\n\t\t\t\ta = Math.abs(a);\n\t\t\t\tp.r0 = a;\n\t\t\t\tp.cx0 = p.x1 + (rMax0 - a) * qx;\n\n\t\t\t\ttx = calcArcHConnector(p.cx1, p.cy1, p.r1, p.cx2, p.cy2, p.r2, 0.8);\n\t\t\t\tp.tx1 = tx[0];\n\t\t\t\tp.tx2 = tx[1];\n\n\t\t\t\t// Find out longest node connection for setLineDash\n\t\t\t\tlMax = Math.max(lMax, Math.abs(p.x1 - p.x2) + Math.abs(p.cy1 - p.cy2));\n\t\t\t}\n\t\t\t// Sort by distance y1 (original) > cy1 (rInc offset) distance\n\t\t\tconnectors.sort(function(a, b) {\n\t\t\t\t// return Math.abs(b.y1 - b.cy1) - Math.abs(a.y1 - a.cy1);\n\t\t\t\t// return a.r0 - b.r0;\n\t\t\t\treturn b.di - a.di;\n\t\t\t});\n\t\t}\n\t\td.connectors = connectors;\n\t\td.maxLength = lMax;\n\t\td.maxLength = qx;\n\t}, */\n\n});\n\nif (DEBUG) {\n\t// GraphView.prototype._logFlags = \"\";\n\n\tvar applyFn = function(context, args) {\n\t\treturn Array.prototype.shift.apply(args).apply(context, args);\n\t}\n\n\tGraphView.prototype._drawConnector = _.wrap(GraphView.prototype._drawConnector, function(fn, p, i, pp) {\n\t\tif (!this._debugGraph) {\n\t\t\t// visual debug aids are off\n\t\t\treturn fn.call(this, p, i, pp);\n\t\t}\n\n\t\t// var isRtl = p.qx < 0;\n\t\tvar isFirst = i == 0;\n\t\tvar isLast = i == (pp.length - 1);\n\t\t// guide color\n\t\tvar gs = _dStyles[isFirst ? \"salmon_dashed\" : \"lightskyblue_dashed\"];\n\n\t\tif (isFirst) {\n\t\t\tCanvasHelper.drawVGuide(this._ctx, _dStyles[\"grey\"], pp.sMin);\n\t\t\tCanvasHelper.drawVGuide(this._ctx, _dStyles[\"grey\"], pp.dMin);\n\t\t}\n\n\t\tif (isFirst) {\n\t\t\tCanvasHelper.drawHGuide(this._ctx, _dStyles[\"silver_dashed\"], p.y1);\n\t\t\tCanvasHelper.drawVGuide(this._ctx, _dStyles[\"silver_dashed\"], p.x1);\n\t\t\tCanvasHelper.drawCircle(this._ctx, _dStyles[\"midnightblue\"], p.x1, p.y1, 10);\n\t\t}\n\t\tif (isFirst || isLast) {\n\t\t\t// CanvasHelper.drawVGuide(this._ctx, gs, p.cx1 + (p.r1 * p.qx));\n\t\t\tCanvasHelper.drawVGuide(this._ctx, gs, p.tx2);\n\t\t\tCanvasHelper.drawVGuide(this._ctx, gs, p.cx2 - (p.r2 * p.qx));\n\t\t\t// CanvasHelper.drawVGuide(this._ctx, gs, p.cx2);\n\t\t\t// CanvasHelper.drawHGuide(this._ctx, gs, p.cy2);\n\t\t}\n\t\tif (isFirst || isLast) {\n\t\t\tthis._ctx.save();\n\t\t\tthis._ctx.strokeStyle = _dStyles[(isFirst ? \"red\" : \"blue\")].strokeStyle;\n\t\t\tthis._ctx.lineWidth *= 1.5;\n\t\t}\n\t\t// }\n\n\t\tfn.call(this, p, i, pp);\n\n\t\t// if (isRtl) {\n\t\tif (isFirst || isLast) {\n\t\t\tthis._ctx.restore();\n\t\t}\n\t\t// point color\n\t\tvar pCol = isLast ? \"midnightblue\" : isFirst ? \"sienna\" : \"grey\";\n\t\tvar ps = _dStyles[pCol];\n\t\tvar pf = _dStyles[pCol + \"_fill\"];\n\n\t\t// CanvasHelper.drawCrosshair(this._ctx, ps, p.x1 + ((p.r0 + p.di) * p.qx), p.cy1, 3);\n\n\n\t\tif (isFirst || isLast) {\n\t\t\t// moveTo(p.x2, p.cy2)\n\t\t\tCanvasHelper.drawCrosshair(this._ctx, ps, p.x2, p.cy2, 10);\n\t\t\tCanvasHelper.drawCircle(this._ctx, ps, p.x2, p.cy2, 3);\n\n\t\t\t// arcTo #1: (p.tx2, p.cy2, p.tx1, p.cy1, p.r2)\n\t\t\tCanvasHelper.drawSquare(this._ctx, ps, p.tx2, p.cy2, 4); // p1\n\t\t\tCanvasHelper.drawCircle(this._ctx, pf, p.tx1, p.cy1, 2); // p2\n\n\t\t\t// arcTo #2: (p.tx1, p.cy1, p.cx1, p.cy1, p.r1)\n\t\t\tCanvasHelper.drawSquare(this._ctx, ps, p.tx1, p.cy1, 4); // p1\n\t\t\tCanvasHelper.drawCircle(this._ctx, pf, p.cx1, p.cy1, 2); // p2\n\n\t\t\t// arcTo #2: (p.cx0, p.cy1, p.cx0, p.y1, p.r0)\n\t\t\tCanvasHelper.drawSquare(this._ctx, ps, p.cx0, p.cy1, 4); // p1\n\t\t\tCanvasHelper.drawCircle(this._ctx, pf, p.cx0, p.y1, 2); // p2\n\n\t\t\tCanvasHelper.drawCircle(this._ctx, _dStyles[\"green\"], p.tx1, p.cy1, 4);\n\t\t\tCanvasHelper.drawCircle(this._ctx, _dStyles[\"green\"], p.cx1, p.cy1, 4);\n\t\t\tCanvasHelper.drawCircle(this._ctx, _dStyles[\"green\"], p.cx2, p.cy2, 4);\n\t\t}\n\t\t// }\n\t});\n\n\n\tGraphView.prototype._traceScroll = function(type) {\n\t\tvar tpl = \"%s:[%s] DPR:%i \" +\n\t\t\t\"[window: %i %i] \" +\n\t\t\t\"[html: %i %i %i] \" +\n\t\t\t\"[body: %i %i %i] \" +\n\t\t\t\"[container: %i %i %i] \" +\n\t\t\t\"[graph: %i %i %i]\";\n\t\tconsole.log(tpl, this.cid, type, this._canvasRatio,\n\t\t\twindow.pageYOffset,\n\t\t\twindow.pageYOffset,\n\t\t\tdocument.documentElement.clientHeight,\n\t\t\tdocument.documentElement.scrollTop,\n\t\t\tdocument.documentElement.scrollHeight,\n\t\t\tdocument.body.clientHeight,\n\t\t\tdocument.body.scrollTop,\n\t\t\tdocument.body.scrollHeight,\n\t\t\tdocument.body.firstElementChild.clientHeight,\n\t\t\tdocument.body.firstElementChild.scrollTop,\n\t\t\tdocument.body.firstElementChild.scrollHeight,\n\t\t\tthis.el.clientHeight,\n\t\t\tthis.el.scrollTop,\n\t\t\tthis.el.scrollHeight\n\t\t);\n\t};\n\n\tif (GraphView.prototype._logFlags.split(\" \")[\"view.render\"]) {\n\t\t// GraphView.prototype._requestRender = _.wrap(CanvasView.prototype._requestRender, function(fn) {\n\t\t// \tdebouncedLog(\"%s::_requestRender\", this.cid);\n\t\t// \treturn applyMethod(this, arguments);\n\t\t// });\n\t\tvar debouncedLog = _.debounce(_.bind(console.log, console), 500, true);\n\n\t\tGraphView.prototype._applyRender = _.wrap(CanvasView.prototype._applyRender, function(fn) {\n\t\t\tvar retval;\n\t\t\tthis._logFlags[\"view.render\"] = false;\n\t\t\tdebouncedLog(\"%s::_applyRender [debounced]\", this.cid);\n\t\t\tretval = applyFn(this, arguments);\n\t\t\tthis._logFlags[\"view.render\"] = true;\n\t\t\treturn retval;\n\t\t});\n\t}\n}\n\nmodule.exports = GraphView;\n",
    "/**\n * @module app/view/component/GroupingListView\n */\n\n/** @type {module:app/view/component/FilterableListView} */\nconst FilterableListView = require(\"app/view/component/FilterableListView\");\n/** @type {module:app/view/component/ClickableRenderer} */\nconst ClickableRenderer = require(\"app/view/render/ClickableRenderer\");\n/** @type {module:app/view/render/LabelRenderer} */\nconst LabelRenderer = require(\"app/view/render/LabelRenderer\");\n// /** @type {module:utils/array/difference} */\n// var diff = require(\"utils/array/difference\");\n\n/**\n * @constructor\n * @type {module:app/view/component/GroupingListView}\n */\nvar GroupingListView = FilterableListView.extend({\n\n\t/** @type {string} */\n\tcidPrefix: \"groupingList\",\n\n\t/** @override */\n\ttagName: \"dl\",\n\n\t/** @override */\n\tclassName: \"grouped\",\n\n\t/** @type {Function|null} empty array */\n\t_groupingFn: null, //function() { return null; },\n\n\t/** @override */\n\tdefaults: _.defaults({\n\t\t// defaults: {\n\t\trenderer: ClickableRenderer.extend({\n\t\t\t/** @override */\n\t\t\tcidPrefix: \"groupingListItem\",\n\t\t\t/** @override */\n\t\t\ttagName: \"dl\",\n\t\t\t/** @override */\n\t\t\tclassName: \"list-item list-node\",\n\t\t}),\n\t\tgroupingRenderer: LabelRenderer.extend({\n\t\t\t/** @override */\n\t\t\tcidPrefix: \"groupingListGroup\",\n\t\t\t/** @override */\n\t\t\ttagName: \"dt\",\n\t\t\t/** @override */\n\t\t\tclassName: \"list-group list-node\",\n\t\t}),\n\t\tgroupingFn: null,\n\t\t// },\n\t}, FilterableListView.prototype.defaults),\n\n\tproperties: {\n\t\tgroups: {\n\t\t\tget: function() {\n\t\t\t\treturn this._groups;\n\t\t\t}\n\t\t},\n\t\tfilteredGroups: {\n\t\t\tget: function() {\n\t\t\t\treturn this._filteredGroups;\n\t\t\t}\n\t\t},\n\t},\n\n\t/** @override */\n\tinitialize: function(options) {\n\t\tFilterableListView.prototype.initialize.apply(this, arguments);\n\n\t\tthis._groups = [];\n\t\tthis._filteredGroups = [];\n\t\tthis._changedFilteredGroups = [];\n\t\tthis._groupsByItemCid = {};\n\n\t\tthis._groupingFn = options.groupingFn;\n\t\tthis.groupingRenderer = options.groupingRenderer;\n\t\tthis._computeGroups();\n\t\tif (this._groupingFn) {\n\t\t\tthis._groups.forEach(this.createGroupingView, this);\n\t\t}\n\t},\n\n\t/**\n\t * Called once on collection change\n\t * @private\n\t */\n\t_computeGroups: function() {\n\t\t// this._groups = _.uniq(this.collection.map(this._groupingFn, this));\n\t\tthis._groups.length = 0;\n\t\t// this._groupItems.length = 0;\n\t\tif (this._groupingFn) {\n\t\t\tthis.collection.forEach(function(item) {\n\t\t\t\tvar gIdx, gObj;\n\t\t\t\tgObj = this._groupingFn.apply(null, arguments);\n\t\t\t\tif (gObj) {\n\t\t\t\t\tgIdx = this._groups.indexOf(gObj);\n\t\t\t\t\tif (gIdx == -1) {\n\t\t\t\t\t\tgIdx = this._groups.length;\n\t\t\t\t\t\tthis._groups[gIdx] = gObj;\n\t\t\t\t\t\t// this._groupItems[gIdx] = [];\n\t\t\t\t\t}\n\t\t\t\t\t// this._groupItems[gIdx].push(item);\n\t\t\t\t}\n\t\t\t\tthis._groupsByItemCid[item.cid] = gObj;\n\t\t\t}, this);\n\t\t} else {\n\t\t\tthis.collection.forEach(function(item) {\n\t\t\t\tthis._groupsByItemCid[item.cid] = null;\n\t\t\t}, this);\n\t\t}\n\t},\n\n\t/** @private Create children views */\n\tcreateGroupingView: function(item) {\n\t\tvar view = new this.groupingRenderer({\n\t\t\tmodel: item,\n\t\t\tel: this.el.querySelector(\".list-group[data-id=\\\"\" + item.id + \"\\\"]\")\n\t\t});\n\t\tthis.itemViews.add(view);\n\t\treturn view;\n\t},\n\n\t/* --------------------------- *\n\t/* Filter impl 1\n\t/* --------------------------- */\n\n\t/** @override */\n\t/*\n\tcomputeFilter_1: function() {\n\t\tFilterableListView.prototype.computeFilter_1.apply(this, arguments);\n\n\t\tif (this._groupingFn) {\n\t\t\tif (this._filteredItems.length == 0) {\n\t\t\t\tthis._filteredGroups = [];\n\t\t\t} else {\n\t\t\t\tthis._filteredGroups = _.uniq(this._filteredItems.map(function(item) {\n\t\t\t\t\treturn this._groupsByItemCid[item.cid];\n\t\t\t\t}, this));\n\t\t\t}\n\t\t}\n\t\t// if (this._groupingFn) {\n\t\t// \tif (this._filteredItems.length == 0) {\n\t\t// \t\tthis._filteredGroups = [];\n\t\t// \t\tthis._groups.forEach(function(group) {\n\t\t// \t\t\tthis.itemViews.findByModel(group).el.classList.remove(\"excluded\");\n\t\t// \t\t}, this);\n\t\t// \t} else {\n\t\t// \t\tthis._filteredGroups = _.uniq(this._filteredItems.map(function(item) {\n\t\t// \t\t\treturn this._groupsByItemCid[item.cid];\n\t\t// \t\t}, this));\n\t\t// \t\tthis._groups.forEach(function(group) {\n\t\t// \t\t\tthis.itemViews.findByModel(group).el.classList.toggle(\"excluded\", this._filteredGroups.indexOf(group) == -1);\n\t\t// \t\t}, this);\n\t\t// \t}\n\t\t// }\n\t},\n\t*/\n\n\t/* --------------------------- *\n\t/* Filter impl 2\n\t/* --------------------------- */\n\n\t// /** @override */\n\t// renderFilterFn_2: function() {\n\t// \tFilterableListView.prototype.renderFilterFn_2.apply(this, arguments);\n\t// },\n\n\t/** @override */\n\tcomputeFilter: function() {\n\t\tFilterableListView.prototype.computeFilter.apply(this, arguments);\n\n\t\tif (this._groupingFn) {\n\t\t\tif (this._filteredItems.length == 0) {\n\t\t\t\tthis._filteredGroups = this._groups.concat(); //[];\n\t\t\t} else {\n\t\t\t\tthis._filteredGroups = _.uniq(this._filteredItems.map(function(item) {\n\t\t\t\t\treturn this._groupsByItemCid[item.cid];\n\t\t\t\t}, this));\n\t\t\t}\n\t\t}\n\t},\n\n\t/** @override */\n\tapplyFilter: function() {\n\t\tFilterableListView.prototype.applyFilter.apply(this, arguments);\n\n\t\tthis._groups.forEach(function(group) {\n\t\t\tthis.itemViews.findByModel(group).el.classList.toggle(\"excluded\", (this._filteredGroups.indexOf(group) == -1));\n\t\t}, this);\n\t},\n\n\t// computeFiltered: function() {\n\t// \tFilterableListView.prototype.computeFiltered.apply(this, arguments);\n\t// },\n\t//\n\t// renderFiltered: function() {\n\t// \tFilterableListView.prototype.renderFiltered.apply(this, arguments);\n\t// },\n\n});\n\nmodule.exports = GroupingListView;\n",
    "/**\n * @module app/view/component/PlayToggleSymbol\n */\n\n// /** @type {module:app/control/Globals} */\n// var Globals = require(\"app/control/Globals\");\n/** @type {module:app/view/base/CanvasView} */\nconst CanvasView = require(\"app/view/base/CanvasView\");\n\n/** @type {Function} */\nconst Color = require(\"color\");\n/** @type {module:utils/canvas/bitmap/stackBlurRGB} */\nconst stackBlurRGB = require(\"utils/canvas/bitmap/stackBlurRGB\");\n/** @type {module:utils/canvas/bitmap/getAverageRGB} */\nconst getAverageRGB = require(\"utils/canvas/bitmap/getAverageRGB\");\n/** @type {module:utils/canvas/bitmap/multiply} */\nconst multiply = require(\"utils/canvas/bitmap/multiply\");\n/** @type {module:utils/canvas/bitmap/desaturate} */\nconst desaturate = require(\"utils/canvas/bitmap/desaturate\");\n/** @type {module:utils/canvas/CanvasHelper} */\nconst roundRect = require(\"utils/canvas/CanvasHelper\").roundRect;\n\n/** @type {module:utils/ease/fn/easeInQuad} */\nconst easeIn = require(\"utils/ease/fn/easeInQuad\");\n/** @type {module:utils/ease/fn/easeOutQuad} */\nconst easeOut = require(\"utils/ease/fn/easeOutQuad\");\n\nvar PI2 = Math.PI * 2;\nvar LOOP_OFFSET = 1.833333;\nconst INTEP_MS = require(\"app/control/Globals\").TRANSITION_DURATION;\nvar FILTER_REFRESH_THRESHOLD = 0.5; //seconds elapsed\nvar FILTER_SCALE = 1.5;\nvar FILTER_RADIUS = 30; //pixels\nvar FILTER_MULTIPLY = 0.1;\n\nvar PlayToggleSymbol = {\n\tPLAY: \"playing\",\n\tPAUSE: \"paused\",\n\tWAITING: \"waiting\",\n\tENDED: \"ended\",\n};\n\nmodule.exports = CanvasView.extend({\n\n\t\t/** @type {string} */\n\t\tcidPrefix: \"playToggleSymbol\",\n\t\t/** @type {string} */\n\t\tclassName: \"play-toggle\",\n\n\t\tdefaults: {\n\t\t\tvalues: {\n\t\t\t\t_loop: 0,\n\t\t\t\t_arc: 0,\n\t\t\t},\n\t\t\tmaxValues: {\n\t\t\t\t_loop: 1\n\t\t\t},\n\t\t\tcolor: \"rgba(255,255,255,1.0)\",\n\t\t\tbackgroundColor: \"rgba(0,0,0,0.25)\",\n\t\t\tpaused: true,\n\t\t\tsymbolName: \"\",\n\t\t\t// borderRadius: 3,\n\t\t\t// borderWidth: 3,\n\t\t},\n\n\t\tproperties: {\n\t\t\tsymbolName: {\n\t\t\t\tget: function() {\n\t\t\t\t\treturn this._symbolName;\n\t\t\t\t},\n\t\t\t\tset: function(value) {\n\t\t\t\t\tthis._setSymbolName(value);\n\t\t\t\t}\n\t\t\t},\n\t\t},\n\n\t\t/** @override */\n\t\tinitialize: function(options) {\n\t\t\t// TODO: cleanup options mess in CanvasView\n\t\t\tCanvasView.prototype.initialize.apply(this, arguments);\n\t\t\tthis._options = _.extend(this._options, _.pick(options, \"symbolName\", \"borderRadius\", \"borderWidth\"));\n\t\t\tthis.symbolName = this._options.symbolName;\n\t\t},\n\n\t\t/** @override */\n\t\tmeasureCanvas: function(w, h, s) {\n\t\t\t// make canvas square\n\t\t\tthis._canvasHeight = this._canvasWidth = Math.min(w, h);\n\t\t},\n\n\t\t/** @override */\n\t\tupdateCanvas: function(ctx, s) {\n\t\t\tvar mObj = this._getFontMetrics(this._fontFamily);\n\t\t\tthis._baselineShift = mObj ? (mObj.ascent + mObj.descent) / mObj.unitsPerEm : 0.7; // default value\n\t\t\tthis._baselineShift *= this._fontSize * 0.5; // apply to font-size, halve it\n\t\t\tthis._baselineShift = Math.round(this._baselineShift);\n\n\t\t\tthis._canvasOffsetX = this._canvasOffsetY = this._canvasWidth / 2;\n\t\t\t// double SQRT1_2: square within circle within square\n\t\t\tthis._radius = (this._canvasWidth / 2) * Math.SQRT1_2 * Math.SQRT1_2 * Math.SQRT1_2;\n\t\t\tthis._side = this._radius; // * Math.SQRT1_2; // * Math.SQRT1_2;\n\t\t\t// this._borderWidth = this._options.borderWidth * this._canvasRatio;\n\t\t\t// this._borderRadius = this._canvasWidth * this._canvasRatio / 2; //this._options.borderRadius * this._canvasRatio;\n\n\t\t\t// reset matrix and translate 0,0 to center\n\t\t\tthis._ctx.setTransform(1, 0, 0, 1, this._canvasOffsetX, this._canvasOffsetY);\n\t\t\t// this._ctx.restore();\n\t\t\t// this._ctx.textBaseline = \"middle\";\n\t\t\tthis._ctx.lineWidth = this._radius * (1 - Math.SQRT1_2);\n\t\t\t// this._ctx.fillStyle = \"#FFF\";\n\t\t\tthis._ctx.shadowColor = \"rgba(0,0,0,0.75)\";\n\t\t\tthis._ctx.shadowBlur = 1;\n\t\t\tthis._ctx.shadowOffsetX = 2;\n\t\t\tthis._ctx.shadowOffsetY = 2;\n\t\t\t// this._ctx.save();\n\n\t\t\tthis._isImageDataInvalid = true;\n\t\t\t//console.log(\"%s::updateCanvas %s\", this.cid, this._backgroundColor);\n\t\t},\n\n\t\t/* --------------------------- *\n\t\t * symbolName\n\t\t * --------------------------- */\n\n\t\t_symbolName: \"\",\n\t\t_setSymbolName: function(value) {\n\t\t\tif (this._symbolName !== value) {\n\t\t\t\tthis._lastSymbolName = this._symbolName;\n\t\t\t\tthis._symbolName = value;\n\n\t\t\t\tthis.refreshImageSource();\n\t\t\t\tthis.requestRender(CanvasView.LAYOUT_INVALID);\n\t\t\t\tconsole.log(\"%s::[set] symbol %o (from %o)\", this.attached ? this.parentView.cid : this.cid, this._symbolName, this._lastSymbolName, this.paused ? \"paused\" : \"\");\n\t\t\t}\n\t\t},\n\n\t\t/* --------------------------- *\n\t\t * setImageSource/refreshImageSource\n\t\t * --------------------------- */\n\n\t\t_imageSource: null,\n\t\tsetImageSource: function(imageSource) {\n\t\t\tif (this._imageSource !== imageSource) {\n\t\t\t\tthis._imageSource = imageSource;\n\t\t\t\tthis._isImageDataInvalid = true;\n\t\t\t\tthis.requestRender(CanvasView.SIZE_INVALID);\n\t\t\t}\n\t\t},\n\n\t\t_imageDataTC: null,\n\t\trefreshImageSource: function(threshold) {\n\t\t\tif (this._isImageDataInvalid || !(this._imageSource instanceof HTMLVideoElement)) {\n\t\t\t\treturn; // data is marked for refresh already, or not a video\n\t\t\t}\n\t\t\tif (!_.isNumber(threshold)) {\n\t\t\t\tthreshold = FILTER_REFRESH_THRESHOLD;\n\t\t\t}\n\t\t\tif (threshold < Math.abs(this._imageDataTC - this._imageSource.currentTime)) {\n\t\t\t\tthis._isImageDataInvalid = true;\n\t\t\t\tthis.requestRender(CanvasView.SIZE_INVALID);\n\t\t\t}\n\t\t},\n\n\t\t_imageData: null,\n\t\t_updateImageData: function() {\n\t\t\tif (this._imageSource === null) {\n\t\t\t\tthis._imageData = null;\n\t\t\t\tthis._imageDataTC = null;\n\t\t\t\treturn;\n\t\t\t}\n\t\t\t// source scale, source rect, dest scale, dest rect, current timecode\n\t\t\tvar s, sr, d, dr, tc;\n\n\t\t\t// Get source/dest offsets, intrinsic scale and timecode\n\t\t\t// ---------------------------------\n\t\t\tsr = this._imageSource.getBoundingClientRect();\n\t\t\tdr = this.el.getBoundingClientRect();\n\n\t\t\tif (this._imageSource instanceof HTMLVideoElement) {\n\t\t\t\ts = this._imageSource.videoWidth / sr.width;\n\t\t\t\ttc = this._imageSource.currentTime;\n\t\t\t} else {\n\t\t\t\ts = this._imageSource.naturalWidth / sr.width;\n\t\t\t\ttc = 0;\n\t\t\t}\n\t\t\td = s * FILTER_SCALE;\n\n\t\t\t// draw source canvas maintaining position\n\t\t\t// ---------------------------------\n\t\t\tthis._ctx.save();\n\t\t\tthis._ctx.setTransform(1, 0, 0, 1, 0, 0);\n\t\t\tthis._ctx.drawImage(this._imageSource,\n\t\t\t\t(dr.left - sr.left) * s + (dr.width / 2) * s - (dr.width / 2) * d,\n\t\t\t\t(dr.top - sr.top) * s + (dr.height / 2) * s - (dr.height / 2) * d,\n\t\t\t\tdr.width * d, dr.height * d,\n\t\t\t\t0, 0, this.el.width, this.el.height\n\t\t\t);\n\t\t\t// if (d == s)\n\t\t\t// this._ctx.drawImage(this._imageSource,\n\t\t\t// \t(dr.left - sr.left) * s, (dr.top - sr.top) * s,\n\t\t\t// \tdr.width * s, dr.height * s,\n\t\t\t// \t0, 0, this.el.width, this.el.height\n\t\t\t// );\n\n\t\t\t// get ImageData\n\t\t\t// find luminosity threshold form average color\n\t\t\t// ---------------------------------\n\t\t\tvar imgdata, isDark;\n\n\t\t\timgdata = this._ctx.getImageData(0, 0, this.el.width, this.el.height);\n\t\t\t// isDark = !Color().rgb(getAverageRGB(imgdata)).dark();\n\n\t\t\t// this._ctx.globalCompositeOperation = \"luminosity\";\n\t\t\t// this._ctx.globalAlpha = 0.25;\n\t\t\t// this._ctx.fillStyle = (isDark ? \"black\" : \"white\");\n\t\t\t// this._ctx.fillRect(0, 0, this.el.width, this.el.height);\n\n\t\t\tthis._ctx.clearRect(0, 0, this.el.width, this.el.height);\n\t\t\tthis._ctx.restore();\n\n\t\t\t// Store appropiate color values\n\t\t\t// ---------------------------------\n\t\t\tthis._color = isDark ? \"white\" : \"black\";\n\t\t\t// this._color = isDark ? \"rgba(255,255,255,0.75)\" : \"rgba(0,0,0,0.75)\";\n\t\t\t// this._backgroundColor = isDark ? \"rgba(0,0,0,0.75)\" : \"rgba(255,255,255,0.74)\";\n\n\t\t\t// this.el.style.color =\n\t\t\t// \tthis._ctx.fillStyle =\n\t\t\t// \tthis._ctx.strokeStyle =\n\t\t\t// \tthis._color;\n\t\t\t// this.el.style.backgroundColor =\n\t\t\t// \tthis._ctx.shadowColor =\n\t\t\t// \tthis._backgroundColor;\n\n\t\t\t// this.el.classList.toggle(\"lod\", isDark);\n\t\t\t// this.el.classList.toggle(\"dol\", !isDark);\n\n\t\t\t// Apply filters and save results\n\t\t\t// ---------------------------------\n\t\t\t// imgdata = this._ctx.getImageData(0, 0, this.el.width, this.el.height);\n\t\t\t// imgdata = multiply(imgdata, (isDark ? 1 - FILTER_MULTIPLY : 1 + FILTER_MULTIPLY));\n\t\t\t// imgdata = desaturate(imgdata, 0.5);\n\n\t\t\timgdata = multiply(imgdata, 1 + FILTER_MULTIPLY);\n\t\t\timgdata = stackBlurRGB(imgdata, FILTER_RADIUS);\n\t\t\t// imgdata = null;\n\n\t\t\tthis._imageData = imgdata;\n\t\t\tthis._imageDataTC = tc;\n\t\t},\n\n\t\t/** @override */\n\t\tredraw: function(ctx, intrp, flags) {\n\t\t\tthis._clearCanvas();\n\n\t\t\tif (this._symbolName === 'waiting') {\n\t\t\t\tif (intrp.getTargetValue('_arc') === 0) {\n\t\t\t\t\tintrp.valueTo('_arc', 1, 0 * INTEP_MS, easeIn)\n\t\t\t\t\t\t.updateValue('_arc');\n\t\t\t\t}\n\t\t\t} else {\n\t\t\t\tif (intrp.getTargetValue('_arc') === 1) {\n\t\t\t\t\tintrp.valueTo('_arc', 0, 0 * INTEP_MS, easeOut)\n\t\t\t\t\t\t.updateValue('_arc');\n\t\t\t\t}\n\t\t\t}\n\t\t\tvar a = intrp.getRenderedValue(\"_arc\");\n\t\t\t// while arc is > 0, loop indefinitely while spinning and restart\n\t\t\t// if at end. Otherwise let interp exhaust arc duration\n\t\t\tif (a > 0) {\n\t\t\t\tif (!intrp.paused && intrp.isAtTarget('_loop')) {\n\t\t\t\t\t// console.log(\"%s::redraw [loop]\", this.cid, this.parentView.cid);\n\t\t\t\t\tintrp\n\t\t\t\t\t\t.valueTo('_loop', 0, 0)\n\t\t\t\t\t\t.valueTo('_loop', 1, 2 * INTEP_MS)\n\t\t\t\t\t\t.updateValue('_loop');\n\t\t\t\t}\n\t\t\t}\n\t\t\tvar l = intrp.getRenderedValue(\"_loop\");\n\n\t\t\t// if (this._isImageDataInvalid) {\n\t\t\t// \tthis._isImageDataInvalid = false;\n\t\t\t// \tthis._updateImageData();\n\t\t\t// }\n\t\t\t// if (this._imageData !== null) {\n\t\t\t// \tctx.putImageData(this._imageData, 0, 0);\n\t\t\t// }\n\n\t\t\t// always render while arc is > 0\n\t\t\tif (a > 0) {\n\t\t\t\t// arc span bounce\n\t\t\t\tvar b = (l < 0.5 ? (l % 0.5) : 0.5 - (l % 0.5)) * 2;\n\t\t\t\t// bounce + main arc span\n\t\t\t\tvar aa = (a * b * 0.25) + (a * 0.125) + .0001;\n\t\t\t\t// rotation loop\n\t\t\t\tvar ll = l + LOOP_OFFSET;\n\n\t\t\t\tctx.beginPath();\n\t\t\t\tctx.arc(0, 0, this._radius, ((1 - aa) + ll) * PI2, (aa + ll) * PI2, false);\n\t\t\t\tctx.stroke();\n\t\t\t}\n\n\t\t\tswitch (this._symbolName) {\n\t\t\t\tcase \"replay\":\n\t\t\t\tcase \"ended\":\n\t\t\t\tcase \"play\":\n\t\t\t\t\t// this.drawPlay(ctx, (1 - a) * s);\n\t\t\t\t\tthis.drawPlay(ctx, this._side);\n\t\t\t\t\tctx.fill();\n\t\t\t\t\tbreak;\n\t\t\t\tcase \"pause\":\n\t\t\t\t\t// this.drawPause(ctx, (1 - a) * s);\n\t\t\t\t\tthis.drawPause(ctx, this._side);\n\t\t\t\t\tctx.fill();\n\t\t\t\t\tbreak;\n\t\t\t\tcase \"waiting\":\n\t\t\t\t\tswitch (this._lastSymbolName) {\n\t\t\t\t\t\tcase \"replay\":\n\t\t\t\t\t\tcase \"ended\":\n\t\t\t\t\t\tcase \"play\":\n\t\t\t\t\t\t\tthis.drawPlay(ctx, (1 - a) * this._side);\n\t\t\t\t\t\t\tctx.fill();\n\t\t\t\t\t\t\tbreak;\n\t\t\t\t\t\tcase \"pause\":\n\t\t\t\t\t\t\tthis.drawPause(ctx, (1 - a) * this._side);\n\t\t\t\t\t\t\tctx.fill();\n\t\t\t\t\t\t\tbreak;\n\t\t\t\t\t\tdefault:\n\t\t\t\t\t\t\tbreak;\n\t\t\t\t\t}\n\t\t\t\t\tbreak;\n\t\t\t\tdefault:\n\t\t\t\t\tbreak;\n\t\t\t}\n\t\t},\n\n\t\tdrawPlay: function(ctx, r) {\n\t\t\tvar tx = (1 - Math.SQRT1_2) * r;\n\t\t\tctx.beginPath();\n\t\t\tctx.moveTo(tx + r, 0);\n\t\t\tctx.lineTo(tx - r, -r);\n\t\t\tctx.lineTo(tx - r, r);\n\t\t\tctx.closePath();\n\t\t},\n\n\t\tdrawPause: function(ctx, r) {\n\t\t\tvar w = r * 0.75;\n\t\t\tvar h = r * 2;\n\t\t\tctx.beginPath();\n\t\t\tctx.rect(-r, -r, w, h);\n\t\t\tctx.rect(r - w, -r, w, h);\n\t\t\tctx.closePath();\n\t\t},\n\n\t\tdrawLabel: function(labelString) {\n\t\t\tvar labelWidth = this._ctx.measureText(labelString).width;\n\t\t\tthis._ctx.fillText(labelString,\n\t\t\t\tlabelWidth * -0.5,\n\t\t\t\t// 0, labelWidth);\n\t\t\t\tthis._baselineShift, labelWidth);\n\t\t},\n\t},\n\tPlayToggleSymbol);\n",
    "/**\n * @module app/view/component/SelectableListView\n */\n\n/** @type {module:app/view/base/View} */\nconst View = require(\"app/view/base/View\");\n\n/** @type {module:backbone.babysitter} */\nconst Container = require(\"backbone.babysitter\");\n/** @type {module:app/view/component/DefaultSelectableRenderer} */\nconst DefaultSelectableRenderer = require(\"app/view/render/DefaultSelectableRenderer\");\n/** @type {module:app/view/component/ClickableRenderer} */\nconst ClickableRenderer = require(\"app/view/render/ClickableRenderer\");\n\nvar SelectableListView = View.extend({\n\n\t/** @type {string} */\n\tcidPrefix: \"selectableList\",\n\n\t/** @override */\n\ttagName: \"ul\",\n\n\t/** @override */\n\tclassName: \"list selectable\",\n\n\t/** @type {module:app/view/component/DefaultSelectableRenderer} */\n\trenderer: DefaultSelectableRenderer,\n\n\t/** @override */\n\tinitialize: function(options) {\n\t\tthis._enabled = true;\n\t\tthis._childrenInvalid = true;\n\n\t\toptions.renderer && (this.renderer = options.renderer);\n\t\tthis.showEmpty = !!options.showEmpty;\n\t\tthis.itemViews = new Container();\n\n\t\tthis.listenTo(this.collection, \"add remove reset\", this._onCollectionChange);\n\t},\n\n\t/** @override */\n\tremove: function() {\n\t\tthis.removeChildren();\n\t\tView.prototype.remove.apply(this, arguments);\n\t\treturn this;\n\t},\n\n\t_onCollectionChange: function(ev) {\n\t\tthis._childrenInvalid = true;\n\t\tthis.render();\n\t},\n\n\t/** @override */\n\trender: function() {\n\t\tif (this._childrenInvalid) {\n\t\t\tthis._childrenInvalid = false;\n\t\t\tthis.createChildren();\n\t\t}\n\t\treturn this;\n\t},\n\n\t/** @override */\n\tsetEnabled: function(enabled) {\n\t\tif (this._enabled !== enabled) {\n\t\t\tthis._enabled = enabled;\n\t\t\tthis.el.classList.toggle(\"disabled\", !this._enabled);\n\t\t}\n\t},\n\n\t/* --------------------------- *\n\t/* Child views\n\t/* --------------------------- */\n\n\tcreateChildren: function() {\n\t\tvar eltBuffer, view;\n\n\t\tthis.removeChildren();\n\t\tthis.el.innerHTML = \"\";\n\n\t\tif (this.collection.length) {\n\t\t\teltBuffer = document.createDocumentFragment();\n\t\t\tif (this.showEmpty) {\n\t\t\t\tview = this.createEmptyView();\n\t\t\t\teltBuffer.appendChild(view.render().el);\n\t\t\t}\n\t\t\tthis.collection.each(function(model, index, arr) {\n\t\t\t\tview = this.createItemView(model, index);\n\t\t\t\teltBuffer.appendChild(view.render().el);\n\t\t\t}, this);\n\t\t\tthis.el.appendChild(eltBuffer);\n\t\t}\n\t},\n\n\tcreateItemView: function(model, index) {\n\t\tvar view = new(this.renderer)({\n\t\t\tmodel: model\n\t\t});\n\t\tthis.itemViews.add(view);\n\t\tthis.listenTo(view, \"renderer:click\", this.onItemViewClick);\n\t\treturn view;\n\t},\n\n\tremoveChildren: function() {\n\t\tthis.itemViews.each(this.removeItemView, this);\n\t},\n\n\tremoveItemView: function(view) {\n\t\tthis.stopListening(view);\n\t\tthis.itemViews.remove(view);\n\t\tview.remove();\n\t\treturn view;\n\t},\n\n\t/* --------------------------- *\n\t/* Child event handlers\n\t/* --------------------------- */\n\n\t/** @private */\n\tonItemViewClick: function(item) {\n\t\tif (this.collection.selected !== item && this._enabled) {\n\t\t\tthis.trigger(\"view:select:one\", item);\n\t\t}\n\t},\n\n\t/* --------------------------- *\n\t/* Empty view\n\t/* --------------------------- */\n\n\tcreateEmptyView: function() {\n\t\tvar view = new SelectableListView.EmptyRenderer({\n\t\t\tmodel: this.collection\n\t\t});\n\t\tthis.itemViews.add(view);\n\t\tthis.listenTo(view, \"renderer:click\", function() {\n\t\t\tthis._enabled && this.trigger(\"view:select:none\");\n\t\t});\n\t\treturn view;\n\t},\n}, {\n\tEmptyRenderer: ClickableRenderer.extend({\n\n\t\t/** @override */\n\t\ttagName: \"li\",\n\t\t/** @override */\n\t\tclassName: \"list-item empty-item\",\n\n\t\t/** @override */\n\t\tinitialize: function(options) {\n\t\t\tthis.listenTo(this.model, \"selected deselected\", this.renderClassList);\n\t\t\tthis.renderClassList();\n\t\t},\n\n\t\t/** @override */\n\t\trender: function() {\n\t\t\tthis.el.innerHTML = \"<a href=\\\"#clear\\\"><b> </b></a>\";\n\t\t\tthis.renderClassList();\n\t\t\treturn this;\n\t\t},\n\n\t\trenderClassList: function() {\n\t\t\tthis.el.classList.toggle(\"selected\", this.model.selectedIndex === -1);\n\t\t},\n\t})\n});\n\nmodule.exports = SelectableListView;\n",
    "/** @type {Function} */\nconst Color = require(\"color\");\n/** @type {module:app/control/Globals} */\nconst Globals = require(\"app/control/Globals\");\n/** @type {module:app/model/collection/BundleCollection} */\nconst bundles = require(\"app/model/collection/BundleCollection\");\n\n// - - - - - - - - - - - - - - - -\n//  utils\n// - - - - - - - - - - - - - - - -\n\nfunction insertCSSRule(sheet, selector, style) {\n\tvar cssText = \"\";\n\tfor (var prop in style) {\n\t\tcssText += prop + \":\" + style[prop] + \";\";\n\t}\n\tsheet.insertRule(selector + \"{\" + cssText + \"}\", sheet.cssRules.length);\n}\n\nfunction selfAndDescendant(selfCls, cls) {\n\treturn selfCls + \" \" + cls + \", \" + selfCls + cls;\n}\n\n// - - - - - - - - - - - - - - - -\n//  root rules\n// - - - - - - - - - - - - - - - -\n\nvar rootStyles = [\n\t\"color\",\n\t\"background\",\n\t\"background-color\",\n\t// \"--link-color\"\n];\n\nfunction initRootStyles(sheet, rootSelector, attrs, fgColor, bgColor, lnColor, hasDarkBg) {\n\tvar s, revSelector, fgColorVal, bgColorVal;\n\t// var revFgColorVal, revBgColorVal;\n\n\ts = _.pick(attrs, rootStyles);\n\t// s[\"-webkit-font-smoothing\"] = (hasDarkBg ? \"antialiased\" : \"auto\");\n\t/* NOTE: In Firefox '-moz-osx-font-smoothing: grayscale;'\n\t/* works both in light over dark and dark over light, hardcoded in _base.scss */\n\t//s[\"-moz-osx-font-smoothing\"] = (hasDarkBg? \"grayscale\" : \"auto\");\n\tinsertCSSRule(sheet, rootSelector, s);\n\n\t// A element\n\t// - - - - - - - - - - - - - - - -\n\ts = {}\n\ts[\"color\"] = lnColor.rgb().string();\n\tinsertCSSRule(sheet, rootSelector + \" a\", s);\n\tinsertCSSRule(sheet, rootSelector + \" .color-ln\", s);\n\n\t// .color-fg05\n\t// - - - - - - - - - - - - - - - -\n\ts = {};\n\ts[\"color\"] = Color(fgColor).mix(bgColor, 0.5).rgb().string();\n\ts[\"border-color\"] = Color(fgColor).mix(bgColor, 0.3).rgb().string();\n\tinsertCSSRule(sheet, rootSelector + \" .color-fg05\", s);\n\n\tfgColorVal = fgColor.rgb().string();\n\tbgColorVal = bgColor.rgb().string();\n\t// revFgColorVal = Color(bgColor).mix(fgColor, 0.9).rgb().string();\n\t// revBgColorVal = Color(fgColor).mix(bgColor, 0.6).rgb().string();\n\trevSelector = rootSelector + \" .color-reverse\";\n\n\t// .color-fg .color-bg\n\t// - - - - - - - - - - - - - - - -\n\ts = {\n\t\t\"color\": fgColorVal\n\t};\n\tinsertCSSRule(sheet, rootSelector + \" .color-fg\", s);\n\ts = {\n\t\t\"background-color\": bgColorVal\n\t};\n\tinsertCSSRule(sheet, rootSelector + \" .color-bg\", s);\n\t// html inverted text/background\n\ts = {\n\t\t\"color\": bgColorVal\n\t}; // s = { \"color\" : revFgColorVal };\n\t// s[\"-webkit-font-smoothing\"] = (hasDarkBg ? \"auto\" : \"antialiased\");\n\t// insertCSSRule(sheet, revSelector + \" .color-fg\", s);\n\t// insertCSSRule(sheet, revSelector + \".color-fg\", s);\n\tinsertCSSRule(sheet, selfAndDescendant(revSelector, \".color-fg\"), s);\n\n\ts = {\n\t\t\"background-color\": fgColorVal\n\t};\n\t// s = { \"background-color\" : revBgColorVal };\n\t// insertCSSRule(sheet, revSelector + \" .color-bg\", s);\n\t// insertCSSRule(sheet, revSelector + \".color-bg\", s);\n\tinsertCSSRule(sheet, selfAndDescendant(revSelector, \".color-bg\"), s);\n\n\t// .color-stroke .color-fill (SVG)\n\t// - - - - - - - - - - - - - - - -\n\ts = {\n\t\t\"stroke\": fgColorVal\n\t};\n\tinsertCSSRule(sheet, rootSelector + \" .color-stroke\", s);\n\ts = {\n\t\t\"fill\": bgColorVal\n\t};\n\tinsertCSSRule(sheet, rootSelector + \" .color-fill\", s);\n\t// svg inverted fill/stroke\n\ts = {\n\t\t\"stroke\": bgColorVal\n\t};\n\t// insertCSSRule(sheet, revSelector + \" .color-stroke\", s);\n\t// insertCSSRule(sheet, revSelector + \".color-stroke\", s);\n\tinsertCSSRule(sheet, selfAndDescendant(revSelector, \".color-stroke\"), s);\n\ts = {\n\t\t\"fill\": fgColorVal\n\t};\n\t// insertCSSRule(sheet, revSelector + \" .color-fill\", s);\n\t// insertCSSRule(sheet, revSelector + \".color-fill\", s);\n\tinsertCSSRule(sheet, selfAndDescendant(revSelector, \".color-fill\"), s);\n\n\t// .text-outline\n\t// - - - - - - - - - - - - - - - -\n\t// s = {\n\t// \t\"text-shadow\": \"-1px -1px 0 \" + bgColorVal +\n\t// \t\t\", 1px -1px 0 \" + bgColorVal +\n\t// \t\t\", -1px 1px 0 \" + bgColorVal +\n\t// \t\t\", 1px 1px 0 \" + bgColorVal\n\t// };\n\t// insertCSSRule(sheet, rootSelector + \" :not(..collapsed-changing) .text-outline-bg\", s);\n\n}\n\n// - - - - - - - - - - - - - - - -\n// carousel styles\n// - - - - - - - - - - - - - - - -\n\nvar carouselStyles = [\"box-shadow\", \"border\", \"border-radius\"];\n\nfunction initCarouselStyles(sheet, carouselSelector, attrs, fgColor, bgColor, lnColor, hasDarkBg) {\n\tvar s = _.pick(attrs, carouselStyles); //, \"background-color\"]);\n\tinsertCSSRule(sheet, carouselSelector + \" .media-item .content\", s);\n\n\t// .media-item .color-bg09\n\t// - - - - - - - - - - - - - - - -\n\ts = {};\n\ts[\"background-color\"] = Color(bgColor).mix(fgColor, 0.05).rgb().string();\n\t// s[\"background-color\"] = Color(bgColor)[hasDarkBg ? \"darken\" : \"lighten\"](0.045).rgb().string();\n\t// s[\"background-color\"] = Color(bgColor)[hasDarkBg ? \"lighten\" : \"darken\"](0.03).rgb().string();\n\tinsertCSSRule(sheet, carouselSelector + \" .media-item .color-bg09\", s);\n\n\t// .media-item .placeholder\n\t// - - - - - - - - - - - - - - - -\n\ts = {};\n\t// s[\"-webkit-font-smoothing\"] = (hasDarkBg ? \"auto\" : \"antialiased\");\n\t// text color luminosity is inverse from body, apply oposite rendering mode\n\ts[\"color\"] = bgColor.rgb().string();\n\t// s[\"color\"] = Color(bgColor)[hasDarkBg ? \"darken\" : \"lighten\"](0.045).rgb().string();\n\ts[\"background-color\"] = Color(bgColor).mix(fgColor, 0.05).rgb().string();\n\t// s[\"background-color\"] = Color(bgColor).mix(fgColor, 0.8).alpha(0.3).rgba().string();\n\t// s[\"background-color\"] = Color(bgColor)[hasDarkBg ? \"lighten\" : \"darken\"](0.03).rgb().string();\n\t(\"border-radius\" in attrs) && (s[\"border-radius\"] = attrs[\"border-radius\"]);\n\tinsertCSSRule(sheet, carouselSelector + \" .media-item .placeholder\", s);\n\n\t// .image-item img\n\t// .sequence-item .sequence-step\n\t// - - - - - - - - - - - - - - - -\n\ts = {};\n\ts[\"background-color\"] = bgColor.rgb().string();\n\tinsertCSSRule(sheet, carouselSelector + \" .image-item img\", s);\n\tinsertCSSRule(sheet, carouselSelector + \" .sequence-item .sequence-step\", s);\n\n\t// .empty-item A\n\t// - - - - - - - - - - - - - - - -\n\ts = {};\n\ts[\"text-decoration-color\"] = Color(fgColor).mix(bgColor, 0.7).rgb().string();\n\tinsertCSSRule(sheet, carouselSelector + \" .empty-item A\", s);\n\t// // .color-gradient\n\t// // - - - - - - - - - - - - - - - -\n\t// s = {};\n\t// s[\"background-color\"] = \"transparent\";\n\t// s[\"background\"] = \"linear-gradient(to bottom, \" +\n\t// \t\tColor(bgColor).alpha(0.00).rgba().string() + \" 0%, \" +\n\t// \t\tColor(bgColor).alpha(0.11).rgba().string() + \" 100%)\";\n\t// insertCSSRule(sheet, rootSelector + \" .color-gradient\", s);\n\t// s = {};\n\t// s[\"background-color\"] = \"transparent\";\n\t// s[\"background\"] = \"linear-gradient(to bottom, \" +\n\t// \t\tColor(fgColor).alpha(0.00).rgba().string() + \" 0%, \" +\n\t// \t\tColor(fgColor).alpha(0.11).rgba().string() + \" 100%)\";\n\t// insertCSSRule(sheet, revSelector + \" .color-gradient\", s);\n\t// insertCSSRule(sheet, revSelector + \".color-gradient\", s);\n}\n\nmodule.exports = function() {\n\tvar attrs, fgColor, bgColor, lnColor, hasDarkBg;\n\n\tattrs = Globals.DEFAULT_COLORS;\n\tfgColor = new Color(Globals.DEFAULT_COLORS[\"color\"]);\n\tbgColor = new Color(Globals.DEFAULT_COLORS[\"background-color\"]);\n\tlnColor = new Color(Globals.DEFAULT_COLORS[\"link-color\"])\n\thasDarkBg = fgColor.luminosity() > bgColor.luminosity();\n\n\tvar colorStyles = document.createElement(\"style\");\n\tcolorStyles.id = \"colors\";\n\tcolorStyles.type = \"text/css\";\n\tdocument.head.appendChild(colorStyles);\n\t// var colorStyles = document.querySelector(\"link#folio\");\n\n\tinitRootStyles(colorStyles.sheet, \".app\",\n\t\tattrs, fgColor, bgColor, lnColor, hasDarkBg);\n\tinitCarouselStyles(colorStyles.sheet, \".carousel\",\n\t\tattrs, fgColor, bgColor, lnColor, hasDarkBg);\n\n\t// - - - - - - - - - - - - - - - -\n\t// per-bundle rules\n\t// - - - - - - - - - - - - - - - -\n\tbundles.each(function(bundle) {\n\t\tattrs = bundle.attrs(); //get(\"attrs\");\n\t\tfgColor = bundle.colors.fgColor;\n\t\tbgColor = bundle.colors.bgColor;\n\t\tlnColor = bundle.colors.lnColor;\n\t\thasDarkBg = bundle.colors.hasDarkBg;\n\n\t\tinitRootStyles(colorStyles.sheet,\n\t\t\t\".app.\" + bundle.get(\"domid\"),\n\t\t\tattrs, fgColor, bgColor, lnColor, hasDarkBg);\n\t\tinitCarouselStyles(colorStyles.sheet,\n\t\t\t\".carousel.\" + bundle.get(\"domid\"),\n\t\t\tattrs, fgColor, bgColor, lnColor, hasDarkBg);\n\t});\n};\n",
    "// /** @type {module:underscore.string/lpad} */\n// var classify = require(\"underscore.string/classify\");\n\n// var statusMsg = _.template(\"<%= status %> received from <%= url %> (<%= statusText %>)\");\n// var errMsg = _.template(\"'<%= errName %>' ocurred during request <%= url %>\");\n\nif (window.XMLHttpRequest && window.URL && window.Blob) {\n\tmodule.exports = function(url, progressFn) {\n\t\treturn new Promise(function(resolve, reject) {\n\t\t\tvar request = new XMLHttpRequest();\n\t\t\trequest.open(\"GET\", url, true);\n\t\t\t// request.timeout = 10000; // in milliseconds\n\t\t\trequest.responseType = \"blob\";\n\n\t\t\tvar errorFromEvent = function(ev) {\n\t\t\t\tvar err = new Error((ev.target.status > 0 ?\n\t\t\t\t\t\"http_\" + request.statusText.replace(/\\s/g, \"_\") :\n\t\t\t\t\tev.type + \"_event\").toUpperCase());\n\t\t\t\terr.logMessage = \"_loadImageAsObjectURL::\" + ev.type + \" [reject]\";\n\t\t\t\terr.infoCode = ev.target.status;\n\t\t\t\terr.infoSrc = url;\n\t\t\t\terr.logEvent = ev;\n\t\t\t\treturn err;\n\t\t\t};\n\t\t\t// if progressFn is supplied\n\t\t\t// - - - - - - - - - - - - - - - - - -\n\t\t\tif (progressFn) {\n\t\t\t\trequest.onprogress = function(ev) {\n\t\t\t\t\tprogressFn(ev.loaded / ev.total, request);\n\t\t\t\t};\n\t\t\t}\n\t\t\t// resolved/success\n\t\t\t// - - - - - - - - - - - - - - - - - -\n\t\t\trequest.onload = function(ev) {\n\t\t\t\t// When the request loads, check whether it was successful\n\t\t\t\tif (request.status == 200) {\n\t\t\t\t\t// If successful, resolve the promise by passing back a reference url\n\t\t\t\t\tresolve(URL.createObjectURL(request.response));\n\t\t\t\t} else {\n\t\t\t\t\treject(errorFromEvent(ev));\n\t\t\t\t}\n\t\t\t};\n\t\t\t// normal abort\n\t\t\t// - - - - - - - - - - - - - - - - - -\n\t\t\trequest.onabort = function(ev) {\n\t\t\t\tresolve(void 0);\n\t\t\t};\n\t\t\t// reject/failure\n\t\t\t// - - - - - - - - - - - - - - - - - -\n\t\t\trequest.onerror = function(ev) {\n\t\t\t\treject(errorFromEvent(ev));\n\t\t\t};\n\t\t\trequest.ontimeout = request.onerror;\n\n\t\t\t// finally\n\t\t\t// - - - - - - - - - - - - - - - - - -\n\t\t\trequest.onloadend = function(ev) {\n\t\t\t\t//console.log(\"_loadImageAsObjectURL::%s [cleanup] (%s)\", ev ? ev.type : \"no event\", url);\n\t\t\t\trequest.onabort = request.ontimeout = request.onerror = void 0;\n\t\t\t\trequest.onload = request.onloadend = void 0;\n\t\t\t\tif (progressFn) {\n\t\t\t\t\trequest.onprogress = void 0;\n\t\t\t\t}\n\t\t\t};\n\n\t\t\trequest.send();\n\t\t});\n\t};\n} else {\n\tmodule.exports = function(url, progressFn) {\n\t\treturn Promise.resolve(url);\n\t};\n}\n",
    "module.exports = function(image, resolveEmpty) {\n\treturn new Promise(function(resolve, reject) {\n\t\tif (!(image instanceof window.HTMLImageElement)) {\n\t\t\t//reject(new Error(\"not an HTMLImageElement\"));\n\t\t\treject(\"Error: not an HTMLImageElement\");\n\t\t} else if (image.complete && (image.src.length > 0 || resolveEmpty)) {\n\t\t\t// if (image.src === \"\") console.warn(\"_whenImageLoads resolved with empty src\");\n\t\t\t// else console.log(\"_whenImageLoads resolve-sync\", image.src);\n\t\t\tresolve(image);\n\t\t} else {\n\t\t\tvar handlers = {\n\t\t\t\tload: function(ev) {\n\t\t\t\t\t// console.log(\"_whenImageLoads_dom resolve-async\", ev.type, image.src);\n\t\t\t\t\tremoveEventListeners();\n\t\t\t\t\tresolve(image);\n\t\t\t\t},\n\t\t\t\terror: function(ev) {\n\t\t\t\t\tvar err = new Error(\"Loading failed (\" + ev.type + \" event)\");\n\t\t\t\t\terr.infoCode = -1;\n\t\t\t\t\terr.infoSrc = image.src;\n\t\t\t\t\terr.logEvent = ev;\n\t\t\t\t\terr.logMessage = \"_whenImageLoads::\" + ev.type + \" [reject]\";\n\t\t\t\t\tremoveEventListeners();\n\t\t\t\t\treject(err);\n\t\t\t\t}\n\t\t\t};\n\t\t\thandlers.abort = handlers.error;\n\t\t\tvar removeEventListeners = function() {\n\t\t\t\tfor (var event in handlers) {\n\t\t\t\t\tif (handlers.hasOwnProperty(event)) {\n\t\t\t\t\t\timage.removeEventListener(event, handlers[event], false);\n\t\t\t\t\t}\n\t\t\t\t}\n\t\t\t};\n\t\t\tfor (var event in handlers) {\n\t\t\t\tif (handlers.hasOwnProperty(event)) {\n\t\t\t\t\timage.addEventListener(event, handlers[event], false);\n\t\t\t\t}\n\t\t\t}\n\t\t}\n\t});\n};\n",
    "/** @type {module:app/view/promise/_whenImageLoads} */\nconst _whenImageLoads = require(\"app/view/promise/_whenImageLoads\");\n/** @type {module:app/view/promise/_loadImageAsObjectURL} */\nconst _loadImageAsObjectURL = require(\"app/view/promise/_loadImageAsObjectURL\");\n\n// var isBlobRE = /^blob\\:.*/;\n\n// var logMessage = \"%s::whenDefaultImageLoads [%s]: %s\";\n\nmodule.exports = function(view) {\n\treturn new Promise(function(resolve, reject) {\n\t\tvar source = view.model.get(\"source\");\n\t\tif (source.has(\"prefetched\")) {\n\t\t\tview.defaultImage.src = source.get(\"prefetched\");\n\t\t\t_whenImageLoads(view.defaultImage)\n\t\t\t\t.then(\n\t\t\t\t\tfunction(targetEl) {\n\t\t\t\t\t\tresolve(view);\n\t\t\t\t\t});\n\t\t} else {\n\t\t\tview.mediaState = \"pending\";\n\n\t\t\tvar sUrl = source.get(\"original\");\n\t\t\tvar progressFn = function(progress, ev) {\n\t\t\t\t// console.log(logMessage, view.cid, \"progress\", progress);\n\t\t\t\tview.updateMediaProgress(progress, sUrl);\n\t\t\t};\n\t\t\tprogressFn = _.throttle(progressFn, 100, {\n\t\t\t\tleading: true,\n\t\t\t\ttrailing: false\n\t\t\t});\n\t\t\t_loadImageAsObjectURL(sUrl, progressFn)\n\t\t\t\t.then(\n\t\t\t\t\tfunction(url) {\n\t\t\t\t\t\tif (/^blob\\:.*/.test(url)) {\n\t\t\t\t\t\t\tsource.set(\"prefetched\", url);\n\t\t\t\t\t\t}\n\t\t\t\t\t\tview.defaultImage.src = url;\n\t\t\t\t\t\treturn view.defaultImage;\n\t\t\t\t\t})\n\t\t\t\t.then(_whenImageLoads)\n\t\t\t\t.then(\n\t\t\t\t\tfunction(targetEl) {\n\t\t\t\t\t\tview.on(\"view:removed\", function() {\n\t\t\t\t\t\t\tvar prefetched = source.get(\"prefetched\");\n\t\t\t\t\t\t\tif (prefetched && /^blob\\:/.test(prefetched)) {\n\t\t\t\t\t\t\t\tsource.unset(\"prefetched\", { silent: true });\n\t\t\t\t\t\t\t\tURL.revokeObjectURL(prefetched);\n\t\t\t\t\t\t\t}\n\t\t\t\t\t\t});\n\t\t\t\t\t\tresolve(view);\n\t\t\t\t\t},\n\t\t\t\t\tfunction(err) {\n\t\t\t\t\t\treject(err);\n\t\t\t\t\t});\n\t\t}\n\t});\n};\n",
    "/* global Promise */\n/** @type {module:app/view/base/ViewError} */\nconst ViewError = require(\"app/view/base/ViewError\");\n\n/** @type {module:app/view/base/ViewError} */\nconst whenViewIsAttached = require(\"app/view/promise/whenViewIsAttached\");\n\nfunction whenScrollingEnds(view) {\n\treturn new Promise(function(resolve, reject) {\n\t\tvar parent = view.parentView;\n\t\tif (parent === null) {\n\t\t\tconsole.error(\"%s::whenScrollingEnds [%s] (sync)\", view.cid, \"rejected\", view.attached);\n\t\t\treject(new ViewError(view, new Error(\"whenScrollingEnds: view has no parent\")));\n\t\t} else if (!parent.scrolling) {\n\t\t\t// console.log(\"%s::whenScrollingEnds [%s] (sync)\", view.cid, \"resolved\", view.attached);\n\t\t\tresolve(view);\n\t\t} else {\n\t\t\tvar cleanup = function() {\n\t\t\t\tparent.off(\"view:scrollend\", onScrollend);\n\t\t\t\tparent.off(\"view:remove\", onRemove);\n\t\t\t};\n\t\t\tvar onScrollend = function() {\n\t\t\t\t// console.log(\"%s::whenScrollingEnds [%s]\", view.cid, \"resolved\", view.attached);\n\t\t\t\tcleanup();\n\t\t\t\tresolve(view);\n\t\t\t};\n\t\t\tvar onRemove = function() {\n\t\t\t\t// console.log(\"%s::whenScrollingEnds [%s]\", view.cid, \"rejected\", view.attached);\n\t\t\t\tcleanup();\n\t\t\t\treject(new ViewError(view, new Error(\"whenScrollingEnds: view was removed\")));\n\t\t\t};\n\t\t\tparent.on(\"view:scrollend\", onScrollend);\n\t\t\tparent.on(\"view:remove\", onRemove);\n\t\t}\n\t});\n}\n\nmodule.exports = function(view) {\n\treturn Promise.resolve(view)\n\t\t.then(whenViewIsAttached)\n\t\t.then(whenScrollingEnds);\n};\n\n/*\nmodule.exports = function(view) {\n\treturn Promise.resolve(view)\n\t\t.then(function(view) {\n\t\t\tif (view.attached) {\n\t\t\t\treturn view;\n\t\t\t} else {\n\t\t\t\treturn new Promise(function(resolve, reject) {\n\t\t\t\t\tview.once(\"view:attached\", function(view) {\n\t\t\t\t\t\tresolve(view);\n\t\t\t\t\t});\n\t\t\t\t});\n\t\t\t}\n\t\t})\n\t\t.then(function(view) {\n\t\t\tif (!view.parentView.scrolling) {\n\t\t\t\treturn view;\n\t\t\t} else {\n\t\t\t\treturn new Promise(function(resolve, reject) {\n\t\t\t\t\tvar resolveOnScrollend = function() {\n\t\t\t\t\t\t// console.log(\"%s::whenScrollingEnds [%s]\", view.cid, \"resolved\");\n\t\t\t\t\t\tview.off(\"view:remove\", rejectOnRemove);\n\t\t\t\t\t\tresolve(view);\n\t\t\t\t\t};\n\t\t\t\t\tvar rejectOnRemove = function(view) {\n\t\t\t\t\t\t// console.log(\"%s::whenScrollingEnds [%s]\", view.cid, \"rejected\");\n\t\t\t\t\t\tview.parentView.off(\"view:scrollend\", resolveOnScrollend);\n\t\t\t\t\t\treject(new ViewError(view,\n\t\t\t\t\t\t\tnew Error(\"whenSelectScrollingEnds: view was removed (\"+ view.cid +\")\")));\n\t\t\t\t\t};\n\t\t\t\t\tview.parentView.once(\"view:scrollend\", resolveOnScrollend);\n\t\t\t\t\tview.once(\"view:remove\", rejectOnRemove);\n\t\t\t\t});\n\t\t\t}\n\t\t});\n};\n*/\n",
    "/** @type {module:app/view/base/ViewError} */\nconst ViewError = require(\"app/view/base/ViewError\");\n\n// var logMessage = \"%s::whenSelectionDistanceIs [%s]: %s\";\n\n/**\n * @param {module:app/view/base/View}\n * @param {number} distance\n */\nmodule.exports = function(view, distance) {\n\treturn new Promise(function(resolve, reject) {\n\t\t// if (!(view.model && view.model.collection)) {\n\t\t// \treject(new ViewError(view, new Error(\"whenSelectionIsContiguous: model.collection is empty\")));\n\t\t// }\n\t\tvar model = view.model;\n\t\tvar collection = model.collection;\n\n\t\tvar check = function(n) { // Check indices for contiguity\n\t\t\treturn Math.abs(collection.indexOf(model) - collection.selectedIndex) <= distance;\n\t\t};\n\n\t\tif (check()) {\n\t\t\t// console.log(logMessage, view.cid, \"resolve\", \"sync\");\n\t\t\tresolve(view);\n\t\t} else {\n\t\t\tvar cleanupOnSettle = function() {\n\t\t\t\t// console.log(logMessage, view.cid, \"cleanup\", \"async\");\n\t\t\t\tcollection.off(\"select:one select:none\", resolveOnSelect);\n\t\t\t\tview.off(\"view:removed\", rejectOnRemove);\n\t\t\t};\n\t\t\tvar resolveOnSelect = function(model) {\n\t\t\t\tif (check()) {\n\t\t\t\t\t// console.log(logMessage, view.cid, \"resolve\", \"async\");\n\t\t\t\t\tcleanupOnSettle();\n\t\t\t\t\tresolve(view);\n\t\t\t\t}\n\t\t\t};\n\t\t\tvar rejectOnRemove = function(view) {\n\t\t\t\tcleanupOnSettle();\n\t\t\t\treject(new ViewError(view, new Error(\"whenSelectionDistanceIs: view was removed\")));\n\t\t\t};\n\t\t\tcollection.on(\"select:one select:none\", resolveOnSelect);\n\t\t\tview.on(\"view:removed\", rejectOnRemove);\n\t\t}\n\t});\n};\n",
    "// /** @type {module:app/view/base/ViewError} */\n// var ViewError = require(\"app/view/base/ViewError\");\n\n/** @type {module:app/view/promise/whenSelectionDistanceIs} */\nconst whenSelectionDistanceIs = require(\"app/view/promise/whenSelectionDistanceIs\");\n\n/** @param {module:app/view/base/View} */\nmodule.exports = function(view) {\n\treturn whenSelectionDistanceIs(view, 1);\n};\n",
    "module.exports = function(view) {\n\treturn new Promise(function(resolve, reject) {\n\t\tif (view.attached) {\n\t\t\tresolve(view);\n\t\t} else {\n\t\t\tview.on(\"view:attached\", function(view) {\n\t\t\t\tresolve(view);\n\t\t\t});\n\t\t}\n\t});\n};\n",
    "module.exports = function(view) {\n\treturn new Promise(function(resolve, reject) {\n\t\tif (!view.invalidated) {\n\t\t\tresolve(view);\n\t\t} else {\n\t\t\tview.once(\"view:render:after\", function(view, flags) {\n\t\t\t\tresolve(view);\n\t\t\t});\n\t\t}\n\t});\n};\n",
    "/**\n * @module app/view/render/CarouselRenderer\n */\n\n/** @type {module:app/view/base/View} */\nconst View = require(\"app/view/base/View\");\n\n/** @type {module:underscore} */\nconst getBoxEdgeStyles = require(\"utils/css/getBoxEdgeStyles\");\n\n// FIXME: this fixup should not be done here\n// /** @type {module:utils/net/toAbsoluteURL} */\n// var toAbsoluteURL = require(\"utils/net/toAbsoluteURL\");\n// /** @type {string} */\n// var ABS_APP_ROOT = toAbsoluteURL(require(\"app/control/Globals\").APP_ROOT);\n\n/**\n * @constructor\n * @type {module:app/view/render/CarouselRenderer}\n */\nvar CarouselRenderer = View.extend({\n\n\t/** @type {string} */\n\tcidPrefix: \"carouselRenderer\",\n\t/** @override */\n\ttagName: \"div\",\n\t/** @override */\n\tclassName: \"carousel-item\",\n\t/** @override */\n\ttemplate: _.template(\"<div class=\\\"content sizing\\\"><%= name %></div>\"),\n\n\tproperties: {\n\t\tcontent: {\n\t\t\tget: function() {\n\t\t\t\treturn this._content || (this._content = this.el.querySelector(\".content\"));\n\t\t\t},\n\t\t},\n\t\tsizing: {\n\t\t\tget: function() {\n\t\t\t\treturn this._sizing || (this._sizing = this.el.querySelector(\".sizing\"));\n\t\t\t},\n\t\t}\n\t},\n\n\t/** @override */\n\tinitialize: function(options) {\n\t\tif (this.model.attr(\"@classname\") !== void 0) {\n\t\t\tvar clsAttr = this.model.attr(\"@classname\").split(\" \");\n\t\t\tfor (var i = 0; i < clsAttr.length; i++) {\n\t\t\t\tthis.el.classList.add(clsAttr[i]);\n\t\t\t}\n\t\t}\n\t\toptions.parentView && (this.parentView = options.parentView);\n\t\tthis.metrics = {};\n\t\tthis.metrics.content = {};\n\t\tthis.createChildren();\n\t\t// this.enabled = !!options.enabled; // force bool\n\t\tthis.setEnabled(!!options.enabled);\n\t},\n\n\tcreateChildren: function() {\n\t\tthis.el.innerHTML = this.template(this.model.toJSON());\n\t\t// FIXME: this fixup should not be done here\n\t\t// FIXED: now done in xslt\n\t\t/*this.el.querySelectorAll(\"a[href]\").forEach(function(el) {\n\t\t\tvar url = toAbsoluteURL(el.getAttribute(\"href\"));\n\t\t\tif (url.indexOf(ABS_APP_ROOT) !== 0) {\n\t\t\t\tel.setAttribute(\"target\", \"_blank\");\n\t\t\t}\n\t\t});*/\n\t},\n\n\t/** @return {HTMLElement} */\n\tgetSizingEl: function() {\n\t\treturn this._sizing || (this._sizing = this.el.querySelector(\".sizing\"));\n\t},\n\n\t/** @return {HTMLElement} */\n\tgetContentEl: function() {\n\t\treturn this._content || (this._content = this.el.querySelector(\".content\"));\n\t},\n\n\t/** @return {this} */\n\tmeasure: function() {\n\t\tvar sizing = this.getSizingEl();\n\n\t\tthis.metrics = getBoxEdgeStyles(this.el, this.metrics);\n\t\tthis.metrics.content = getBoxEdgeStyles(this.getContentEl(), this.metrics.content);\n\n\t\tsizing.style.maxWidth = \"\";\n\t\tsizing.style.maxHeight = \"\";\n\n\t\tthis.metrics.content.x = sizing.offsetLeft + sizing.clientLeft;\n\t\tthis.metrics.content.y = sizing.offsetTop + sizing.clientTop;\n\t\tthis.metrics.content.width = sizing.clientWidth;\n\t\tthis.metrics.content.height = sizing.clientHeight;\n\n\t\treturn this;\n\t},\n\n\t/** @override */\n\trender: function() {\n\t\tthis.measure();\n\t\treturn this;\n\t},\n\n\tgetSelectionDistance: function() {\n\t\treturn Math.abs(this.model.collection.indexOf(this.model) - this.model.collection.selectedIndex);\n\t},\n});\n\nmodule.exports = CarouselRenderer;\n",
    "/**\n * @module app/view/render/ClickableRenderer\n */\n\n/** @type {module:app/view/render/LabelRenderer} */\nconst LabelRenderer = require(\"app/view/render/LabelRenderer\");\n\n/**\n * @constructor\n * @type {module:app/view/render/ClickableRenderer}\n */\nvar ClickableRenderer = LabelRenderer.extend({\n\n\t/** @type {string} */\n\tcidPrefix: \"clickableRenderer\",\n\n\t// defaults: {\n\t// \ttarget: \".label\"\n\t// },\n\n\t/** @override */\n\tevents: {\n\t\t\"click .label\": function(ev) {\n\t\t\tif (ev.defaultPrevented) return;\n\n\t\t\tev.preventDefault();\n\t\t\tthis.trigger(\"renderer:click\", this.model, ev);\n\t\t},\n\t\t\"click a\": function(ev) {\n\t\t\tev.defaultPrevented || ev.preventDefault();\n\t\t}\n\t},\n\n\t// initialize: function(options) {\n\t// \toptions || (options = {});\n\t// \t// if (options) {\n\t// \toptions = _.defaults({}, options, _.result(this, 'defaults'));\n\t// \t// } else {\n\t// \t// \t _.defaults({}, _.result(this, 'defaults'));\n\t// \t// }\n\t// \tthis.events[\"click \" + options.target] = this.clickHandler;\n\t// },\n\t//\n\t// clickHandler: function(ev) {\n\t// \tif (ev.defaultPrevented) return;\n\t//\n\t// \tev.preventDefault();\n\t// \tthis.trigger(\"renderer:click\", this.model, ev);\n\t// }\n});\n\nmodule.exports = ClickableRenderer;\n",
    "// hbsfy compiled Handlebars template\nvar HandlebarsCompiler = require('hbsfy/runtime');\nmodule.exports = HandlebarsCompiler.template({\"compiler\":[7,\">= 4.0.0\"],\"main\":function(container,depth0,helpers,partials,data) {\n    var stack1, helper, alias1=depth0 != null ? depth0 : (container.nullContext || {}), alias2=helpers.helperMissing, alias3=\"function\";\n\n  return \"<a href=\\\"#\"\n    + container.escapeExpression(((helper = (helper = helpers.domid || (depth0 != null ? depth0.domid : depth0)) != null ? helper : alias2),(typeof helper === alias3 ? helper.call(alias1,{\"name\":\"domid\",\"hash\":{},\"data\":data}) : helper)))\n    + \"\\\"><span class=\\\"label\\\">\"\n    + ((stack1 = ((helper = (helper = helpers.name || (depth0 != null ? depth0.name : depth0)) != null ? helper : alias2),(typeof helper === alias3 ? helper.call(alias1,{\"name\":\"name\",\"hash\":{},\"data\":data}) : helper))) != null ? stack1 : \"\")\n    + \"</span></a>\";\n},\"useData\":true});\n",
    "/**\n * @module app/view/render/DefaultSelectableRenderer\n */\n\n/** @type {module:app/view/component/ClickableRenderer} */\nconst ClickableRenderer = require(\"app/view/render/ClickableRenderer\");\n\n/**\n * @constructor\n * @type {module:app/view/render/DefaultSelectableRenderer}\n */\nvar DefaultSelectableRenderer = ClickableRenderer.extend({\n\n\t/** @override */\n\ttagName: \"li\",\n\t/** @override */\n\tclassName: \"list-item\",\n\t/** @override */\n\ttemplate: require(\"./DefaultSelectableRenderer.hbs\"),\n\n\tinitialize: function(options) {\n\t\tthis.listenTo(this.model, \"selected deselected\", this._renderClassList);\n\t\tthis._renderClassList();\n\t},\n\n\t/** @override */\n\trender: function() {\n\t\tthis.el.innerHTML = this.template(this.model.toJSON());\n\t\tthis._renderClassList();\n\t\treturn this;\n\t},\n\n\t_renderClassList: function() {\n\t\tthis.el.classList.toggle(\"selected\", this.model.selected);\n\t},\n});\n\nmodule.exports = DefaultSelectableRenderer;\n",
    "// hbsfy compiled Handlebars template\nvar HandlebarsCompiler = require('hbsfy/runtime');\nmodule.exports = HandlebarsCompiler.template({\"compiler\":[7,\">= 4.0.0\"],\"main\":function(container,depth0,helpers,partials,data) {\n    var helper, alias1=depth0 != null ? depth0 : (container.nullContext || {}), alias2=helpers.helperMissing, alias3=\"function\", alias4=container.escapeExpression;\n\n  return \"<span class=\\\"label\\\">\"\n    + alias4(((helper = (helper = helpers.name || (depth0 != null ? depth0.name : depth0)) != null ? helper : alias2),(typeof helper === alias3 ? helper.call(alias1,{\"name\":\"name\",\"hash\":{},\"data\":data}) : helper)))\n    + \"</span><a href=\\\"#\"\n    + alias4(((helper = (helper = helpers.domid || (depth0 != null ? depth0.domid : depth0)) != null ? helper : alias2),(typeof helper === alias3 ? helper.call(alias1,{\"name\":\"domid\",\"hash\":{},\"data\":data}) : helper)))\n    + \"\\\"><b> </b></a>\";\n},\"useData\":true});\n",
    "/**\n * @module app/view/render/DotNavigationRenderer\n */\n\n/** @type {module:app/view/base/View} */\nconst View = require(\"app/view/base/View\");\n\n// /** @type {module:app/view/component/ClickableRenderer} */\n// var ClickableRenderer = require(\"app/view/render/LabelRenderer\");\n/** @type {string} */\nconst viewTemplate = require(\"./DotNavigationRenderer.hbs\");\n\n/**\n * @constructor\n * @type {module:app/view/render/DotNavigationRenderer}\n */\nvar DotNavigationRenderer = View.extend({\n\n\t/** @type {string} */\n\tcidPrefix: \"dotRenderer\",\n\t/** @override */\n\ttagName: \"li\",\n\t/** @override */\n\tclassName: \"list-item\",\n\t/** @override */\n\ttemplate: viewTemplate,\n\n\t/** @override */\n\tevents: {\n\t\t\"click\": function(ev) {\n\t\t\tif (ev.defaultPrevented) return;\n\n\t\t\tev.preventDefault();\n\t\t\tthis.trigger(\"renderer:click\", this.model, ev);\n\t\t},\n\t\t\"click a\": function(ev) {\n\t\t\tev.defaultPrevented || ev.preventDefault();\n\t\t}\n\t},\n\n\t/** @override */\n\tinitialize: function(options) {\n\t\tthis.listenTo(this.model, \"selected deselected\", this.renderClassList);\n\t\tthis.renderClassList();\n\t},\n\n\t/** @override */\n\trender: function() {\n\t\tthis.el.innerHTML = this.template(this.model.toJSON());\n\t\tthis.renderClassList();\n\t\treturn this;\n\t},\n\n\trenderClassList: function() {\n\t\tthis.el.classList.toggle(\"selected\", this.model.selected);\n\t},\n});\n\nmodule.exports = DotNavigationRenderer;\n",
    "// hbsfy compiled Handlebars template\nvar HandlebarsCompiler = require('hbsfy/runtime');\nmodule.exports = HandlebarsCompiler.template({\"compiler\":[7,\">= 4.0.0\"],\"main\":function(container,depth0,helpers,partials,data) {\n    var helper, alias1=depth0 != null ? depth0 : (container.nullContext || {}), alias2=helpers.helperMissing, alias3=\"function\", alias4=container.escapeExpression;\n\n  return \"<div class=\\\"placeholder sizing\\\"></div>\\n<img class=\\\"content media-border default\\\" alt=\\\"\"\n    + alias4(((helper = (helper = helpers.text || (depth0 != null ? depth0.text : depth0)) != null ? helper : alias2),(typeof helper === alias3 ? helper.call(alias1,{\"name\":\"text\",\"hash\":{},\"data\":data}) : helper)))\n    + \"\\\" longdesc=\\\"#desc_m\"\n    + alias4(((helper = (helper = helpers.id || (depth0 != null ? depth0.id : depth0)) != null ? helper : alias2),(typeof helper === alias3 ? helper.call(alias1,{\"name\":\"id\",\"hash\":{},\"data\":data}) : helper)))\n    + \"\\\" />\\n\";\n},\"useData\":true});\n",
    "/**\n * @module app/view/render/ImageRenderer\n */\n\n/** @type {module:app/view/MediaRenderer} */\nconst MediaRenderer = require(\"./MediaRenderer\");\n\n/** @type {Function} */\nconst viewTemplate = require(\"./ImageRenderer.hbs\");\n\n/**\n * @constructor\n * @type {module:app/view/render/ImageRenderer}\n */\nvar ImageRenderer = MediaRenderer.extend({\n\n\t/** @type {string} */\n\tcidPrefix: \"imageRenderer\",\n\t/** @type {string} */\n\tclassName: MediaRenderer.prototype.className + \" image-item\",\n\t/** @type {Function} */\n\ttemplate: viewTemplate,\n\n\t/** @override */\n\tinitialize: function(opts) {\n\t\tMediaRenderer.prototype.initialize.apply(this, arguments);\n\t\t// this.createChildren();\n\t\t// this.initializeAsync();\n\t},\n\n\t/* --------------------------- *\n\t/* children/layout\n\t/* --------------------------- */\n\n\t/** @override */\n\tcreateChildren: function() {\n\t\tMediaRenderer.prototype.createChildren.apply(this, arguments);\n\t\t// this.el.innerHTML = this.template(this.model.toJSON());\n\t\tthis.placeholder = this.el.querySelector(\".placeholder\");\n\t},\n\n\t/** @override */\n\trender: function() {\n\t\tMediaRenderer.prototype.render.apply(this, arguments);\n\n\t\t// this.measure();\n\n\t\tvar img = this.getDefaultImage();\n\t\tif (this.metrics.media.width) {\n\t\t\timg.setAttribute(\"width\", this.metrics.media.width);\n\t\t}\n\t\tif (this.metrics.media.height) {\n\t\t\timg.setAttribute(\"height\", this.metrics.media.height);\n\t\t}\n\n\t\tvar content = this.getContentEl();\n\t\tcontent.style.left = this.metrics.content.x + \"px\";\n\t\tcontent.style.top = this.metrics.content.y + \"px\";\n\n\t\t// var sizing = this.getSizingEl();\n\t\t// sizing.style.maxWidth = this.metrics.content.width + \"px\";\n\t\t// sizing.style.maxHeight = this.metrics.content.height + \"px\";\n\n\t\treturn this;\n\t},\n\n\t/* --------------------------- *\n\t/* initializeAsync\n\t/* --------------------------- */\n\n\tinitializeAsync: function() {\n\t\treturn MediaRenderer.prototype.initializeAsync.apply(this, arguments)\n\t\t// return MediaRenderer.whenSelectionIsContiguous(this)\n\t\t// // return Promise.resolve(this)\n\t\t// // \t.then(MediaRenderer.whenSelectionIsContiguous)\n\t\t// \t.then(MediaRenderer.whenSelectTransitionEnds)\n\t\t// \t.then(MediaRenderer.whenDefaultImageLoads)\n\t\t// .then(\n\t\t// \tfunction(view) {\n\t\t// \t\tview.mediaState = \"ready\";\n\t\t// \t})\n\t\t// .catch(\n\t\t// \tfunction(err) {\n\t\t// \t\tif (err instanceof ViewError) {\n\t\t// \t\t\t// NOTE: ignore ViewError type\n\t\t// \t\t\t// console.log(err.view.cid, err.view.model.cid, \"ImageRenderer: \" + err.message);\n\t\t// \t\t} else {\n\t\t// \t\t\tconsole.error(this.cid, err.name, err);\n\t\t// \t\t\tthis.placeholder.innerHTML = \"<p class=\\\"color-fg\\\" style=\\\"position:absolute;bottom:0;padding:3rem;\\\"><strong>\" + err.name + \"</strong> \" + err.message + \"</p>\";\n\t\t// \t\t\tthis.mediaState = \"error\";\n\t\t// \t\t}\n\t\t// \t}.bind(this))\n\t\t;\n\t},\n});\n\nmodule.exports = ImageRenderer;\n",
    "/**\n * @module app/view/render/LabelRenderer\n */\n\n/** @type {module:app/view/base/View} */\nconst View = require(\"app/view/base/View\");\n\n/**\n * @constructor\n * @type {module:app/view/render/LabelRenderer}\n */\nvar LabelRenderer = View.extend({\n\n\t/** @type {string} */\n\tcidPrefix: \"labelRenderer\",\n\n\tproperties: {\n\t\tlabel: {\n\t\t\tget: function() {\n\t\t\t\treturn this._label || (this._label = this.el.querySelector(\".label\"));\n\t\t\t}\n\t\t}\n\t\t// measuredWidth: {\n\t\t// \tget: function() {\n\t\t// \t\treturn this._measuredWidth;\n\t\t// \t}\n\t\t// },\n\t\t// measuredHeight: {\n\t\t// \tget: function() {\n\t\t// \t\treturn this._measuredHeight;\n\t\t// \t}\n\t\t// },\n\t},\n\n\t/* -------------------------------\n\t/* measure\n\t/* ------------------------------- */\n\n\t// _measuredWidth: null,\n\t// _measuredHeight: null,\n\t// measure: function() {},\n});\n\nmodule.exports = LabelRenderer;\n",
    "/*global XMLHttpRequest, HTMLMediaElement, MediaError*/\n/**\n * @module app/view/render/MediaRenderer\n */\n\n/** @type {module:underscore.strings/lpad} */\nconst lpad = require(\"underscore.string/lpad\");\n\n/** @type {module:app/model/item/MediaItem} */\nconst MediaItem = require(\"app/model/item/MediaItem\");\n/** @type {module:app/view/CarouselRenderer} */\nconst CarouselRenderer = require(\"app/view/render/CarouselRenderer\");\n\n// var errorTemplate = require(\"../template/ErrorBlock.hbs\");\n// /** @type {module:utils/css/getBoxEdgeStyles} */\n// var getBoxEdgeStyles = require(\"utils/css/getBoxEdgeStyles\");\n\nvar MediaRenderer = CarouselRenderer.extend({\n\n\t/** @type {string} */\n\tcidPrefix: \"mediaRenderer\",\n\t/** @type {string} */\n\tclassName: CarouselRenderer.prototype.className + \" media-item\",\n\t/** @type {module:app/model/MediaItem} */\n\tmodel: MediaItem,\n\n\tproperties: {\n\t\tdefaultImage: {\n\t\t\tget: function() {\n\t\t\t\treturn this._defaultImage || (this._defaultImage = this.el.querySelector(\"img.default\"));\n\t\t\t}\n\t\t},\n\t\tmediaState: {\n\t\t\tget: function() {\n\t\t\t\treturn this._mediaState;\n\t\t\t},\n\t\t\tset: function(state) {\n\t\t\t\tthis._setMediaState(state);\n\t\t\t}\n\t\t}\n\t},\n\n\t/** @override */\n\tinitialize: function(opts) {\n\t\t// if (this.model.attrs().hasOwnProperty(\"@classname\")) {\n\t\t// \tthis.el.className += \" \" + this.model.attr(\"@classname\");\n\t\t// }\n\n\t\t// NOTE: @classname attr handling moved to CarouselRenderer\n\t\t// if (this.model.attr(\"@classname\") !== void 0) {\n\t\t// \tvar clsAttr = this.model.attr(\"@classname\").split(\" \");\n\t\t// \tfor (var i = 0; i < clsAttr.length; i++) {\n\t\t// \t\tthis.el.classList.add(clsAttr[i]);\n\t\t// \t}\n\t\t// }\n\t\tCarouselRenderer.prototype.initialize.apply(this, arguments);\n\n\t\tthis.metrics.media = {};\n\t\tthis.mediaState = \"idle\";\n\n\t\tthis.initializeAsync()\n\t\t\t.then(this.whenInitialized)\n\t\t\t.catch(this.whenInitializeError.bind(this));\n\t},\n\n\tinitializeAsync: function() {\n\t\t// var MediaRenderer = Object.getPrototypeOf(this).constructor;\n\t\treturn Promise.resolve(this)\n\t\t\t.then(MediaRenderer.whenSelectionIsContiguous)\n\t\t\t.then(MediaRenderer.whenScrollingEnds)\n\t\t\t.then(MediaRenderer.whenDefaultImageLoads);\n\t},\n\n\twhenInitialized: function(view) {\n\t\t// console.log(\"%s::whenInitialized [%s]\", view.cid, \"resolved\");\n\t\tview.mediaState = \"ready\";\n\t\tview.placeholder.removeAttribute(\"data-progress\");\n\t\treturn view;\n\t},\n\n\twhenInitializeError: function(err) {\n\t\tif (err instanceof CarouselRenderer.ViewError) {\n\t\t\t// NOTE: ignore ViewError type\n\t\t\treturn;\n\t\t} else if (err instanceof Error) {\n\t\t\tconsole.error(err.stack);\n\t\t}\n\t\tthis.placeholder.removeAttribute(\"data-progress\");\n\t\tthis.mediaState = \"error\";\n\t},\n\n\tupdateMediaProgress: function(progress, id) {\n\t\tif (_.isNumber(progress)) {\n\t\t\tthis.placeholder.setAttribute(\"data-progress\", lpad(Math.floor(progress * 100), 2, '0'));\n\t\t}\n\t\t// else if (progress === \"complete\") {\n\t\t// \tthis.placeholder.removeAttribute(\"data-progress\");\n\t\t// }\n\t},\n\n\t// whenMediaIsReady: function(view) {\n\t// \treturn MediaRenderer.whenDefaultImageLoads(this, this.updateMediaProgress.bind(this));\n\t// },\n\n\t/* --------------------------- *\n\t/* child getters\n\t/* --------------------------- */\n\n\t/** @return {HTMLElement} */\n\tgetDefaultImage: function() {\n\t\treturn this.defaultImage;\n\t},\n\n\t/* --------------------------- *\n\t/* children/layout\n\t/* --------------------------- */\n\n\tcreateChildren: function() {\n\t\tthis.el.innerHTML = this.template(this.model.toJSON());\n\t},\n\n\t/** @override */\n\tmeasure: function() {\n\t\tCarouselRenderer.prototype.measure.apply(this, arguments);\n\n\t\tvar sw, sh; // source dimensions\n\t\tvar pcw, pch; // measured values\n\t\tvar cx, cy, cw, ch, cs; // computed values\n\t\tvar ew, eh; // content edge totals\n\t\tvar cm; // content metrics\n\n\t\tcm = this.metrics.content;\n\t\tcx = cm.x;\n\t\tcy = cm.y;\n\t\tpcw = cm.width;\n\t\tpch = cm.height;\n\n\t\tew = (cm.paddingLeft + cm.paddingRight + cm.borderLeftWidth + cm.borderRightWidth);\n\t\teh = (cm.paddingTop + cm.paddingBottom + cm.borderTopWidth + cm.borderBottomWidth);\n\t\tpcw -= ew;\n\t\tpch -= eh;\n\n\t\tsw = this.model.get(\"source\").get(\"w\");\n\t\t// || this.defaultImage.naturalWidth || pcw;\n\t\tsh = this.model.get(\"source\").get(\"h\");\n\t\t// || this.defaultImage.naturalHeight || pch;\n\n\t\t// if (!(sw && sh)) {\n\t\t// \tsw = pcw;\n\t\t// \tsh = pch;\n\t\t// }\n\n\t\t// Unless both client dimensions are larger than the source's\n\t\t// choose constraint direction by aspect ratio\n\t\tif (sw < pcw && sh < pch) {\n\t\t\tcs = 1;\n\t\t\tcw = sw;\n\t\t\tch = sh;\n\t\t\tthis.metrics.fitDirection = \"both\";\n\t\t} else if ((pcw / pch) < (sw / sh)) {\n\t\t\t// fit width\n\t\t\tcw = pcw;\n\t\t\tcs = cw / sw;\n\t\t\t// ch = cs * sh;\n\t\t\tch = Math.round(cs * sh);\n\t\t\tthis.metrics.fitDirection = \"width\";\n\t\t} else {\n\t\t\t// fit height\n\t\t\tch = pch;\n\t\t\tcs = ch / sh;\n\t\t\t// cw = cs * sw;\n\t\t\tcw = Math.round(cs * sw);\n\t\t\tthis.metrics.fitDirection = \"height\";\n\t\t}\n\n\t\tthis.metrics.content.x = cx;\n\t\tthis.metrics.content.y = cy;\n\t\tthis.metrics.content.width = cw + ew;\n\t\tthis.metrics.content.height = ch + eh;\n\n\t\tthis.metrics.media.x = cx + cm.paddingLeft + cm.borderLeftWidth;\n\t\tthis.metrics.media.y = cy + cm.paddingTop + cm.borderTopWidth;\n\t\tthis.metrics.media.width = cw;\n\t\tthis.metrics.media.height = ch;\n\t\tthis.metrics.media.scale = cs;\n\n\t\t// console.log(\"%s::measure mw:%s mh:%s fit: %s metrics: %o\", this.cid, pcw, pch, this.metrics.fitDirection, this.metrics);\n\t\t// var sizing = this.getSizingEl();\n\t\t// sizing.style.maxWidth = (cw + ew) + \"px\";\n\t\t// sizing.style.maxHeight = (ch + eh) + \"px\";\n\n\t\treturn this;\n\t},\n\n\trender: function() {\n\t\t// NOTE: not calling super.render, calling measure ourselves\n\t\tthis.measure();\n\n\t\tvar sizing = this.getSizingEl();\n\t\tsizing.style.maxWidth = this.metrics.content.width + \"px\";\n\t\tsizing.style.maxHeight = this.metrics.content.height + \"px\";\n\n\t\tthis.el.setAttribute(\"data-fit-dir\", this.metrics.fitDirection);\n\n\t\treturn this;\n\t},\n\n\t/* --------------------------- *\n\t/* mediaState\n\t/* --------------------------- */\n\n\t_mediaStateEnum: [\"idle\", \"pending\", \"ready\", \"error\"],\n\n\t_setMediaState: function(key) {\n\t\tif (this._mediaStateEnum.indexOf(key) === -1) {\n\t\t\tthrow new Error(\"Argument \" + key + \" invalid. Must be one of: \" + this._mediaStateEnum.join(\", \"));\n\t\t}\n\t\tif (this._mediaState !== key) {\n\t\t\tif (this._mediaState) {\n\t\t\t\tthis.el.classList.remove(this._mediaState);\n\t\t\t}\n\t\t\tthis.el.classList.add(key);\n\t\t\tthis._mediaState = key;\n\t\t\tthis.trigger(\"media:\" + key);\n\t\t}\n\t},\n}, {\n\tLOG_TO_SCREEN: true,\n\t/** @type {module:app/view/promise/whenSelectionDistanceIs} */\n\twhenSelectionDistanceIs: require(\"app/view/promise/whenSelectionDistanceIs\"),\n\n\t/** @type {module:app/view/promise/whenSelectionIsContiguous} */\n\twhenSelectionIsContiguous: require(\"app/view/promise/whenSelectionIsContiguous\"),\n\n\t// /** @type {module:app/view/promise/whenSelectTransitionEnds} */\n\t// whenSelectTransitionEnds: require(\"app/view/promise/whenSelectTransitionEnds\"),\n\n\t/** @type {module:app/view/promise/whenScrollingEnds} */\n\twhenScrollingEnds: require(\"app/view/promise/whenScrollingEnds\"),\n\n\t/** @type {module:app/view/promise/whenDefaultImageLoads} */\n\twhenDefaultImageLoads: require(\"app/view/promise/whenDefaultImageLoads\"),\n});\n\n/* ---------------------------\n/* log to screen\n/* --------------------------- */\nif (DEBUG) {\n\n\tMediaRenderer = (function(MediaRenderer) {\n\t\tif (!MediaRenderer.LOG_TO_SCREEN) return MediaRenderer;\n\n\t\t/** @type {Function} */\n\t\tvar Color = require(\"color\");\n\t\t// /** @type {module:underscore.string/lpad} */\n\t\t// var lpad = require(\"underscore.string/lpad\");\n\t\t// /** @type {module:underscore.string/rpad} */\n\t\t// var rpad = require(\"underscore.string/rpad\");\n\n\t\treturn MediaRenderer.extend({\n\n\t\t\t/** @override */\n\t\t\tinitialize: function() {\n\n\t\t\t\tvar fgColor = new Color(this.model.attr(\"color\"));\n\t\t\t\tvar bgColor = new Color(this.model.attr(\"background-color\"));\n\t\t\t\tthis.__logColors = {\n\t\t\t\t\tnormal: Color(fgColor).mix(bgColor, 0.75).hsl().string(),\n\t\t\t\t\tignored: Color(fgColor).mix(bgColor, 0.25).hsl().string(),\n\t\t\t\t\terror: \"brown\",\n\t\t\t\t\tabort: \"orange\"\n\t\t\t\t};\n\t\t\t\tthis.__logFrameStyle = \"1px dashed \" + Color(fgColor).mix(bgColor, 0.5).hsl().string();\n\t\t\t\tthis.__logStartTime = Date.now();\n\t\t\t\tthis.__rafId = -1;\n\t\t\t\tthis.__onFrame = this.__onFrame.bind(this);\n\t\t\t\tMediaRenderer.prototype.initialize.apply(this, arguments);\n\t\t\t},\n\n\t\t\tinitializeAsync: function() {\n\t\t\t\treturn MediaRenderer.prototype.initializeAsync.apply(this, arguments).catch(function(err) {\n\t\t\t\t\tif (!(err instanceof MediaRenderer.ViewError)) {\n\t\t\t\t\t\tthis.__logMessage(err.message, err.name, this.__logColors[\"error\"]);\n\t\t\t\t\t}\n\t\t\t\t\treturn Promise.reject(err);\n\t\t\t\t}.bind(this));\n\t\t\t},\n\n\t\t\t/** @override */\n\t\t\tcreateChildren: function() {\n\t\t\t\tvar ret = MediaRenderer.prototype.createChildren.apply(this, arguments);\n\n\t\t\t\tthis.__logElement = document.createElement(\"div\");\n\t\t\t\tthis.__logElement.className = \"debug-log\";\n\t\t\t\t// this.__logElement.style.touchAction = \"pan-y\";\n\t\t\t\tthis.__logHeaderEl = document.createElement(\"pre\");\n\t\t\t\tthis.__logHeaderEl.className = \"log-header color-bg\";\n\t\t\t\t// Color(this.model.colors.fgColor).mix(fgColor, 0.9).rgb().string()\n\t\t\t\t// Color(this.model.colors.fgColor).alpha\n\t\t\t\tthis.__logHeaderEl.textContent = this.__getHeaderText();\n\t\t\t\tthis.__logElement.appendChild(this.__logHeaderEl);\n\t\t\t\tthis.el.insertBefore(this.__logElement, this.el.firstElementChild);\n\t\t\t\treturn ret;\n\t\t\t},\n\n\t\t\t/** @override */\n\t\t\trender: function() {\n\t\t\t\tvar ret = MediaRenderer.prototype.render.apply(this, arguments);\n\n\t\t\t\tthis.__logElement.style.top = (this.metrics.content.height + this.metrics.content.y) + \"px\";\n\t\t\t\tthis.__logElement.style.left = this.metrics.content.x + \"px\";\n\t\t\t\tthis.__logElement.style.width = this.metrics.content.width + \"px\";\n\t\t\t\tthis.__logElement.scrollTop = this.__logElement.scrollHeight;\n\n\t\t\t\treturn ret;\n\t\t\t},\n\n\t\t\twhenInitializeError: function(err) {\n\t\t\t\t// NOTE: not calling super\n\t\t\t\t// MediaRenderer.prototype.whenInitializeError.apply(this, arguments);\n\t\t\t\tif (err instanceof CarouselRenderer.ViewError) {\n\t\t\t\t\t// NOTE: ignore ViewError type\n\t\t\t\t\t// console.warn(\"%s::whenInitializeError \", err.view.cid, err.message);\n\t\t\t\t\treturn;\n\t\t\t\t} else if (err instanceof Error) {\n\t\t\t\t\tconsole.warn(err.stack);\n\t\t\t\t}\n\t\t\t\t// this.placeholder.innerHTML = err ? errorTemplate(err) : \"\";\n\t\t\t\tthis.placeholder.removeAttribute(\"data-progress\");\n\t\t\t\tthis.mediaState = \"error\";\n\n\t\t\t\t// console.error(\"%s::initializeAsync [%s (caught)]: %s\", this.cid, err.name, (err.info && err.info.logMessage) || err.message);\n\t\t\t\t// err.logEvent && console.log(err.logEvent);\n\t\t\t},\n\n\t\t\t/* --------------------------- *\n\t\t\t/* log methods\n\t\t\t/* --------------------------- */\n\n\t\t\t__logMessage: function(msg, logtype, color) {\n\t\t\t\tvar logEntryEl = document.createElement(\"pre\");\n\n\t\t\t\tlogtype || (logtype = \"-\")\n\t\t\t\tlogEntryEl.textContent = this.__getTStamp() + \" \" + msg;\n\t\t\t\tlogEntryEl.setAttribute(\"data-logtype\", logtype);\n\t\t\t\tlogEntryEl.style.color = color || this.__logColors[logtype] || this.__logColors.normal;\n\n\t\t\t\tthis.__logElement.appendChild(logEntryEl);\n\t\t\t\tthis.__logElement.scrollTop = this.__logElement.scrollHeight;\n\n\t\t\t\tif (this.__rafId == -1) {\n\t\t\t\t\tthis.__rafId = this.requestAnimationFrame(this.__onFrame);\n\t\t\t\t}\n\t\t\t},\n\n\t\t\t__onFrame: function(tstamp) {\n\t\t\t\tthis.__rafId = -1;\n\t\t\t\tthis.__logElement.lastElementChild.style.borderBottom = this.__logFrameStyle;\n\t\t\t\tthis.__logElement.lastElementChild.style.paddingBottom = \"2px\";\n\t\t\t\tthis.__logElement.lastElementChild.style.marginBottom = \"2px\";\n\t\t\t},\n\n\t\t\t__getTStamp: function() {\n\t\t\t\t// return new Date(Date.now() - this.__logStartTime).toISOString().substr(11, 12);\n\t\t\t\treturn lpad(((Date.now() - this.__logStartTime) / 1000).toFixed(3), 8, \"0\");\n\t\t\t},\n\n\t\t\t__getHeaderText: function() {\n\t\t\t\treturn '';\n\t\t\t},\n\t\t});\n\t})(MediaRenderer);\n\n} // end debug\n\n/**\n * @constructor\n * @type {module:app/view/render/MediaRenderer}\n */\nmodule.exports = MediaRenderer;\n",
    "/**\n * @module app/view/render/PlayableRenderer\n */\n\n/** @type {module:app/view/MediaRenderer} */\nconst MediaRenderer = require(\"app/view/render/MediaRenderer\");\n// /** @type {module:app/view/component/CanvasProgressMeter} */\n// var ProgressMeter = require(\"app/view/component/CanvasProgressMeter\");\n\n/** @type {Function} */\nconst prefixedProperty = require(\"utils/prefixedProperty\");\n/** @type {Function} */\nconst prefixedEvent = require(\"utils/prefixedEvent\");\n\n// var visibilityHiddenProp = prefixedProperty(\"hidden\", document);\n/** @type {String} */\nvar visibilityStateProp = prefixedProperty(\"visibilityState\", document);\n/** @type {String} */\nvar visibilityChangeEvent = prefixedEvent(\"visibilitychange\", document, \"hidden\");\n\n// /** @type {Function} */\n// var Color = require(\"color\");\n//\n// /** @type {Function} */\n// // var duotone = require(\"utils/canvas/bitmap/duotone\");\n// // var stackBlurMono = require(\"utils/canvas/bitmap/stackBlurMono\");\n// var stackBlurRGB = require(\"utils/canvas/bitmap/stackBlurRGB\");\n// // var getAverageRGBA = require(\"utils/canvas/bitmap/getAverageRGBA\");\n// var getAverageRGB = require(\"utils/canvas/bitmap/getAverageRGB\");\n// // var inflateRect = require(\"utils/geom/inflateRect\");\n//\n\n// var WAIT_DEBOUNCE_MS = require(\"app/control/Globals\").TRANSITION_DURATION;\n\n// /** @type {HTMLCanvasElement} */\n// var _sharedCanvas = null;\n// /** @return {HTMLCanvasElement} */\n// var getSharedCanvas = function() {\n// \tif (_sharedCanvas === null) {\n// \t\t_sharedCanvas = document.createElement(\"canvas\");\n// \t}\n// \treturn _sharedCanvas;\n// };\n\n// var SVG_NS = \"http://www.w3.org/2000/svg\";\n// var XLINK_NS = \"http://www.w3.org/1999/xlink\";\n//\n// var useIdSeed = 0\n// var createSVGUseElement = function() {\n// \tvar svgEl = document.createElementNS(SVG_NS, \"use\");\n// \tsvgEl.setAttributeNS(null, \"id\", name + (useIdSeed++));\n// \tsvgEl.setAttributeNS(null, \"class\", [name, \"symbol\"].join(\" \"));\n// \tsvgEl.setAttributeNS(XLINK_NS, \"xlink:href\", \"#\" + name);\n// \treturn svgEl;\n// };\n\n// function logAttachInfo(view, name, level) {\n// \tif ([\"log\", \"info\", \"warn\", \"error\"].indexOf(level) != -1) {\n// \t\tlevel = \"log\";\n// \t}\n// \tconsole[level].call(console, \"%s::%s [parent:%s %s %s depth:%s]\", view.cid, name, view.parentView && view.parentView.cid, view.attached ? \"attached\" : \"detached\", view._viewPhase, view.viewDepth);\n// }\n\n/**\n * @constructor\n * @type {module:app/view/render/PlayableRenderer}\n */\nvar PlayableRenderer = MediaRenderer.extend({\n\n\t/** @type {string} */\n\tcidPrefix: \"playableRenderer\",\n\n\t/** @type {string|Function} */\n\tclassName: MediaRenderer.prototype.className + \" playable-item\",\n\n\tproperties: {\n\t\tmediaPaused: {\n\t\t\t/** @return {Boolean} */\n\t\t\tget: function() {\n\t\t\t\treturn this._isMediaPaused();\n\t\t\t}\n\t\t},\n\t\tmediaWaiting: {\n\t\t\t/** @return {Boolean} */\n\t\t\tget: function() {\n\t\t\t\treturn this._isMediaWaiting();\n\t\t\t}\n\t\t},\n\t\tplaybackRequested: {\n\t\t\t/** @return {Boolean} */\n\t\t\tget: function() {\n\t\t\t\treturn this._playbackRequested;\n\t\t\t},\n\t\t\tset: function(value) {\n\t\t\t\tthis._setPlaybackRequested(value);\n\t\t\t}\n\t\t},\n\t\toverlay: {\n\t\t\t/** @return {HTMLElement} */\n\t\t\tget: function() {\n\t\t\t\treturn this._overlay || (this._overlay = this.el.querySelector(\".overlay\"));\n\t\t\t}\n\t\t},\n\t\t// playToggle: {\n\t\t// \t/** @return {HTMLElement} */\n\t\t// \tget: function() {\n\t\t// \t\treturn this._playToggle || (this._playToggle = this.el.querySelector(\".play-toggle\"));\n\t\t// \t}\n\t\t// },\n\t\t// playToggleSymbol: {\n\t\t// \t/** @return {HTMLElement} */\n\t\t// \tget: function() {\n\t\t// \t\treturn this._playToggleSymbol || (this._playToggleSymbol = this.el.querySelector(\".play-toggle-symbol\"));\n\t\t// \t}\n\t\t// },\n\t\tplayToggleHitarea: {\n\t\t\t/** @return {HTMLElement} */\n\t\t\tget: function() {\n\t\t\t\treturn this._playToggleHitarea || (this._playToggleHitarea = this.el.querySelector(\".play-toggle-hitarea\"));\n\t\t\t}\n\t\t},\n\t},\n\n\t/** @override */\n\tinitialize: function(opts) {\n\t\tthis._playToggleSymbol = {};\n\t\t// this._toggleWaiting = _.debounce(this._toggleWaiting, 500);\n\t\t// this._toggleWaiting = _.throttle(this._toggleWaiting, WAIT_DEBOUNCE_MS, { leading: true, trailing: true });\n\n\t\t_.bindAll(this,\n\t\t\t\"_onPlaybackToggle\",\n\t\t\t\"_onVisibilityChange\"\n\t\t);\n\t\tMediaRenderer.prototype.initialize.apply(this, arguments);\n\t\tthis._setPlaybackRequested(this._playbackRequested);\n\n\t\t// this.listenTo(this, \"view:parentChange\", function(childView, newParent, oldParent) {\n\t\t// \t// logAttachInfo(this, \"[view:parentChange]\", \"info\");\n\t\t// \tconsole.info(\"%s::[view:parentChange] '%s' to '%s'\", this.cid, oldParent && oldParent.cid, newParent && newParent.cid);\n\t\t// });\n\t},\n\n\t// /** @override */\n\t// initializeAsync: function() {\n\t// \treturn MediaRenderer.prototype.initialize.initializeAsync.apply(this, arguments);\n\t// },\n\n\t// /** @override */\n\t// remove: function() {\n\t// \tMediaRenderer.prototype.remove.apply(this, arguments);\n\t// \treturn this;\n\t// },\n\n\t/* --------------------------- *\n\t/* children/layout\n\t/* --------------------------- */\n\n\t// createChildren: function() {\n\t// },\n\n\t/* --------------------------- *\n\t/* setEnabled\n\t/* --------------------------- */\n\n\t/** @override */\n\tsetEnabled: function(enabled) {\n\t\tMediaRenderer.prototype.setEnabled.apply(this, arguments);\n\t\t// this._validatePlayback(enabled);\n\t\t// if (enabled) {\n\t\tthis._validatePlayback();\n\t\t// } else {\n\t\t// \t// if selected, pause media\n\t\t// \tthis.model.selected && this._togglePlayback(false);\n\t\t// \t// this._togglePlayback(false);\n\t\t// }\n\t\t// console.log(\"%s::setEnabled\", this.cid, this.enabled);\n\t\t// this._playToggleSymbol.paused = (this.enabled && this.model.selected);\n\t\t//}\n\t},\n\n\t/* ---------------------------\n\t/* selection handlers\n\t/* --------------------------- */\n\n\tlistenToSelection: function() {\n\t\tif (this._viewPhase != \"initialized\")\n\t\t\tthrow new Error(this.cid + \"::listenToSelection called while \" + this._viewPhase);\n\n\t\t// logAttachInfo(this, \"listenToSelection\", \"log\");\n\t\t// this.listenTo(this, \"view:removed\", this.removeSelectionListeners);\n\t\tthis.listenTo(this.model, \"selected\", this._onModelSelected);\n\t\tthis.listenTo(this.model, \"deselected\", this._onModelDeselected);\n\t\tif (this.model.selected) {\n\t\t\tthis._onModelSelected();\n\t\t}\n\t},\n\n\t/* model selected handlers:\n\t/* model selection toggles playback\n\t/* --------------------------- */\n\n\t_onModelSelected: function() {\n\t\tconsole.log(\"%s::_onModelSelected _playbackRequested: %s, event: %s\", this.cid, this._playbackRequested, this._toggleEvent);\n\t\tthis.listenTo(this, \"view:parentChange\", this._onParentChange);\n\t\tif (this.parentView) this._onParentChange(this, this.parentView, null);\n\n\t\t// this.enabled = true;\n\t\tthis._playToggleSymbol.paused = !this.enabled;\n\n\t\tthis._listenWhileSelected();\n\t\tthis._validatePlayback();\n\t},\n\n\t_onModelDeselected: function() {\n\t\tconsole.log(\"%s::_onModelDeselected _playbackRequested: %s, event: %s\", this.cid, this._playbackRequested, this._toggleEvent);\n\t\tthis.stopListening(this, \"view:parentChange\", this._onParentChange);\n\t\tif (this.parentView) this._onParentChange(this, null, this.parentView);\n\n\t\tthis._playToggleSymbol.paused = true;\n\n\t\tthis._stopListeningWhileSelected();\n\t\tthis._validatePlayback(false);\n\t\t// this._togglePlayback(false);\n\t},\n\n\t/* view:parentChange handlers 3\n\t/* --------------------------- */\n\t_onParentChange: function(childView, newParent, oldParent) {\n\t\t// console.log(\"[scroll] %s::_onParentChange '%s' to '%s'\", this.cid, oldParent && oldParent.cid, newParent && newParent.cid);\n\t\tif (oldParent) this.stopListening(oldParent, \"view:scrollstart view:scrollend\", this._onScrollChange);\n\t\tif (newParent) this.listenTo(newParent, \"view:scrollstart view:scrollend\", this._onScrollChange);\n\t},\n\n\t_onScrollChange: function() {\n\t\tif (this.parentView === null) {\n\t\t\tthrow new Error(this.cid + \"::_onScrollChange parentView is null\");\n\t\t}\n\t\tthis._validatePlayback();\n\t},\n\n\t/* visibility dom event\n\t/* --------------------------- */\n\t_onVisibilityChange: function(ev) {\n\t\tthis._validatePlayback();\n\t},\n\n\t/* listen to DOM events\n\t * --------------------------- */\n\n\t_listenWhileSelected: function() {\n\t\tthis.listenTo(this, \"view:removed\", this._stopListeningWhileSelected);\n\t\tdocument.addEventListener(visibilityChangeEvent, this._onVisibilityChange, false);\n\t\tthis.playToggleHitarea.addEventListener(this._toggleEvent, this._onPlaybackToggle, false);\n\t},\n\n\t_stopListeningWhileSelected: function() {\n\t\tthis.stopListening(this, \"view:removed\", this._stopListeningWhileSelected);\n\t\tdocument.removeEventListener(visibilityChangeEvent, this._onVisibilityChange, false);\n\t\tthis.playToggleHitarea.removeEventListener(this._toggleEvent, this._onPlaybackToggle, false);\n\t},\n\n\t/* --------------------------- *\n\t/* play-toggle\n\t/* --------------------------- */\n\n\t/** @type {String} */\n\t_toggleEvent: MediaRenderer.CLICK_EVENT, //window.hasOwnProperty(\"onpointerup\") ? \"pointerup\" : \"mouseup\",\n\n\t_onPlaybackToggle: function(ev) {\n\t\t//console.log(\"%s[%sabled]::_onPlaybackToggle[%s] defaultPrevented: %s\", this.cid, this.enabled ? \"en\" : \"dis\", ev.type, ev.defaultPrevented);\n\t\t// NOTE: Perform action if MouseEvent.button is 0 or undefined (0: left-button)\n\t\tif (this.enabled && !ev.defaultPrevented && !ev.button) {\n\t\t\tev.preventDefault();\n\t\t\tthis.playbackRequested = !this.playbackRequested;\n\t\t}\n\t},\n\n\t/* --------------------------- *\n\t/* playbackRequested\n\t/* --------------------------- */\n\n\t_playbackCount: 0,\n\n\t/** @type {Boolean?} */\n\t_playbackRequested: null,\n\n\t_setPlaybackRequested: function(value) {\n\t\tthis._playbackRequested = value;\n\n\t\tvar classList = this.content.classList;\n\t\tclassList.toggle(\"playing\", value === true);\n\t\tclassList.toggle(\"paused\", value === false);\n\t\tclassList.toggle(\"requested\", value === true || value === false);\n\n\t\tthis._renderPlaybackState();\n\n\t\t// this._validatePlayback(this.playbackRequested);\n\t\t// if (this.playbackRequested) {\n\t\tthis._validatePlayback();\n\t\t// } else {\n\t\t// \tthis._togglePlayback(false);\n\t\t// }\n\t},\n\n\t/* --------------------------- *\n\t/* _togglePlayback\n\t/* --------------------------- */\n\n\t/** @param {Boolean} */\n\t_togglePlayback: function(newPlayState) {\n\t\tif (DEBUG) this.__logMessage([\n\t\t\t\t\"args:\", Array.prototype.join.apply(arguments),\n\t\t\t\t\"paused:\", (this._isMediaPaused() ? \"pause\" : \"play\"),\n\t\t\t\t\"media-state:\", this.mediaState,\n\t\t\t\t].join(\" \"),\n\t\t\t\"toggle-playback\");\n\n\t\tif (_.isBoolean(newPlayState) && newPlayState !== this._isMediaPaused()) {\n\t\t\treturn; // requested state is current, do nothing\n\t\t} else {\n\t\t\tnewPlayState = this._isMediaPaused();\n\t\t}\n\t\tif (newPlayState) { // changing to what?\n\t\t\t// this._playbackCount++;\n\t\t\tthis._playMedia();\n\t\t} else {\n\t\t\tthis._pauseMedia();\n\t\t}\n\t\t/* NOTE: called from _setPlaybackRequested */\n\t\t// this._renderPlaybackState();\n\t},\n\n\t_canResumePlayback: function() {\n\t\treturn !!(\n\t\t\tthis.enabled &&\n\t\t\tthis.model.selected &&\n\t\t\tthis.playbackRequested &&\n\t\t\t(this.mediaState === \"ready\") &&\n\t\t\tthis.attached &&\n\t\t\t(this.parentView !== null) &&\n\t\t\t(!this.parentView.scrolling) &&\n\t\t\t(document[visibilityStateProp] != \"hidden\")\n\t\t);\n\t},\n\n\t_validatePlayback: function(shortcircuit) {\n\t\t// a 'shortcircuit' boolean argument can be passed, and if false,\n\t\t// skip _canResumePlayback and pause playback right away\n\t\tif (arguments.length !== 0 && !shortcircuit) {\n\t\t\tthis._togglePlayback(false);\n\t\t} else {\n\t\t\tthis._togglePlayback(this._canResumePlayback());\n\t\t}\n\t\tthis._playToggleSymbol.paused = !(this.attached && this.enabled && this.model.selected);\n\t},\n\n\t/* ---------------------------\n\t/* _setPlayToggleSymbol\n\t/* --------------------------- */\n\n\t_renderPlaybackState: function() {\n\t\tif (!this.attached) {\n\t\t\treturn;\n\t\t}\n\t\tif (this.progressMeter) {\n\t\t\tthis.progressMeter.stalled = this._isMediaWaiting();\n\t\t}\n\t\t// this._setPlayToggleSymbol(\"waiting\");\n\t\t// this.content.classList.toggle(\"waiting\", true);\n\n\t\t// if (!this.content.classList.contains(\"started\")) {\n\t\t// \tthis._setPlayToggleSymbol(\"play\");\n\t\t// } else\n\t\tvar waiting = !this.parentView.scrolling && this._isMediaWaiting();\n\n\t\tif (this.playbackRequested) {\n\t\t\tif (waiting) {\n\t\t\t\tthis._setPlayToggleSymbol(\"waiting\");\n\t\t\t} else {\n\t\t\t\tthis._setPlayToggleSymbol(\"play\");\n\t\t\t}\n\t\t} else {\n\t\t\tif (this.content.classList.contains(\"started\")) {\n\t\t\t\tthis._setPlayToggleSymbol(\"pause\");\n\t\t\t} else {\n\t\t\t\tthis._setPlayToggleSymbol(\"play\");\n\t\t\t}\n\t\t}\n\t\tvar cls = this.content.classList;\n\t\tcls.toggle(\"playing\", this.playbackRequested);\n\t\tcls.toggle(\"paused\", !this.playbackRequested);\n\t\tcls.toggle(\"waiting\", waiting);\n\n\t\t//console.log(\"%s::_renderPlaybackState [play: %s] [wait: %s] [symbol: %s]\", this.cid, this.playbackRequested, this._isMediaWaiting(), this._playToggleSymbol.symbolName);\n\t},\n\n\t_setPlayToggleSymbol: function(symbolName) {\n\t\t//console.log(\"%s::_setPlayToggleSymbol [enabled: %s] [selected: %s] [symbol: %s]\", this.cid, this.enabled, !!(this.model.selected), symbolName);\n\n\t\t// this._playToggleSymbol.paused = !(this.attached && this.enabled && !!(this.model.selected));\n\t\tthis._playToggleSymbol.symbolName = symbolName;\n\t\tif (this.mediaState === \"ready\") { //this._playToggleSymbol.renderFlags) {\n\t\t\tthis._playToggleSymbol.renderNow();\n\t\t}\n\t},\n\n\t// _playToggleSymbolSvg: null,\n\t// _playToggleSymbolName: null,\n\t// _setPlayToggleSymbol_svg: function(symbolName) {\n\t// \tif (this._playToggleSymbolName !== symbolName) {\n\t// \t\tvar svgDoc = this.el.querySelector(\"svg.play-toggle-symbol\");\n\t// \t\tif (this._playToggleSymbolSvg) {\n\t// \t\t\tsvgDoc.removeChild(this._playToggleSymbolSvg);\n\t// \t\t}\n\t// \t\tvar svgSym = document.createElementNS(\"http://www.w3.org/2000/svg\", \"use\");\n\t// \t\tsvgSym.setAttributeNS(\"http://www.w3.org/1999/xlink\", \"xlink:href\", \"#\" + symbolName);\n\t// \t\tsvgDoc.appendChild(svgSym);\n\t// \t\tsvgDoc.setAttributeNS(null, \"class\", symbolName + \"-symbol play-toggle-symbol\");\n\t//\n\t// \t\tthis._playToggleSymbolSvg = svgSym;\n\t// \t\tthis._playToggleSymbolName = symbolName;\n\t// \t}\n\t// },\n\n\t/* --------------------------- *\n\t/* waiting\n\t/* --------------------------- */\n\n\t_isWaiting: false,\n\n\t_isMediaWaiting: function() {\n\t\treturn this._isWaiting;\n\t},\n\n\t_toggleWaiting: function(waiting) {\n\t\tif (arguments.length === 0) {\n\t\t\twaiting = !this._isWaiting;\n\t\t}\n\t\t// if (this._isMediaPaused()) {\n\t\t// \twaiting = false;\n\t\t// }\n\t\tif (this._isWaiting !== waiting) {\n\t\t\tthis._isWaiting = waiting;\n\t\t\tthis._renderPlaybackState();\n\t\t}\n\t},\n\n\t/* --------------------------- *\n\t/* abstract\n\t/* --------------------------- */\n\n\t_isMediaPaused: function() {\n\t\tconsole.warn(\"%s::_isMediaPaused Not implemented\", this.cid);\n\t\treturn true;\n\t},\n\n\t_playMedia: function() {\n\t\tconsole.warn(\"%s::_playMedia Not implemented\", this.cid);\n\t},\n\n\t_pauseMedia: function() {\n\t\tconsole.warn(\"%s::_pauseMedia Not implemented\", this.cid);\n\t},\n\n\t/* --------------------------- *\n\t/* util\n\t/* --------------------------- */\n\n\tupdateOverlay: function(mediaEl, targetEl, rectEl) {\n\t\t// this method is not critical, just catch and log all errors\n\t\t// try {\n\t\t// \tthis._updateOverlay(mediaEl, targetEl, rectEl)\n\t\t// } catch (err) {\n\t\t// \tconsole.error(\"%s::updateOverlay\", this.cid, err);\n\t\t// }\n\t},\n\n\t/**\\/\n\t_drawMediaElement: function(ctx, mediaEl, dest) {\n\t\t// destination rect\n\t\t// NOTE: mediaEl is expected to have the same dimensions in this.metrics.media\n\t\tmediaEl || (mediaEl = this.defaultImage);\n\t\tdest || (dest = {\n\t\t\tx: 0,\n\t\t\ty: 0,\n\t\t\twidth: this.metrics.media.width,\n\t\t\theight: this.metrics.media.height\n\t\t});\n\n\t\t// native/display scale\n\t\tvar sW = this.model.get(\"source\").get(\"w\"),\n\t\t\tsH = this.model.get(\"source\").get(\"h\"),\n\t\t\trsX = sW / this.metrics.media.width,\n\t\t\trsY = sH / this.metrics.media.height;\n\n\t\t// dest, scaled to native\n\t\tvar src = {\n\t\t\tx: Math.max(0, dest.x * rsX),\n\t\t\ty: Math.max(0, dest.y * rsY),\n\t\t\twidth: Math.min(sW, dest.width * rsX),\n\t\t\theight: Math.min(sH, dest.height * rsY)\n\t\t};\n\n\t\t// resize canvas\n\t\t// var canvas = ctx.canvas;\n\t\t// if (canvas.width !== dest.width || canvas.height !== dest.height) {\n\t\t// \tcanvas.width = dest.width;\n\t\t// \tcanvas.height = dest.height;\n\t\t// }\n\t\tctx.canvas.width = dest.width;\n\t\tctx.canvas.height = dest.height;\n\n\t\t// copy image to canvas\n\t\tctx.clearRect(0, 0, dest.width, dest.height);\n\t\tctx.drawImage(mediaEl,\n\t\t\tsrc.x, src.y, src.width, src.height,\n\t\t\t0, 0, dest.width, dest.height // destination rect\n\t\t);\n\n\t\treturn ctx;\n\t},\n\n\t_getImageData: function(mediaEl, targetEl, rectEl) {\n\t\t// src/dest rects\n\t\t// ------------------------------\n\t\trectEl || (rectEl = targetEl);\n\n\t\t// NOTE: does not work with svg element\n\t\t// var tRect = rectEl.getBoundingClientRect();\n\t\t// var cRect = mediaEl.getBoundingClientRect();\n\t\t// var tX = tRect.x - cRect.x,\n\t\t// \ttY = tRect.y - cRect.y,\n\t\t// \ttW = tRect.width,\n\t\t// \ttH = tRect.height;\n\n\t\t// target bounds\n\t\tvar tX = rectEl.offsetLeft,\n\t\t\ttY = rectEl.offsetTop,\n\t\t\ttW = rectEl.offsetWidth,\n\t\t\ttH = rectEl.offsetHeight;\n\n\t\tif (tX === void 0 || tY === void 0 || tW === void 0 || tH === void 0) {\n\t\t\treturn;\n\t\t}\n\n\t\t// destination rect\n\t\tvar RECT_GROW = 0;\n\t\tvar dest = {\n\t\t\tx: tX - RECT_GROW,\n\t\t\ty: tY - RECT_GROW,\n\t\t\twidth: tW + RECT_GROW * 2,\n\t\t\theight: tH + RECT_GROW * 2\n\t\t};\n\n\t\t// native/display scale\n\t\tvar sW = this.model.get(\"source\").get(\"w\"),\n\t\t\tsH = this.model.get(\"source\").get(\"h\"),\n\t\t\trsX = sW / this.metrics.media.width,\n\t\t\trsY = sH / this.metrics.media.height;\n\n\t\t// dest, scaled to native\n\t\tvar src = {\n\t\t\tx: Math.max(0, dest.x * rsX),\n\t\t\ty: Math.max(0, dest.y * rsY),\n\t\t\twidth: Math.min(sW, dest.width * rsX),\n\t\t\theight: Math.min(sH, dest.height * rsY)\n\t\t};\n\n\t\t// Copy image to canvas\n\t\t// ------------------------------\n\t\t// canvas = document.createElement(\"canvas\");\n\t\t// canvas.style.width  = dest.width + \"px\";\n\t\t// canvas.style.height = dest.height + \"px\";\n\n\t\tvar canvas = getSharedCanvas();\n\t\tif (canvas.width !== dest.width || canvas.height !== dest.height) {\n\t\t\tcanvas.width = dest.width;\n\t\t\tcanvas.height = dest.height;\n\t\t}\n\t\tvar ctx = canvas.getContext(\"2d\");\n\t\tctx.clearRect(0, 0, dest.width, dest.height);\n\t\tctx.drawImage(mediaEl,\n\t\t\tsrc.x, src.y, src.width, src.height,\n\t\t\t0, 0, dest.width, dest.height // destination rect\n\t\t);\n\t\treturn ctx.getImageData(0, 0, dest.width, dest.height);\n\t},\n\n\t_updateOverlay: function(mediaEl, targetEl, rectEl) {\n\t\tvar canvas, ctx;\n\t\tvar imageData = this._getImageData(mediaEl, targetEl, rectEl);\n\t\tvar avgColor = Color().rgb(getAverageRGB(imageData));\n\n\t\t// var avgHex = avgColor.hex().string(), els = this.el.querySelectorAll(\"img, video\");\n\t\t// for (var i = 0; i < els.length; i++) {\n\t\t// \tels.item(i).style.backgroundColor = avgHex;\n\t\t// }\n\n\t\ttargetEl.classList.toggle(\"over-dark\", avgColor.dark());\n\n\t\t// console.log(\"%s::updateOverlay() avgColor:%s (%s)\", this.cid, avgColor.rgb().string(), avgColor.dark()?\"dark\":\"light\", targetEl);\n\n\t\t// Color, filter opts\n\t\t// ------------------------------\n\n\t\tthis.fgColor || (this.fgColor = new Color(this.model.attr(\"color\")));\n\t\tthis.bgColor || (this.bgColor = new Color(this.model.attr(\"background-color\")));\n\n\t\tvar opts = { radius: 20 };\n\t\tvar isFgDark = this.fgColor.luminosity() < this.bgColor.luminosity();\n\t\topts.x00 = isFgDark ? Color(this.fgColor).lighten(0.5) : Color(this.bgColor).darken(0.5);\n\t\topts.xFF = isFgDark ? Color(this.bgColor).lighten(0.5) : Color(this.fgColor).darken(0.5);\n\n\t\tstackBlurRGB(imageData, { radius: 40 });\n\t\t// stackBlurMono(imageData, opts);\n\t\t// duotone(imageData, opts);\n\n\t\tctx = getSharedCanvas();\n\t\tif (canvas.width !== imageData.width || canvas.height !== imageData.height) {\n\t\t\tcanvas.width = imageData.width;\n\t\t\tcanvas.height = imageData.height;\n\t\t}\n\t\tctx = canvas.getContext(\"2d\");\n\t\tctx.putImageData(imageData, 0, 0);\n\t\ttargetEl.style.backgroundOrigin = \"border-box\";\n\t\ttargetEl.style.backgroundClip = \"content-box\";\n\t\ttargetEl.style.backgroundSize = \"100%\";\n\t\t// targetEl.style.padding = \"0 0 5rem 0\";\n\t\ttargetEl.style.backgroundImage = \"url(\" + canvas.toDataURL() + \")\";\n\t} /**/\n});\n\n/* ---------------------------\n/* Google Analytics\n/* --------------------------- */\n// if (window.GTAG_ENABLED && window.ga) {\nif (window.ga) {\n\tPlayableRenderer = (function(PlayableRenderer) {\n\n\t\t/** @type {module:underscore.strings/dasherize} */\n\t\tvar dasherize = require(\"underscore.string/dasherize\");\n\n\t\t// var readyEvents = [\"playing\", \"waiting\", \"ended\"];\n\t\t// var userEvents = [\"play\", \"pause\"];\n\n\t\treturn PlayableRenderer.extend({\n\n\t\t\t/** @override */\n\t\t\tinitialize: function() {\n\t\t\t\tvar retval = PlayableRenderer.prototype.initialize.apply(this, arguments);\n\t\t\t\tthis._gaEventSuffix = this.playbackRequested ? \"-autoplay\" : \"\";\n\t\t\t\treturn retval;\n\t\t\t},\n\n\t\t\t/** @override */\n\t\t\t_onPlaybackToggle: function(ev) {\n\t\t\t\tvar retval = PlayableRenderer.prototype._onPlaybackToggle.apply(this, arguments);\n\t\t\t\tif (window.ga) {\n\t\t\t\t\twindow.ga(\"send\", {\n\t\t\t\t\t\thitType: \"event\",\n\t\t\t\t\t\teventCategory: dasherize(this.cidPrefix),\n\t\t\t\t\t\teventAction: (this.playbackRequested ? \"play\" : \"pause\") + this._gaEventSuffix,\n\t\t\t\t\t\teventLabel: this.model.get(\"text\"),\n\t\t\t\t\t});\n\t\t\t\t} else {\n\t\t\t\t\tconsole.warn(\"%s::_onPlaybackToggle window.ga is %s\", this.cid, window.ga);\n\t\t\t\t}\n\t\t\t\treturn retval;\n\t\t\t},\n\n\t\t\t// /** @override */\n\t\t\t// _togglePlayback: function(newPlayState) {\n\t\t\t// \tvar retval = PlayableRenderer.prototype._togglePlayback.apply(this, arguments);\n\t\t\t// \twindow.ga(\"send\", {\n\t\t\t// \t\thitType: \"event\",\n\t\t\t// \t\teventCategory: \"Playable\",\n\t\t\t// \t\teventAction: this.playbackRequested ? \"play\" : \"pause\",\n\t\t\t// \t\teventLabel: this.model.get(\"text\"),\n\t\t\t// \t});\n\t\t\t// \treturn retval;\n\t\t\t// },\n\t\t});\n\t})(PlayableRenderer);\n}\n\n// if (DEBUG) {\n// \tPlayableRenderer.prototype._logFlags = \"\";\n//\n// \tPlayableRenderer = (function(PlayableRenderer) {\n// \t\tif (!PlayableRenderer.LOG_TO_SCREEN) return PlayableRenderer;\n//\n// \t\t/** @type {module:underscore.strings/lpad} */\n// \t\tvar lpad = require(\"underscore.string/lpad\");\n//\n// \t\treturn PlayableRenderer.extend({\n// \t\t\t_canResumePlayback: function() {\n// \t\t\t\tvar retval = PlayableRenderer.prototype._canResumePlayback.apply(this.arguments);\n// \t\t\t\tconsole.log(\"[scroll] %s::_canResumePlayback():%s\", this.cid, retval, {\n// \t\t\t\t\t\"enabled\": this.enabled,\n// \t\t\t\t\t\"selected\": (!!this.model.selected),\n// \t\t\t\t\t\"playbackRequested\": this.playbackRequested,\n// \t\t\t\t\t\"attached\": this.attached,\n// \t\t\t\t\t\"parentView\": (this.parentView && this.parentView.cid),\n// \t\t\t\t\t\"!scrolling\": (this.parentView && !this.parentView.scrolling),\n// \t\t\t\t\t\"mediaState\": this.mediaState,\n// \t\t\t\t\t// \"!document.hidden\": !document[visibilityHiddenProp],\n// \t\t\t\t\t\"visibilityState\": document[visibilityStateProp]\n// \t\t\t\t});\n// \t\t\t\treturn retval;\n// \t\t\t},\n// \t\t});\n// \t})(PlayableRenderer);\n// }\n\nmodule.exports = PlayableRenderer;\n",
    "// hbsfy compiled Handlebars template\nvar HandlebarsCompiler = require('hbsfy/runtime');\nmodule.exports = HandlebarsCompiler.template({\"compiler\":[7,\">= 4.0.0\"],\"main\":function(container,depth0,helpers,partials,data) {\n    var helper, alias1=depth0 != null ? depth0 : (container.nullContext || {}), alias2=helpers.helperMissing, alias3=\"function\", alias4=container.escapeExpression;\n\n  return \"<div class=\\\"placeholder sizing\\\"></div>\\n<div class=\\\"content\\\">\\n\t<div class=\\\"media-border content-size\\\"></div>\\n\t<div class=\\\"controls content-size\\\">\\n\t\t<canvas class=\\\"progress-meter\\\"></canvas>\\n\t</div>\\n\t<div class=\\\"sequence media-size\\\">\\n\t\t<img class=\\\"sequence-step current default\\\" alt=\\\"\"\n    + alias4(((helper = (helper = helpers.text || (depth0 != null ? depth0.text : depth0)) != null ? helper : alias2),(typeof helper === alias3 ? helper.call(alias1,{\"name\":\"text\",\"hash\":{},\"data\":data}) : helper)))\n    + \"\\\" longdesc=\\\"#desc_m\"\n    + alias4(((helper = (helper = helpers.id || (depth0 != null ? depth0.id : depth0)) != null ? helper : alias2),(typeof helper === alias3 ? helper.call(alias1,{\"name\":\"id\",\"hash\":{},\"data\":data}) : helper)))\n    + \"\\\" />\\n\t</div>\\n\t<div class=\\\"overlay media-size play-toggle-hitarea\\\">\\n\t\t<canvas class=\\\"play-toggle\\\"/>\\n\t</div>\\n</div>\\n\";\n},\"useData\":true});\n",
    "/**\n * @module app/view/render/SequenceRenderer\n */\n\n/* --------------------------- *\n * Imports\n * --------------------------- */\n\n/** @type {module:backbone.babysitter} */\nconst Container = require(\"backbone.babysitter\");\n\n/** @type {module:app/view/base/View} */\nconst View = require(\"app/view/base/View\");\n/** @type {module:app/view/render/PlayableRenderer} */\nconst PlayableRenderer = require(\"app/view/render/PlayableRenderer\");\n// /** @type {module:app/model/SelectableCollection} */\n// var SelectableCollection = require(\"app/model/SelectableCollection\");\n/** @type {module:app/control/Globals} */\nconst Globals = require(\"app/control/Globals\");\n\n/** @type {module:app/view/component/CanvasProgressMeter} */\nconst ProgressMeter = require(\"app/view/component/CanvasProgressMeter\");\n/** @type {module:app/view/component/PlayToggleSymbol} */\nconst PlayToggleSymbol = require(\"app/view/component/PlayToggleSymbol\");\n\n/** @type {module:utils/Timer} */\nconst Timer = require(\"utils/Timer\");\n// /** @type {Function} */\n// var transitionEnd = require(\"utils/event/transitionEnd\");\n// /** @type {module:utils/prefixedProperty} */\n// var prefixed = require(\"utils/prefixedProperty\");\n\n/** @type {Function} */\nconst _whenImageLoads = require(\"app/view/promise/_whenImageLoads\");\n/** @type {module:app/view/promise/_loadImageAsObjectURL} */\nconst _loadImageAsObjectURL = require(\"app/view/promise/_loadImageAsObjectURL\");\n// /** @type {Function} */\n// var whenSelectionDistanceIs = require(\"app/view/promise/whenSelectionDistanceIs\");\n// var whenSelectTransitionEnds = require(\"app/view/promise/whenSelectTransitionEnds\");\n// var whenDefaultImageLoads = require(\"app/view/promise/whenDefaultImageLoads\");\n\n// /** @type {Function} */\n// var Color = require(\"color\");\n// var duotone = require(\"utils/canvas/bitmap/duotone\");\n// var stackBlurRGB = require(\"utils/canvas/bitmap/stackBlurRGB\");\n// var stackBlurMono = require(\"utils/canvas/bitmap/stackBlurMono\");\n// var getAverageRGBA = require(\"utils/canvas/bitmap/getAverageRGBA\");\n\nconst errorTemplate = require(\"../template/ErrorBlock.hbs\");\n\nvar MIN_STEP_INTERVAL = 2 * Globals.TRANSITION_DURATION + Globals.TRANSITION_DELAY_INTERVAL;\nvar DEFAULT_STEP_INTERVAL = 6 * Globals.TRANSITION_DURATION + Globals.TRANSITION_DELAY_INTERVAL;\n\n\n/* --------------------------- *\n * Private classes\n * --------------------------- */\n\n/**\n * @constructor\n * @type {module:app/view/render/SequenceRenderer.PrefetechedSourceRenderer}\n */\nvar PrefetechedSourceRenderer = View.extend({\n\n\tcidPrefix: \"sequenceStepRenderer\",\n\t/** @type {string} */\n\tclassName: \"sequence-step\",\n\t/** @type {string} */\n\ttagName: \"img\",\n\n\tproperties: {\n\t\tready: {\n\t\t\tget: function() {\n\t\t\t\treturn this._ready;\n\t\t\t}\n\t\t}\n\t},\n\n\t/** @override */\n\tinitialize: function(opts) {\n\t\t!this.el.hasAttribute(\"alt\") && this.el.setAttribute(\"alt\", this.model.get(\"src\"));\n\t\t// this.el.setAttribute(\"longdesc\", this.model.get(\"original\"));\n\n\t\tif (this.model.has(\"prefetched\")) {\n\t\t\tthis._renderPrefetched();\n\t\t} else {\n\t\t\tthis.listenTo(this.model, \"change:prefetched\", this._renderPrefetched);\n\t\t}\n\t\tthis.listenTo(this.model, \"selected deselected\", this._renderSelection);\n\t\tthis._renderSelection();\n\t},\n\n\t_renderSelection: function() {\n\t\tthis.el.classList.toggle(\"current\", !!this.model.selected);\n\t},\n\n\t_renderPrefetched: function() {\n\t\tvar prefetched = this.model.get(\"prefetched\");\n\t\tif (prefetched !== this.el.src) {\n\t\t\tthis.el.src = prefetched;\n\t\t}\n\t\t_whenImageLoads(this.el).then(\n\t\t\tfunction(el) {\n\t\t\t\tthis.requestAnimationFrame(function(tstamp) {\n\t\t\t\t\tthis._setReady(true);\n\t\t\t\t});\n\t\t\t}.bind(this),\n\t\t\tfunction(err) {\n\t\t\t\t// this._setReady(false);\n\t\t\t\t(err instanceof Error) || (err = new Error(\"cannot load prefetched url\"));\n\t\t\t\tthrow err;\n\t\t\t}.bind(this)\n\t\t);\n\t},\n\n\t/** @type {boolean} */\n\t_ready: false,\n\n\t_setReady: function(ready) {\n\t\tif (this._ready !== ready) {\n\t\t\tthis._ready = !!(ready); // make bool\n\t\t\tthis.trigger(\"renderer:ready\", this);\n\t\t}\n\t},\n\n\trender: function() {\n\t\t// if (this.model.has(\"prefetched\")) {\n\t\t// \tthis._renderPrefetched();\n\t\t// }\n\t\t// this.el.classList.toggle(\"current\", !!this.model.selected);\n\t\tconsole.log(\"%s::render\", this.cid);\n\t\treturn this;\n\t},\n});\n\n/**\n * @constructor\n * @type {module:app/view/render/SequenceRenderer.SimpleSourceRenderer}\n */\n// var SimpleSourceRenderer = View.extend({\n//\n// \tcidPrefix: \"sequenceStepRenderer\",\n// \t/** @type {string} */\n// \tclassName: \"sequence-step\",\n// \t/** @type {string} */\n// \ttagName: \"img\",\n//\n// \t/** @override */\n// \tinitialize: function (options) {\n// \t\t// this.el.classList.toggle(\"current\", this.model.hasOwnProperty(\"selected\"));\n// \t\tthis.el.classList.toggle(\"current\", !!this.model.selected);\n// \t\tthis.listenTo(this.model, {\n// \t\t\t\"selected\": function () {\n// \t\t\t\tthis.el.classList.add(\"current\");\n// \t\t\t},\n// \t\t\t\"deselected\": function () {\n// \t\t\t\tthis.el.classList.remove(\"current\");\n// \t\t\t}\n// \t\t});\n// \t\tif (this.el.src === \"\") {\n// \t\t\tthis.el.src = Globals.MEDIA_DIR + \"/\" + this.model.get(\"src\");\n// \t\t}\n//\n// \t\tif (this.model.has(\"error\")) {\n// \t\t\tthis._onModelError();\n// \t\t} else {\n// \t\t\tthis.listenToOnce(this.model, \"change:error\", this._onModelError);\n// \t\t\t// this.listenToOnce(this.model, {\n// \t\t\t// \t\"change:source\": this._onModelSource,\n// \t\t\t// \t\"change:error\": this._onModelError,\n// \t\t\t// });\n// \t\t}\n// \t},\n//\n// \t// _onModelSource: function() {\n// \t// \tthis.el.src = Globals.MEDIA_DIR + \"/\" + this.model.get(\"src\");\n// \t// \t// console.log(\"%s::change:src\", this.cid, this.model.get(\"src\"));\n// \t// },\n//\n// \t_onModelError: function() {\n// \t\tvar err = this.model.get(\"error\");\n// \t\tvar errEl = document.createElement(\"div\");\n// \t\terrEl.className = \"error color-bg\" + (this.model.selected? \" current\" : \"\");\n// \t\terrEl.innerHTML = errorTemplate(err);\n// \t\tthis.setElement(errEl, true);\n// \t\tconsole.log(\"%s::change:error\", this.cid, err.message, err.infoSrc);\n// \t},\n// });\n\nvar SourceErrorRenderer = View.extend({\n\n\t/** @type {string} */\n\tclassName: \"sequence-step error\",\n\t/** @override */\n\tcidPrefix: \"sourceErrorRenderer\",\n\t/** @override */\n\ttemplate: errorTemplate,\n\t/** @type {boolean} */\n\tready: true,\n\n\tinitialize: function(opts) {\n\t\t// var handleSelectionChange = function onSelectionChange () {\n\t\t// \tthis.el.classList.toggle(\"current\", !!this.model.selected);\n\t\t// };\n\t\t// this.listenTo(this.model, \"selected deselected\", handleSelectionChange);\n\t\t// // this.el.classList.toggle(\"current\", !!this.model.selected);\n\t\t// handleSelectionChange.call(this);\n\t\tthis.listenTo(this.model, \"selected deselected\", function() {\n\t\t\tthis.el.classList.toggle(\"current\", !!this.model.selected);\n\t\t});\n\t},\n\n\trender: function() {\n\t\tthis.el.classList.toggle(\"current\", !!this.model.selected);\n\t\tthis.el.innerHTML = this.template(this.model.get(\"error\"));\n\t\treturn this;\n\t},\n});\n\nvar SequenceStepRenderer = PrefetechedSourceRenderer;\n// var SequenceStepRenderer = SimpleSourceRenderer;\n\n/**\n * @constructor\n * @type {module:app/view/render/SequenceRenderer}\n */\nvar SequenceRenderer = PlayableRenderer.extend({\n\n\t/** @type {string} */\n\tcidPrefix: \"sequenceRenderer\",\n\t/** @type {string} */\n\tclassName: PlayableRenderer.prototype.className + \" sequence-item\",\n\t/** @type {Function} */\n\ttemplate: require(\"./SequenceRenderer.hbs\"),\n\n\t/* --------------------------- *\n\t/* initialize\n\t/* --------------------------- */\n\n\tinitialize: function(opts) {\n\t\tthis.sources = this.model.get(\"sources\");\n\t\tPlayableRenderer.prototype.initialize.apply(this, arguments);\n\t},\n\n\t/* --------------------------- *\n\t * children\n\t * --------------------------- */\n\n\t/** @override */\n\tcreateChildren: function() {\n\t\tPlayableRenderer.prototype.createChildren.apply(this, arguments);\n\n\t\tthis.placeholder = this.el.querySelector(\".placeholder\");\n\t\tthis.sequence = this.content.querySelector(\".sequence\");\n\n\t\t// styles\n\t\t// ---------------------------------\n\t\tvar s, attrs = this.model.attrs();\n\t\t// var s, attrs = this.model.get(\"attrs\");\n\t\ts = _.pick(attrs, \"box-shadow\", \"border\", \"border-radius\");\n\t\t_.extend(this.content.querySelector(\".media-border\").style, s);\n\t\ts = _.pick(attrs, \"border-radius\");\n\t\t_.extend(this.sequence.style, s);\n\t\t_.extend(this.placeholder.style, s);\n\n\t\t// model\n\t\t// ---------------------------------\n\t\tthis.sources.select(this.model.get(\"source\"));\n\n\t\t// itemViews\n\t\t// ---------------------------------\n\t\tthis.itemViews = new Container();\n\t\t// add default image as renderer (already in DOM)\n\t\tthis.itemViews.add(new SequenceStepRenderer({\n\t\t\tel: this.getDefaultImage(),\n\t\t\tmodel: this.model.get(\"source\")\n\t\t}));\n\t},\n\n\t/* --------------------------- *\n\t * layout/render\n\t * --------------------------- */\n\n\t/** @override */\n\trender: function() {\n\t\tPlayableRenderer.prototype.render.apply(this, arguments);\n\n\t\tvar els, el, i, cssW, cssH;\n\t\tvar content = this.content;\n\n\t\t// media-size\n\t\t// ---------------------------------\n\t\tcssW = this.metrics.media.width + \"px\";\n\t\tcssH = this.metrics.media.height + \"px\";\n\n\t\tels = this.el.querySelectorAll(\".media-size\");\n\t\tfor (i = 0; i < els.length; i++) {\n\t\t\tel = els.item(i);\n\t\t\tel.style.width = cssW;\n\t\t\tel.style.height = cssH;\n\t\t}\n\t\tcontent.style.width = cssW;\n\t\tcontent.style.height = cssH;\n\n\t\t// content-position\n\t\t// ---------------------------------\n\t\tvar cssX, cssY;\n\t\tcssX = this.metrics.content.x + \"px\";\n\t\tcssY = this.metrics.content.y + \"px\";\n\t\tcontent.style.left = cssX;\n\t\tcontent.style.top = cssY;\n\n\t\tel = this.el.querySelector(\".controls\");\n\t\t// el.style.left = cssX;\n\t\t// el.style.top = cssY;\n\t\tel.style.width = this.metrics.content.width + \"px\";\n\t\tel.style.height = this.metrics.content.height + \"px\";\n\n\t\t// // content-size\n\t\t// // ---------------------------------\n\t\t// cssW = this.metrics.content.width + \"px\";\n\t\t// cssH = this.metrics.content.height + \"px\";\n\t\t//\n\t\t// els = this.el.querySelectorAll(\".content-size\");\n\t\t// for (i = 0; i < els.length; i++) {\n\t\t// \tel = els.item(i);\n\t\t// \tel.style.width = cssW;\n\t\t// \tel.style.height = cssH;\n\t\t// }\n\n\t\treturn this;\n\t},\n\n\t/* --------------------------- *\n\t * initializeAsync\n\t * --------------------------- */\n\n\tinitializePlayable: function() {\n\t\t// model\n\t\t// ---------------------------------\n\t\t// this.sources.select(this.model.get(\"source\"));\n\t\tthis.content.classList.add(\"started\");\n\n\t\t// Sequence model\n\t\t// ---------------------------------\n\t\tPlayableRenderer.whenSelectionDistanceIs(this, 0)\n\t\t\t// .then(function(view) {\n\t\t\t// \t/* defaultImage is loaded, add `started` rightaway */\n\t\t\t// \tview.content.classList.add(\"started\");\n\t\t\t// \treturn view;\n\t\t\t// })\n\t\t\t.then(this._preloadAllItems, function(err) {\n\t\t\t\treturn (err instanceof View.ViewError) ? (void 0) : err; // Ignore ViewError\n\t\t\t});\n\n\t\tthis._sequenceInterval = Math.max(parseInt(this.model.attr(\"@sequence-interval\")), MIN_STEP_INTERVAL) || DEFAULT_STEP_INTERVAL;\n\n\t\t// timer\n\t\t// ---------------------------------\n\t\t/* timer will be started when _validatePlayback is called from _onModelSelected */\n\t\tthis.timer = new Timer();\n\t\tthis.listenTo(this, \"view:removed\", function() {\n\t\t\tthis.timer.stop();\n\t\t\tthis.stopListening(this.timer);\n\t\t});\n\n\t\tthis.listenTo(this.timer, {\n\t\t\t\"start\": this._onTimerStart,\n\t\t\t\"resume\": this._onTimerResume,\n\t\t\t\"pause\": this._onTimerPause,\n\t\t\t\"end\": this._onTimerEnd,\n\t\t\t// \"stop\": function () {}, // stop is only called on view remove\n\t\t});\n\n\t\t// play-toggle-symbol\n\t\t// ---------------------------------\n\t\tthis._playToggleSymbol = new PlayToggleSymbol(_.extend({\n\t\t\tel: this.el.querySelector(\".play-toggle\")\n\t\t}, this._playToggleSymbol || {}));\n\n\t\t// progress-meter model\n\t\t// ---------------------------------\n\t\tthis._sourceProgressByIdx = this.sources.map(function() {\n\t\t\treturn 0;\n\t\t});\n\t\tthis._sourceProgressByIdx[0] = 1; // first item is already loaded\n\n\t\t// progress-meter\n\t\t// ---------------------------------\n\t\tthis.progressMeter = new ProgressMeter({\n\t\t\tel: this.el.querySelector(\".progress-meter\"),\n\t\t\tcolor: this.model.attr(\"color\"),\n\t\t\t// backgroundColor: this.model.attr(\"background-color\"),\n\t\t\tvalues: {\n\t\t\t\tavailable: this._sourceProgressByIdx.concat(),\n\t\t\t},\n\t\t\tmaxValues: {\n\t\t\t\tamount: this.sources.length,\n\t\t\t\tavailable: this.sources.length,\n\t\t\t},\n\t\t\tlabelFn: (function() {\n\t\t\t\tif (this.playbackRequested === false) return Globals.PAUSE_CHAR;\n\t\t\t\treturn (this.sources.selectedIndex + 1) + \"/\" + this.sources.length;\n\t\t\t}).bind(this)\n\t\t});\n\t\t// this.el.querySelector(\".top-bar\")\n\t\t//\t\t.appendChild(this.progressMeter.render().el);\n\t},\n\n\tinitializeAsync: function() {\n\t\treturn PlayableRenderer.prototype.initializeAsync.apply(this, arguments)\n\t\t\t.then(\n\t\t\t\tfunction(view) {\n\t\t\t\t\treturn view.whenAttached();\n\t\t\t\t})\n\t\t\t.then(function(view) {\n\t\t\t\tview.initializePlayable();\n\t\t\t\t// view.updateOverlay(view.defaultImage, view.playToggle); //view.overlay);\n\t\t\t\tview.listenToSelection();\n\t\t\t\treturn view;\n\t\t\t});\n\t},\n\n\twhenInitialized: function(view) {\n\t\tvar retval = PlayableRenderer.prototype.whenInitialized.apply(this, arguments);\n\t\tview._validatePlayback();\n\t\treturn retval;\n\t},\n\n\t/* --------------------------- *\n\t * _preloadAllItems\n\t * --------------------------- */\n\n\t_preloadAllItems: function(view) {\n\t\tview.once(\"view:remove\", function() {\n\t\t\tvar silent = { silent: true };\n\t\t\tview.sources.forEach(function(item, index, sources) {\n\t\t\t\t// view.stopListening(item, \"change:progress\");\n\t\t\t\tvar prefetched = item.get(\"prefetched\");\n\t\t\t\tif (prefetched) {\n\t\t\t\t\titem.set(\"progress\", 0, silent);\n\t\t\t\t\titem.unset(\"prefetched\", silent);\n\t\t\t\t\tif (/^blob\\:/.test(prefetched)) {\n\t\t\t\t\t\tURL.revokeObjectURL(prefetched);\n\t\t\t\t\t}\n\t\t\t\t}\n\t\t\t});\n\t\t});\n\t\treturn view.sources.reduce(function(lastPromise, item, index, sources) {\n\t\t\treturn lastPromise.then(function(view) {\n\t\t\t\tif (view._viewPhase === \"disposed\") {\n\t\t\t\t\t/** do nothing */\n\t\t\t\t\treturn view;\n\t\t\t\t} else\n\t\t\t\tif (item.has(\"prefetched\")) {\n\t\t\t\t\tview._updateItemProgress(1, index);\n\t\t\t\t\treturn view;\n\t\t\t\t} else {\n\t\t\t\t\tvar onItemProgress = function(item, progress) {\n\t\t\t\t\t\tview._updateItemProgress(progress, index);\n\t\t\t\t\t};\n\t\t\t\t\tview.listenTo(item, \"change:progress\", onItemProgress);\n\t\t\t\t\tview.once(\"view:remove\", function(view) {\n\t\t\t\t\t\tview.stopListening(item, \"change:progress\", onItemProgress);\n\t\t\t\t\t});\n\t\t\t\t\tconsole.log(\"%s:_preloadAllItems\", view.cid, item.get(\"original\"), item.get(\"mime\"));\n\t\t\t\t\treturn _loadImageAsObjectURL(item.get(\"original\"),\n\t\t\t\t\t\t\tfunction(progress, request) {\n\t\t\t\t\t\t\t\t/* NOTE: Since we are calling URL.revokeObjectURL when view is removed, also abort incomplete requests. Otherwise, clear the callback reference from XMLHttpRequest.onprogress  */\n\t\t\t\t\t\t\t\tif (view._viewPhase === \"disposed\") {\n\t\t\t\t\t\t\t\t\t//console.warn(\"%s::_preloadAllItems aborting XHR [%s %s] (%s)\", view.cid, request.status, request.readyState, item.get(\"original\"), request);\n\t\t\t\t\t\t\t\t\trequest.abort();\n\t\t\t\t\t\t\t\t\t// request.onprogress = void 0;\n\t\t\t\t\t\t\t\t} else {\n\t\t\t\t\t\t\t\t\titem.set(\"progress\", progress);\n\t\t\t\t\t\t\t\t}\n\t\t\t\t\t\t\t})\n\t\t\t\t\t\t.then(\n\t\t\t\t\t\t\tfunction(pUrl) {\n\t\t\t\t\t\t\t\titem.set({\n\t\t\t\t\t\t\t\t\t\"progress\": pUrl ? 1 : 0,\n\t\t\t\t\t\t\t\t\t\"prefetched\": pUrl\n\t\t\t\t\t\t\t\t});\n\t\t\t\t\t\t\t\treturn view;\n\t\t\t\t\t\t\t},\n\t\t\t\t\t\t\tfunction(err) {\n\t\t\t\t\t\t\t\titem.set({\n\t\t\t\t\t\t\t\t\t\"progress\": 0,\n\t\t\t\t\t\t\t\t\t\"error\": err\n\t\t\t\t\t\t\t\t});\n\t\t\t\t\t\t\t\treturn view;\n\t\t\t\t\t\t\t}\n\t\t\t\t\t\t);\n\t\t\t\t}\n\t\t\t});\n\t\t}, Promise.resolve(view));\n\t},\n\n\t// _preloadAllItems2: function(view) {\n\t// \treturn view.sources.reduce(function(lastPromise, item, index, sources) {\n\t// \t\treturn lastPromise.then(function(view) {\n\t// \t\t\tvar itemView = view._getItemView(item);\n\t// \t\t\treturn _whenImageLoads(itemView.el).then(function(url){\n\t// \t\t\t\tview._updateItemProgress(1, index);\n\t// \t\t\t\treturn view;\n\t// \t\t\t}, function(err) {\n\t// \t\t\t\tview._updateItemProgress(0, index);\n\t// \t\t\t\titem.set(\"error\", err);\n\t// \t\t\t\treturn view;\n\t// \t\t\t});\n\t// \t\t});\n\t// \t}, Promise.resolve(view));\n\t// },\n\n\t_updateItemProgress: function(progress, index) {\n\t\tthis._sourceProgressByIdx[index] = progress;\n\t\tif (this.progressMeter) {\n\t\t\tthis.progressMeter.valueTo(\"available\", this._sourceProgressByIdx, 300);\n\t\t}\n\t},\n\n\t/* ---------------------------\n\t * PlayableRenderer implementation\n\t * --------------------------- */\n\n\t/** @override initial value */\n\t_playbackRequested: true,\n\n\t/** @type {Boolean} internal store */\n\t_paused: true,\n\n\t/** @override */\n\t_isMediaPaused: function() {\n\t\treturn this._paused;\n\t},\n\n\t/** @override */\n\t_playMedia: function() {\n\t\tif (!this._paused) return;\n\t\tthis._paused = false;\n\n\t\tif (!this._isMediaWaiting()) {\n\t\t\tif (this.timer.status === Timer.PAUSED) {\n\t\t\t\tthis.timer.start(); // resume, actually\n\t\t\t} else {\n\t\t\t\tthis.timer.start(this._sequenceInterval);\n\t\t\t}\n\t\t}\n\t},\n\n\t/** @override */\n\t_pauseMedia: function() {\n\t\tif (this._paused) return;\n\t\tthis._paused = true;\n\t\tif (this.timer.status === Timer.STARTED) {\n\t\t\tthis.timer.pause();\n\t\t}\n\t},\n\n\t// /** @override */\n\t// _renderPlaybackState: function() {\n\t// \t// if (!this.content.classList.contains(\"started\")) {\n\t// \t// \tthis.content.classList.add(\"started\");\n\t// \t// }\n\t// \tPlayableRenderer.prototype._renderPlaybackState.apply(this, arguments);\n\t// },\n\n\t/* --------------------------- *\n\t/* sequence private\n\t/* --------------------------- */\n\n\t_onTimerStart: function(duration) {\n\t\tvar item;\n\t\tif (this.sources.selectedIndex === -1) {\n\t\t\titem = this.model.get(\"source\");\n\t\t} else {\n\t\t\titem = this.sources.followingOrFirst();\n\t\t}\n\t\tthis.sources.select(item);\n\t\tthis.progressMeter.valueTo(\"amount\", this.sources.selectedIndex + 1, duration);\n\t\tthis.content.classList.toggle(\"playback-error\", item.has(\"error\"));\n\n\t\t// var currView = this.itemViews.findByModel(item);\n\t\t// if (!item.has(\"error\") && currView !== null) {\n\t\t// \tthis._playToggleSymbol.setImageSource(currView.el);\n\t\t// \t// this.updateOverlay(currView.el, this.playToggle);\n\t\t// } else {\n\t\t// \tthis._playToggleSymbol.setImageSource(null);\n\t\t// }\n\n\t\t// // init next renderer now to have smoother transitions\n\t\t// this._getItemView(this.sources.followingOrFirst());\n\t},\n\n\t_onTimerResume: function(duration) {\n\t\tthis.progressMeter.valueTo(\"amount\", this.sources.selectedIndex + 1, duration);\n\t},\n\n\t_onTimerPause: function(duration) {\n\t\tthis.progressMeter.valueTo(\"amount\", this.progressMeter.getRenderedValue(\"amount\"), 0);\n\t},\n\n\t/* last completely played sequence index */\n\t// _lastPlayedIndex: -1,\n\n\t_onTimerEnd: function() {\n\t\tvar nextItem, nextView;\n\n\t\tvar showNextView = function(result) {\n\t\t\t// console.log(\"%s::showNextView %sms %s\", context.cid, context._sequenceInterval, nextItem.cid)\n\t\t\tthis.setImmediate(function() {\n\t\t\t\tif (!this.mediaPaused) {\n\t\t\t\t\tthis.timer.start(this._sequenceInterval);\n\t\t\t\t}\n\t\t\t});\n\t\t\treturn result;\n\t\t}.bind(this);\n\n\t\t// get next item init next renderer\n\t\tnextItem = this.sources.followingOrFirst();\n\t\tnextView = this._getItemView(nextItem);\n\n\t\tif (nextItem.has(\"error\")) {\n\t\t\tshowNextView();\n\t\t} else if (nextItem.has(\"prefetched\")) {\n\t\t\t_whenImageLoads(nextView.el).then(showNextView, showNextView);\n\t\t} else {\n\t\t\t/* TODO: add ga event 'media-waiting' */\n\t\t\t// window.ga(\"send\", \"event\", \"sequence-item\", \"waiting\", this.model.get(\"text\"));\n\t\t\t// console.log(\"%s:[waiting] %sms %s\", context.cid, nextItem.cid);\n\t\t\tthis._toggleWaiting(true);\n\t\t\tthis.listenToOnce(nextItem, \"change:prefetched change:error\", function(model) {\n\t\t\t\t// console.log(\"%s:[playing] %sms %s\", context.cid, nextItem.cid);\n\t\t\t\tthis._toggleWaiting(false);\n\t\t\t\t_whenImageLoads(nextView.el).then(showNextView, showNextView);\n\t\t\t});\n\t\t}\n\t},\n\n\t_getItemView: function(item) {\n\t\tvar view = this.itemViews.findByModel(item);\n\t\tif (!view) {\n\t\t\tview = new(item.has(\"error\") ? SourceErrorRenderer : SequenceStepRenderer)({\n\t\t\t\tmodel: item\n\t\t\t});\n\t\t\tthis.itemViews.add(view);\n\t\t\tthis.sequence.appendChild(view.render().el);\n\t\t}\n\t\treturn view;\n\t},\n\n\t/* --------------------------- *\n\t/* progress meter\n\t/* --------------------------- */\n\n\t// _createDefaultItemData: function() {\n\t// \tvar canvas = document.createElement(\"canvas\");\n\t// \tvar context = canvas.getContext(\"2d\");\n\t// \tvar imageData = this._drawMediaElement(context).getImageData(0, 0, canvas.width, canvas.height);\n\t//\n\t// \tvar opts = { radius: 20 };\n\t// \tvar fgColor = new Color(this.model.attr(\"color\"));\n\t// \tvar bgColor = new Color(this.model.attr(\"background-color\"));\n\t// \tvar isFgDark = fgColor.luminosity() < bgColor.luminosity();\n\t// \topts.x00 = isFgDark? Color(fgColor).lighten(0.33) : Color(bgColor).darken(0.33);\n\t// \topts.xFF = isFgDark? Color(bgColor).lighten(0.33) : Color(fgColor).darken(0.33);\n\t//\n\t// \tstackBlurMono(imageData, opts);\n\t// \tduotone(imageData, opts);\n\t// \t// stackBlurRGB(imageData, opts);\n\t//\n\t// \tcontext.putImageData(imageData, 0, 0);\n\t// \treturn canvas.toDataURL();\n\t// },\n});\n\nif (DEBUG) {\n\tSequenceRenderer = (function(SequenceRenderer) {\n\t\tif (!SequenceRenderer.LOG_TO_SCREEN) return SequenceRenderer;\n\n\t\t// /** @type {module:underscore.strings/lpad} */\n\t\t// var rpad = require(\"underscore.string/rpad\");\n\t\t/** @type {module:underscore.strings/lpad} */\n\t\tvar lpad = require(\"underscore.string/lpad\");\n\t\t/** @type {module:underscore.strings/capitalize} */\n\t\tvar caps = require(\"underscore.string/capitalize\");\n\n\t\treturn SequenceRenderer.extend({\n\t\t\t/** @override */\n\t\t\tinitialize: function() {\n\t\t\t\tSequenceRenderer.prototype.initialize.apply(this, arguments);\n\n\t\t\t\tthis.__logColors = _.extend({\n\t\t\t\t\t\"media:play\": \"darkred\",\n\t\t\t\t\t\"media:pause\": \"darkred\",\n\n\t\t\t\t\t\"timer:start\": \"darkgreen\",\n\t\t\t\t\t\"timer:end\": \"darkgreen\",\n\t\t\t\t\t\"timer:resume\": \"green\",\n\t\t\t\t\t\"timer:pause\": \"green\",\n\n\t\t\t\t\t\"load:progress\": \"blue\",\n\t\t\t\t\t\"load:complete\": \"darkblue\"\n\t\t\t\t}, this.__logColors);\n\t\t\t},\n\n\t\t\t// __getHeaderText: function() {\n\t\t\t// \tvar fmt1 = function(s) {\n\t\t\t// \t\treturn lpad(caps(s), 8).substr(0, 8).toUpperCase();\n\t\t\t// \t};\n\t\t\t// \tvar fmt2 = function(s) {\n\t\t\t// \t\treturn lpad(caps(s), 8).substr(0, 8).toUpperCase();\n\t\t\t// \t};\n\t\t\t// \tvar o = {\n\t\t\t// \t\t\"tstamp\": fmt1,\n\t\t\t// \t\t\"index\": fmt2,\n\t\t\t// \t\t\"duration\": fmt1,\n\t\t\t// \t\t\"playback\": fmt1,\n\t\t\t// \t\t\"media\": fmt1,\n\t\t\t// \t\t\"timer\": fmt1,\n\t\t\t// \t\t\"next\": fmt1,\n\t\t\t// \t};\n\t\t\t// \treturn Object.keys(o).map(function(s, i, a) {\n\t\t\t// \t\treturn o[s](s);\n\t\t\t// \t}).join(\" \");\n\t\t\t// \t// Object.keys(o).reduce(function(ss, s, i, a) {\n\t\t\t// \t// \treturn ss + \" \" + lpad(caps(s), 8).substr(0, 8).toUpperCase();\n\t\t\t// \t// }, \"\");\n\t\t\t// },\n\n\t\t\t__getHeaderText: function() {\n\t\t\t\treturn [\n\t\t\t\t\t\"tstamp\",\n\t\t\t\t\t\"index\",\n\t\t\t\t\t\"duration\",\n\t\t\t\t\t\"playback\",\n\t\t\t\t\t\"media\",\n\t\t\t\t\t\"timer\",\n\t\t\t\t\t\"next\",\n\t\t\t\t].map(function(s, i, a) {\n\t\t\t\t\treturn lpad(caps(s), 8).substr(0, 8).toUpperCase();\n\t\t\t\t}).join(\" \");\n\t\t\t},\n\n\t\t\t__logTimerEvent: function(evname, msg) {\n\t\t\t\tvar logMsg = [\n\t\t\t\t\tthis.sources.selectedIndex,\n\t\t\t\t\t(this.timer.getDuration() * .001).toFixed(3),\n\t\t\t\t\tthis.playbackRequested ? \">>\" : \"::\",\n\t\t\t\t\tthis.mediaPaused ? \"paused\" :\n\t\t\t\t\t(this.mediaWaiting ? \"waiting\" : \"playing\"),\n\t\t\t\t\tthis.timer.getStatus(),\n\t\t\t\t\tthis.sources.followingOrFirst().has(\"prefetched\") ? \"ready\" : \"pending\"\n\t\t\t\t].map(function(s, i, a) {\n\t\t\t\t\treturn lpad(s, 8).substr(0, 8).toUpperCase();\n\t\t\t\t});\n\t\t\t\tmsg && logMsg.push(msg);\n\t\t\t\tlogMsg = logMsg.join(\" \");\n\n\t\t\t\tthis.__logMessage(logMsg, evname);\n\t\t\t\t// console.log(\"%s::[%s] %s\", this.cid, evname, logMsg);\n\t\t\t},\n\t\t\t_playMedia: function() {\n\t\t\t\tthis.__logTimerEvent(\"media:play\");\n\t\t\t\tSequenceRenderer.prototype._playMedia.apply(this, arguments);\n\t\t\t\t// this.__logTimerEvent(\"< media:play\");\n\t\t\t\t// console.log(\"%s::_playMedia()\", this.cid);\n\t\t\t},\n\t\t\t_pauseMedia: function() {\n\t\t\t\tthis.__logTimerEvent(\"media:pause\");\n\t\t\t\tSequenceRenderer.prototype._pauseMedia.apply(this, arguments);\n\t\t\t\t// this.__logTimerEvent(\"< media:pause\");\n\t\t\t\t// console.log(\"%s::_pauseMedia()\", this.cid);\n\t\t\t},\n\n\t\t\t_onTimerStart: function() {\n\t\t\t\tthis.__logTimerEvent(\"timer:start\");\n\t\t\t\tSequenceRenderer.prototype._onTimerStart.apply(this, arguments);\n\t\t\t},\n\t\t\t_onTimerResume: function() {\n\t\t\t\tthis.__logTimerEvent(\"timer:resume\");\n\t\t\t\tSequenceRenderer.prototype._onTimerResume.apply(this, arguments);\n\t\t\t},\n\t\t\t_onTimerPause: function() {\n\t\t\t\tthis.__logTimerEvent(\"timer:pause\");\n\t\t\t\tSequenceRenderer.prototype._onTimerPause.apply(this, arguments);\n\t\t\t},\n\t\t\t_onTimerEnd: function() {\n\t\t\t\tthis.__logTimerEvent(\"timer:end\");\n\t\t\t\tSequenceRenderer.prototype._onTimerEnd.apply(this, arguments);\n\t\t\t},\n\n\t\t\t_updateItemProgress: function(progress, srcIdx) {\n\t\t\t\tif (progress == 1) {\n\t\t\t\t\tthis.__logTimerEvent(\"load:complete\", \"item \" + srcIdx + \": complete\");\n\t\t\t\t} else\n\t\t\t\tif (srcIdx === this.sources.selectedIndex) {\n\t\t\t\t\tthis.__logTimerEvent(\"load:progress\", \"item \" + srcIdx + \": \" + progress);\n\t\t\t\t}\n\t\t\t\tSequenceRenderer.prototype._updateItemProgress.apply(this, arguments);\n\t\t\t},\n\n\t\t\t_preloadAllItems: function(view) {\n\t\t\t\tview.__logMessage(view.cid + \"::_preloadAllItems\", \"load:start\");\n\t\t\t\tSequenceRenderer.prototype._preloadAllItems.apply(view, arguments);\n\t\t\t},\n\t\t});\n\t})(SequenceRenderer);\n}\n\nmodule.exports = SequenceRenderer;\n",
    "// hbsfy compiled Handlebars template\nvar HandlebarsCompiler = require('hbsfy/runtime');\nvar partial$0 = require('../template/svg/FullscreenSymbol.hbs');\nHandlebarsCompiler.registerPartial('../template/svg/FullscreenSymbol.hbs', partial$0);\nmodule.exports = HandlebarsCompiler.template({\"compiler\":[7,\">= 4.0.0\"],\"main\":function(container,depth0,helpers,partials,data) {\n    var stack1, helper;\n\n  return \"<div class=\\\"placeholder sizing\\\"></div>\\n<div class=\\\"content media-border\\\">\\n\t<div class=\\\"controls content-size\\\">\\n\t\t<canvas class=\\\"progress-meter\\\"></canvas>\\n\t</div>\\n\t<div class=\\\"crop-box media-size\\\">\\n\t\t<video width=\\\"240\\\" height=\\\"180\\\" muted playsinline></video>\\n\t\t<img class=\\\"poster default\\\" alt=\\\"\"\n    + container.escapeExpression(((helper = (helper = helpers.text || (depth0 != null ? depth0.text : depth0)) != null ? helper : helpers.helperMissing),(typeof helper === \"function\" ? helper.call(depth0 != null ? depth0 : (container.nullContext || {}),{\"name\":\"text\",\"hash\":{},\"data\":data}) : helper)))\n    + \"\\\" width=\\\"240\\\" height=\\\"180\\\" />\\n\t</div>\\n\t<div class=\\\"overlay media-size play-toggle-hitarea\\\">\\n\t\t\t<canvas class=\\\"play-toggle\\\"></canvas>\\n\t\t<a class=\\\"fullscreen-toggle\\\" href=\\\"javascript:(void 0)\\\">\\n\"\n    + ((stack1 = container.invokePartial(partials[\"../template/svg/FullscreenSymbol.hbs\"],depth0,{\"name\":\"../template/svg/FullscreenSymbol.hbs\",\"data\":data,\"indent\":\"\\t\\t\\t\",\"helpers\":helpers,\"partials\":partials,\"decorators\":container.decorators})) != null ? stack1 : \"\")\n    + \"\t\t</a>\\n\t</div>\\n</div>\\n\";\n},\"usePartial\":true,\"useData\":true});\n",
    "/*global HTMLMediaElement, MediaError*/\n/**\n * @module app/view/render/VideoRenderer\n *\n * @see https://developer.mozilla.org/en-US/docs/Web/HTML/Element/video\n * @see https://developer.mozilla.org/en-US/docs/Web/API/HTMLMediaElement\n * @see https://developer.mozilla.org/en-US/docs/Web/Guide/Events/Media_events\n * @see https://developer.mozilla.org/en-US/docs/Web/Guide/HTML/Using_HTML5_audio_and_video\n */\n\n/* --------------------------- *\n * Imports\n * --------------------------- */\n\n// /** @type {module:backbone} */\n// var Backbone = require(\"backbone\");\n/** @type {module:app/control/Globals} */\nconst Globals = require(\"app/control/Globals\");\n/** @type {module:app/view/render/PlayableRenderer} */\nconst PlayableRenderer = require(\"app/view/render/PlayableRenderer\");\n/** @type {module:app/view/component/CanvasProgressMeter} */\nconst ProgressMeter = require(\"app/view/component/CanvasProgressMeter\");\n// /** @type {module:app/view/component/PlayToggleSymbol} */\nconst PlayToggleSymbol = require(\"app/view/component/PlayToggleSymbol\");\n\n// var stackBlurMono = require(\"utils/canvas/bitmap/stackBlurMono\");\n// var stackBlurRGB = require(\"utils/canvas/bitmap/stackBlurRGB\");\n\n// /** @type {module:utils/prefixedStyleName} */\n// var prefixedStyleName = require(\"utils/prefixedStyleName\");\n/** @type {module:utils/prefixedEvent} */\nconst prefixedEvent = require(\"utils/prefixedEvent\");\n\n// var whenViewIsAttached = require(\"app/view/promise/whenViewIsAttached\");\n// /** @type {Function} */\n// var whenSelectionDistanceIs = require(\"app/view/promise/whenSelectionDistanceIs\");\n\n/* --------------------------- *\n * private static\n * --------------------------- */\n\nvar fullscreenChangeEvent = prefixedEvent(\"fullscreenchange\", document);\n// var fullscreenErrorEvent = prefixedEvent(\"fullscreenerror\", document);\n\nvar formatTimecode = function(value) {\n\tif (isNaN(value)) return \"\"; //value = 0;\n\tif (value >= 3600) return ((value / 3600) | 0) + \"H\";\n\tif (value >= 60) return ((value / 60) | 0) + \"M\";\n\t// if (value >= 10) return \"0\" + (value | 0) + \"S\";\n\treturn (value | 0) + \"S\";\n};\n\nvar VIDEO_CROP_PX = Globals.VIDEO_CROP_PX;\nvar SYNC_TIMEOUT_MS = 1200;\nvar SYNC_THRESHOLD_MS = 100;\n\n/**\n * @constructor\n * @type {module:app/view/render/VideoRenderer}\n */\nvar VideoRenderer = PlayableRenderer.extend({\n\n\t/** @type {string} */\n\tcidPrefix: \"videoRenderer\",\n\t/** @type {string} */\n\tclassName: PlayableRenderer.prototype.className + \" video-item\",\n\t/** @type {Function} */\n\ttemplate: require(\"./VideoRenderer.hbs\"),\n\n\t// events: (function() {\n\t// \tvar ret = {};\n\t// \tret[PlayableRenderer.CLICK_EVENT + \" .fullscreen-toggle\"] = \"_onFullscreenToggle\";\n\t// \treturn ret;\n\t// }()),\n\n\t// events: function() {\n\t// \tvar events = {};\n\t// \tevents[PlayableRenderer.CLICK_EVENT + \" .fullscreen-toggle\"] = \"_onFullscreenToggle\";\n\t// \treturn _.extend(events, _.result(this, PlayableRenderer.prototype.events));\n\t// },\n\t// events: {\n\t// \t\"click .fullscreen-toggle\": \"_onFullscreenToggle\",\n\t// },\n\n\tproperties: {\n\t\tfullscreenToggle: {\n\t\t\t/** @return {HTMLElement} */\n\t\t\tget: function() {\n\t\t\t\treturn this._fullscreenToggle || (this._fullscreenToggle = this.el.querySelector(\".fullscreen-toggle\"));\n\t\t\t}\n\t\t},\n\t},\n\n\t/** @override */\n\tinitialize: function(opts) {\n\t\tPlayableRenderer.prototype.initialize.apply(this, arguments);\n\t\t_.bindAll(this,\n\t\t\t\"_updatePlaybackState\",\n\t\t\t\"_updateCurrTimeValue\",\n\t\t\t\"_updateBufferedValue\",\n\t\t\t\"_onMediaError\",\n\t\t\t\"_onMediaEnded\",\n\t\t\t// \"_onMediaPlayingOnce\",\n\t\t\t\"_onFullscreenChange\",\n\t\t\t\"_onFullscreenToggle\"\n\t\t);\n\t\t_.bindAll(this,\n\t\t\t\"_playbackTimeoutFn_playing\",\n\t\t\t\"_playbackTimeoutFn_waiting\"\n\t\t);\n\t\t// var onPeerSelect = function() {\n\t\t// \tthis.content.style.display = (this.getSelectionDistance() > 1)? \"none\": \"\";\n\t\t// };\n\t\t// this.listenTo(this.model.collection, \"select:one select:none\", onPeerSelect);\n\t\t// onPeerSelect();\n\t},\n\n\t/* --------------------------- *\n\t * children\n\t * --------------------------- */\n\n\t/** @override */\n\tcreateChildren: function() {\n\t\tPlayableRenderer.prototype.createChildren.apply(this, arguments);\n\n\t\tthis.placeholder = this.el.querySelector(\".placeholder\");\n\t\t// this.overlay = this.content.querySelector(\".overlay\");\n\t\tthis.video = this.content.querySelector(\"video\");\n\t\t// this.video.loop = this.model.attrs().hasOwnProperty(\"@video-loop\");\n\n\t\t// this.video.setAttribute(\"muted\", \"muted\");\n\t\t// this.video.setAttribute(\"playsinline\", \"playsinline\");\n\t\t// if (this.model.attr(\"@video-loop\") !== void 0) {\n\t\t// \tthis.video.setAttribute(\"loop\", \"loop\");\n\t\t// }\n\t\tthis.video.setAttribute(\"preload\", \"none\");\n\t\tif (this.video.controlList) this.video.controlList.add(\"nodownload\");\n\n\t\t// this.video.muted = true;\n\t\t// this.video.playsinline = true;\n\t\t// this.video.preload = \"auto\";\n\t\tthis.video.loop = this.model.attr(\"@video-loop\") !== void 0;\n\t\tthis.video.src = this.findPlayableSource(this.video);\n\t},\n\n\t/* --------------------------- *\n\t * layout/render\n\t * --------------------------- */\n\n\tmeasure: function() {\n\t\tPlayableRenderer.prototype.measure.apply(this, arguments);\n\n\t\t// NOTE: Vertical 1px video crop\n\t\t// - Cropped in CSS: video, .poster { margin-top: -1px; margin-bottom: -1px;}\n\t\t// - Cropped height is adjusted in metrics obj\n\t\t// - Crop amount added back to actual video on render()\n\t\tthis.metrics.media.height += VIDEO_CROP_PX * 2;\n\t\tthis.metrics.content.height += VIDEO_CROP_PX * 2;\n\t},\n\n\t/** @override */\n\trender: function() {\n\t\tPlayableRenderer.prototype.render.apply(this, arguments);\n\n\t\tvar els, el, i, cssW, cssH;\n\t\tvar img = this.defaultImage;\n\t\tvar content = this.content;\n\n\t\t// media-size\n\t\t// ---------------------------------\n\t\tcssW = this.metrics.media.width + \"px\";\n\t\tcssH = this.metrics.media.height + \"px\";\n\n\t\tels = this.el.querySelectorAll(\".media-size\");\n\t\tfor (i = 0; i < els.length; i++) {\n\t\t\tel = els.item(i);\n\t\t\tel.style.width = cssW;\n\t\t\tel.style.height = cssH;\n\t\t}\n\n\t\tcontent.style.width = cssW;\n\t\tcontent.style.height = (this.metrics.media.height + VIDEO_CROP_PX) + \"px\";\n\n\t\t// content-position\n\t\t// ---------------------------------\n\t\tvar cssX, cssY;\n\t\tcssX = this.metrics.content.x + \"px\";\n\t\tcssY = this.metrics.content.y + \"px\";\n\t\tcontent.style.left = cssX;\n\t\tcontent.style.top = cssY;\n\n\t\tel = this.el.querySelector(\".controls\");\n\t\t// el.style.left = cssX;\n\t\t// controls.style.top = cssY;\n\t\tel.style.width = this.metrics.content.width + \"px\";\n\t\tel.style.height = this.metrics.content.height + \"px\";\n\n\t\t// // content-size\n\t\t// // ---------------------------------\n\t\t// cssW = this.metrics.content.width + \"px\";\n\t\t// cssH = this.metrics.content.height + \"px\";\n\t\t//\n\t\t// els = this.el.querySelectorAll(\".content-size\");\n\t\t// for (i = 0; i < els.length; i++) {\n\t\t// \tel = els.item(i);\n\t\t// \tel.style.width = cssW;\n\t\t// \tel.style.height = cssH;\n\t\t// }\n\n\t\t// NOTE: elements below must use video's UNCROPPED height, so +2px\n\t\tthis.video.setAttribute(\"width\", this.metrics.media.width);\n\t\tthis.video.setAttribute(\"height\", this.metrics.media.height - VIDEO_CROP_PX * 2);\n\t\timg.setAttribute(\"width\", this.metrics.media.width);\n\t\timg.setAttribute(\"height\", this.metrics.media.height - VIDEO_CROP_PX * 2);\n\n\t\treturn this;\n\t},\n\n\t/* --------------------------- *\n\t * initializeAsync\n\t * --------------------------- */\n\n\tinitializeAsync: function() {\n\t\treturn Promise.resolve(this)\n\t\t\t.then(PlayableRenderer.whenSelectionIsContiguous)\n\t\t\t.then(PlayableRenderer.whenScrollingEnds)\n\t\t\t.then(PlayableRenderer.whenViewIsAttached)\n\t\t\t.then(\n\t\t\t\tfunction(view) {\n\t\t\t\t\t// console.log(\"%s::initializeAsync [attached, scrollend, selected > %o, preload:%s] ('%o')\", view.cid, view.model.getDistanceToSelected(), view.video.preload, view.model.get(\"name\"));\n\t\t\t\t\treturn Promise.all([\n\t\t\t\t\t\tPlayableRenderer.whenDefaultImageLoads(view),\n\t\t\t\t\t\tview.whenVideoHasMetadata(view),\n\t\t\t\t\t]).then(function() {\n\t\t\t\t\t\treturn view;\n\t\t\t\t\t});\n\t\t\t\t})\n\t\t\t.then(\n\t\t\t\tfunction(view) {\n\t\t\t\t\t// console.log(\"%s::initializeAsync [defaultImage, preload:%s] ('%o')\", view.cid, view.video.preload, view.model.get(\"name\"));\n\t\t\t\t\tview.initializePlayable();\n\t\t\t\t\t// view.updateOverlay(view.defaultImage, view.playToggle); //view.overlay);\n\t\t\t\t\tview.listenToSelection();\n\t\t\t\t\treturn view;\n\t\t\t\t});\n\n\t\t// videoEl.setAttribute(\"preload\", \"metadata\");\n\t},\n\n\tinitializePlayable: function() {\n\t\t// When selected for the first time\n\t\t// ---------------------------------\n\t\tPlayableRenderer.whenSelectionDistanceIs(this, 0)\n\t\t\t.then(function(view) {\n\t\t\t\tview.video.setAttribute(\"preload\", \"auto\");\n\t\t\t\tview.video.preload = \"auto\";\n\t\t\t\t// console.log(\"%s::initializeAsync [selected, preload:%s] ('%o')\", view.cid, view.video.preload, view.model.get(\"name\"));\n\t\t\t\treturn view;\n\t\t\t})\n\t\t\t.catch(function(reason) {\n\t\t\t\tif (reason instanceof PlayableRenderer.ViewError) {\n\t\t\t\t\tconsole.log(\"%s::%s\", reason.view.cid, reason.message);\n\t\t\t\t} else {\n\t\t\t\t\tconsole.warn(reason);\n\t\t\t\t\t// return Promise.reject(reason);\n\t\t\t\t}\n\t\t\t});\n\t\t// play-toggle-symbol\n\t\t// ---------------------------------\n\t\tthis._playToggleSymbol = new PlayToggleSymbol(_.extend({\n\t\t\tel: this.el.querySelector(\".play-toggle\")\n\t\t}, this._playToggleSymbol || {}));\n\n\t\t// this._playToggleSymbol.setImageSource(this.defaultImage, 0, 0);\n\t\t// this.listenToElementOnce(this.video, \"timeupdate\", function(ev) {\n\t\t// \tthis._playToggleSymbol.setImageSource(this.video);\n\t\t// });\n\n\t\t// progress-meter\n\t\t// ---------------------------------\n\t\tthis.progressMeter = new ProgressMeter({\n\t\t\tel: this.el.querySelector(\".progress-meter\"),\n\t\t\tcolor: this.model.attr(\"color\"),\n\t\t\t// backgroundColor: this.model.attr(\"background-color\"),\n\t\t\tmaxValues: {\n\t\t\t\tamount: this.video.duration,\n\t\t\t\tavailable: this.video.duration,\n\t\t\t},\n\t\t\tlabelFn: (function(value, total) {\n\t\t\t\tif (!this._started || this.video.ended || isNaN(value)) {\n\t\t\t\t\treturn formatTimecode(total);\n\t\t\t\t} else if (!this.playbackRequested) {\n\t\t\t\t\treturn Globals.PAUSE_CHAR;\n\t\t\t\t} else {\n\t\t\t\t\treturn formatTimecode(total - value);\n\t\t\t\t}\n\t\t\t}).bind(this)\n\t\t});\n\t\t// this.el.querySelector(\".controls\").appendChild(this.progressMeter.el);\n\t\t// var el = this.el.querySelector(\".progress-meter\");\n\t\t// el.parentNode.replaceChild(this.progressMeter.el, el);\n\t\t// var parentEl = this.el.querySelector(\".controls\");\n\t\t// parentEl.insertBefore(this.progressMeter.el, parentEl.firstChild);\n\n\t\t// this._setPlayToggleSymbol(\"play-symbol\");\n\t\tthis._renderPlaybackState();\n\n\t\t// listen to video events\n\t\t// ---------------------------------\n\t\t// this.video.poster = this.model.get(\"source\").get(\"original\");\n\t\tthis.addMediaListeners();\n\t},\n\n\t/* --------------------------- *\n\t * whenVideoHasMetadata promise\n\t * --------------------------- */\n\n\twhenVideoHasMetadata: function(view) {\n\t\t// NOTE: not pretty !!!\n\t\treturn new Promise(function(resolve, reject) {\n\t\t\tvar videoEl = view.video;\n\t\t\tvar eventHandlers = {\n\t\t\t\tloadedmetadata: function(ev) {\n\t\t\t\t\tif (ev) removeEventListeners();\n\t\t\t\t\t// console.log(\"%s::whenVideoHasMetadata [%s] %s\", view.cid, \"resolved\", ev ? ev.type : \"sync\");\n\t\t\t\t\tresolve(view);\n\t\t\t\t},\n\t\t\t\tabort: function(ev) {\n\t\t\t\t\tif (ev) removeEventListeners();\n\t\t\t\t\treject(new PlayableRenderer.ViewError(view, new Error(\"whenVideoHasMetadata: view was removed\")));\n\t\t\t\t},\n\t\t\t\terror: function(ev) {\n\t\t\t\t\tif (ev) removeEventListeners();\n\t\t\t\t\tvar err;\n\t\t\t\t\tif (videoEl.error) {\n\t\t\t\t\t\terr = new Error(_.invert(MediaError)[videoEl.error.code]);\n\t\t\t\t\t\terr.infoCode = videoEl.error.code;\n\t\t\t\t\t} else {\n\t\t\t\t\t\terr = new Error(\"Unspecified error\");\n\t\t\t\t\t}\n\t\t\t\t\terr.infoSrc = videoEl.src;\n\t\t\t\t\terr.logMessage = \"whenVideoHasMetadata: \" + err.name + \" \" + err.infoSrc;\n\t\t\t\t\terr.logEvent = ev;\n\t\t\t\t\treject(err);\n\t\t\t\t},\n\t\t\t};\n\n\t\t\t//  (videoEl.preload == \"auto\" && videoEl.readyState >= HTMLMediaElement.HAVE_CURRENT_DATA)\n\t\t\t// \t(videoEl.preload == \"metadata\" && videoEl.readyState >= HTMLMediaElement.HAVE_METADATA)\n\n\t\t\tif (videoEl.error) {\n\t\t\t\teventHandlers.error();\n\t\t\t} else if (videoEl.readyState >= HTMLMediaElement.HAVE_METADATA) {\n\t\t\t\teventHandlers.loadedmetadata();\n\t\t\t} else {\n\t\t\t\tvar sources = videoEl.querySelectorAll(\"source\");\n\t\t\t\tvar errTarget = sources.length > 0 ? sources.item(sources.length - 1) : videoEl;\n\t\t\t\tvar errCapture = errTarget === videoEl; // use capture with HTMLMediaElement\n\n\t\t\t\tvar removeEventListeners = function() {\n\t\t\t\t\terrTarget.removeEventListener(\"error\", eventHandlers.error, errCapture);\n\t\t\t\t\tfor (var ev in eventHandlers) {\n\t\t\t\t\t\tif (ev !== \"error\" && eventHandlers.hasOwnProperty(ev)) {\n\t\t\t\t\t\t\tvideoEl.removeEventListener(ev, eventHandlers[ev], false);\n\t\t\t\t\t\t}\n\t\t\t\t\t}\n\t\t\t\t};\n\t\t\t\terrTarget.addEventListener(\"error\", eventHandlers.error, errCapture);\n\t\t\t\tfor (var ev in eventHandlers) {\n\t\t\t\t\tif (ev !== \"error\" && eventHandlers.hasOwnProperty(ev)) {\n\t\t\t\t\t\tvideoEl.addEventListener(ev, eventHandlers[ev], false);\n\t\t\t\t\t}\n\t\t\t\t}\n\t\t\t\t/* NOTE: MS Edge ignores js property, using setAttribute */\n\t\t\t\tvideoEl.setAttribute(\"preload\", \"metadata\");\n\t\t\t\tvideoEl.preload = \"metadata\";\n\n\t\t\t\t// videoEl.setAttribute(\"poster\", view.get(\"source\").get(\"original\"));\n\t\t\t\t// videoEl.setAttribute(\"preload\", \"metadata\");\n\t\t\t\t// videoEl.poster = view.model.get(\"source\").get(\"original\");\n\t\t\t\t// videoEl.loop = view.model.attr(\"@video-loop\") !== void 0;\n\t\t\t\t// videoEl.src = view.findPlayableSource(videoEl);\n\t\t\t\t// videoEl.load();\n\n\t\t\t\t// console.log(\"%s::whenVideoHasMetadata [preload:%s]\", view.cid, videoEl.preload);\n\t\t\t}\n\t\t});\n\t},\n\n\tfindPlayableSource: function(video) {\n\t\tvar playable = this.model.get(\"sources\").find(function(source) {\n\t\t\treturn /^video\\//.test(source.get(\"mime\")) && video.canPlayType(source.get(\"mime\")) != \"\";\n\t\t});\n\t\treturn playable ? playable.get(\"original\") : \"\";\n\t},\n\n\t/* ---------------------------\n\t * PlayableRenderer implementation\n\t * --------------------------- */\n\n\t// /** @override */\n\t// _canResumePlayback: function() {\n\t// \treturn PlayableRenderer.prototype._canResumePlayback.apply(this, arguments) && this.video.readyState >= HTMLMediaElement.HAVE_CURRENT_DATA;\n\t// },\n\n\t/** @override initial value */\n\t_playbackRequested: false,\n\n\t/** @override */\n\t_isMediaPaused: function() {\n\t\treturn this.video.paused;\n\t},\n\n\t/** @override */\n\t_playMedia: function() {\n\t\tif (this.video.readyState >= HTMLMediaElement.HAVE_CURRENT_DATA && this.video.seekable.length == 0) {\n\t\t\tconsole.warn(this.cid, \"WTF! got video data, but cannot seek, calling load()\");\n\t\t\t// this._logMessage(\"call:load\", \"got video data, but cannot seek, calling load()\", \"orange\");\n\t\t\tif (_.isFunction(this.video.load)) {\n\t\t\t\tthis.video.load();\n\t\t\t}\n\t\t}\n\t\t/* NOTE: loop is false, restart from end on request */\n\t\telse if (this.video.ended) {\n\t\t\tthis.video.currentTime = this.video.seekable.start(0);\n\t\t}\n\n\t\t/* if not enough data */\n\t\tif (this.video.readyState < HTMLMediaElement.HAVE_ENOUGH_DATA) {\n\t\t\tif (this.video.networkState == HTMLMediaElement.NETWORK_IDLE) {\n\t\t\t\tthis.video.load();\n\t\t\t} //else {\n\t\t\t// var _playStamp = this._playbackCount;\n\t\t\t// console.log(\"%s::_playMedia %s waiting [#%s]\", this.cid, this._isMediaWaiting() ? \"continue\" : \"begin\", _playStamp);\n\t\t\t//\n\t\t\t// this.listenToElementOnce(this.video, \"canplaythrough\", function(ev) {\n\t\t\t// \tconsole.log(\"%s::_playMedia end waiting [#%s]\", this.cid, _playStamp);\n\t\t\t//\n\t\t\t// \tthis._toggleWaiting(false);\n\t\t\t// \t// this.playbackRequested && this.video.play();\n\t\t\t// \tthis._validatePlayback();\n\t\t\t// });\n\t\t\t//}\n\t\t\t/* NOTE: on \"canplaythrough\" _playMedia() will be called again if still required */\n\t\t\tthis._toggleWaiting(true);\n\t\t}\n\t\t/* play */\n\t\telse {\n\t\t\t/* NOTE: current browsers return a promise */\n\t\t\tthis.video.play();\n\t\t}\n\t},\n\n\t/** @override */\n\t_pauseMedia: function() {\n\t\t// this._setPlayToggleSymbol(\"play-symbol\");\n\t\tthis.video.pause();\n\t\t// this._renderPlaybackState();\n\t},\n\n\t/* ---------------------------\n\t/* DOM events\n\t/* --------------------------- */\n\n\t_listenWhileSelected: function() {\n\t\tPlayableRenderer.prototype._listenWhileSelected.apply(this, arguments);\n\t\tthis.fullscreenToggle.addEventListener(\n\t\t\tthis._toggleEvent, this._onFullscreenToggle, false);\n\t},\n\n\t_stopListeningWhileSelected: function() {\n\t\tPlayableRenderer.prototype._stopListeningWhileSelected.apply(this, arguments);\n\t\tthis.fullscreenToggle.removeEventListener(\n\t\t\tthis._toggleEvent, this._onFullscreenToggle, false);\n\t},\n\n\t/* ---------------------------\n\t/* media events\n\t/* --------------------------- */\n\n\taddMediaListeners: function() {\n\t\t// if (!this._started) {\n\t\t// \tthis.addListeners(this.video, this.playingOnceEvents, this._onMediaPlayingOnce);\n\t\t// }\n\t\tthis.addListeners(this.video, this.updatePlaybackEvents, this._updatePlaybackState);\n\t\tthis.addListeners(this.video, this.updateBufferedEvents, this._updateBufferedValue);\n\t\tthis.addListeners(this.video, this.updateCurrTimeEvents, this._updateCurrTimeValue);\n\t\tthis.video.addEventListener(\"ended\", this._onMediaEnded, false);\n\t\tthis.video.addEventListener(\"error\", this._onMediaError, true);\n\n\t\tthis.on(\"view:removed\", this.removeMediaListeners, this);\n\t},\n\n\tremoveMediaListeners: function() {\n\t\tthis.off(\"view:removed\", this.removeMediaListeners, this);\n\n\t\t// if (!this._started) {\n\t\t// \tthis.removeListeners(this.video, this.playingOnceEvents, this._onMediaPlayingOnce);\n\t\t// }\n\t\tthis.removeListeners(this.video, this.updatePlaybackEvents, this._updatePlaybackState);\n\t\tthis.removeListeners(this.video, this.updateBufferedEvents, this._updateBufferedValue);\n\t\tthis.removeListeners(this.video, this.updateCurrTimeEvents, this._updateCurrTimeValue);\n\t\tthis.video.removeEventListener(\"ended\", this._onMediaEnded, false);\n\t\tthis.video.removeEventListener(\"error\", this._onMediaError, true);\n\t},\n\n\t/* ---------------------------\n\t/* media event handlers\n\t/* --------------------------- */\n\n\t_onMediaError: function(ev) {\n\t\tthis.removeMediaListeners();\n\t\tthis.removeSelectionListeners();\n\n\t\tthis._started = false;\n\t\tthis.content.classList.remove(\"started\");\n\n\t\tthis.mediaState = \"error\";\n\t\tthis.playbackRequested = false;\n\t\t// this.content.classList.remove(\"ended\");\n\t\t// this.content.classList.remove(\"waiting\");\n\t\tthis._exitFullscreen();\n\t},\n\n\t_onMediaEnded: function(ev) {\n\t\tthis.playbackRequested = false;\n\t\tthis._exitFullscreen();\n\t},\n\n\t_exitFullscreen: function() {\n\t\t/* NOTE: polyfill should handle this on iOS? */\n\t\tif (this.video.webkitDisplayingFullscreen) {\n\t\t\tthis.video.webkitExitFullscreen();\n\t\t}\n\t\tif (document.fullscreenElement === this.video) {\n\t\t\tthis.video.exitFullscreen();\n\t\t}\n\t},\n\n\t/* ---------------------------\n\t/* _onMediaPlayingOnce\n\t/* --------------------------- */\n\n\t// playingOnceEvents: \"playing waiting\",\n\t//\n\t// _onMediaPlayingOnce: function(ev) {\n\t// \tthis.removeListeners(this.video, this.playingOnceEvents, this._onMediaPlayingOnce);\n\t// \tif (!this._started) {\n\t// \t\tthis._started = true;\n\t// \t\tthis.content.classList.add(\"started\");\n\t// \t}\n\t// },\n\n\t/* ---------------------------\n\t/* _updateCurrTimeValue\n\t/* --------------------------- */\n\n\tupdateCurrTimeEvents: \"playing waiting pause timeupdate seeked\", //.split(\" \"),\n\n\t_updateCurrTimeValue: function(ev) {\n\t\tif (this.video.played.length) {\n\t\t\tthis.content.classList.add(\"started\");\n\t\t}\n\t\tif (this.progressMeter) {\n\t\t\tthis.progressMeter.valueTo(\"amount\", this.video.currentTime, 0);\n\t\t}\n\t},\n\n\t/* ---------------------------\n\t/* _updatePlaybackState\n\t/* --------------------------- */\n\n\t// updatePlaybackEvents: \"playing play waiting pause seeking seeked ended\",\n\tupdatePlaybackEvents: \"timeupdate playing pause waiting canplaythrough seeked\",\n\n\t_isPlaybackWaiting: false,\n\t_playbackStartTS: -1,\n\t_playbackStartTC: -1,\n\n\t_updatePlaybackState: function(ev) {\n\t\t// var isWaiting = false;\n\t\t// var symbolName = \"play-symbol\";\n\n\t\t// NOTE: clearTimeout will cancel both setTimeout and setInterval IDs\n\t\twindow.clearTimeout(this._playbackTimeoutID);\n\t\tthis._playbackTimeoutID = -1;\n\n\t\tif (this.playbackRequested) {\n\t\t\tif (ev.type !== \"timeupdate\") {\n\t\t\t\tthis._playbackStartTS = ev.timeStamp;\n\t\t\t\tthis._playbackStartTC = this.video.currentTime;\n\t\t\t}\n\t\t\tswitch (ev.type) {\n\t\t\t\tcase \"timeupdate\":\n\t\t\t\t\tif (SYNC_THRESHOLD_MS < Math.abs((ev.timeStamp - this._playbackStartTS) -\n\t\t\t\t\t\t\t((this.video.currentTime - this._playbackStartTC) * 1000))) {\n\t\t\t\t\t\tthis._playbackStartTS = ev.timeStamp;\n\t\t\t\t\t\tthis._playbackStartTC = this.video.currentTime;\n\t\t\t\t\t\tthis._playbackTimeoutID =\n\t\t\t\t\t\t\twindow.setTimeout(this._playbackTimeoutFn_waiting, SYNC_TIMEOUT_MS);\n\t\t\t\t\t\tthis._toggleWaiting(true);\n\t\t\t\t\t\t// break;\n\t\t\t\t\t} else {\n\t\t\t\t\t\tthis._playbackTimeoutID =\n\t\t\t\t\t\t\twindow.setTimeout(this._playbackTimeoutFn_playing, SYNC_TIMEOUT_MS);\n\t\t\t\t\t\tthis._toggleWaiting(false);\n\t\t\t\t\t}\n\t\t\t\t\tbreak;\n\n\t\t\t\tcase \"playing\":\n\t\t\t\t\tthis._playbackStartTS = ev.timeStamp;\n\t\t\t\t\tthis._playbackStartTC = this.video.currentTime;\n\t\t\t\t\tthis._playbackTimeoutID = window.setTimeout(this._playbackTimeoutFn_playing, SYNC_TIMEOUT_MS);\n\t\t\t\t\tthis._toggleWaiting(false);\n\t\t\t\t\tbreak;\n\n\t\t\t\tcase \"pause\":\n\t\t\t\t\t/* NOTE: this.playbackRequested is true, the pause wasn't triggered\n\t\t\t\t\t * from UI, but by the waiting handler below, so we treat it as\n\t\t\t\t\t * waiting */\n\t\t\t\t\t// if (!this.playbackRequested) {\n\t\t\t\t\t// \tthis._toggleWaiting(false);\n\t\t\t\t\t// }\n\t\t\t\t\tthis._toggleWaiting(this.playbackRequested);\n\t\t\t\t\tbreak;\n\n\t\t\t\tcase \"canplaythrough\":\n\t\t\t\t\tthis._toggleWaiting(false);\n\t\t\t\t\tthis._validatePlayback();\n\t\t\t\t\tbreak;\n\n\t\t\t\tcase \"waiting\":\n\t\t\t\t\t/* NOTE: if the video is seeking, give it a chance to resume, so do\n\t\t\t\t\t * nothing, and handle things on seeked/playing */\n\t\t\t\t\tif (!this.video.seeking) {\n\t\t\t\t\t\t/* if not enough data */\n\t\t\t\t\t\tif (this.video.readyState < HTMLMediaElement.HAVE_ENOUGH_DATA) {\n\t\t\t\t\t\t\tthis.video.pause();\n\n\t\t\t\t\t\t\t// this.listenToElementOnce(this.video, \"canplaythrough\", function() {\n\t\t\t\t\t\t\t// \tthis._toggleWaiting(false);\n\t\t\t\t\t\t\t// \tthis._validatePlayback();\n\t\t\t\t\t\t\t// this.playbackRequested && this.video.play();\n\t\t\t\t\t\t\t// });\n\t\t\t\t\t\t}\n\t\t\t\t\t\tthis._toggleWaiting(true);\n\t\t\t\t\t}\n\t\t\t\t\tbreak;\n\n\t\t\t\tdefault:\n\t\t\t\t\tthis._toggleWaiting(false);\n\t\t\t\t\tbreak;\n\t\t\t}\n\t\t} else {\n\t\t\tthis._toggleWaiting(false);\n\t\t}\n\t},\n\n\t_playbackTimeoutID: -1,\n\t_playbackTimeoutFn_playing: function() {\n\t\tthis._playbackTimeoutID = -1;\n\n\t\tthis._toggleWaiting(true);\n\t\t// this._renderPlaybackState();\n\n\t\t// this._setPlayToggleSymbol(\"waiting-symbol\");\n\t\t// this.content.classList.add(\"waiting\");\n\t\t// this.progressMeter.stalled = true;\n\t\t// this._isPlaybackWaiting = true;\n\t},\n\n\t_playbackTimeoutFn_waiting: function() {\n\t\tif (SYNC_THRESHOLD_MS < (this.video.currentTime - this._playbackStartTC) * 1000) {\n\t\t\tthis._playbackTimeoutID =\n\t\t\t\twindow.setTimeout(this._playbackTimeoutFn_waiting, SYNC_TIMEOUT_MS);\n\t\t} else {\n\t\t\t// since there is no event.timeStamp\n\t\t\t// var delta = this.video.currentTime - this._playbackStartTC;\n\t\t\t// this._playbackStartTS += delta * 1000;\n\t\t\t// this._playbackStartTS = window.performance.now();\n\t\t\tthis._playbackStartTS += SYNC_TIMEOUT_MS;\n\t\t\tthis._playbackStartTC = this.video.currentTime;\n\t\t\tthis._playbackTimeoutID =\n\t\t\t\twindow.setTimeout(this._playbackTimeoutFn_playing, SYNC_TIMEOUT_MS);\n\n\t\t\tthis._toggleWaiting(false);\n\t\t\t// this._renderPlaybackState();\n\n\t\t\t// this._setPlayToggleSymbol(\"pause-symbol\");\n\t\t\t// this.content.classList.remove(\"waiting\");\n\t\t\t// this.progressMeter.stalled = false;\n\t\t\t// this._isPlaybackWaiting = false;\n\t\t}\n\t},\n\n\t/** @override */\n\t_renderPlaybackState: function() {\n\t\t// if (DEBUG) {\n\t\t// \tthis.__logMessage([\n\t\t// \t\"mediaState:\", this.mediaState,\n\t\t// \t\"played:\", this.video.played.length,\n\t\t// \t\"ended:\", this.video.ended,\n\t\t// \t\"toggle.paused:\", this._playToggleSymbol.paused\n\t\t// ].join(\" \"), \"_renderPlaybackState\");\n\t\t// }\n\t\t// console.log(\"%s::_renderPlaybackState mediaState:%s played:%o ended:%o\",\n\t\t// \tthis.cid, this.mediaState, this.video.played.length, this.video.ended);\n\t\t//\n\t\t// if (this.mediaState === \"ready\") {\n\t\t// \tthis.updateOverlay(this.video, this.playToggle);\n\t\t// }\n\n\t\tvar cls = this.content.classList;\n\t\t// if (!this._started && this.playbackRequested &&\n\t\t// \t\tthis.video.readyState === HTMLMediaElement.HAVE_ENOUGH_DATA) {\n\t\t// \tthis._started = true;\n\t\t// \tcls.add(\"started\");\n\t\t// }\n\t\t// cls.toggle(\"started\", (this.video.played.length > 0));\n\t\tcls.toggle(\"ended\", this.video.ended);\n\n\t\tPlayableRenderer.prototype._renderPlaybackState.apply(this, arguments);\n\t},\n\n\t_setPlayToggleSymbol: function(symbolName) {\n\t\t// if (this.video.ended) {\n\t\t// \tconsole.log(\"%s::_setPlayToggleSymbol %s -> ended\", this.cid, symbolName);\n\t\t// }\n\t\t// if (this.mediaState === \"ready\") {\n\t\t// \tif (this.playbackRequested && !this._isMediaWaiting()) {\n\t\t// \t\tthis._playToggleSymbol.setImageSource(null);\n\t\t// \t} else {\n\t\t// \t\tthis._playToggleSymbol.setImageSource(this.video);\n\t\t// \t}\n\t\t// \tthis._playToggleSymbol.refreshImageSource();\n\t\t// }\n\t\treturn PlayableRenderer.prototype._setPlayToggleSymbol.call(this, this.video.ended ? \"ended\" : symbolName);\n\t},\n\n\t/* ---------------------------\n\t/* _updateBufferedValue\n\t/* --------------------------- */\n\n\t// updateBufferedEvents: \"progress canplay canplaythrough playing timeupdate\",//loadeddata\n\tupdateBufferedEvents: \"progress canplay canplaythrough play playing\",\n\n\t_updateBufferedValue: function(ev) {\n\t\t// if (!this._started) return;\n\t\tvar bRanges = this.video.buffered;\n\t\tif (bRanges.length > 0) {\n\t\t\tthis._bufferedValue = bRanges.end(bRanges.length - 1);\n\t\t\tif (this.progressMeter && ((this.video.readyState >= HTMLMediaElement.HAVE_CURRENT_DATA) /*|| (this.video.readyState >= HTMLMediaElement.HAVE_CURRENT_DATA && this.video.networkState == HTMLMediaElement.NETWORK_LOADING)*/ )) {\n\t\t\t\tthis.progressMeter.valueTo(\"available\", this._bufferedValue, 300);\n\t\t\t\t// this.progressMeter.valueTo(\"available\", this._bufferedValue, Math.max(0, 1000 * (this._bufferedValue - (this.progressMeter.getTargetValue(\"available\") | 0))));\n\t\t\t}\n\t\t}\n\t},\n\n\t/* ---------------------------\n\t/* fullscreen api\n\t/* --------------------------- */\n\n\t_onFullscreenToggle: function(ev) {\n\t\t// NOTE: Ignore if MouseEvent.button is 0 or undefined (0: left-button)\n\t\tif (!ev.defaultPrevented && !ev.button && this.model.selected) {\n\t\t\tev.preventDefault();\n\t\t\ttry {\n\t\t\t\tif (document.hasOwnProperty(\"fullscreenElement\") &&\n\t\t\t\t\tdocument.fullscreenElement !== this.video) {\n\t\t\t\t\tdocument.addEventListener(fullscreenChangeEvent, this._onFullscreenChange, false);\n\t\t\t\t\tthis.video.requestFullscreen();\n\t\t\t\t} else\n\t\t\t\tif (this.video.webkitSupportsFullscreen && !this.video.webkitDisplayingFullscreen) {\n\t\t\t\t\tthis.video.addEventListener(\"webkitbeginfullscreen\", this._onFullscreenChange, false);\n\t\t\t\t\tthis.video.webkitEnterFullScreen();\n\t\t\t\t}\n\t\t\t} catch (err) {\n\t\t\t\tthis.video.controls = false;\n\t\t\t\tconsole.error(err);\n\t\t\t}\n\t\t}\n\t},\n\n\t_onFullscreenChange: function(ev) {\n\t\tswitch (ev.type) {\n\t\t\tcase fullscreenChangeEvent:\n\t\t\t\t// var isOwnFullscreen = Modernizr.prefixed(\"fullscreenElement\", document) === this.video;\n\t\t\t\tvar isOwnFullscreen = document.fullscreenElement === this.video;\n\t\t\t\tthis.video.controls = isOwnFullscreen;\n\t\t\t\tif (!isOwnFullscreen) {\n\t\t\t\t\tdocument.removeEventListener(fullscreenChangeEvent, this._onFullscreenChange, false);\n\t\t\t\t}\n\t\t\t\tbreak;\n\t\t\tcase \"webkitbeginfullscreen\":\n\t\t\t\tthis.video.controls = true;\n\t\t\t\tthis.video.removeEventListener(\"webkitbeginfullscreen\", this._onFullscreenChange, false);\n\t\t\t\tthis.video.addEventListener(\"webkitendfullscreen\", this._onFullscreenChange, false);\n\t\t\t\tbreak;\n\t\t\tcase \"webkitendfullscreen\":\n\t\t\t\tthis.video.removeEventListener(\"webkitendfullscreen\", this._onFullscreenChange, false);\n\t\t\t\tthis.video.controls = false;\n\t\t\t\tbreak;\n\t\t}\n\t},\n});\nmodule.exports = VideoRenderer;\n\n/* ---------------------------\n/* log to screen\n/* --------------------------- */\nif (DEBUG) {\n\tmodule.exports = (function(VideoRenderer) {\n\t\tif (!VideoRenderer.LOG_TO_SCREEN) return VideoRenderer;\n\n\t\t/** @type {Function} */\n\t\tvar Color = require(\"color\");\n\t\t/** @type {module:underscore.strings/lpad} */\n\t\tvar lpad = require(\"underscore.string/lpad\");\n\t\t/** @type {module:underscore.strings/rpad} */\n\t\tvar rpad = require(\"underscore.string/rpad\");\n\n\t\t// var fullscreenEvents = [\n\t\t// \tfullscreenChangeEvent, fullscreenErrorEvent,\n\t\t// \t\"webkitbeginfullscreen\", \"webkitendfullscreen\",\n\t\t// ];\n\n\t\tvar mediaEvents = require(\"utils/event/mediaEventsEnum\");\n\t\tvar logPlaybackStateEvents, logBufferedEvents, logPlayedEvents;\n\n\t\t// logPlaybackStateEvents = [\"playing\", \"waiting\", \"ended\", \"pause\", \"seeking\", \"seeked\"];\n\t\t// logBufferedEvents = [\"progress\", \"durationchange\", \"canplay\", \"play\"];\n\t\t// logPlayedEvents = [\"playing\", \"timeupdate\"];\n\n\t\tlogPlaybackStateEvents = [\n\t\t\t\"loadstart\",\n\t\t\t\"progress\",\n\t\t\t\"suspend\",\n\t\t\t\"abort\",\n\t\t\t\"error\",\n\t\t\t\"emptied\",\n\t\t\t\"stalled\",\n\t\t];\n\t\tlogBufferedEvents = [\n\t\t\t\"loadedmetadata\",\n\t\t\t\"loadeddata\",\n\t\t\t\"canplay\",\n\t\t\t\"canplaythrough\",\n\t\t\t\"playing\",\n\t\t\t\"waiting\",\n\t\t\t\"seeking\", // seeking changed to true\n\t\t\t\"seeked\", // seeking changed to false\n\t\t\t\"ended\", // ended is true\n\t\t];\n\t\tlogPlayedEvents = [\n\t\t\t\"play\",\n\t\t\t\"pause\"\n\t\t];\n\n\t\t// Exclude some events from log\n\t\tmediaEvents = _.without(mediaEvents, \"resize\", \"error\");\n\t\t// Make sure event subsets exist in the main set\n\t\tlogPlaybackStateEvents = _.intersection(mediaEvents, logPlaybackStateEvents);\n\t\tlogBufferedEvents = _.intersection(mediaEvents, logBufferedEvents);\n\t\tlogPlayedEvents = _.intersection(mediaEvents, logPlayedEvents);\n\n\t\tvar readyStateSymbols = _.invert(_.pick(HTMLMediaElement,\n\t\t\tfunction(val, key, obj) {\n\t\t\t\treturn /^HAVE_/.test(key);\n\t\t\t}));\n\t\tvar readyStateToString = function(el) {\n\t\t\treturn readyStateSymbols[el.readyState] + \"(\" + el.readyState + \")\";\n\t\t};\n\n\t\tvar networkStateSymbols = _.invert(_.pick(HTMLMediaElement,\n\t\t\tfunction(val, key, obj) {\n\t\t\t\treturn /^NETWORK_/.test(key);\n\t\t\t}));\n\t\tvar networkStateToString = function(el) {\n\t\t\treturn networkStateSymbols[el.networkState] + \"(\" + el.networkState + \")\";\n\t\t};\n\n\t\tvar mediaErrorSymbols = _.invert(MediaError);\n\t\tvar mediaErrorToString = function(el) {\n\t\t\treturn el.error ? mediaErrorSymbols[el.error.code] + \"(\" + el.error.code + \")\" : \"[MediaError null]\";\n\t\t};\n\n\t\tvar findRangeIndex = function(range, currTime) {\n\t\t\tfor (var i = 0, ii = range.length; i < ii; i++) {\n\t\t\t\tif (range.start(i) <= currTime && currTime <= range.end(i)) {\n\t\t\t\t\treturn i;\n\t\t\t\t}\n\t\t\t}\n\t\t\treturn -1;\n\t\t};\n\n\t\tvar formatVideoError = function(video) {\n\t\t\treturn [\n\t\t\t\tmediaErrorToString(video),\n\t\t\t\tnetworkStateToString(video),\n\t\t\t\treadyStateToString(video),\n\t\t\t].join(\" \");\n\t\t};\n\n\t\tvar getVideoStatsCols = function() {\n\t\t\treturn \"0000.000 [Curr/Total] [Seekable]  [Buffered]  networkState readyState      Playback\";\n\t\t\t// return \"0000.620 [t:  0.0  27.4] [s: 27.4 0/1] [b:  0.5 0/1] LOADING(2)   FUTURE_DATA(3)  :: (::)\";\n\t\t}\n\n\t\tvar formatVideoStats = function(video) {\n\t\t\tvar currTime = video.currentTime,\n\t\t\t\tdurTime = video.duration,\n\t\t\t\tbRanges = video.buffered,\n\t\t\t\tbRangeIdx,\n\t\t\t\tsRanges = video.seekable,\n\t\t\t\tsRangeIdx;\n\n\t\t\tbRangeIdx = findRangeIndex(bRanges, currTime);\n\t\t\tsRangeIdx = findRangeIndex(sRanges, currTime);\n\t\t\treturn [\n\t\t\t\t\"[\" + lpad(currTime.toFixed(1), 5) +\n\t\t\t\t\t\" \" + lpad((!isNaN(durTime) ? durTime.toFixed(1) : \"-\"), 4) + \"]\",\n\t\t\t\t\"[\" + lpad((sRangeIdx >= 0 ? sRanges.end(sRangeIdx).toFixed(1) : \"-\"), 5) +\n\t\t\t\t\t\" \" + (sRangeIdx >= 0 ? sRangeIdx : \"-\") + \"/\" + sRanges.length + \"]\",\n\t\t\t\t\"[\" + lpad((bRangeIdx >= 0 ? bRanges.end(bRangeIdx).toFixed(1) : \"-\"), 5) +\n\t\t\t\t\t\" \" + (bRangeIdx >= 0 ? bRangeIdx : \"-\") + \"/\" + bRanges.length + \"]\",\n\t\t\t\trpad(networkStateToString(video).substr(8), 12),\n\t\t\t\trpad(readyStateToString(video).substr(5), 15),\n\t\t\t\t(video.ended ? \">:\" : (video.paused ? \"::\" : \">>\"))\n\t\t\t\t// video.playbackRate.toFixed(2) + \" (\" + video.defaultPlaybackRate.toFixed(2) + \")\"\n\t\t\t]; //.join(\" \");\n\t\t};\n\n\t\treturn VideoRenderer.extend({\n\n\t\t\t/** @override */\n\t\t\tinitialize: function() {\n\t\t\t\tVideoRenderer.prototype.initialize.apply(this, arguments);\n\n\t\t\t\t_.bindAll(this, \"__handleMediaEvent\");\n\n\t\t\t\tvar fgColor = this.model.attr(\"color\"),\n\t\t\t\t\tred = new Color(\"red\"),\n\t\t\t\t\tblue = new Color(\"blue\"),\n\t\t\t\t\tgreen = new Color(\"green\");\n\n\t\t\t\tfor (var i = 0; i < mediaEvents.length; i++) {\n\t\t\t\t\tvar ev = mediaEvents[i];\n\t\t\t\t\tthis.video.addEventListener(ev, this.__handleMediaEvent, false);\n\n\t\t\t\t\tvar c = new Color(fgColor),\n\t\t\t\t\t\tcc = 1;\n\t\t\t\t\tif (logBufferedEvents.indexOf(ev) != -1) c.mix(green, (cc /= 2));\n\t\t\t\t\tif (logPlayedEvents.indexOf(ev) != -1) c.mix(red, (cc /= 2));\n\t\t\t\t\tif (logPlaybackStateEvents.indexOf(ev) != -1) c.mix(blue, (cc /= 2));\n\t\t\t\t\tthis.__logColors[ev] = c.rgb().string();\n\t\t\t\t}\n\t\t\t\tthis.video.addEventListener(\"error\", this.__handleMediaEvent, true);\n\t\t\t},\n\n\t\t\t/** @override */\n\t\t\tremove: function() {\n\t\t\t\tVideoRenderer.prototype.remove.apply(this, arguments);\n\t\t\t\tfor (var i = 0; i < mediaEvents.length; i++) {\n\t\t\t\t\tif (mediaEvents[i] == \"error\") continue;\n\t\t\t\t\tthis.video.removeEventListener(mediaEvents[i], this.__handleMediaEvent, false);\n\t\t\t\t}\n\t\t\t\tthis.video.removeEventListener(\"error\", this.__handleMediaEvent, true);\n\t\t\t},\n\n\t\t\t// /** @override */\n\t\t\t// _onVisibilityChange: function(ev) {\n\t\t\t// \tVideoRenderer.prototype._onVisibilityChange.apply(this, arguments);\n\t\t\t// \tvar stateVal = Modernizr.prefixed(\"visibilityState\", document);\n\t\t\t// \tthis.__logEvent(\"visibilityState:\" + stateVal, ev.type + \":\" + stateVal);\n\t\t\t// },\n\t\t\t//\n\t\t\t// /** @override */\n\t\t\t// _onFullscreenChange: function(ev) {\n\t\t\t// \tVideoRenderer.prototype._onFullscreenChange.apply(this, arguments);\n\t\t\t// \tvar logtype = (document.fullscreenElement === this.video ? \"enter:\" : \"exit:\") + ev.type;\n\t\t\t// \tthis.__logEvent(\"document.fullscreenElement: \" + this.cid, logtype);\n\t\t\t// },\n\n\t\t\t/** @override */\n\t\t\t_onFullscreenToggle: function(ev) {\n\t\t\t\tif (!ev.defaultPrevented && this.model.selected) {\n\t\t\t\t\tthis.__logEvent(\"fullscreen-toggle\", ev.type);\n\t\t\t\t}\n\t\t\t\tVideoRenderer.prototype._onFullscreenToggle.apply(this, arguments);\n\t\t\t},\n\n\t\t\t/** @override */\n\t\t\t_playbackTimeoutFn_playing: function() {\n\t\t\t\tVideoRenderer.prototype._playbackTimeoutFn_playing.apply(this, arguments);\n\t\t\t\t// this.__logEvent(formatVideoStats(this.video).join(\" \"), \"timeout-play\");\n\t\t\t\tthis.__handleMediaEvent({\n\t\t\t\t\ttype: \"timeout-play\",\n\t\t\t\t\ttimeStamp: null,\n\t\t\t\t\tisTimeout: true\n\t\t\t\t});\n\t\t\t},\n\n\t\t\t/** @override */\n\t\t\t_playbackTimeoutFn_waiting: function() {\n\t\t\t\tVideoRenderer.prototype._playbackTimeoutFn_waiting.apply(this, arguments);\n\t\t\t\t// this.__logEvent(formatVideoStats(this.video).join(\" \"), \"timeout-wait\");\n\t\t\t\tthis.__handleMediaEvent({\n\t\t\t\t\ttype: \"timeout-wait\",\n\t\t\t\t\ttimeStamp: null,\n\t\t\t\t\tisTimeout: true\n\t\t\t\t});\n\t\t\t},\n\n\t\t\t__handleMediaEvent: function(ev) {\n\t\t\t\tvar evmsg = formatVideoStats(this.video);\n\n\t\t\t\tif (this.playbackRequested === true) {\n\t\t\t\t\tevmsg.push(\"(>>)\");\n\t\t\t\t} else if (this.playbackRequested === false) {\n\t\t\t\t\tevmsg.push(\"(::)\");\n\t\t\t\t} else {\n\t\t\t\t\tevmsg.push(\"(--)\");\n\t\t\t\t}\n\n\t\t\t\tif (this.playbackRequested) {\n\t\t\t\t\tevmsg.push(this._playbackTimeoutID !== -1 ? \"W\" : \"-\");\n\t\t\t\t} else {\n\t\t\t\t\tevmsg.push(this._playbackTimeoutID !== -1 ? \"?\" : \"!\");\n\t\t\t\t}\n\t\t\t\t// evmsg.push(this._playToggleSymbol.symbolName);\n\n\t\t\t\tvar ts, tc;\n\t\t\t\tif ((this.updatePlaybackEvents.indexOf(ev.type) > -1) || ev.isTimeout) {\n\t\t\t\t\t// evmsg.push(this._playbackStartTS.toFixed(2));\n\t\t\t\t\tts = ev.timeStamp - this._playbackStartTS;\n\t\t\t\t\ttc = this.video.currentTime - this._playbackStartTC;\n\t\t\t\t\tts *= .001; // s to ms\n\t\t\t\t\tevmsg.push(Math.abs(tc - ts).toFixed(3));\n\t\t\t\t}\n\t\t\t\t// else {\n\t\t\t\t// \tts = this._playbackStartTS;\n\t\t\t\t// \ttc = this._playbackStartTC;\n\t\t\t\t// }\n\t\t\t\t// ts *= .001; // s to ms\n\t\t\t\t// evmsg.push(Math.abs(tc - ts).toFixed(3));\n\t\t\t\t// evmsg.push(\"TC:\" + tc.toFixed(3));\n\t\t\t\t// evmsg.push(\"TS:\" + ts.toFixed(3));\n\n\t\t\t\tthis.__logEvent(evmsg.join(\" \"), ev.type);\n\t\t\t\tif (ev.type === \"error\" || ev.type === \"abort\") {\n\t\t\t\t\tthis.__logMessage(formatVideoError(this.video), ev.type);\n\t\t\t\t}\n\t\t\t},\n\n\t\t\t__logEvent: function(msg, logtype, color) {\n\t\t\t\tvar logEntryEl = this.__logElement.lastElementChild;\n\t\t\t\tif ((logEntryEl && logEntryEl.getAttribute(\"data-logtype\") == logtype) &&\n\t\t\t\t\t((logtype === \"timeupdate\") || (logtype === \"progress\"))) {\n\t\t\t\t\tvar logRepeatVal = parseInt(logEntryEl.getAttribute(\"data-logrepeat\"));\n\t\t\t\t\tlogEntryEl.textContent = this.__getTStamp() + \" \" + msg;\n\t\t\t\t\tlogEntryEl.setAttribute(\"data-logrepeat\", isNaN(logRepeatVal) ? 2 : ++logRepeatVal);\n\t\t\t\t} else {\n\t\t\t\t\tthis.__logMessage(msg, logtype, color);\n\t\t\t\t}\n\t\t\t},\n\n\t\t\t__getHeaderText: function() {\n\t\t\t\treturn getVideoStatsCols();\n\t\t\t},\n\t\t});\n\t})(module.exports);\n}\n",
    "// hbsfy compiled Handlebars template\nvar HandlebarsCompiler = require('hbsfy/runtime');\nmodule.exports = HandlebarsCompiler.template({\"compiler\":[7,\">= 4.0.0\"],\"main\":function(container,depth0,helpers,partials,data) {\n    var stack1, helper, alias1=depth0 != null ? depth0 : (container.nullContext || {}), alias2=helpers.helperMissing, alias3=\"function\";\n\n  return \"<div id=\\\"desc_b\"\n    + container.escapeExpression(((helper = (helper = helpers.id || (depth0 != null ? depth0.id : depth0)) != null ? helper : alias2),(typeof helper === alias3 ? helper.call(alias1,{\"name\":\"id\",\"hash\":{},\"data\":data}) : helper)))\n    + \"\\\" class=\\\"content sizing mdown\\\">\"\n    + ((stack1 = ((helper = (helper = helpers.desc || (depth0 != null ? depth0.desc : depth0)) != null ? helper : alias2),(typeof helper === alias3 ? helper.call(alias1,{\"name\":\"desc\",\"hash\":{},\"data\":data}) : helper))) != null ? stack1 : \"\")\n    + \"</div>\\n\";\n},\"useData\":true});\n",
    "// hbsfy compiled Handlebars template\nvar HandlebarsCompiler = require('hbsfy/runtime');\nmodule.exports = HandlebarsCompiler.template({\"compiler\":[7,\">= 4.0.0\"],\"main\":function(container,depth0,helpers,partials,data) {\n    var stack1, helper, alias1=depth0 != null ? depth0 : (container.nullContext || {}), alias2=helpers.helperMissing, alias3=\"function\";\n\n  return \"<div id=\\\"desc_m\"\n    + container.escapeExpression(((helper = (helper = helpers.id || (depth0 != null ? depth0.id : depth0)) != null ? helper : alias2),(typeof helper === alias3 ? helper.call(alias1,{\"name\":\"id\",\"hash\":{},\"data\":data}) : helper)))\n    + \"\\\" class=\\\"content sizing\\\"><p>\"\n    + ((stack1 = ((helper = (helper = helpers.name || (depth0 != null ? depth0.name : depth0)) != null ? helper : alias2),(typeof helper === alias3 ? helper.call(alias1,{\"name\":\"name\",\"hash\":{},\"data\":data}) : helper))) != null ? stack1 : \"\")\n    + \"</p>\"\n    + ((stack1 = ((helper = (helper = helpers.sub || (depth0 != null ? depth0.sub : depth0)) != null ? helper : alias2),(typeof helper === alias3 ? helper.call(alias1,{\"name\":\"sub\",\"hash\":{},\"data\":data}) : helper))) != null ? stack1 : \"\")\n    + \"</div>\\n\";\n},\"useData\":true});\n",
    "// hbsfy compiled Handlebars template\nvar HandlebarsCompiler = require('hbsfy/runtime');\nmodule.exports = HandlebarsCompiler.template({\"1\":function(container,depth0,helpers,partials,data) {\n    var helper;\n\n  return \"\t\t<p><code>\"\n    + container.escapeExpression(((helper = (helper = helpers.infoSrc || (depth0 != null ? depth0.infoSrc : depth0)) != null ? helper : helpers.helperMissing),(typeof helper === \"function\" ? helper.call(depth0 != null ? depth0 : (container.nullContext || {}),{\"name\":\"infoSrc\",\"hash\":{},\"data\":data}) : helper)))\n    + \"</code></p>\\n\";\n},\"compiler\":[7,\">= 4.0.0\"],\"main\":function(container,depth0,helpers,partials,data) {\n    var stack1, helper, alias1=depth0 != null ? depth0 : (container.nullContext || {}), alias2=helpers.helperMissing, alias3=\"function\", alias4=container.escapeExpression;\n\n  return \"<div class=\\\"error-title color-fg color-reverse\\\">\"\n    + alias4(((helper = (helper = helpers.name || (depth0 != null ? depth0.name : depth0)) != null ? helper : alias2),(typeof helper === alias3 ? helper.call(alias1,{\"name\":\"name\",\"hash\":{},\"data\":data}) : helper)))\n    + \"</div>\\n<div class=\\\"error-message color-fg\\\">\\n\t<p><strong>\"\n    + alias4(((helper = (helper = helpers.name || (depth0 != null ? depth0.name : depth0)) != null ? helper : alias2),(typeof helper === alias3 ? helper.call(alias1,{\"name\":\"name\",\"hash\":{},\"data\":data}) : helper)))\n    + \"</strong> <code>\"\n    + alias4(((helper = (helper = helpers.message || (depth0 != null ? depth0.message : depth0)) != null ? helper : alias2),(typeof helper === alias3 ? helper.call(alias1,{\"name\":\"message\",\"hash\":{},\"data\":data}) : helper)))\n    + \"</code></p>\\n\"\n    + ((stack1 = helpers[\"if\"].call(alias1,(depth0 != null ? depth0.infoSrc : depth0),{\"name\":\"if\",\"hash\":{},\"fn\":container.program(1, data, 0),\"inverse\":container.noop,\"data\":data})) != null ? stack1 : \"\")\n    + \"</div>\\n\";\n},\"useData\":true});\n",
    "// var Handlebars = require(\"handlebars\")[\"default\"];\nconst Handlebars = require(\"hbsfy/runtime\");\n/** @type {Function} */\nconst Color = require(\"color\");\n/** @type {module:app/control/Globals} */\nconst Globals = require(\"app/control/Globals\");\n\n// (function() {\nvar helpers = {\n\t/*\n\t/* Arithmetic helpers\n\t/*/\n\tadd: function(value, addition) {\n\t\treturn value + addition;\n\t},\n\tsubtract: function(value, substraction) {\n\t\treturn value - substraction;\n\t},\n\tdivide: function(value, divisor) {\n\t\treturn value / divisor;\n\t},\n\tmultiply: function(value, multiplier) {\n\t\treturn value * multiplier;\n\t},\n\tfloor: function(value) {\n\t\treturn Math.floor(value);\n\t},\n\tceil: function(value) {\n\t\treturn Math.ceil(value);\n\t},\n\tround: function(value) {\n\t\treturn Math.round(value);\n\t},\n\tglobal: function(value) {\n\t\treturn Globals[value];\n\t},\n\n\t/*\n\t/* Flow control helpers\n\t/*/\n\tis: function(a, b, opts) {\n\t\treturn (a === b) ? opts.fn(this) : opts.inverse(this);\n\t},\n\tisnot: function(a, b, opts) {\n\t\treturn (a !== b) ? opts.fn(this) : opts.inverse(this);\n\t},\n\tisany: function(value) {\n\t\tvar i = 0,\n\t\t\tii = arguments.length - 2,\n\t\t\topts = arguments[ii + 1];\n\t\tdo\n\t\t\tif (value === arguments[++i]) {\n\t\t\t\treturn opts.fn(this);\n\t\t\t}\n\t\twhile (i < ii);\n\t\treturn opts.inverse(this);\n\t},\n\tcontains: function(a, b, opts) {\n\t\treturn (a.indexOf(b) !== -1) ? opts.fn(this) : opts.inverse(this);\n\t},\n\tignore: function() {\n\t\treturn \"\";\n\t},\n\n\t/*\n\t/* Color helpers\n\t/*/\n\tmix: function(colora, colorb, amount) {\n\t\treturn new Color(colora).mix(new Color(colorb), amount).rgb().string();\n\t},\n\tlighten: function(color, amount) {\n\t\treturn new Color(color).lighten(amount).rgb().string();\n\t},\n\tdarken: function(color, amount) {\n\t\treturn new Color(color).darken(amount).rgb().string();\n\t},\n\t// colorFormat: function(color, fmt) {\n\t// \tswitch (fmt) {\n\t// \t\tcase \"rgb\":\n\t// \t\t\treturn new Color(color).rgb().string();\n\t// \t\tcase \"hsl\":\n\t// \t\t\treturn new Color(color).hsl().string();\n\t// \t\tcase \"hex\": default:\n\t// \t\t\treturn new Color(color).hex().string();\n\t// \t}\n\t// },\n};\nfor (var helper in helpers) {\n\tif (helpers.hasOwnProperty(helper)) {\n\t\tHandlebars.registerHelper(helper, helpers[helper]);\n\t}\n}\n// })();\n\n// module.exports = Handlebars;\n",
    "// hbsfy compiled Handlebars template\nvar HandlebarsCompiler = require('hbsfy/runtime');\nmodule.exports = HandlebarsCompiler.template({\"compiler\":[7,\">= 4.0.0\"],\"main\":function(container,depth0,helpers,partials,data) {\n    return \"<svg class=\\\"cog-symbol icon\\\" viewBox=\\\"-100 -100 200 200\\\" version=\\\"1.1\\\" xmlns=\\\"http://www.w3.org/2000/svg\\\" preserveAspectRatio=\\\"xMidYMid meet\\\">\\n\t<path d=\\\"M11.754,-99.307c-7.809,-0.924 -15.699,-0.924 -23.508,0l-3.73,20.82c-6.254,1.234 -12.338,3.21 -18.123,5.888l-15.255,-14.651c-6.861,3.842 -13.244,8.48 -19.018,13.818l9.22,19.036c-4.335,4.674 -8.095,9.849 -11.201,15.416l-20.953,-2.886c-3.292,7.141 -5.731,14.645 -7.265,22.357l18.648,9.981c-0.759,6.329 -0.759,12.727 0,19.056l-18.648,9.981c1.534,7.712 3.973,15.216 7.265,22.357l20.953,-2.886c3.106,5.567 6.866,10.742 11.201,15.416l-9.22,19.036c5.774,5.338 12.157,9.976 19.018,13.818l15.255,-14.651c5.785,2.678 11.869,4.654 18.123,5.888l3.73,20.82c7.809,0.924 15.699,0.924 23.508,0l3.73,-20.82c6.254,-1.234 12.338,-3.21 18.123,-5.888l15.255,14.651c6.861,-3.842 13.244,-8.48 19.018,-13.818l-9.22,-19.036c4.335,-4.674 8.095,-9.849 11.201,-15.416l20.953,2.886c3.292,-7.141 5.731,-14.645 7.265,-22.357l-18.648,-9.981c0.759,-6.329 0.759,-12.727 0,-19.056l18.648,-9.981c-1.534,-7.712 -3.973,-15.216 -7.265,-22.357l-20.953,2.886c-3.106,-5.567 -6.866,-10.742 -11.201,-15.416l9.22,-19.036c-5.774,-5.338 -12.157,-9.976 -19.018,-13.818l-15.255,14.651c-5.785,-2.678 -11.869,-4.654 -18.123,-5.888l-3.73,-20.82ZM0,-33c18.213,0 33,14.787 33,33c0,18.213 -14.787,33 -33,33c-18.213,0 -33,-14.787 -33,-33c0,-18.213 14.787,-33 33,-33Z\\\" style=\\\"fill:currentColor;fill-rule:evenodd;\\\"/>\\n</svg>\\n\";\n},\"useData\":true});\n",
    "// hbsfy compiled Handlebars template\nvar HandlebarsCompiler = require('hbsfy/runtime');\nmodule.exports = HandlebarsCompiler.template({\"compiler\":[7,\">= 4.0.0\"],\"main\":function(container,depth0,helpers,partials,data) {\n    return \"<svg class=\\\"fullscreen-symbol\\\" version=\\\"1.1\\\" xmlns=\\\"http://www.w3.org/2000/svg\\\" xmlns:xlink=\\\"http://www.w3.org/1999/xlink\\\" preserveAspectRatio=\\\"xMidYMid meet\\\" viewBox=\\\"-21 -21 42 42\\\">\\n\t<path id=\\\"fullscreen-shadow\\\" d=\\\"M-5,5 L-20,20 M-7,20 L-20,20 L-20,7 M5,-5 L20,-20 M7,-20 L20,-20 L20,-7\\\" class=\\\"bg-color-stroke\\\" style=\\\"fill:none\\\" vector-effect=\\\"non-scaling-stroke\\\" transform=\\\"translate(2 2)\\\"/>\\n\t<path id=\\\"fullscreen-path\\\" d=\\\"M-5,5 L-20,20 M-7,20 L-20,20 L-20,7 M5,-5 L20,-20 M7,-20 L20,-20 L20,-7\\\" class=\\\"color-stroke\\\" style=\\\"fill:none\\\" vector-effect=\\\"non-scaling-stroke\\\" />\\n</svg>\\n\";\n},\"useData\":true});\n",
    "/** @type {module:backbone} */\nconst Events = require(\"backbone\").Events;\n\n\n// var defaultOptions = {\n// \ttick: 1,\n// \tonstart: null,\n// \tontick: null,\n// \tonpause: null,\n// \tonstop: null,\n// \tonend: null\n// }\nvar idSeed = 0;\n\nvar Timer = function(options) {\n\t// if (!(this instanceof Timer)) {\n\t// \treturn new Timer(options);\n\t// }\n\tthis._id = idSeed++;\n\t// this._options = {};\n\tthis._duration = 0;\n\tthis._status = \"initialized\";\n\tthis._start = 0;\n\t// this._measures = [];\n\n\t// for (var prop in defaultOptions) {\n\t// \tthis._options[prop] = defaultOptions[prop];\n\t// }\n\t// this.options(options);\n};\n\n_.extend(Timer.prototype, Events, {\n\n\tstart: function(duration) {\n\t\tif (!_.isNumber(duration) && !this._duration) {\n\t\t\treturn this;\n\t\t}\n\t\t// duration && (duration *= 1000)\n\t\tif (this._timeout && this._status === \"started\") {\n\t\t\treturn this;\n\t\t}\n\t\tvar evName = (this._status === \"stopped\") ? \"start\" : \"resume\";\n\t\tthis._duration = duration || this._duration;\n\t\tthis._timeout = window.setTimeout(end.bind(this), this._duration);\n\t\t// if (typeof this._options.ontick === \"function\") {\n\t\t// \tthis._interval = setInterval(function() {\n\t\t// \t\tthis.trigger(\"tick\", this.getDuration())\n\t\t// \t}.bind(this), +this._options.tick * 1000)\n\t\t// }\n\t\tthis._start = _now();\n\t\tthis._status = \"started\";\n\t\tthis.trigger(evName, this.getDuration());\n\t\treturn this;\n\t},\n\n\tpause: function() {\n\t\tif (this._status !== \"started\") {\n\t\t\treturn this;\n\t\t}\n\t\tthis._duration -= (_now() - this._start);\n\t\tclear.call(this, false);\n\t\tthis._status = \"paused\";\n\t\tthis.trigger(\"pause\", this.getDuration());\n\t\treturn this;\n\t},\n\n\tstop: function() {\n\t\tif (!/started|paused/.test(this._status)) {\n\t\t\treturn this;\n\t\t}\n\t\tclear.call(this, true);\n\t\tthis._status = \"stopped\";\n\t\tthis.trigger(\"stop\");\n\t\treturn this;\n\t},\n\n\tgetDuration: function() {\n\t\tif (this._status === \"started\") {\n\t\t\treturn this._duration - (_now() - this._start);\n\t\t}\n\t\tif (this._status === \"paused\") {\n\t\t\treturn this._duration;\n\t\t}\n\t\treturn 0;\n\t},\n\n\tgetStatus: function() {\n\t\treturn this._status;\n\t},\n});\n\nvar _now = window.performance ?\n\twindow.performance.now.bind(window.performance) :\n\tDate.now.bind(Date);\n\nfunction end() {\n\tclear.call(this);\n\tthis._status = \"stopped\";\n\tthis.trigger(\"end\");\n}\n\nfunction clear(clearDuration) {\n\twindow.clearTimeout(this._timeout);\n\t// window.clearInterval(this._interval);\n\tif (clearDuration === true) {\n\t\tthis._duration = 0;\n\t}\n}\n\nObject.defineProperties(Timer.prototype, {\n\tduration: {\n\t\tenumerable: true,\n\t\tget: function() {\n\t\t\treturn this.getDuration();\n\t\t}\n\t},\n\tstatus: {\n\t\tenumerable: true,\n\t\tget: function() {\n\t\t\treturn this.getStatus();\n\t\t}\n\t}\n});\n\nObject.defineProperties(Timer, {\n\tSTOPPED: {\n\t\tenumerable: true,\n\t\tvalue: \"stopped\"\n\t},\n\tSTARTED: {\n\t\tenumerable: true,\n\t\tvalue: \"started\"\n\t},\n\tPAUSED: {\n\t\tenumerable: true,\n\t\tvalue: \"paused\"\n\t},\n});\n\nmodule.exports = Timer;\n",
    "/* -------------------------------\n/* Imports\n/* ------------------------------- */\n/** @type {module:utils/TransformItem} */\nconst TransformItem = require(\"./TransformItem\");\n\nvar idSeed = 0;\nvar cidSeed = 100;\nvar slice = Array.prototype.slice;\n\n/**\n * @constructor\n * @type {module:app/helper/TransformHelper}\n */\nfunction TransformHelper() {\n\tthis.id = idSeed++;\n\tthis._items = [];\n\tthis._itemsById = {};\n}\n\nTransformHelper.prototype = Object.create({\n\n\t/* -------------------------------\n\t/* Private\n\t/* ------------------------------- */\n\n\t_get: function(el) {\n\t\tif (this.has(el)) {\n\t\t\treturn this._itemsById[el.eid];\n\t\t} else {\n\t\t\treturn this._add(el);\n\t\t}\n\t},\n\n\t_add: function(el) {\n\t\tvar item, id;\n\t\t// id = el.eid || el.cid || el.id;\n\t\t// if (!id || (this._itemsById[id] && (this._itemsById[id].el !== el))) {\n\t\t// \tid = \"elt\" + cidSeed++;\n\t\t// }\n\t\t// if (!el.eid) {\n\t\t// \tid = el.eid || el.cid || (\"elt\" + cidSeed++);\n\t\t// }\n\t\tid = el.eid || el.cid || (\"elt\" + cidSeed++);\n\t\titem = new TransformItem(el, id);\n\t\tthis._itemsById[id] = item;\n\t\tthis._items.push(item);\n\t\treturn item;\n\t},\n\n\t_remove: function(el) {\n\t\tif (this.has(el)) {\n\t\t\tvar o = this._itemsById[el.eid];\n\t\t\tthis._items.splice(this._items.indexOf(o), 1);\n\t\t\to.destroy();\n\t\t\tdelete this._itemsById[el.eid];\n\t\t}\n\t},\n\n\t_invoke: function(funcName, args, startIndex) {\n\t\tvar i, ii, j, jj, el, o, rr;\n\t\tvar funcArgs = null;\n\t\tif (startIndex !== void 0) {\n\t\t\tfuncArgs = slice.call(args, 0, startIndex);\n\t\t} else {\n\t\t\tstartIndex = 0;\n\t\t}\n\t\tfor (i = startIndex, ii = args.length, rr = []; i < ii; ++i) {\n\t\t\tel = args[i];\n\t\t\t// iterate on NodeList, Arguments, Array...\n\t\t\tif (el.length) {\n\t\t\t\tfor (j = 0, jj = el.length; j < jj; ++j) {\n\t\t\t\t\to = this._get(el[j]);\n\t\t\t\t\trr.push(o[funcName].apply(o, funcArgs));\n\t\t\t\t}\n\t\t\t} else {\n\t\t\t\to = this._get(el);\n\t\t\t\trr.push(o[funcName].apply(o, funcArgs));\n\t\t\t}\n\t\t}\n\t\treturn rr;\n\t},\n\n\t/* -------------------------------\n\t/* Public\n\t/* ------------------------------- */\n\n\thas: function(el) {\n\t\treturn el.eid && this._itemsById[el.eid] !== void 0;\n\t},\n\n\tgetItems: function() {\n\t\tvar i, j, el, ret = [];\n\t\tfor (i = 0; i < arguments.length; ++i) {\n\t\t\tel = arguments[i];\n\t\t\tif (el.length) {\n\t\t\t\tfor (j = 0; j < el.length; ++j) {\n\t\t\t\t\tret.push(this._get(el[j]));\n\t\t\t\t}\n\t\t\t} else {\n\t\t\t\tret.push(this._get(el));\n\t\t\t}\n\t\t}\n\t\treturn ret;\n\t},\n\n\tget: function(el) {\n\t\treturn this._get(el);\n\t},\n\n\tadd: function() {\n\t\tvar i, j, el;\n\t\tfor (i = 0; i < arguments.length; ++i) {\n\t\t\tel = arguments[i];\n\t\t\tif (el.length) {\n\t\t\t\tfor (j = 0; j < el.length; ++j) {\n\t\t\t\t\tthis._get(el[j]);\n\t\t\t\t}\n\t\t\t} else {\n\t\t\t\tthis._get(el);\n\t\t\t}\n\t\t}\n\t},\n\n\tremove: function() {\n\t\tvar i, j, el;\n\t\tfor (i = 0; i < arguments.length; ++i) {\n\t\t\tel = arguments[i];\n\t\t\tif (el.length) {\n\t\t\t\tfor (j = 0; j < el.length; ++j) {\n\t\t\t\t\tthis._remove(el[j]);\n\t\t\t\t}\n\t\t\t} else {\n\t\t\t\tthis._remove(el);\n\t\t\t}\n\t\t}\n\t},\n\n\t/* --------------------------------\n\t/* public\n\t/* -------------------------------- */\n\n\t/* public: single arg\n\t/* - - - - - - - - - - - - - - - - */\n\n\thasOffset: function(el) {\n\t\treturn this.has(el) ? this._itemsById[el.eid].hasOffset : (void 0);\n\t},\n\n\t/* public: capture\n\t/* - - - - - - - - - - - - - - - - */\n\n\tcapture: function() {\n\t\tthis._invoke(\"capture\", arguments);\n\t},\n\tcaptureAll: function() {\n\t\tfor (var i = 0, ii = this._items.length; i < ii; i++) {\n\t\t\tthis._items[i].capture();\n\t\t}\n\t},\n\n\tclearCapture: function() {\n\t\tthis._invoke(\"clearCapture\", arguments);\n\t},\n\tclearAllCaptures: function() {\n\t\tfor (var i = 0, ii = this._items.length; i < ii; i++) {\n\t\t\tthis._items[i].clearCapture();\n\t\t}\n\t},\n\n\t/* public: offset\n\t/* - - - - - - - - - - - - - - - - */\n\toffset: function(x, y) {\n\t\tthis._invoke(\"offset\", arguments, 2);\n\t},\n\toffsetAll: function(x, y) {\n\t\tfor (var i = 0, ii = this._items.length; i < ii; i++) {\n\t\t\tthis._items[i].offset(x, y);\n\t\t}\n\t},\n\n\tclearOffset: function() {\n\t\tthis._invoke(\"clearOffset\", arguments);\n\t},\n\tclearAllOffsets: function() {\n\t\tfor (var i = 0, ii = this._items.length; i < ii; i++) {\n\t\t\tthis._items[i].clearOffset();\n\t\t}\n\t},\n\n\t/* public: transitions\n\t/* - - - - - - - - - - - - - - - - */\n\n\trunTransition: function(transition) {\n\t\tthis._invoke(\"runTransition\", arguments, 1);\n\t},\n\trunAllTransitions: function(transition) {\n\t\tfor (var i = 0, ii = this._items.length; i < ii; i++) {\n\t\t\tthis._items[i].runTransition(transition);\n\t\t}\n\t},\n\n\tclearTransition: function() {\n\t\tthis._invoke(\"clearTransition\", arguments);\n\t},\n\tclearAllTransitions: function() {\n\t\tfor (var i = 0, ii = this._items.length; i < ii; i++) {\n\t\t\tthis._items[i].clearTransition();\n\t\t}\n\t},\n\n\tstopTransition: function() {\n\t\tthis._invoke(\"stopTransition\", arguments);\n\t},\n\tstopAllTransitions: function() {\n\t\tfor (var i = 0, ii = this._items.length; i < ii; i++) {\n\t\t\tthis._items[i].stopTransition();\n\t\t}\n\t},\n\n\twhenTransitionEnds: function() {\n\t\tvar res = this._invoke(\"whenTransitionEnds\", arguments);\n\t\treturn res.length != 0 ?\n\t\t\tPromise.all(res) :\n\t\t\tPromise.resolve(null);\n\t},\n\twhenAllTransitionsEnd: function() {\n\t\treturn (this._items.length != 0) ? Promise.all(this._items.map(function(o) {\n\t\t\treturn o.whenTransitionEnds();\n\t\t})) : Promise.resolve(null);\n\t},\n\n\tpromise: function() {\n\t\treturn arguments.length == 0 ?\n\t\t\tthis.whenAllTransitionsEnd() :\n\t\t\tthis.whenTransitionEnds.call(this, arguments);\n\t},\n\n\t/* -------------------------------\n\t/* validation\n\t/* ------------------------------- */\n\n\tvalidate: function() {\n\t\tfor (var i = 0, ii = this._items.length; i < ii; i++) {\n\t\t\tthis._items[i].validate();\n\t\t}\n\t},\n}, {\n\titems: {\n\t\tget: function() {\n\t\t\treturn this._items;\n\t\t}\n\t}\n});\n\nmodule.exports = TransformHelper;\n",
    "/* -------------------------------\n * Imports\n * ------------------------------- */\n/** @type {module:utils/prefixedProperty} */\nconst prefixedProperty = require(\"utils/prefixedProperty\");\n/** @type {module:utils/prefixedStyleName} */\nconst prefixedStyleName = require(\"utils/prefixedStyleName\");\n/** @type {module:utils/prefixedEvent} */\nconst prefixedEvent = require(\"utils/prefixedEvent\");\n/** @type {String} */\nvar transitionEnd = prefixedEvent(\"transitionend\");\n//var transitionEnd = require(\"utils/event/transitionEnd\");\n// /** @type {Function} */\n// var slice = Array.prototype.slice;\n\n// /** @type {module:utils/debug/traceElement} */\n// var traceElt = require(\"./debug/traceElement\");\n// var traceEltCache = {};\n// var log = function() {\n// \tvar logFn = \"log\";\n// \tvar args = slice.apply(arguments);\n// \tswitch(args[0]) {\n// \t\tcase \"error\":\n// \t\tcase \"warn\":\n// \t\tcase \"info\":\n// \t\t\tlogFn = args.shift();\n// \t\t\tbreak;\n// \t\tdefault:\n// \t\t\t// break;\n// \t\t\treturn;\n// \t}\n// \tvar el, txId;\n// \tif ((el = args[0]) && (txId = el.eid)) {\n// \t\targs[0] = traceEltCache[txId] || (traceEltCache[txId] = el);\n// \t}\n// \targs[0] = \"\\t\" + args[0];\n// \tconsole[logFn].apply(console, args);\n// };\n\n/* jshint -W079 */\n// var console = (function(target) {\n// \treturn Object.getOwnPropertyNames(target).reduce(function(proxy, prop) {\n// \t\tif ((typeof target[prop]) == \"function\") {\n// \t\t\tswitch (prop) {\n// \t\t\t\tcase \"error\":\n// \t\t\t\tcase \"warn\":\n// \t\t\t\tcase \"info\":\n// \t\t\t\t\tproxy[prop] = function () {\n// \t\t\t\t\t\tvar args = slice.apply(arguments);\n// \t\t\t\t\t\tif (typeof args[0] == \"string\") {\n// \t\t\t\t\t\t\targs[0] = prop + \"::\" + args[0];\n// \t\t\t\t\t\t}\n// \t\t\t\t\t\treturn target[prop].apply(target, args);\n// \t\t\t\t\t};\n// \t\t\t\t\tbreak;\n// \t\t\t\tcase \"log\":\n// \t\t\t\t\tproxy[prop] = function() {};\n// \t\t\t\t\tbreak;\n// \t\t\t\tdefault:\n// \t\t\t\t\tproxy[prop] = target[prop].bind(target);\n// \t\t\t\t\tbreak;\n// \t\t\t}\n// \t\t} else {\n// \t\t\tObject.defineProperty(proxy, prop, {\n// \t\t\t\tget: function() { return target[prop]; },\n// \t\t\t\tset: function(val) { target[prop] = val; }\n// \t\t\t});\n// \t\t}\n// \t\treturn proxy;\n// \t}, {});\n// })(window.console);\n/* jshint +W079 */\n\n/* -------------------------------\n/* Private static\n/* ------------------------------- */\n\nvar NO_TRANSITION_VALUE = \"none 0s step-start 0s\";\n// var NO_TRANSITION_VALUE = \"all 0.001s step-start 0.001s\";\n\nvar UNSET_TRANSITION = {\n\tname: \"unset\",\n\tclassName: \"tx-unset\",\n\tproperty: \"none\",\n\teasing: \"ease\",\n\tdelay: 0,\n\tduration: 0,\n\tcssText: \"unset\",\n};\n\n// var translateTemplate = _.template(\"translate(<%= _renderedX %>px, <%= _renderedY %>px)\";\n// var translate3dTemplate = _.template(\"translate3d(<%= _renderedX %>px, <%= _renderedY %>px, 0px)\";\n// var transitionTemplate = _.template(\"<%= property %> <% duration/1000 %>s <%= easing %> <% delay/1000 %>s\");\n\nvar translateTemplate = (function(fn) {\n\treturn function(o) {\n\t\treturn fn(o._renderedX, o._renderedY);\n\t};\n}(require(\"app/control/Globals\").TRANSLATE_TEMPLATE));\n\nvar transitionTemplate = function(o) {\n\treturn o.property + \" \" +\n\t\to.duration / 1000 + \"s \" +\n\t\to.easing + \" \" +\n\t\to.delay / 1000 + \"s\";\n};\n\nvar propDefaults = {\n\t\"opacity\": \"1\",\n\t\"visibility\": \"visible\",\n\t\"transform\": \"matrix(1, 0, 0, 1, 0, 0)\",\n\t\"transformStyle\": \"\",\n\t\"transition\": \"\",\n\t// \"willChange\": \"\",\n\t// \"transitionDuration\": \"0s\",\n\t// \"transitionDelay\": \"0s\",\n\t// \"transitionProperty\": \"none\",\n\t// \"transitionTimingFunction\": \"ease\"\n};\nvar propKeys = Object.keys(propDefaults);\nvar propNames = propKeys.reduce(function(obj, propName) {\n\tobj[propName] = prefixedProperty(propName);\n\treturn obj;\n}, {});\n\nvar styleNames = (function(camelToDashed) {\n\treturn propKeys\n\t\t.map(camelToDashed)\n\t\t.reduce(function(obj, propName) {\n\t\t\tobj[propName] = prefixedStyleName(propName);\n\t\t\treturn obj;\n\t\t}, {});\n})(require(\"utils/strings/camelToDashed\"));\n\nvar resolveAll = function(pp, result) {\n\tif (pp.length != 0) {\n\t\tpp.forEach(function(p, i, a) {\n\t\t\tp.resolve(result);\n\t\t\ta[i] = null;\n\t\t});\n\t\tpp.length = 0;\n\t}\n\treturn pp;\n};\n\nvar rejectAll = function(pp, reason) {\n\tif (pp.length != 0) {\n\t\tpp.forEach(function(p, i, a) {\n\t\t\tp.reject(reason);//\n\t\t\ta[i] = null;\n\t\t});\n\t\tpp.length = 0;//\n\t}\n\treturn pp;\n};\n\n/* -------------------------------\n * TransformItem\n * ------------------------------- */\n\n/**\n * @constructor\n */\nvar TransformItem = function(el, id) {\n\tthis.el = el;\n\tthis.id = id;\n\tthis.el.eid = id;\n\n\tthis._onTransitionEnd = this._onTransitionEnd.bind(this);\n\tthis.el.addEventListener(transitionEnd, this._onTransitionEnd, false);\n\n\tthis._captureInvalid = false;\n\tthis._capturedChanged = false;\n\tthis._capturedX = null;\n\tthis._capturedY = null;\n\tthis._currCapture = {};\n\tthis._lastCapture = {};\n\n\tthis._hasOffset = false;\n\tthis._offsetInvalid = false;\n\tthis._offsetX = null;\n\tthis._offsetY = null;\n\n\tthis._renderedX = null;\n\tthis._renderedY = null;\n\n\tthis._hasTransition = false;\n\tthis._transitionInvalid = false;\n\tthis._transitionRunning = false;\n\tthis._transition = _.extend({}, UNSET_TRANSITION); //{};\n\n\tthis._promises = [];\n\tthis._pendingPromises = [];\n}\n\nTransformItem.prototype = Object.create({\n\n\t/* -------------------------------\n\t/* Public\n\t/* ------------------------------- */\n\n\t/* destroy\n\t/* - - - - - - - - - - - - - - - - */\n\tdestroy: function() {\n\t\t// NOTE: style property may have been modified; clearOffset(element) should\n\t\t// be called explicitly if clean up is required.\n\t\tthis.el.removeEventListener(transitionEnd, this._onTransitionEnd, false);\n\t\tresolveAll(this._pendingPromises, this);\n\t\tresolveAll(this._promises, this);\n\t\t// delete this.el.eid;\n\t},\n\n\t/* capture\n\t/* - - - - - - - - - - - - - - - - */\n\tcapture: function(force) {\n\t\t// console.log(\"tx[%s]::capture\", this.id);\n\t\tif (force) {\n\t\t\tthis.clearCapture();\n\t\t}\n\t\tthis._validateCapture();\n\t\treturn this;\n\t},\n\n\tclearCapture: function() {\n\t\t// console.log(\"tx[%s]::clearCapture\", this.id);\n\t\t// this._hasOffset = false;\n\t\tthis._captureInvalid = true;\n\t\treturn this;\n\t},\n\n\t/* offset/clear\n\t/* - - - - - - - - - - - - - - - - */\n\toffset: function(x, y) {\n\t\t// console.log(\"tx[%s]::offset\", this.id);\n\t\tthis._hasOffset = true;\n\t\tthis._offsetInvalid = true;\n\t\tthis._offsetX = x || 0;\n\t\tthis._offsetY = y || 0;\n\t\t// if (this.immediate) this._validateOffset();\n\t\treturn this;\n\t},\n\n\tclearOffset: function() {\n\t\tif (this._hasOffset) {\n\t\t\t// console.log(\"tx[%s]::clearOffset\", this.id);\n\t\t\tthis._hasOffset = false;\n\t\t\tthis._offsetInvalid = true;\n\t\t\tthis._offsetX = null;\n\t\t\tthis._offsetY = null;\n\t\t\t// if (this.immediate) this._validateOffset();\n\t\t}\n\t\t// else {\n\t\t// \tconsole.log(\"tx[%s]::clearOffset no offset to clear\", this.id);\n\t\t// }\n\t\treturn this;\n\t},\n\n\t/* transitions\n\t/* - - - - - - - - - - - - - - - - */\n\trunTransition: function(transition) {\n\t\tif (!transition) { // || (transition.duration + transition.delay) == 0) {\n\t\t\treturn this.clearTransition();\n\t\t}\n\t\tvar lastValue = this._transitionValue;\n\t\tvar lastName = this._transition.name;\n\t\tthis._transition.property = styleNames[\"transform\"];\n\t\tthis._transition = _.extend(this._transition, transition);\n\t\tthis._transitionValue = transitionTemplate(this._transition);\n\n\t\tif (this._transitionInvalid) {\n\t\t\tconsole.warn(\"tx[%s]::runTransition set over (%s:'%s' => %s:'%s')\", this.id,\n\t\t\t\tlastName, lastValue, this._transition.name, this._transitionValue);\n\t\t}\n\n\t\tthis._hasTransition = true;\n\t\tthis._transitionInvalid = true;\n\t\t// if (this.immediate) this._validateTransition();\n\t\treturn this;\n\t},\n\n\tclearTransition: function() {\n\t\tthis._transition = _.extend(this._transition, UNSET_TRANSITION);\n\t\tthis._transitionValue = NO_TRANSITION_VALUE;\n\n\t\tthis._hasTransition = false;\n\t\tthis._transitionInvalid = true;\n\t\t// if (this.immediate) this._validateTransition();\n\t\treturn this;\n\t},\n\n\tstopTransition: function() {\n\t\t// this._transition.name = \"[none]\";\n\t\t// this._transition.property = \"none\";\n\t\tthis._transition = _.extend(this._transition, UNSET_TRANSITION);\n\t\tthis._transitionValue = NO_TRANSITION_VALUE;\n\n\t\tthis._hasTransition = false;\n\t\tthis._transitionInvalid = true;\n\t\t// if (this.immediate) this._validateTransition();\n\t\treturn this;\n\t},\n\n\twhenTransitionEnds: function() {\n\t\tvar d, p, pp;\n\t\tif (this._transitionInvalid || this._transitionRunning) {\n\t\t\td = {};\n\t\t\tp = new Promise(function(resolve, reject) {\n\t\t\t\td.resolve = resolve;\n\t\t\t\td.reject = reject;\n\t\t\t});\n\t\t\tpp = this._transitionInvalid ? this._pendingPromises : this._promises;\n\t\t\tpp.push(d);\n\t\t} else {\n\t\t\tp = Promise.resolve(this);\n\t\t}\n\t\treturn p;\n\t},\n\n\t/* validation\n\t/* - - - - - - - - - - - - - - - - */\n\tvalidate: function() {\n\t\t// this.el.removeEventListener(transitionEnd, this._onTransitionEnd, false);\n\t\tthis._ignoreEvent = true;\n\n\t\tif (this._captureInvalid) {\n\t\t\tvar lastX = (this._renderedX !== null ? this._renderedX : this._capturedX),\n\t\t\t\tlastY = (this._renderedY !== null ? this._renderedY : this._capturedY);\n\n\t\t\t// this._validateTransition();\n\t\t\tthis._validateCapture();\n\t\t\tthis._validateOffset();\n\n\t\t\tvar currX = (this._renderedX !== null ? this._renderedX : this._capturedX),\n\t\t\t\tcurrY = (this._renderedY !== null ? this._renderedY : this._capturedY);\n\n\t\t\tif (lastX === currX && lastY === currY) {\n\t\t\t\tthis._hasTransition && console.warn(\"tx[%s]::validate unchanged: last:[%i,%i] curr:[%i,%i]\", this.el.id || this.id, lastX, lastY, currX, currY);\n\t\t\t\t// console.info(\"tx[%s]::validate unchanged: last:[%f,%f] curr:[%f,%f] render:[%f,%f] captured[%f,%f]\", this.el.id || this.id, lastX, lastY, currX, currY, this._renderedX, this._renderedY, this._capturedX, this._capturedY);\n\t\t\t\tthis.clearTransition();\n\t\t\t\t// this._validateTransition();\n\t\t\t}\n\t\t\tthis._validateTransition();\n\t\t} else {\n\t\t\t// this._validateCapture();\n\t\t\tthis._validateTransition();\n\t\t\tthis._validateOffset();\n\t\t}\n\n\t\t// this.el.addEventListener(transitionEnd, this._onTransitionEnd, false);\n\t\tthis._ignoreEvent = false;\n\n\t\t// if (this._capturedChanged) {\n\t\t// \tconsole.error(\"tx[%s]::validate capture changed: [%f,%f]\", this.id, this._capturedX, this._capturedY);\n\t\t// }\n\t\tthis._capturedChanged = false;\n\t\treturn this;\n\t},\n\n\t/* -------------------------------\n\t/* Private\n\t/* ------------------------------- */\n\n\t_validateCapture: function() {\n\t\tif (!this._captureInvalid) {\n\t\t\treturn;\n\t\t}\n\t\t// var computed, capturedValues;\n\t\tvar transformValue = null;\n\n\t\tif (this._hasOffset && !this._offsetInvalid) {\n\t\t\t// this is an explicit call to capture() instead of a subcall from _validateOffset()\n\t\t\ttransformValue = this._getCSSProp(\"transform\");\n\t\t\tif (transformValue === \"\") {\n\t\t\t\tconsole.error(\"tx[%s]::_capture valid offset (%i,$i) but transformValue=\\\"\\\"\", this.id, this._offsetX, this._offsetY);\n\t\t\t}\n\t\t\tthis._removeCSSProp(\"transform\");\n\t\t}\n\n\t\t// NOTE: reusing object, all props will be overwritten\n\t\tthis._lastCapture = this._currCapture;\n\t\tthis._currCapture = this._getComputedCSSProps();\n\n\t\tif (this._currCapture.transform !== this._lastCapture.transform) {\n\t\t\tvar m, mm; //, ret = {};\n\t\t\tmm = this._currCapture.transform.match(/(matrix|matrix3d)\\(([^\\)]+)\\)/);\n\t\t\tif (mm) {\n\t\t\t\tm = mm[2].split(\",\");\n\t\t\t\tif (mm[1] === \"matrix\") {\n\t\t\t\t\tthis._capturedX = parseFloat(m[4]);\n\t\t\t\t\tthis._capturedY = parseFloat(m[5]);\n\t\t\t\t} else {\n\t\t\t\t\tthis._capturedX = parseFloat(m[12]);\n\t\t\t\t\tthis._capturedY = parseFloat(m[13]);\n\t\t\t\t}\n\t\t\t} else {\n\t\t\t\tthis._capturedX = 0;\n\t\t\t\tthis._capturedY = 0;\n\t\t\t}\n\t\t\tthis._capturedChanged = true;\n\t\t}\n\t\tif (transformValue !== null) {\n\t\t\tconsole.log(\"tx[%s]::_capture reapplying '%s'\", this.id, transformValue);\n\t\t\tthis._setCSSProp(\"transform\", transformValue);\n\t\t}\n\t\tthis._captureInvalid = false;\n\t},\n\n\t_validateOffset: function() {\n\t\tif (this._offsetInvalid) {\n\t\t\t// this._validateCapture();\n\t\t\tthis._offsetInvalid = false;\n\t\t\tif (this._hasOffset) {\n\t\t\t\tvar tx = this._offsetX + this._capturedX;\n\t\t\t\tvar ty = this._offsetY + this._capturedY;\n\t\t\t\tif (tx !== this._renderedX || ty !== this._renderedY) {\n\t\t\t\t\tthis._renderedX = tx;\n\t\t\t\t\tthis._renderedY = ty;\n\t\t\t\t\tthis._setCSSProp(\"transform\", translateTemplate(this));\n\t\t\t\t}\n\t\t\t} else {\n\t\t\t\tthis._renderedX = null;\n\t\t\t\tthis._renderedY = null;\n\t\t\t\tthis._removeCSSProp(\"transform\");\n\t\t\t}\n\t\t}\n\t},\n\n\t_validateTransition: function() {\n\t\tif (this._transitionInvalid) {\n\t\t\t// this._validateCapture();\n\t\t\tthis._transitionInvalid = false;\n\n\t\t\t// save promises made while invalid\n\t\t\tvar pp = this._promises;\n\t\t\t// prepare _promises and push in new ones\n\t\t\tthis._promises = this._pendingPromises;\n\t\t\t// whatever still here is to be rejected. reuse array\n\t\t\tthis._pendingPromises = resolveAll(pp, this);\n\n\t\t\t// Set running flag, if there's a transition to run\n\t\t\tthis._transitionRunning = this._hasTransition;\n\t\t\t// Set the css value (which will be empty string if there's no transition)\n\t\t\tthis._setCSSProp(\"transition\", this._transitionValue);\n\t\t\tif (DEBUG) {\n\t\t\t\tif (this._hasTransition) {\n\t\t\t\t\tthis.el.setAttribute(\"data-tx\", this._transition.name);\n\t\t\t\t}\n\t\t\t}\n\n\t\t\tif (!this._hasTransition) {\n\t\t\t\t// if there is no transition, resolve promises now\n\t\t\t\tresolveAll(this._promises, this);\n\t\t\t}\n\t\t}\n\t},\n\n\t_onTransitionEnd: function(ev) {\n\t\tif (this._ignoreEvent) {\n\t\t\treturn;\n\t\t}\n\t\tif (this._transitionRunning && (this.el === ev.target) &&\n\t\t\t(this._transition.property == ev.propertyName)) {\n\t\t\tthis._hasTransition = false;\n\t\t\tthis._transitionRunning = false;\n\t\t\tthis._removeCSSProp(\"transition\");\n\t\t\tresolveAll(this._promises, this);\n\n\t\t\tif (DEBUG) {\n\t\t\t\tif (this.el.hasAttribute(\"data-tx\")) {\n\t\t\t\t\t// this.el.setAttribute(\"data-tx-last\", this.el.getAttribute(\"data-tx\"));\n\t\t\t\t\tthis.el.removeAttribute(\"data-tx\");\n\t\t\t\t}\n\t\t\t}\n\t\t}\n\t},\n\n\t/* -------------------------------\n\t/* CSS\n\t/* ------------------------------- */\n\n\t_getCSSProp: function(prop) {\n\t\treturn this.el.style[propNames[prop]];\n\t\t// return this.el.style[prefixedProperty(prop)];\n\t\t// return this.el.style.getPropertyValue(styleNames[prop]);\n\t},\n\n\t_setCSSProp: function(prop, value) {\n\t\tif (prop === \"transition\" && value == NO_TRANSITION_VALUE) {\n\t\t\tvalue = \"\";\n\t\t}\n\t\tif (value === null || value === void 0 || value === \"\") {\n\t\t\tthis._removeCSSProp(prop);\n\t\t} else {\n\t\t\tthis.el.style[propNames[prop]] = value;\n\t\t\t// this.el.style.setProperty(styleNames[prop], value);\n\t\t}\n\t},\n\n\t_removeCSSProp: function(prop) {\n\t\tthis.el.style[propNames[prop]] = \"\";\n\t\t// this.el.style.removeProperty(styleNames[prop]);\n\t},\n\n\t_getComputedCSSProps: function() {\n\t\tvar values = {};\n\t\tvar computed = window.getComputedStyle(this.el);\n\t\tfor (var p in propNames) {\n\t\t\tvalues[p] = computed[propNames[p]];\n\t\t}\n\t\treturn values;\n\t},\n}, {\n\ttransition: {\n\t\tget: function() {\n\t\t\treturn this._transition;\n\t\t}\n\t},\n\thasTransition: {\n\t\tget: function() {\n\t\t\treturn this._hasTransition;\n\t\t}\n\t},\n\tcapturedChanged: {\n\t\tget: function() {\n\t\t\treturn this._capturedChanged;\n\t\t}\n\t},\n\tcapturedX: {\n\t\tget: function() {\n\t\t\treturn this._capturedX;\n\t\t}\n\t},\n\tcapturedY: {\n\t\tget: function() {\n\t\t\treturn this._capturedY;\n\t\t}\n\t},\n\n\thasOffset: {\n\t\tget: function() {\n\t\t\treturn this._hasOffset;\n\t\t}\n\t},\n\toffsetX: {\n\t\tget: function() {\n\t\t\treturn this._offsetX;\n\t\t}\n\t},\n\toffsetY: {\n\t\tget: function() {\n\t\t\treturn this._offsetY;\n\t\t}\n\t},\n});\n\nmodule.exports = TransformItem;\n",
    "module.exports = function(a1, a2, dest) {\n\treturn a1.reduce(function(res, o, i, a) {\n\t\tif (a2.indexOf(o) == -1) res.push(o);\n\t\treturn res;\n\t}, (dest !== void 0) ? dest : []);\n};\n",
    "var PI2 = Math.PI * 2;\n\nvar splice = Array.prototype.splice;\n// var concat = Array.prototype.concat;\n\n/*\n *\tUsing javascript to convert radians to degrees with positive and\n *\tnegative values [https://stackoverflow.com/questions/29588404/]\n *\t`(((r * (180/Math.PI)) % 360) + 360) % 360;`\n *\t`function mod(n, m) {\n *\t\treturn ((n % m) + m) % m;\n *\t}`\n */\nvar _mod = function(n, m) {\n\treturn ((n % m) + m) % m;\n};\n\nvar setStyle = function(ctx, s) {\n\tif (typeof s != \"object\") return;\n\tfor (var p in s) {\n\t\tswitch (typeof ctx[p]) {\n\t\t\tcase \"undefined\":\n\t\t\t\tbreak;\n\t\t\tcase \"function\":\n\t\t\t\tif (Array.isArray(s[p])) {\n\t\t\t\t\tctx[p].apply(ctx, s[p]);\n\t\t\t\t} else {\n\t\t\t\t\tctx[p].call(ctx, s[p]);\n\t\t\t\t}\n\t\t\t\tbreak;\n\t\t\tdefault:\n\t\t\t\tctx[p] = s[p];\n\t\t}\n\t}\n};\n\nvar _drawShape = function(fn, s, ctx) {\n\tctx.save();\n\tif (s) {\n\t\tsetStyle(ctx, s);\n\t}\n\tfn.apply(null, splice.call(arguments, 2));\n\tif ('strokeStyle' in s) { /* ctx.lineWidth > 0 */\n\t\tctx.stroke();\n\t}\n\tif ('fillStyle' in s) { /* ctx.fillStyle !== \"transparent\" */\n\t\tctx.fill();\n\t}\n\tctx.restore();\n};\n\nmodule.exports = {\n\tsetStyle: setStyle,\n\n\tvGuide: function(ctx, x) {\n\t\tctx.beginPath();\n\t\tctx.moveTo(x, 0);\n\t\tctx.lineTo(x, ctx.canvas.height);\n\t},\n\tdrawVGuide: function(ctx, s, x) {\n\t\t_drawShape(this.vGuide, s, ctx, x);\n\t},\n\n\thGuide: function(ctx, y) {\n\t\tctx.beginPath();\n\t\tctx.moveTo(0, y);\n\t\tctx.lineTo(ctx.canvas.width, y);\n\t},\n\tdrawHGuide: function(ctx, s, y) {\n\t\t_drawShape(this.hGuide, s, ctx, y);\n\t},\n\n\tcrosshair: function(ctx, x, y, r) {\n\t\tctx.save();\n\t\tctx.translate(x, y);\n\t\tctx.rotate(Math.PI / 4);\n\t\tctx.beginPath();\n\t\tctx.moveTo(0, -r);\n\t\tctx.lineTo(0, r);\n\t\tctx.moveTo(-r, 0);\n\t\tctx.lineTo(r, 0);\n\t\tctx.restore();\n\t},\n\tdrawCrosshair: function(ctx, s, x, y, r) {\n\t\t_drawShape(this.crosshair, s, ctx, x, y, r);\n\t},\n\n\tcircle: function(ctx, x, y, r) {\n\t\tctx.beginPath();\n\t\tctx.arc(x, y, r, 0, PI2);\n\t},\n\tdrawCircle: function(ctx, s, x, y, r) {\n\t\t_drawShape(this.circle, s, ctx, x, y, r);\n\t},\n\n\tsquare: function(ctx, x, y, r) {\n\t\tr = Math.floor(r / 2) * 2;\n\t\tctx.beginPath();\n\t\tctx.rect(x - r, y - r, r * 2, r * 2);\n\t},\n\tdrawSquare: function(ctx, s, x, y, r) {\n\t\t_drawShape(this.square, s, ctx, x, y, r);\n\t},\n\n\tarrowhead: function(ctx, x, y, r, t) {\n\t\tctx.save();\n\t\tctx.translate(x, y);\n\t\tctx.rotate(_mod(t, PI2));\n\t\tctx.translate(r * 0.5, 0);\n\t\tctx.beginPath();\n\t\tctx.moveTo(0, 0);\n\t\t// ctx.lineTo(-r, r * Math.SQRT1_2);\n\t\t// ctx.lineTo(-r, -r * Math.SQRT1_2);\n\t\tctx.lineTo(-r * Math.SQRT2, r * Math.SQRT1_2);\n\t\tctx.arcTo(0, 0, -r * Math.SQRT2, -r * Math.SQRT1_2, r);\n\t\t// ctx.quadraticCurveTo(0, 0, -r * Math.SQRT2, -r * Math.SQRT1_2);\n\t\tctx.lineTo(0, 0);\n\t\tctx.closePath();\n\t\tctx.restore();\n\t},\n\tdrawArrowhead: function(ctx, s, x, y, r, t) {\n\t\t_drawShape(this.arrowhead, s, ctx, x, y, r, t);\n\t},\n\n\tarrowhead2: function(ctx, x, y, r, t) {\n\t\tctx.save();\n\t\tctx.translate(x, y);\n\t\tctx.rotate(_mod(t, PI2));\n\t\tctx.beginPath();\n\t\tctx.moveTo(-r, r * Math.SQRT1_2);\n\t\tctx.lineTo(0, 0);\n\t\tctx.lineTo(-r, -r * Math.SQRT1_2);\n\t\tctx.restore();\n\t},\n\tdrawArrowhead2: function(ctx, s, x, y, r, t) {\n\t\t_drawShape(this.arrowhead, s, ctx, x, y, r, t);\n\t},\n\n\trect: function(ctx, a1, a2, a3, a4) {\n\t\tif (typeof a1 === \"object\") {\n\t\t\ta4 = a1.height;\n\t\t\ta3 = a1.width;\n\t\t\ta2 = a1.top;\n\t\t\ta1 = a1.left;\n\t\t}\n\t\tctx.beginPath();\n\t\tctx.rect(a1, a2, a3, a4);\n\t},\n\tdrawRect: function(ctx, s, a1, a2, a3, a4) {\n\t\t_drawShape(this.rect, s, ctx, a1, a2, a3, a4);\n\t},\n\n\troundRect: function(ctx, x, y, w, h, r) {\n\t\tif (w < 2 * r) r = w / 2;\n\t\tif (h < 2 * r) r = h / 2;\n\t\tctx.beginPath();\n\t\tctx.moveTo(x + r, y);\n\t\tctx.arcTo(x + w, y, x + w, y + h, r);\n\t\tctx.arcTo(x + w, y + h, x, y + h, r);\n\t\tctx.arcTo(x, y + h, x, y, r);\n\t\tctx.arcTo(x, y, x + w, y, r);\n\t\tctx.closePath();\n\t},\n\tdrawRoundRect: function(ctx, s, x, y, w, h, r) {\n\t\t_drawShape(this.roundRect, s, ctx, x, y, h, r);\n\t},\n\n\tquadRoundRect: function(ctx, x, y, w, h, r) {\n\t\tctx.beginPath();\n\t\tctx.moveTo(x, y + r);\n\t\tctx.quadraticCurveTo(x, y, x + r, y);\n\t\tctx.lineTo(x + w - r, y);\n\t\tctx.quadraticCurveTo(x + w, y, x + w, y + r);\n\t\tctx.lineTo(x + w, y + h - r);\n\t\tctx.quadraticCurveTo(x + w, y + h, x + w - r, y + h);\n\t\tctx.lineTo(x + r, y + h);\n\t\tctx.quadraticCurveTo(x, y + h, x, y + h - r);\n\t\tctx.closePath();\n\t},\n\tdrawQuadRoundRect: function(ctx, s, x, y, w, h, r) {\n\t\t_drawShape(this.quadRoundRect, s, ctx, x, y, h, r);\n\t},\n};\n",
    "/*\n\nStackBlur - a fast almost Gaussian Blur For Canvas\n\nVersion:  0.5\nAuthor: Mario Klingemann\nContact:  mario@quasimondo.com\nWebsite: http://www.quasimondo.com/StackBlurForCanvas\nTwitter: @quasimondo\n\nIn case you find this class useful - especially in commercial projects -\nI am not totally unhappy for a small donation to my PayPal account\nmario@quasimondo.de\n\nOr support me on flattr: \nhttps://flattr.com/thing/72791/StackBlur-a-fast-almost-Gaussian-Blur-Effect-for-CanvasJavascript\n\nCopyright (c) 2010 Mario Klingemann\n\nPermission is hereby granted, free of charge, to any person\nobtaining a copy of this software and associated documentation\nfiles (the \"Software\"), to deal in the Software without\nrestriction, including without limitation the rights to use,\ncopy, modify, merge, publish, distribute, sublicense, and/or sell\ncopies of the Software, and to permit persons to whom the\nSoftware is furnished to do so, subject to the following\nconditions:\n\nThe above copyright notice and this permission notice shall be\nincluded in all copies or substantial portions of the Software.\n\nTHE SOFTWARE IS PROVIDED \"AS IS\", WITHOUT WARRANTY OF ANY KIND,\nEXPRESS OR IMPLIED, INCLUDING BUT NOT LIMITED TO THE WARRANTIES\nOF MERCHANTABILITY, FITNESS FOR A PARTICULAR PURPOSE AND\nNONINFRINGEMENT. IN NO EVENT SHALL THE AUTHORS OR COPYRIGHT\nHOLDERS BE LIABLE FOR ANY CLAIM, DAMAGES OR OTHER LIABILITY,\nWHETHER IN AN ACTION OF CONTRACT, TORT OR OTHERWISE, ARISING\nFROM, OUT OF OR IN CONNECTION WITH THE SOFTWARE OR THE USE OR\nOTHER DEALINGS IN THE SOFTWARE.\n*/\n\nmodule.exports = function() {\n\tthis.r = 0;\n\tthis.g = 0;\n\tthis.b = 0;\n\tthis.a = 0;\n\tthis.next = null;\n};\n",
    "module.exports = function(imageData, adj) {\n\tvar pixels = imageData.data;\n\tvar r, g, b, s;\n\tvar i, ii;\n\n\tif (arguments.length === 1) {\n\t\tfor (i = 0, ii = pixels.length; i < ii; i += 4) {\n\t\t\tpixels[i] = (pixels[i] * 299 + pixels[i + 1] * 587 + pixels[i + 2] * 144) / 1000;\n\t\t}\n\t} else\n\tif (arguments.length === 2) {\n\t\tif (0 >= adj > 1) {\n\t\t\tconsole.warn(\"argument out of range (1-0)\", adj);\n\t\t\treturn imageData;\n\t\t}\n\t\tfor (i = 0, ii = pixels.length; i < ii; i += 4) {\n\t\t\tr = pixels[i];\n\t\t\tg = pixels[i + 1];\n\t\t\tb = pixels[i + 2];\n\t\t\t// s = ((r * 299 + g * 587 + b * 144) / 1000) * (1 - adj);\n\t\t\t// pixels[i] = r * adj + s;\n\t\t\t// pixels[i + 1] = g * adj + s;\n\t\t\t// pixels[i + 2] = b * adj + s;\n\t\t\ts = Math.max(r, g, b);\n\t\t\tif (s === 0) {\n\t\t\t\tpixels[i] = Math.round(255 * adj);\n\t\t\t\tpixels[i + 1] = Math.round(255 * adj);\n\t\t\t\tpixels[i + 2] = Math.round(255 * adj);\n\t\t\t} else {\n\t\t\t\ts = 255 * adj / s;\n\t\t\t\tpixels[i] = Math.round(r * s);\n\t\t\t\tpixels[i + 1] = Math.round(g * s);\n\t\t\t\tpixels[i + 2] = Math.round(b * s);\n\t\t\t}\n\t\t}\n\t}\n\treturn imageData;\n};\n\n// function saturation(r,g,b, s) {\n//     var min = rgb.indexOf(Math.min.apply(null, rgb)), // index of min\n//         max = rgb.indexOf(Math.max.apply(null, rgb)), // index of max\n//         mid = [0, 1, 2].filter(function (i) {return i !== min && i !== max;})[0],\n//         a = rgb[max] - rgb[min],\n//         b = rgb[mid] - rgb[min],\n//         x = rgb[max],\n//         arr = [x, x, x];\n//     if (min === max) {\n//         min = 2; // both max = min = 0, => mid = 1, so set min = 2\n//         a = 1;   // also means a = b = 0, don't want division by 0 in `b / a`\n//     }\n//\n//     arr[max] = x;\n//     arr[min] = Math.round(x * (1 - s));\n//     arr[mid] = Math.round(x * ((1 - s) + s * b / a));\n//\n//     return arr;\n// }\n\n\n// function nvalue(rgb, v) {\n//     var x = Math.max.apply(null, rgb);\n//     if (x === 0)\n//         return [\n//             Math.round(255 * v),\n//             Math.round(255 * v),\n//             Math.round(255 * v)\n//         ];\n//     x = 255 * v / x;\n//     return [\n//         Math.round(rgb[0] * x),\n//         Math.round(rgb[1] * x),\n//         Math.round(rgb[2] * x)\n//     ];\n// }\n",
    "module.exports = function(imageData, opts) {\n\tvar pixels = imageData.data;\n\tvar pixelsNum = pixels.length;\n\tvar rgbAvg = [0, 0, 0];\n\tvar i;\n\n\tfor (i = 0; i < pixelsNum; i += 4) {\n\t\trgbAvg[0] += pixels[i];\n\t\trgbAvg[1] += pixels[i + 1];\n\t\trgbAvg[2] += pixels[i + 2];\n\t}\n\tfor (i = 0; i < 3; i++) {\n\t\trgbAvg[i] = (rgbAvg[i] / (pixelsNum / 4)) | 0;\n\t}\n\treturn rgbAvg;\n};\n",
    "/*\n\nStackBlur - a fast almost Gaussian Blur For Canvas\n\nVersion:  0.5\nAuthor: Mario Klingemann\nContact:  mario@quasimondo.com\nWebsite: http://www.quasimondo.com/StackBlurForCanvas\nTwitter: @quasimondo\n\nIn case you find this class useful - especially in commercial projects -\nI am not totally unhappy for a small donation to my PayPal account\nmario@quasimondo.de\n\nOr support me on flattr: \nhttps://flattr.com/thing/72791/StackBlur-a-fast-almost-Gaussian-Blur-Effect-for-CanvasJavascript\n\nCopyright (c) 2010 Mario Klingemann\n\nPermission is hereby granted, free of charge, to any person\nobtaining a copy of this software and associated documentation\nfiles (the \"Software\"), to deal in the Software without\nrestriction, including without limitation the rights to use,\ncopy, modify, merge, publish, distribute, sublicense, and/or sell\ncopies of the Software, and to permit persons to whom the\nSoftware is furnished to do so, subject to the following\nconditions:\n\nThe above copyright notice and this permission notice shall be\nincluded in all copies or substantial portions of the Software.\n\nTHE SOFTWARE IS PROVIDED \"AS IS\", WITHOUT WARRANTY OF ANY KIND,\nEXPRESS OR IMPLIED, INCLUDING BUT NOT LIMITED TO THE WARRANTIES\nOF MERCHANTABILITY, FITNESS FOR A PARTICULAR PURPOSE AND\nNONINFRINGEMENT. IN NO EVENT SHALL THE AUTHORS OR COPYRIGHT\nHOLDERS BE LIABLE FOR ANY CLAIM, DAMAGES OR OTHER LIABILITY,\nWHETHER IN AN ACTION OF CONTRACT, TORT OR OTHERWISE, ARISING\nFROM, OUT OF OR IN CONNECTION WITH THE SOFTWARE OR THE USE OR\nOTHER DEALINGS IN THE SOFTWARE.\n*/\n\nmodule.exports = [\n\t\t512, 512, 456, 512, 328, 456, 335, 512, 405, 328, 271, 456, 388, 335, 292, 512,\n\t\t454, 405, 364, 328, 298, 271, 496, 456, 420, 388, 360, 335, 312, 292, 273, 512,\n\t\t482, 454, 428, 405, 383, 364, 345, 328, 312, 298, 284, 271, 259, 496, 475, 456,\n\t\t437, 420, 404, 388, 374, 360, 347, 335, 323, 312, 302, 292, 282, 273, 265, 512,\n\t\t497, 482, 468, 454, 441, 428, 417, 405, 394, 383, 373, 364, 354, 345, 337, 328,\n\t\t320, 312, 305, 298, 291, 284, 278, 271, 265, 259, 507, 496, 485, 475, 465, 456,\n\t\t446, 437, 428, 420, 412, 404, 396, 388, 381, 374, 367, 360, 354, 347, 341, 335,\n\t\t329, 323, 318, 312, 307, 302, 297, 292, 287, 282, 278, 273, 269, 265, 261, 512,\n\t\t505, 497, 489, 482, 475, 468, 461, 454, 447, 441, 435, 428, 422, 417, 411, 405,\n\t\t399, 394, 389, 383, 378, 373, 368, 364, 359, 354, 350, 345, 341, 337, 332, 328,\n\t\t324, 320, 316, 312, 309, 305, 301, 298, 294, 291, 287, 284, 281, 278, 274, 271,\n\t\t268, 265, 262, 259, 257, 507, 501, 496, 491, 485, 480, 475, 470, 465, 460, 456,\n\t\t451, 446, 442, 437, 433, 428, 424, 420, 416, 412, 408, 404, 400, 396, 392, 388,\n\t\t385, 381, 377, 374, 370, 367, 363, 360, 357, 354, 350, 347, 344, 341, 338, 335,\n\t\t332, 329, 326, 323, 320, 318, 315, 312, 310, 307, 304, 302, 299, 297, 294, 292,\n\t\t289, 287, 285, 282, 280, 278, 275, 273, 271, 269, 267, 265, 263, 261, 259];\n",
    "module.exports = function(pixels, adjustment) {\n\tvar d = pixels.data;\n\tfor (var i = 0; i < d.length; i += 4) {\n\t\td[i] *= adjustment;\n\t\td[i + 1] *= adjustment;\n\t\td[i + 2] *= adjustment;\n\t}\n\treturn pixels;\n};\n",
    "/*\n\nStackBlur - a fast almost Gaussian Blur For Canvas\n\nVersion:  0.5\nAuthor: Mario Klingemann\nContact:  mario@quasimondo.com\nWebsite: http://www.quasimondo.com/StackBlurForCanvas\nTwitter: @quasimondo\n\nIn case you find this class useful - especially in commercial projects -\nI am not totally unhappy for a small donation to my PayPal account\nmario@quasimondo.de\n\nOr support me on flattr: \nhttps://flattr.com/thing/72791/StackBlur-a-fast-almost-Gaussian-Blur-Effect-for-CanvasJavascript\n\nCopyright (c) 2010 Mario Klingemann\n\nPermission is hereby granted, free of charge, to any person\nobtaining a copy of this software and associated documentation\nfiles (the \"Software\"), to deal in the Software without\nrestriction, including without limitation the rights to use,\ncopy, modify, merge, publish, distribute, sublicense, and/or sell\ncopies of the Software, and to permit persons to whom the\nSoftware is furnished to do so, subject to the following\nconditions:\n\nThe above copyright notice and this permission notice shall be\nincluded in all copies or substantial portions of the Software.\n\nTHE SOFTWARE IS PROVIDED \"AS IS\", WITHOUT WARRANTY OF ANY KIND,\nEXPRESS OR IMPLIED, INCLUDING BUT NOT LIMITED TO THE WARRANTIES\nOF MERCHANTABILITY, FITNESS FOR A PARTICULAR PURPOSE AND\nNONINFRINGEMENT. IN NO EVENT SHALL THE AUTHORS OR COPYRIGHT\nHOLDERS BE LIABLE FOR ANY CLAIM, DAMAGES OR OTHER LIABILITY,\nWHETHER IN AN ACTION OF CONTRACT, TORT OR OTHERWISE, ARISING\nFROM, OUT OF OR IN CONNECTION WITH THE SOFTWARE OR THE USE OR\nOTHER DEALINGS IN THE SOFTWARE.\n*/\n\nmodule.exports = [\n\t\t9, 11, 12, 13, 13, 14, 14, 15, 15, 15, 15, 16, 16, 16, 16, 17,\n\t\t17, 17, 17, 17, 17, 17, 18, 18, 18, 18, 18, 18, 18, 18, 18, 19,\n\t\t19, 19, 19, 19, 19, 19, 19, 19, 19, 19, 19, 19, 19, 20, 20, 20,\n\t\t20, 20, 20, 20, 20, 20, 20, 20, 20, 20, 20, 20, 20, 20, 20, 21,\n\t\t21, 21, 21, 21, 21, 21, 21, 21, 21, 21, 21, 21, 21, 21, 21, 21,\n\t\t21, 21, 21, 21, 21, 21, 21, 21, 21, 21, 22, 22, 22, 22, 22, 22,\n\t\t22, 22, 22, 22, 22, 22, 22, 22, 22, 22, 22, 22, 22, 22, 22, 22,\n\t\t22, 22, 22, 22, 22, 22, 22, 22, 22, 22, 22, 22, 22, 22, 22, 23,\n\t\t23, 23, 23, 23, 23, 23, 23, 23, 23, 23, 23, 23, 23, 23, 23, 23,\n\t\t23, 23, 23, 23, 23, 23, 23, 23, 23, 23, 23, 23, 23, 23, 23, 23,\n\t\t23, 23, 23, 23, 23, 23, 23, 23, 23, 23, 23, 23, 23, 23, 23, 23,\n\t\t23, 23, 23, 23, 23, 24, 24, 24, 24, 24, 24, 24, 24, 24, 24, 24,\n\t\t24, 24, 24, 24, 24, 24, 24, 24, 24, 24, 24, 24, 24, 24, 24, 24,\n\t\t24, 24, 24, 24, 24, 24, 24, 24, 24, 24, 24, 24, 24, 24, 24, 24,\n\t\t24, 24, 24, 24, 24, 24, 24, 24, 24, 24, 24, 24, 24, 24, 24, 24,\n\t\t24, 24, 24, 24, 24, 24, 24, 24, 24, 24, 24, 24, 24, 24, 24];\n",
    "/* jshint ignore:start */\n/*\n\nStackBlur - a fast almost Gaussian Blur For Canvas\n\nVersion:  0.5\nAuthor: Mario Klingemann\nContact:  mario@quasimondo.com\nWebsite: http://www.quasimondo.com/StackBlurForCanvas\nTwitter: @quasimondo\n\nIn case you find this class useful - especially in commercial projects -\nI am not totally unhappy for a small donation to my PayPal account\nmario@quasimondo.de\n\nOr support me on flattr:\nhttps://flattr.com/thing/72791/StackBlur-a-fast-almost-Gaussian-Blur-Effect-for-CanvasJavascript\n\nCopyright (c) 2010 Mario Klingemann\n\nPermission is hereby granted, free of charge, to any person\nobtaining a copy of this software and associated documentation\nfiles (the \"Software\"), to deal in the Software without\nrestriction, including without limitation the rights to use,\ncopy, modify, merge, publish, distribute, sublicense, and/or sell\ncopies of the Software, and to permit persons to whom the\nSoftware is furnished to do so, subject to the following\nconditions:\n\nThe above copyright notice and this permission notice shall be\nincluded in all copies or substantial portions of the Software.\n\nTHE SOFTWARE IS PROVIDED \"AS IS\", WITHOUT WARRANTY OF ANY KIND,\nEXPRESS OR IMPLIED, INCLUDING BUT NOT LIMITED TO THE WARRANTIES\nOF MERCHANTABILITY, FITNESS FOR A PARTICULAR PURPOSE AND\nNONINFRINGEMENT. IN NO EVENT SHALL THE AUTHORS OR COPYRIGHT\nHOLDERS BE LIABLE FOR ANY CLAIM, DAMAGES OR OTHER LIABILITY,\nWHETHER IN AN ACTION OF CONTRACT, TORT OR OTHERWISE, ARISING\nFROM, OUT OF OR IN CONNECTION WITH THE SOFTWARE OR THE USE OR\nOTHER DEALINGS IN THE SOFTWARE.\n*/\n\nconst mul_table = require(\"./mul_table\");\nconst shg_table = require(\"./shg_table\");\nconst BlurStack = require(\"./BlurStack\");\n\nmodule.exports = function(imageData, opts) {\n\tif ((typeof opts === \"object\") && opts.hasOwnProperty(\"radius\")) {\n\t\topts = opts.radius;\n\t}\n\tif ((typeof opts !== \"number\") || isNaN(opts) || (1 > opts)) {\n\t\t// no valid argument value do nothing\n\t\treturn imageData;\n\t}\n\tvar radius = opts | 0;\n\tvar pixels = imageData.data,\n\t\twidth = imageData.width,\n\t\theight = imageData.height;\n\n\tvar x, y, i, p, yp, yi, yw, r_sum, g_sum, b_sum,\n\t\tr_out_sum, g_out_sum, b_out_sum,\n\t\tr_in_sum, g_in_sum, b_in_sum,\n\t\tpr, pg, pb, rbs;\n\n\tvar div = radius + radius + 1;\n\tvar w4 = width << 2;\n\tvar widthMinus1 = width - 1;\n\tvar heightMinus1 = height - 1;\n\tvar radiusPlus1 = radius + 1;\n\tvar sumFactor = radiusPlus1 * (radiusPlus1 + 1) / 2;\n\n\tvar stackStart = new BlurStack();\n\tvar stack = stackStart;\n\tfor (i = 1; i < div; i++) {\n\t\tstack = stack.next = new BlurStack();\n\t\tif (i == radiusPlus1) var stackEnd = stack;\n\t}\n\tstack.next = stackStart;\n\tvar stackIn = null;\n\tvar stackOut = null;\n\n\tyw = yi = 0;\n\n\tvar mul_sum = mul_table[radius];\n\tvar shg_sum = shg_table[radius];\n\n\tfor (y = 0; y < height; y++) {\n\t\tr_in_sum = g_in_sum = b_in_sum = r_sum = g_sum = b_sum = 0;\n\n\t\tr_out_sum = radiusPlus1 * (pr = pixels[yi]);\n\t\tg_out_sum = radiusPlus1 * (pg = pixels[yi + 1]);\n\t\tb_out_sum = radiusPlus1 * (pb = pixels[yi + 2]);\n\n\t\tr_sum += sumFactor * pr;\n\t\tg_sum += sumFactor * pg;\n\t\tb_sum += sumFactor * pb;\n\n\t\tstack = stackStart;\n\n\t\tfor (i = 0; i < radiusPlus1; i++) {\n\t\t\tstack.r = pr;\n\t\t\tstack.g = pg;\n\t\t\tstack.b = pb;\n\t\t\tstack = stack.next;\n\t\t}\n\n\t\tfor (i = 1; i < radiusPlus1; i++) {\n\t\t\tp = yi + ((widthMinus1 < i ? widthMinus1 : i) << 2);\n\t\t\tr_sum += (stack.r = (pr = pixels[p])) * (rbs = radiusPlus1 - i);\n\t\t\tg_sum += (stack.g = (pg = pixels[p + 1])) * rbs;\n\t\t\tb_sum += (stack.b = (pb = pixels[p + 2])) * rbs;\n\n\t\t\tr_in_sum += pr;\n\t\t\tg_in_sum += pg;\n\t\t\tb_in_sum += pb;\n\n\t\t\tstack = stack.next;\n\t\t}\n\n\t\tstackIn = stackStart;\n\t\tstackOut = stackEnd;\n\t\tfor (x = 0; x < width; x++) {\n\t\t\tpixels[yi] = (r_sum * mul_sum) >> shg_sum;\n\t\t\tpixels[yi + 1] = (g_sum * mul_sum) >> shg_sum;\n\t\t\tpixels[yi + 2] = (b_sum * mul_sum) >> shg_sum;\n\n\t\t\tr_sum -= r_out_sum;\n\t\t\tg_sum -= g_out_sum;\n\t\t\tb_sum -= b_out_sum;\n\n\t\t\tr_out_sum -= stackIn.r;\n\t\t\tg_out_sum -= stackIn.g;\n\t\t\tb_out_sum -= stackIn.b;\n\n\t\t\tp = (yw + ((p = x + radius + 1) < widthMinus1 ? p : widthMinus1)) << 2;\n\n\t\t\tr_in_sum += (stackIn.r = pixels[p]);\n\t\t\tg_in_sum += (stackIn.g = pixels[p + 1]);\n\t\t\tb_in_sum += (stackIn.b = pixels[p + 2]);\n\n\t\t\tr_sum += r_in_sum;\n\t\t\tg_sum += g_in_sum;\n\t\t\tb_sum += b_in_sum;\n\n\t\t\tstackIn = stackIn.next;\n\n\t\t\tr_out_sum += (pr = stackOut.r);\n\t\t\tg_out_sum += (pg = stackOut.g);\n\t\t\tb_out_sum += (pb = stackOut.b);\n\n\t\t\tr_in_sum -= pr;\n\t\t\tg_in_sum -= pg;\n\t\t\tb_in_sum -= pb;\n\n\t\t\tstackOut = stackOut.next;\n\n\t\t\tyi += 4;\n\t\t}\n\t\tyw += width;\n\t}\n\n\tfor (x = 0; x < width; x++) {\n\t\tg_in_sum = b_in_sum = r_in_sum = g_sum = b_sum = r_sum = 0;\n\n\t\tyi = x << 2;\n\t\tr_out_sum = radiusPlus1 * (pr = pixels[yi]);\n\t\tg_out_sum = radiusPlus1 * (pg = pixels[yi + 1]);\n\t\tb_out_sum = radiusPlus1 * (pb = pixels[yi + 2]);\n\n\t\tr_sum += sumFactor * pr;\n\t\tg_sum += sumFactor * pg;\n\t\tb_sum += sumFactor * pb;\n\n\t\tstack = stackStart;\n\n\t\tfor (i = 0; i < radiusPlus1; i++) {\n\t\t\tstack.r = pr;\n\t\t\tstack.g = pg;\n\t\t\tstack.b = pb;\n\t\t\tstack = stack.next;\n\t\t}\n\n\t\typ = width;\n\n\t\tfor (i = 1; i <= radius; i++) {\n\t\t\tyi = (yp + x) << 2;\n\n\t\t\tr_sum += (stack.r = (pr = pixels[yi])) * (rbs = radiusPlus1 - i);\n\t\t\tg_sum += (stack.g = (pg = pixels[yi + 1])) * rbs;\n\t\t\tb_sum += (stack.b = (pb = pixels[yi + 2])) * rbs;\n\n\t\t\tr_in_sum += pr;\n\t\t\tg_in_sum += pg;\n\t\t\tb_in_sum += pb;\n\n\t\t\tstack = stack.next;\n\n\t\t\tif (i < heightMinus1) {\n\t\t\t\typ += width;\n\t\t\t}\n\t\t}\n\n\t\tyi = x;\n\t\tstackIn = stackStart;\n\t\tstackOut = stackEnd;\n\t\tfor (y = 0; y < height; y++) {\n\t\t\tp = yi << 2;\n\t\t\tpixels[p] = (r_sum * mul_sum) >> shg_sum;\n\t\t\tpixels[p + 1] = (g_sum * mul_sum) >> shg_sum;\n\t\t\tpixels[p + 2] = (b_sum * mul_sum) >> shg_sum;\n\n\t\t\tr_sum -= r_out_sum;\n\t\t\tg_sum -= g_out_sum;\n\t\t\tb_sum -= b_out_sum;\n\n\t\t\tr_out_sum -= stackIn.r;\n\t\t\tg_out_sum -= stackIn.g;\n\t\t\tb_out_sum -= stackIn.b;\n\n\t\t\tp = (x + (((p = y + radiusPlus1) < heightMinus1 ? p : heightMinus1) * width)) << 2;\n\n\t\t\tr_sum += (r_in_sum += (stackIn.r = pixels[p]));\n\t\t\tg_sum += (g_in_sum += (stackIn.g = pixels[p + 1]));\n\t\t\tb_sum += (b_in_sum += (stackIn.b = pixels[p + 2]));\n\n\t\t\tstackIn = stackIn.next;\n\n\t\t\tr_out_sum += (pr = stackOut.r);\n\t\t\tg_out_sum += (pg = stackOut.g);\n\t\t\tb_out_sum += (pb = stackOut.b);\n\n\t\t\tr_in_sum -= pr;\n\t\t\tg_in_sum -= pg;\n\t\t\tb_in_sum -= pb;\n\n\t\t\tstackOut = stackOut.next;\n\n\t\t\tyi += width;\n\t\t}\n\t}\n\treturn imageData;\n};\n\n/* jshint ignore:end */\n",
    "/**\n * @module utils/canvas/calcArcHConnector\n */\n\nmodule.exports = function(x1, y1, r1, x2, y2, r2, ro) {\n\tvar qx = x2 > x1 ? 1 : -1;\n\tvar qy = y2 > y1 ? 1 : -1;\n\tvar dy = Math.abs(y2 - y1);\n\tvar dx = Math.abs(x2 - x1);\n\tvar rr = r1 + r2;\n\tvar tx1, tx2, c, tx, ty;\n\n\tif (dy < 1) {\n\t\t// points are aligned horizontally, no arcs needed\n\t\ttx1 = 0;\n\t\ttx2 = dx\n\t\t// return [x1, x2];\n\t}\n\n\tif (dy >= rr && dx >= rr) {\n\t\t// arcs fit horizontally:\n\t\t// second circle center is r1+r2, tangent intersect at x=r1\n\t\tc = rr;\n\t\ttx1 = r1;\n\t\ttx2 = r1;\n\t} else {\n\t\t// arcs overlap horizontally:\n\t\t// find second circle center\n\t\tc = Math.sqrt(dy * r2 * 2 + dy * r1 * 2 - dy * dy);\n\n\t\t// circles tangent point\n\t\ttx = (c * r1) / rr;\n\t\tty = (dy * r1) / rr;\n\n\t\tif (r1 < ty || c > dx) {\n\t\t\treturn;\n\t\t}\n\n\t\t// tangent perpendicular slope\n\t\tvar slope = (rr - dy) / c;\n\t\t// tangent intersections\n\t\ttx1 = tx - (ty * slope);\n\t\ttx2 = (dy * slope) + tx1;\n\n\t\t/*\n\t\t// circle centers\n\t\tvar ccx1, ccy1, ccx2, ccy2;\n\t\tccx1 = 0;\n\t\tccy1 = r1;\n\t\tccx2 = c;\n\t\tccy2 = dy - r2;\n\t\t// tangent perpendicular slope\n\t\tvar slope = (ccy1 - ccy2) / (ccx2 - ccx1);\n\t\tvar xSec = tx - (ty * slope);\n\t\t// tangent intersections\n\t\ttx1 = xSec;\n\t\ttx2 = (dy * slope) + xSec;\n\t\t*/\n\t}\n\n\t// offset arcTo's in x-axis\n\tif (ro > 0) {\n\t\tif (ro > 1) {\n\t\t\tro = Math.min(dx - rr, ro);\n\t\t} else {\n\t\t\tro *= dx - rr;\n\t\t}\n\t\ttx1 += ro;\n\t\ttx2 += ro;\n\t}\n\n\treturn [tx1 * qx + x1, tx2 * qx + x1, tx1, tx2];\n};\n\n/*\nvar drawArcConnector = function(ctx, x1, y1, x2, y2, r) {\n\tvar dx, dy, hx, hy, gx, gy;\n\n\thx = 0;\n\thy = 0;\n\tgx = (x1 + x2) / 2;\n\tgy = (y1 + y2) / 2;\n\tdx = Math.abs(x1 - gx);\n\tdy = Math.abs(y1 - gy);\n\n\tif (dx < r && dy < r) {\n\t\tr = Math.min(dx * Math.SQRT1_2, dy * Math.SQRT1_2);\n\t} else {\n\t\tif (dx < r) {\n\t\t\thy = Math.acos(dx / r) * r * 0.5;\n\t\t\tif (y1 > y2) hy *= -1;\n\t\t}\n\t\tif (dy < r) {\n\t\t\thx = Math.acos(dy / r) * r * 0.5;\n\t\t\tif (x1 > x2) hx *= -1;\n\t\t}\n\t}\n\tctx.arcTo(gx - hx, y1, gx + hx, y2, r);\n\tctx.arcTo(gx + hx, y2, x2, y2, r);\n};\n\nvar drawArcConnector2 = function(ctx, x1, y1, x2, y2, r) {\n\tvar dx, dy, hx, hy, cx1, cx2;\n\n\thx = 0;\n\thy = 0;\n\tdx = Math.abs(x2 - x1) / 2;\n\tdy = Math.abs(y1 - y2) / 2;\n\n\tif (dx < r && dy < r) {\n\t\tr = Math.min(dx * Math.SQRT1_2, dy * Math.SQRT1_2);\n\t} else {\n\t\tif (dx < r) {\n\t\t\thy = Math.acos(dx / r) * r;\n\t\t}\n\t\tif (dy < r) {\n\t\t\thx = Math.acos(dy / r) * r;\n\t\t}\n\t}\n\tcx1 = x1 + dx;\n\tcx2 = x2 - (dx - hx / 2);\n\tctx.arcTo(cx1, y1, cx2, y2, r);\n\tctx.arcTo(cx2, y2, x2, y2, r);\n};\n\nvar drawArcConnector1 = function(ctx, x1, y1, x2, y2, r) {\n\tvar dx, dy, cx;\n\n\tdx = Math.abs(x2 - x1) / 2;\n\tdy = Math.abs(y1 - y2) / 2;\n\tr = Math.min(r, dy * Math.SQRT1_2);\n\tif (x1 < x2) {\n\t\tcx = x1 + dx + r;\n\t} else {\n\t\tcx = x2 - dx - r;\n\t}\n\t// cx = (x2 + x1) / 2;\n\t// cx += x1 < x2 ? r : -r;\n\n\tctx.arcTo(cx, y1, cx, y2, r);\n\tctx.arcTo(cx, y2, x2, y2, r);\n};\n*/\n",
    "/* global HTMLElement, CSSStyleDeclaration */\n\n// var parseSize = require(\"./parseSize\");\n\nvar CSS_BOX_PROPS = [\n\t\"boxSizing\", \"position\", \"objectFit\"\n];\nvar CSS_EDGE_PROPS = [\n\t\"marginTop\", \"marginBottom\", \"marginLeft\", \"marginRight\",\n\t\"borderTopWidth\", \"borderBottomWidth\", \"borderLeftWidth\", \"borderRightWidth\",\n\t\"paddingTop\", \"paddingBottom\", \"paddingLeft\", \"paddingRight\",\n];\nvar CSS_POS_PROPS = [\"top\", \"bottom\", \"left\", \"right\"];\nvar CSS_SIZE_PROPS = [\"width\", \"height\", \"minWidth\", \"minHeight\", \"maxWidth\", \"maxHeight\"];\nvar CSS_ALL_PROPS = CSS_EDGE_PROPS.concat(CSS_SIZE_PROPS, CSS_POS_PROPS);\n\n// var COMPUTED_PROPS = [\n// \t\"clientLeft\", \"clientTop\", \"clientWidth\", \"clientHeight\",\n// \t\"offsetLeft\", \"offsetTop\", \"offsetWidth\", \"offsetHeight\"\n// ];\n// var o = _.pick(element, function(val) {\n// \treturn /^(offset|client)(Left|Top|Width|Height)/.test(val);\n// });\n\nvar cssDimensionRE = /^(-?[\\d\\.]+)(px|em|rem)$/;\n// var cssDimRe = /^([-\\.0-9]+)([rem]+)$/;\n\nmodule.exports = function(s, m, includeSizePos) {\n\tif (s instanceof HTMLElement) {\n\t\ts = getComputedStyle(s);\n\t}\n\tif (DEBUG) {\n\t\tif (!(s instanceof CSSStyleDeclaration)) {\n\t\t\tthrow new Error(\"Not a CSSStyleDeclaration nor HTMLElement\");\n\t\t}\n\t}\n\tvar v, p, i, ii, emPx, remPx;\n\tm || (m = {});\n\n\temPx = m.fontSize = parseFloat(s.fontSize);\n\n\tfor (i = 0, ii = CSS_BOX_PROPS.length; i < ii; i++) {\n\t\tp = CSS_BOX_PROPS[i];\n\t\tif (p in s) {\n\t\t\tm[p] = s[p];\n\t\t}\n\t}\n\tvar cssProps = includeSizePos ? CSS_EDGE_PROPS : CSS_ALL_PROPS;\n\tfor (i = 0, ii = cssProps.length; i < ii; i++) {\n\t\tp = cssProps[i];\n\t\tm[\"_\" + p] = s[p];\n\t\tif (s[p] && (v = cssDimensionRE.exec(s[p]))) {\n\t\t\tif (v[2] === \"px\") {\n\t\t\t\tm[p] = parseFloat(v[1]);\n\t\t\t} else if (v[2] === \"em\") {\n\t\t\t\tm[p] = parseFloat(v[1]) * emPx;\n\t\t\t} else if (v[2] === \"rem\") {\n\t\t\t\tremPx || (remPx = parseFloat(getComputedStyle(document.documentElement).fontSize));\n\t\t\t\tm[p] = parseFloat(v[1]) * remPx;\n\t\t\t} else {\n\t\t\t\tconsole.warn(\"Ignoring value\", p, v[1], v[2]);\n\t\t\t\tm[p] = null;\n\t\t\t}\n\t\t} // else {\n\t\t//\tconsole.warn(\"Ignoring unitless value\", p, v);\n\t\t//}\n\t}\n\treturn m;\n};\n",
    "/* easeInQuad */\nmodule.exports = function(x, t, b, c, d) {\n\treturn c * (t /= d) * t + b;\n};\n",
    "/* easeOutQuad */\nmodule.exports = function(t, b, c, d) {\n\treturn -c * (t /= d) * (t - 2) + b;\n};\n",
    "/**\n * @param {number} i current iteration\n * @param {number} s start value\n * @param {number} d change in value\n * @param {number} t total iterations\n * @return {number}\n */\nvar linear = function(i, s, d, t) {\n\treturn d * i / t + s;\n};\n\nmodule.exports = linear;\n",
    "/* https://html.spec.whatwg.org/multipage/media.html#event-media-canplay\n */\nmodule.exports = [\n\t// networkState\n\t\"loadstart\",\n\t\"progress\",\n\t\"suspend\",\n\t\"abort\",\n\t\"error\",\n\t\"emptied\",\n\t\"stalled\",\n\t// readyState\n\t\"loadedmetadata\",\n\t\"loadeddata\",\n\t\"canplay\",\n\t\"canplaythrough\",\n\t\"playing\",\n\t\"waiting\",\n\t//\n\t\"seeking\", // seeking changed to true\n\t\"seeked\", // seeking changed to false\n\t\"ended\", // ended is true\n\t//\n\t\"durationchange\", // duration updated\n\t\"timeupdate\", // currentTime updated\n\t\"play\", // paused is false\n\t\"pause\", // paused is false\n\t\"paused\", // ??\n\t\"ratechange\",\n\t//\n\t\"resize\",\n\t\"volumechange\",\n];\n",
    "/**\n * @module app/view/component/GraphView\n */module.exports = function(rect, dx, dy) {\n\tif (arguments.length == 2) {\n\t\tdy = dx;\n\t}\n\tvar r = {\n\t\twidth: rect.width + dx * 2,\n\t\theight: rect.height + dy * 2\n\t};\n\tif (r.width >= 0) {\n\t\tr.left = rect.left - dx;\n\t\tr.right = r.left + r.width;\n\t\tr.x = r.left;\n\t} else {\n\t\tr.right = rect.right + dx;\n\t\tr.left = rect.right - r.width;\n\t\tr.y = r.right;\n\t}\n\tif (r.height >= 0) {\n\t\tr.top = rect.top - dy;\n\t\tr.bottom = r.top + r.height;\n\t\tr.y = r.top;\n\t} else {\n\t\tr.bottom = rect.bottom + dy;\n\t\tr.top = rect.bottom - r.height;\n\t\tr.y = r.bottom;\n\t}\n\n\treturn r;\n};\n",
    "/** @type {Array} lowercase prefixes */\nvar lcPrefixes = [\"\"].concat(require(\"./prefixes\"));\n\n/** @type {Array} capitalized prefixes */\nvar ucPrefixes = lcPrefixes.map(function(s) {\n\treturn (s === \"\") ? s : s.charAt(0).toUpperCase() + s.substr(1);\n});\n\n/** @type {Object} specific event solvers */\nvar _solvers = {};\n\n/** @type {Object} cached values */\nvar _cache = {};\n\n/**\n * @param {String} name Unprefixed event name\n * @param {?Object} obj Prefix test target\n * @param {?String} testProp Proxy property to test prefixes\n * @return {String|null}\n */\nvar _prefixedEvent = function(name, obj, testProp) {\n\tvar prefixes = /^[A-Z]/.test(name) ? ucPrefixes : lcPrefixes;\n\tobj || (obj = document);\n\tfor (var i = 0; i < prefixes.length; i++) {\n\t\tif (testProp) {\n\t\t\tif ((prefixes[i] + testProp) in obj) {\n\t\t\t\treturn prefixes[i] + name;\n\t\t\t}\n\t\t}\n\t\tif ((\"on\" + prefixes[i] + name) in obj) {\n\t\t\treturn prefixes[i] + name;\n\t\t}\n\t}\n\treturn null;\n};\n\n// transitionend\n_solvers[\"transitionend\"] = function() {\n\tvar prop, style = document.body.style,\n\t\tmap = {\n\t\t\t\"transition\": \"transitionend\",\n\t\t\t\"WebkitTransition\": \"webkitTransitionEnd\",\n\t\t\t\"MozTransition\": \"transitionend\",\n\t\t\t// \"msTransition\" : \"MSTransitionEnd\",\n\t\t\t\"OTransition\": \"oTransitionEnd\"\n\t\t};\n\tfor (prop in map) {\n\t\tif (prop in style) {\n\t\t\treturn map[prop];\n\t\t}\n\t}\n\treturn null;\n};\n\n/**\n * get the prefixed property\n * @param {String} property name\n * @param {Object} look-up object\n * @returns {String|null} prefixed\n */\nmodule.exports = function(evName) {\n\tif (!_cache.hasOwnProperty(evName)) {\n\t\t_cache[evName] = _solvers.hasOwnProperty(evName) ? _solvers[evName]() : _prefixedEvent.apply(null, arguments);\n\t\tif (_cache[evName] === null) {\n\t\t\tconsole.warn(\"Event '%s' not found\", evName);\n\t\t} else {\n\t\t\tconsole.log(\"Event '%s' found as '%s'\", evName, _cache[evName]);\n\t\t}\n\t}\n\treturn _cache[evName];\n\t// return _cache[evName] || (_cache[evName] = _solvers[evName]? _solvers[evName].call() : _prefixedProperty.apply(null, arguments));\n};\n\n/*\nvar defaultTest = function(name, obj) {\n\tvar prefixes = /^[A-Z]/.test(name)? ucPrefixes : lcPrefixes;\n\tfor (var i = 0; i < prefixes.length; i++) {\n\t\tif ((\"on\" + prefixes[i] + name) in obj) {\n\t\t\tconsole.log(\"Event '%s' found as '%s'\", name, prefixes[i] + name);\n\t\t\treturn prefixes[i] + name;\n\t\t}\n\t}\n\treturn null;\n};\n\nvar proxyTest = function(name, obj, testProp) {\n\tvar prefixes = /^[A-Z]/.test(name)? ucPrefixes : lcPrefixes;\n\tfor (var i = 0; i < prefixes.length; i++) {\n\t\tif ((prefixes[i] + testProp) in obj) {\n\t\t\tconsole.log(\"Event %s inferred as '%s' from property '%s'\", name, prefixes[i] + name, testProp);\n\t\t\treturn prefixes[i] + name;\n\t\t}\n\t}\n\treturn null;\n};\n*/\n",
    "/**\n/* @module utils/prefixedProperty\n/*/\n\n/** @type {module:utils/prefixes} */\nconst prefixes = require(\"./prefixes\");\n/** @type {Number} prefix count */\nvar _prefixNum = prefixes.length;\n/** @type {Array} cached values */\nvar _cache = {};\n\nvar _prefixedProperty = function(prop, obj) {\n\tvar prefixedProp, camelProp;\n\n\tif (prop in obj) {\n\t\tconsole.log(\"Property '%s' found unprefixed\", prop);\n\t\treturn prop;\n\t}\n\tcamelProp = prop[0].toUpperCase() + prop.slice(1);\n\tfor (var i = 0; i < _prefixNum; i++) {\n\t\tprefixedProp = prefixes[i] + camelProp;\n\t\tif (prefixedProp in obj) {\n\t\t\tconsole.log(\"Property '%s' found as '%s'\", prop, prefixedProp);\n\t\t\treturn prefixedProp;\n\t\t}\n\t}\n\tconsole.error(\"Property '%s' not found\", prop);\n\treturn null;\n};\n\n/**\n * get the prefixed property\n * @param {String} property name\n * @param {Object} look-up object\n * @returns {String|null} prefixed\n */\nmodule.exports = function(prop, obj) {\n\treturn _cache[prop] || (_cache[prop] = _prefixedProperty(prop, obj || document.body.style));\n};\n",
    "/**\n/* @module utils/prefixedStyleName\n/*/\n\n/** @type {module:utils/prefixes} */\nconst prefixes = require(\"./prefixes\"); //.map(function(prefix) { return \"-\" + prefix + \"-\"; });\n/** @type {Number} prefix count */\nvar _prefixNum = prefixes.length;\n/** @type {Array} cached values */\nvar _cache = {};\n\nvar _prefixedStyleName = function(style, styleObj) {\n\tvar prefixedStyle;\n\n\tif (style in styleObj) {\n\t\tconsole.log(\"CSS style '%s' found unprefixed\", style);\n\t\treturn style;\n\t}\n\tfor (var i = 0; i < _prefixNum; i++) {\n\t\tprefixedStyle = \"-\" + prefixes[i] + \"-\" + style;\n\t\t// prefixedStyle = prefixes[i] + style;\n\t\tif (prefixedStyle in styleObj) {\n\t\t\tconsole.log(\"CSS style '%s' found as '%s'\", style, prefixedStyle);\n\t\t\treturn prefixedStyle;\n\t\t}\n\t}\n\tconsole.warn(\"CSS style '%s' not found\", style);\n\treturn null;\n};\n\n/**\n * get the prefixed style name\n * @param {String} style name\n * @param {Object} look-up style object\n * @returns {String|Undefined} prefixed\n */\nmodule.exports = function(style, styleObj) {\n\t// return _cache[style] || (_cache[style] = _prefixedStyleName_reverse(style, styleObj || document.body.style));\n\treturn _cache[style] || (_cache[style] = _prefixedStyleName(style, styleObj || document.body.style));\n};\n\n// /** @type {module:utils/strings/camelToDashed} */\n// var camelToDashed = require(\"./strings/camelToDashed\");\n// /** @type {module:utils/prefixedProperty} */\n// var prefixedProperty = require(\"./prefixedProperty\");\n// /** @type {module:utils/strings/dashedToCamel} */\n// var dashedToCamel = require(\"./strings/dashedToCamel\");\n//\n// var _prefixedStyleName_reverse = function (style, styleObj) {\n// \tvar camelProp, prefixedProp;\n// \tcamelProp = dashedToCamel(style);\n// \tprefixedProp = prefixedProperty(camelProp, styleObj);\n// \treturn prefixedProp? (camelProp === prefixedProp? \"\" : \"-\") + camelToDashed(prefixedProp) : null;\n// };\n",
    "module.exports = [\"webkit\", \"moz\", \"ms\", \"o\"];\n",
    "module.exports = function(pp, reason) {\n\tif (pp.length > 0) {\n\t\tpp.forEach(function(p, i, a) {\n\t\t\tp.reject(reason);\n\t\t\ta[i] = null;\n\t\t});\n\t\tpp.length = 0;\n\t}\n\treturn pp;\n};\n",
    "module.exports = function(pp, result) {\n\tif (pp.length != 0) {\n\t\tpp.forEach(function(p, i, a) {\n\t\t\tp.resolve(result);\n\t\t\ta[i] = null;\n\t\t});\n\t\tpp.length = 0;\n\t}\n\treturn pp;\n};\n",
    "module.exports = function(str) {\n\treturn str.replace(/[A-Z]/g, function($0) {\n\t\treturn \"-\" + $0.toLowerCase();\n\t});\n};\n",
    "module.exports = function(s) {\n\treturn s.replace(/<[^>]+>/g, \"\");\n};\n",
    "/** @type {module:hammerjs} */\nconst Hammer = require(\"hammerjs\");\n\n// /**\n//  * get a usable string, used as event postfix\n//  * @param {Const} state\n//  * @returns {String} state\n//  */\n// function stateStr(state) {\n// \tif (state & Hammer.STATE_CANCELLED) {\n// \t\treturn \"cancel\";\n// \t} else if (state & Hammer.STATE_ENDED) {\n// \t\treturn \"end\";\n// \t} else if (state & Hammer.STATE_CHANGED) {\n// \t\treturn \"move\";\n// \t} else if (state & Hammer.STATE_BEGAN) {\n// \t\treturn \"start\";\n// \t}\n// \treturn \"\";\n// }\n\n/**\n * direction cons to string\n * @param {Const} direction\n * @returns {String}\n */\nfunction dirStr(direction) {\n\tif (direction == Hammer.DIRECTION_DOWN) {\n\t\treturn \"down\";\n\t} else if (direction == Hammer.DIRECTION_UP) {\n\t\treturn \"up\";\n\t} else if (direction == Hammer.DIRECTION_LEFT) {\n\t\treturn \"left\";\n\t} else if (direction == Hammer.DIRECTION_RIGHT) {\n\t\treturn \"right\";\n\t}\n\treturn \"\";\n}\n\n///**\n// * Pan\n// * Recognized when the pointer is down and moved in the allowed direction.\n// * @constructor\n// * @extends AttrRecognizer\n// */\n//function PanRecognizer() {\n//\tHammer.AttrRecognizer.apply(this, arguments);\n//\n//\tthis.pX = null;\n//\tthis.pY = null;\n//}\n//\n//inherit(PanRecognizer, Hammer.AttrRecognizer, {\n//\t/**\n//\t/* @namespace\n//\t/* @memberof PanRecognizer\n//\t/*/\n//\tdefaults: {\n//\t\tevent: \"pan\",\n//\t\tthreshold: 10,\n//\t\tpointers: 1,\n//\t\tdirection: DIRECTION_ALL\n//\t},\n//\n//\tgetTouchAction: function() {\n//\t\tvar direction = this.options.direction;\n//\t\tvar actions = [];\n//\t\tif (direction & DIRECTION_HORIZONTAL) {\n//\t\t\tactions.push(TOUCH_ACTION_PAN_Y);\n//\t\t}\n//\t\tif (direction & DIRECTION_VERTICAL) {\n//\t\t\tactions.push(TOUCH_ACTION_PAN_X);\n//\t\t}\n//\t\treturn actions;\n//\t},\n//\n//\tdirectionTest: function(input) {\n//\t\tvar options = this.options;\n//\t\tvar hasMoved = true;\n//\t\tvar distance = input.distance;\n//\t\tvar direction = input.direction;\n//\t\tvar x = input.deltaX;\n//\t\tvar y = input.deltaY;\n//\n//\t\t// lock to axis?\n//\t\tif (!(direction & options.direction)) {\n//\t\t\tif (options.direction & DIRECTION_HORIZONTAL) {\n//\t\t\t\tdirection = (x === 0) ? DIRECTION_NONE : (x < 0) ? DIRECTION_LEFT : DIRECTION_RIGHT;\n//\t\t\t\thasMoved = x != this.pX;\n//\t\t\t\tdistance = Math.abs(input.deltaX);\n//\t\t\t} else {\n//\t\t\t\tdirection = (y === 0) ? DIRECTION_NONE : (y < 0) ? DIRECTION_UP : DIRECTION_DOWN;\n//\t\t\t\thasMoved = y != this.pY;\n//\t\t\t\tdistance = Math.abs(input.deltaY);\n//\t\t\t}\n//\t\t}\n//\t\tinput.direction = direction;\n//\t\treturn hasMoved && distance > options.threshold && direction & options.direction;\n//\t},\n//\n//\tattrTest: function(input) {\n//\t\treturn AttrRecognizer.prototype.attrTest.call(this, input) &&\n//\t\t\t(this.state & STATE_BEGAN || (!(this.state & STATE_BEGAN) && this.directionTest(input)));\n//\t},\n//\n//\temit: function(input) {\n//\t\tthis.pX = input.deltaX;\n//\t\tthis.pY = input.deltaY;\n//\n//\t\tvar direction = dirStr(input.direction);\n//\t\tif (direction) {\n//\t\t\tthis.manager.emit(this.options.event + direction, input);\n//\t\t}\n//\n//\t\tthis._super.emit.call(this, input);\n//\t}\n//});\n\n/**\n * SmoothPan\n * @constructor\n * @extends Hammer.Pan\n */\nfunction SmoothPan() {\n\tvar ret = Hammer.Pan.apply(this, arguments);\n\tthis.thresholdOffsetX = null;\n\tthis.thresholdOffsetY = null;\n\tthis.thresholdOffset = null;\n\treturn ret;\n}\n\nHammer.inherit(SmoothPan, Hammer.Pan, {\n\temit: function(input) {\n\t\t// Inheritance breaks, so this code is taken from PanRecognizer.emit\n\t\t//\tthis._super.emit.call(this, input); // Triggers infinite recursion\n\t\t//\tHammer.Pan.prototype.emit.apply(this, arguments); // This breaks too\n\n\t\tvar threshold = this.options.threshold;\n\t\tvar direction = input.direction;\n\n\t\tif (this.state == Hammer.STATE_BEGAN) {\n\t\t\tthis.thresholdOffsetX = (direction & Hammer.DIRECTION_HORIZONTAL) ? ((direction & Hammer.DIRECTION_LEFT) ? threshold : -threshold) : 0;\n\t\t\tthis.thresholdOffsetY = (direction & Hammer.DIRECTION_VERTICAL) ? ((direction & Hammer.DIRECTION_UP) ? threshold : -threshold) : 0;\n\t\t\t// this.thresholdOffset = (direction & Hammer.DIRECTION_HORIZONTAL)? input.thresholdOffsetX : input.thresholdOffsetY;\n\t\t\t// console.log(\"RECOGNIZER STATE\", dirStr(direction), stateStr(this.state), this.thresholdOffsetX);\n\t\t}\n\t\tinput.thresholdOffsetX = this.thresholdOffsetX;\n\t\tinput.thresholdOffsetY = this.thresholdOffsetY;\n\t\tinput.thresholdDeltaX = input.deltaX + this.thresholdOffsetX;\n\t\tinput.thresholdDeltaY = input.deltaY + this.thresholdOffsetY;\n\n\t\tthis.pX = input.deltaX;\n\t\tthis.pY = input.deltaY;\n\n\t\tdirection = dirStr(direction);\n\t\tif (direction) {\n\t\t\tthis.manager.emit(this.options.event + direction, input);\n\t\t}\n\t\treturn Hammer.Recognizer.prototype.emit.apply(this, arguments);\n\t}\n});\n\nmodule.exports = SmoothPan;\n",
    "module.exports={\n\t\"video_crop_px\": \"0\",\n\t\"transform_type\": \"3d\",\n\t\"transitions\": {\n\t\t\"ease\": \"ease-in-out\",\n\t\t\"duration_ms\": \"350\",\n\t\t\"delay_interval_ms\": \"34\",\n\t\t\"min_delay_ms\": \"34\"\n\t},\n\t\"breakpoints\": {\n\t\t\"landscape\": \"'(orientation: landscape)'\",\n\t\t\"portrait\": \"'(orientation: portrait)'\",\n\t\t\"xsmall-stretch\": \"'not screen and (min-width: 460px), not screen and (min-height: 420px)'\",\n\t\t\"small-stretch\": \"'not screen and (min-width: 704px), not screen and (min-height: 540px)'\",\n\t\t\"default\":\"'only screen and (min-width: 704px) and (min-height: 540px)'\",\n\t\t\"medium-wide\": \"'only screen and (min-width: 1024px) and (max-width: 1223px) and (min-height: 420px)'\",\n\t\t\"medium-wide-stretch\": \"'only screen and (min-width: 1224px) and (min-height: 420px)'\"\n\t},\n\t\"default_colors\": {\n\t\t\"color\": \"hsl(47, 5%, 15%)\",\n\t\t\"background-color\": \"hsl(47, 5%, 95%)\",\n\t\t\"link-color\": \"hsl(10, 80%, 50%)\"\n\t},\n\t\"temp\": {\n\t\t\"collapse_offset\": \"360\"\n\t},\n\t\"_ignore\": {\n\t\t\"transitions\": {\n\t\t\t\"ease\": \"cubic-bezier(0.42, 0.0, 0.58, 1.0)\",\n\t\t\t\"duration_ms\": \"400\",\n\t\t\t\"delay_interval_ms\": \"134\",\n\t\t\t\"min_delay_ms\": \"34\"\n\t\t},\n\t\t\"default_colors\": {\n\t\t\t\"--link-color\": \"hsl(10, 80%, 50%)\",\n\t\t\t\"--alt-background-color\": \"unset\"\n\t\t},\n\t\t\"units\": {\n\t\t\t\"hu_px\": \"20\",\n\t\t\t\"vu_px\": \"12\"\n\t\t},\n\t\t\"breakpoints\": {\n\t\t\t\"medium-wide-stretch\": \"'only screen and (min-width: 1024px) and (min-height: 420px)'\",\n\t\t\t\"large-wide\": \"'only screen and (min-width: 1824px) and (min-height: 1024px)'\",\n\t\t\t\"mobile\": \"'not screen and (min-width: 704px), not screen and (min-height: 540px)'\",\n\t\t\t\"unsupported\": \"'not screen and (min-width: 704px)'\",\n\t\t\t\"unquoted\": \"only screen and (min-width: 1824px)\",\n\t\t\t\"unquoted_neg\": \"not screen and (min-width: 704px)\",\n\t\t\t\"quoted_combined\": \"'not screen and (min-width: 704px), not screen and (min-height: 540px)'\",\n\t\t\t\"array\": [\n\t\t\t\t\"only screen and (min-width: 704px)\",\n\t\t\t\t\"not screen and (min-width: 704px)\",\n\t\t\t\t\"not screen and (min-height: 540px)\"\n\t\t\t]\n\t\t}\n\t}\n}\n"
  ]
}